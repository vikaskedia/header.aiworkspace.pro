"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c="aiworkspace.pro";function a(o){return o==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(o)}function u(o){return o===c||o.endsWith(`.${c}`)}function n(o){return document.cookie.split(";").map(s=>s.trim()).filter(s=>o.some(g=>s.startsWith(g+"=")))}function S(o,t,e=60*60*24*365){const s=location.hostname;if(a(s)){document.cookie=`${o}=${encodeURIComponent(t)}; Path=/; Max-Age=${e}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:s,name:o,valuePreview:t.slice(0,20)+"..."}),console.log("[auth][cookie][after]",n([o]));return}document.cookie=`${o}=${encodeURIComponent(t)}; Domain=.${c}; Path=/; Max-Age=${e}; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:s,apex:c,name:o,valuePreview:t.slice(0,20)+"..."}),console.log("[auth][cookie][after]",n([o]))}function i(o){const t=new RegExp("(?:^|; )"+o.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),e=document.cookie.match(t);return e?decodeURIComponent(e[1]):null}function I(o){const t=location.hostname;if(a(t)){document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:t,name:o});return}document.cookie=`${o}=; Domain=.${c}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:t,apex:c,name:o}),console.log("[auth][cookie][after]",n([o]))}function d(o){const t=location.hostname;if(a(t)){console.log("[auth][cookie][promote] skip (local host)",t);return}if(!u(t)){console.log("[auth][cookie][promote] skip (not under apex)",{host:t,apex:c});return}console.log("[auth][cookie][promote] start",{host:t,apex:c,names:o}),o.forEach(e=>{const s=i(e);s?S(e,s,60*60*24*365):console.log("[auth][cookie][promote] missing",e)}),console.log("[auth][cookie][promote] done",n(o))}function p(){return`${window.location.origin}/auth/callback`}function k(){try{const o=new URLSearchParams(location.search),t=["redirect","redirect_to","returnTo","next"].find(s=>o.get(s));let e=t?o.get(t):"";if(console.log("[getPostLoginBase] URL params:",Object.fromEntries(o)),console.log("[getPostLoginBase] Found param key:",t),console.log("[getPostLoginBase] Candidate from params:",e),e||(e=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||"",console.log("[getPostLoginBase] Candidate from storage:",e)),e||(e={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/",console.log("[getPostLoginBase] Using default:",e)),e.startsWith("http"))try{const s=new URL(e);return u(s.hostname)||a(s.hostname)?(console.log("[getPostLoginBase] Returning absolute URL:",e),e):(console.log("[getPostLoginBase] Invalid hostname, returning /"),"/")}catch{return console.log("[getPostLoginBase] Invalid URL, returning /"),"/"}return e.startsWith("/")||(e="/"+e),console.log("[getPostLoginBase] Final candidate:",e),e}catch(o){return console.log("[getPostLoginBase] Error:",o),"/"}}const h="sb-access-token",m="sb-refresh-token",r="sb-access-token",l="sb-refresh-token";function E(){try{const o=i(h),t=i(m);o&&localStorage.setItem(r,o),t&&localStorage.setItem(l,t),console.log("[auth][cookie->ls] sync",{hasAccess:!!o,hasRefresh:!!t})}catch(o){console.log("[auth][cookie->ls] error",o)}}function L(){try{localStorage.removeItem(r),localStorage.removeItem(l),console.log("[auth][cookie->ls] cleared localStorage")}catch(o){console.log("[auth][cookie->ls] clear error",o)}}exports.ACCESS_COOKIE=h;exports.LS_ACCESS_KEY=r;exports.LS_REFRESH_KEY=l;exports.REFRESH_COOKIE=m;exports.buildOAuthRedirectUrl=p;exports.clearLocalStorageTokens=L;exports.clearSessionCookie=I;exports.ensureCrossSubdomainCookies=d;exports.getCookie=i;exports.getPostLoginBase=k;exports.setSessionCookie=S;exports.syncCookiesToLocalStorage=E;
