"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c="aiworkspace.pro";function h(o){return o==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(o)}function m(o){return o===c||o.endsWith(`.${c}`)}function g(o){return document.cookie.split(";").map(a=>a.trim()).filter(a=>o.some(e=>a.startsWith(e+"=")))}function u(o,t,s=60*60*24*365){const a=location.hostname;if(h(a)){document.cookie=`${o}=${encodeURIComponent(t)}; Path=/; Max-Age=${s}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:a,name:o,valuePreview:t.slice(0,20)+"..."}),console.log("[auth][cookie][after]",g([o]));return}document.cookie=`${o}=${encodeURIComponent(t)}; Domain=.${c}; Path=/; Max-Age=${s}; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:a,apex:c,name:o,valuePreview:t.slice(0,20)+"..."}),console.log("[auth][cookie][after]",g([o]))}function r(o){const t=new RegExp("(?:^|; )"+o.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),s=document.cookie.match(t);return s?decodeURIComponent(s[1]):null}function E(o){const t=location.hostname;if(h(t)){document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:t,name:o});return}document.cookie=`${o}=; Domain=.${c}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:t,apex:c,name:o}),console.log("[auth][cookie][after]",g([o]))}function k(o){const t=location.hostname;if(h(t)){console.log("[auth][cookie][promote] skip (local host)",t);return}if(!m(t)){console.log("[auth][cookie][promote] skip (not under apex)",{host:t,apex:c});return}console.log("[auth][cookie][promote] start",{host:t,apex:c,names:o});const s=new Map;o.forEach(a=>{const e=a===l?S:f,n=localStorage.getItem(e);n&&(s.set(a,n),console.log("[auth][cookie][promote] found in localStorage",a))}),o.forEach(a=>{let e=r(a);!e&&s.has(a)&&(e=s.get(a),console.log("[auth][cookie][promote] using localStorage backup for",a)),e?u(a,e,60*60*24*365):console.log("[auth][cookie][promote] missing",a)}),console.log("[auth][cookie][promote] done",g(o))}function L(){return`${window.location.origin}/auth/callback`}function p(){try{const o=new URLSearchParams(location.search),t=new URLSearchParams(location.hash.replace("#","")),s=["redirect","redirect_to","returnTo","next","redirect_origin"].find(n=>o.get(n)),a=["redirect","redirect_to","returnTo","next","redirect_origin"].find(n=>t.get(n));let e=s?o.get(s):a?t.get(a):"";if(console.log("[getPostLoginBase] Search params:",Object.fromEntries(o)),console.log("[getPostLoginBase] Hash params:",Object.fromEntries(t)),console.log("[getPostLoginBase] Found search param key:",s),console.log("[getPostLoginBase] Found hash param key:",a),console.log("[getPostLoginBase] Candidate from params:",e),!e){const n=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||"";if(console.log("[getPostLoginBase] Stored URL from storage:",n),n.startsWith("http"))try{const i=new URL(n);e=i.pathname+i.search+i.hash,console.log("[getPostLoginBase] Extracted path from stored URL:",e)}catch(i){console.log("[getPostLoginBase] Error parsing stored URL:",i),e=n}else e=n;console.log("[getPostLoginBase] Final candidate from storage:",e)}if(e||(e={VITE_SUPABASE_URL:void 0,VITE_SUPABASE_ANON_KEY:void 0,VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/",console.log("[getPostLoginBase] Using default:",e)),e.startsWith("http"))try{const n=new URL(e);return m(n.hostname)||h(n.hostname)?(console.log("[getPostLoginBase] Returning absolute URL:",e),e):(console.log("[getPostLoginBase] Invalid hostname, returning /"),"/")}catch{return console.log("[getPostLoginBase] Invalid URL, returning /"),"/"}return e.startsWith("/")||(e="/"+e),console.log("[getPostLoginBase] Final candidate:",e),e}catch(o){return console.log("[getPostLoginBase] Error:",o),"/"}}const l="sb-access-token",d="sb-refresh-token",S="sb-access-token",f="sb-refresh-token";function P(){try{const o=r(l),t=r(d);o&&localStorage.setItem(S,o),t&&localStorage.setItem(f,t),console.log("[auth][cookie->ls] sync",{hasAccess:!!o,hasRefresh:!!t})}catch(o){console.log("[auth][cookie->ls] error",o)}}function _(){try{localStorage.removeItem(S),localStorage.removeItem(f),console.log("[auth][cookie->ls] cleared localStorage")}catch(o){console.log("[auth][cookie->ls] clear error",o)}}if(typeof window<"u")try{const o={ensureCrossSubdomainCookies:k,ACCESS_COOKIE:l,REFRESH_COOKIE:d,setSessionCookie:u,getCookie:r,clearSessionCookie:E,syncCookiesToLocalStorage:P,clearLocalStorageTokens:_,buildOAuthRedirectUrl:L,getPostLoginBase:p};window.authRedirectGlobal=o,window.ensureCrossSubdomainCookies=k,window.ACCESS_COOKIE=l,window.REFRESH_COOKIE=d,window.setSessionCookie=u,window.getCookie=r,window.clearSessionCookie=E,console.log("[auth][authRedirect] Functions made available globally for fallback access")}catch(o){console.warn("[auth][authRedirect] Failed to assign functions globally:",o)}exports.ACCESS_COOKIE=l;exports.LS_ACCESS_KEY=S;exports.LS_REFRESH_KEY=f;exports.REFRESH_COOKIE=d;exports.buildOAuthRedirectUrl=L;exports.clearLocalStorageTokens=_;exports.clearSessionCookie=E;exports.ensureCrossSubdomainCookies=k;exports.getCookie=r;exports.getPostLoginBase=p;exports.setSessionCookie=u;exports.syncCookiesToLocalStorage=P;
