"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n="aiworkspace.pro";function g(o){return o==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(o)}function p(o){return o===n||o.endsWith(`.${n}`)}function l(o){return document.cookie.split(";").map(s=>s.trim()).filter(s=>o.some(e=>s.startsWith(e+"=")))}function d(o,t,a=60*60*24*365){const s=location.hostname;if(g(s)){document.cookie=`${o}=${encodeURIComponent(t)}; Path=/; Max-Age=${a}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:s,name:o,valuePreview:t.slice(0,20)+"..."}),console.log("[auth][cookie][after]",l([o]));return}document.cookie=`${o}=${encodeURIComponent(t)}; Domain=.${n}; Path=/; Max-Age=${a}; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:s,apex:n,name:o,valuePreview:t.slice(0,20)+"..."}),console.log("[auth][cookie][after]",l([o]))}function r(o){const t=new RegExp("(?:^|; )"+o.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),a=document.cookie.match(t);return a?decodeURIComponent(a[1]):null}function k(o){const t=location.hostname;if(g(t)){document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:t,name:o});return}document.cookie=`${o}=; Domain=.${n}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:t,apex:n,name:o}),console.log("[auth][cookie][after]",l([o]))}function I(o){const t=location.hostname;if(g(t)){console.log("[auth][cookie][promote] skip (local host)",t);return}if(!p(t)){console.log("[auth][cookie][promote] skip (not under apex)",{host:t,apex:n});return}console.log("[auth][cookie][promote] start",{host:t,apex:n,names:o});const a=new Map;o.forEach(s=>{const e=s===u?h:S,c=localStorage.getItem(e);c&&(a.set(s,c),console.log("[auth][cookie][promote] found in localStorage",s))}),o.forEach(s=>{let e=r(s);!e&&a.has(s)&&(e=a.get(s),console.log("[auth][cookie][promote] using localStorage backup for",s)),e?d(s,e,60*60*24*365):console.log("[auth][cookie][promote] missing",s)}),console.log("[auth][cookie][promote] done",l(o))}function E(){return`${window.location.origin}/auth/callback`}function f(){try{const o=new URLSearchParams(location.search),t=new URLSearchParams(location.hash.replace("#","")),a=["redirect","redirect_to","returnTo","next","redirect_origin"].find(c=>o.get(c)),s=["redirect","redirect_to","returnTo","next","redirect_origin"].find(c=>t.get(c));let e=a?o.get(a):s?t.get(s):"";if(console.log("[getPostLoginBase] Search params:",Object.fromEntries(o)),console.log("[getPostLoginBase] Hash params:",Object.fromEntries(t)),console.log("[getPostLoginBase] Found search param key:",a),console.log("[getPostLoginBase] Found hash param key:",s),console.log("[getPostLoginBase] Candidate from params:",e),!e){const c=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||"";if(console.log("[getPostLoginBase] Stored URL from storage:",c),c.startsWith("http"))try{const i=new URL(c);e=i.pathname+i.search+i.hash,console.log("[getPostLoginBase] Extracted path from stored URL:",e)}catch(i){console.log("[getPostLoginBase] Error parsing stored URL:",i),e=c}else e=c;console.log("[getPostLoginBase] Final candidate from storage:",e)}if(e||(e={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/",console.log("[getPostLoginBase] Using default:",e)),e.startsWith("http"))try{const c=new URL(e);return p(c.hostname)||g(c.hostname)?(console.log("[getPostLoginBase] Returning absolute URL:",e),e):(console.log("[getPostLoginBase] Invalid hostname, returning /"),"/")}catch{return console.log("[getPostLoginBase] Invalid URL, returning /"),"/"}return e.startsWith("/")||(e="/"+e),console.log("[getPostLoginBase] Final candidate:",e),e}catch(o){return console.log("[getPostLoginBase] Error:",o),"/"}}const u="sb-access-token",m="sb-refresh-token",h="sb-access-token",S="sb-refresh-token";function L(){try{const o=r(u),t=r(m);o&&localStorage.setItem(h,o),t&&localStorage.setItem(S,t),console.log("[auth][cookie->ls] sync",{hasAccess:!!o,hasRefresh:!!t})}catch(o){console.log("[auth][cookie->ls] error",o)}}function C(){try{localStorage.removeItem(h),localStorage.removeItem(S),console.log("[auth][cookie->ls] cleared localStorage")}catch(o){console.log("[auth][cookie->ls] clear error",o)}}typeof window<"u"&&(window.ensureCrossSubdomainCookies=I(window).ACCESS_COOKIE=u(window).REFRESH_COOKIE=m(window).setSessionCookie=d(window).getCookie=r(window).clearSessionCookie=k,console.log("[auth][authRedirect] Functions made available globally for fallback access"));exports.ACCESS_COOKIE=u;exports.LS_ACCESS_KEY=h;exports.LS_REFRESH_KEY=S;exports.REFRESH_COOKIE=m;exports.buildOAuthRedirectUrl=E;exports.clearLocalStorageTokens=C;exports.clearSessionCookie=k;exports.ensureCrossSubdomainCookies=I;exports.getCookie=r;exports.getPostLoginBase=f;exports.setSessionCookie=d;exports.syncCookiesToLocalStorage=L;
