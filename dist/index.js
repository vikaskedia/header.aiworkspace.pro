"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),J=require("element-plus"),ye=require("@supabase/supabase-js"),Ee=require("pinia");/*! Element Plus Icons Vue v2.3.2 */var Ce=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(a){return(s,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),le=Ce,Ie=e.defineComponent({name:"Check",__name:"check",setup(a){return(s,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Ne=Ie;const R="aiworkspace.pro";function Z(a){return a==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(a)}function de(a){return a===R||a.endsWith(`.${R}`)}function K(a){return document.cookie.split(";").map(l=>l.trim()).filter(l=>a.some(m=>l.startsWith(m+"=")))}function M(a,s,r=60*60*24*365){const l=location.hostname;if(Z(l)){document.cookie=`${a}=${encodeURIComponent(s)}; Path=/; Max-Age=${r}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:l,name:a,valuePreview:s.slice(0,20)+"..."}),console.log("[auth][cookie][after]",K([a]));return}document.cookie=`${a}=${encodeURIComponent(s)}; Domain=.${R}; Path=/; Max-Age=${r}; SameSite=Lax; Secure`,document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:l,apex:R,name:a,valuePreview:s.slice(0,20)+"..."}),console.log("[auth][cookie][after]",K([a]))}function T(a){const s=new RegExp("(?:^|; )"+a.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),r=document.cookie.match(s);return r?decodeURIComponent(r[1]):null}function X(a){const s=location.hostname;if(Z(s)){document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:s,name:a});return}document.cookie=`${a}=; Domain=.${R}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:s,apex:R,name:a}),console.log("[auth][cookie][after]",K([a]))}function Q(a){const s=location.hostname;if(Z(s)){console.log("[auth][cookie][promote] skip (local host)",s);return}if(!de(s)){console.log("[auth][cookie][promote] skip (not under apex)",{host:s,apex:R});return}console.log("[auth][cookie][promote] start",{host:s,apex:R,names:a}),a.forEach(r=>{const l=T(r);l?M(r,l,60*60*24*365):console.log("[auth][cookie][promote] missing",r)}),console.log("[auth][cookie][promote] done",K(a))}function be(){return`${window.location.origin}/callback`}function Ae(){try{const a=new URLSearchParams(location.search),s=["redirect","redirect_to","returnTo","next"].find(l=>a.get(l));let r=s?a.get(s):"";if(r||(r=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||""),r||(r={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/"),r.startsWith("http"))try{const l=new URL(r);return de(l.hostname)||Z(l.hostname)?r:"/"}catch{return"/"}return r.startsWith("/")||(r="/"+r),r}catch{return"/"}}const B="sb-access-token",U="sb-refresh-token",ee="sb-access-token",te="sb-refresh-token";function H(){try{const a=T(B),s=T(U);a&&localStorage.setItem(ee,a),s&&localStorage.setItem(te,s),console.log("[auth][cookie->ls] sync",{hasAccess:!!a,hasRefresh:!!s})}catch(a){console.log("[auth][cookie->ls] error",a)}}function pe(){try{localStorage.removeItem(ee),localStorage.removeItem(te),console.log("[auth][cookie->ls] cleared localStorage")}catch(a){console.log("[auth][cookie->ls] clear error",a)}}async function Ve(){try{Q([B,U]);const a=T(B),s=T(U);if(a&&s){const{data:{session:r}}=await x.auth.getSession();if(!r){const{data:l,error:m}=await x.auth.setSession({access_token:a,refresh_token:s});m?console.log("[auth][restore] error",m):console.log("[auth][restore] done",!!l.session)}}else console.log("[auth][restore] no cookies present");H()}catch(a){console.log("[auth][restore] exception",a)}}function he(){console.log("[auth][listener] Setting up auth state listener..."),x.auth.onAuthStateChange(async(a,s)=>{switch(console.log("[auth][listener] Auth state changed:",a,!!s),a){case"TOKEN_REFRESHED":console.log("[auth][listener] Token refreshed successfully"),s&&(M(B,s.access_token,60*60*24*365),M(U,s.refresh_token,60*60*24*365),H());break;case"SIGNED_IN":console.log("[auth][listener] User signed in"),s&&(M(B,s.access_token,60*60*24*365),M(U,s.refresh_token,60*60*24*365),H());break;case"SIGNED_OUT":console.log("[auth][listener] User signed out");break;case"USER_UPDATED":console.log("[auth][listener] User updated");break;default:console.log("[auth][listener] Unhandled auth event:",a)}})}async function j(){try{const{data:{session:a}}=await x.auth.getSession();if(a&&a.user)return console.log("[auth][restore] Active session found"),{success:!0,session:a};const s=T(B),r=T(U);if(s&&r){console.log("[auth][restore] Attempting to restore session from cookies...");const{data:l,error:m}=await x.auth.setSession({access_token:s,refresh_token:r});if(m)return console.log("[auth][restore] Failed to restore session:",m.message),{success:!1,error:m};if(l.session)return console.log("[auth][restore] Session restored successfully"),M(B,l.session.access_token,60*60*24*365),M(U,l.session.refresh_token,60*60*24*365),H(),{success:!0,session:l.session}}return console.log("[auth][restore] No valid session or cookies found"),{success:!1,error:"No valid session or cookies"}}catch(a){return console.log("[auth][restore] Exception during session restoration:",a),{success:!1,error:a}}}const ae="https://oqdnbpmmgntqtigstaow.supabase.co",oe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",x=ye.createClient(ae,oe,{db:{schema:"public"},auth:{storageKey:"sb-auth-token",storage:localStorage,autoRefreshToken:!0,persistSession:!0}});typeof window<"u"&&(Q([B,U]),he());console.log("Supabase Configuration:",{url:ae,hasKey:!!oe,autoRefreshToken:!0,persistSession:!0});console.log("URL:",ae.replace(/https:\/\/(.+)\.supabase\.co/,"https://*****.supabase.co"));console.log("Key configured:",!oe.includes("your-anon-key"));console.log("Environment mode:","production");function ke(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),s=e.ref(null),r=e.computed(()=>a.value.isAuthenticated),l=e.computed(()=>a.value.user),m=e.computed(()=>a.value.isLoading),O=async()=>{var f,y,v,C,N,S,A,p,w,c,k,E,V,Y,G;try{const{data:{session:D}}=await x.auth.getSession();if(D&&D.user){const h=D.user,P={id:h.id,name:((f=h.user_metadata)==null?void 0:f.name)||((y=h.user_metadata)==null?void 0:y.user_name)||((v=h.user_metadata)==null?void 0:v.full_name)||((C=h.email)==null?void 0:C.split("@")[0])||"User",email:h.email,avatar_url:((N=h.user_metadata)==null?void 0:N.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:P,isAuthenticated:!0,isLoading:!1},s.value={user:P,access_token:D.access_token,refresh_token:D.refresh_token},{success:!0,session:s.value}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const b=await j();if(b.success&&b.session){console.log("[auth][enhanced] Session restored successfully");const h=b.session.user,P={id:h.id,name:((S=h.user_metadata)==null?void 0:S.name)||((A=h.user_metadata)==null?void 0:A.user_name)||((p=h.user_metadata)==null?void 0:p.full_name)||((w=h.email)==null?void 0:w.split("@")[0])||"User",email:h.email,avatar_url:((c=h.user_metadata)==null?void 0:c.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:P,isAuthenticated:!0,isLoading:!1},s.value=b.session,{success:!0,session:s.value}}else console.log("[auth][enhanced] Failed to restore session:",b.error)}catch(D){console.error("Error getting Supabase session:",D);try{const b=await j();if(b.success&&b.session){console.log("[auth][enhanced] Session restored after error");const h=b.session.user,P={id:h.id,name:((k=h.user_metadata)==null?void 0:k.name)||((E=h.user_metadata)==null?void 0:E.user_name)||((V=h.user_metadata)==null?void 0:V.full_name)||((Y=h.email)==null?void 0:Y.split("@")[0])||"User",email:h.email,avatar_url:((G=h.user_metadata)==null?void 0:G.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:P,isAuthenticated:!0,isLoading:!1},s.value=b.session,{success:!0,session:s.value}}}catch(b){console.error("Error restoring session:",b)}}return a.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null,{success:!1,error:"No valid session found"}},I=async()=>{try{await x.auth.signOut(),X(B),X(U),pe(),a.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(f){console.error("Error during logout:",f),a.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null}},L=async(f,y)=>{var v,C,N,S,A;try{a.value.isLoading=!0;const{data:p,error:w}=await x.auth.signInWithPassword({email:f,password:y});if(w)throw w;if(p.session){const c=p.session.user,k={id:c.id,name:((v=c.user_metadata)==null?void 0:v.name)||((C=c.user_metadata)==null?void 0:C.user_name)||((N=c.user_metadata)==null?void 0:N.full_name)||((S=c.email)==null?void 0:S.split("@")[0])||"User",email:c.email,avatar_url:((A=c.user_metadata)==null?void 0:A.avatar_url)||null,user_metadata:c.user_metadata};return a.value={user:k,isAuthenticated:!0,isLoading:!1},s.value={user:k,access_token:p.session.access_token,refresh_token:p.session.refresh_token},{success:!0,session:s.value}}return{success:!1,error:"No session returned"}}catch(p){return console.error("Sign in error:",p),a.value.isLoading=!1,{success:!1,error:p}}},g=async(f,y,v)=>{var C,N,S,A,p;try{a.value.isLoading=!0;const{data:w,error:c}=await x.auth.signUp({email:f,password:y,options:{data:v}});if(c)throw c;if(w.session){const k=w.session.user,E={id:k.id,name:((C=k.user_metadata)==null?void 0:C.name)||((N=k.user_metadata)==null?void 0:N.user_name)||((S=k.user_metadata)==null?void 0:S.full_name)||((A=k.email)==null?void 0:A.split("@")[0])||"User",email:k.email,avatar_url:((p=k.user_metadata)==null?void 0:p.avatar_url)||null,user_metadata:k.user_metadata};return a.value={user:E,isAuthenticated:!0,isLoading:!1},s.value={user:E,access_token:w.session.access_token,refresh_token:w.session.refresh_token},{success:!0,session:s.value}}return{success:!1,error:"No session returned"}}catch(w){return console.error("Sign up error:",w),a.value.isLoading=!1,{success:!1,error:w}}},d=async()=>{await O()};return e.onMounted(()=>{d()}),{authState:a,currentSession:s,isAuthenticated:r,currentUser:l,isLoading:m,loadUserInfo:O,logout:I,signIn:L,signUp:g,checkAuth:d}}const fe=Ee.defineStore("workspace",()=>{const a=e.ref(null),s=e.ref([]),r=e.ref(null),l=d=>{a.value=d,localStorage.setItem("current_workspace",JSON.stringify(d))},m=d=>{s.value=d,localStorage.setItem("available_workspaces",JSON.stringify(d))};return{currentWorkspace:a,workspaces:s,user:r,setCurrentWorkspace:l,setWorkspaces:m,setUser:d=>{r.value=d,localStorage.setItem("user_info",JSON.stringify(d))},loadPersistedData:()=>{const d=localStorage.getItem("current_workspace");if(d)try{a.value=JSON.parse(d)}catch(v){console.error("Error loading persisted workspace:",v)}const f=localStorage.getItem("available_workspaces");if(f)try{s.value=JSON.parse(f)}catch(v){console.error("Error loading persisted workspaces:",v)}const y=localStorage.getItem("user_info");if(y)try{r.value=JSON.parse(y)}catch(v){console.error("Error loading persisted user:",v)}},clearData:()=>{a.value=null,s.value=[],r.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(d=!1)=>{try{const{data:{user:f}}=await x.auth.getUser();if(!f)return[];let y=x.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at,
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",f.id);d||(y=y.eq("archived",!1));const{data:v,error:C}=await y;if(C)throw C;const N=new Map;(v||[]).forEach(c=>{(c.workspace_access||[]).forEach(k=>{k.shared_with_user_id===f.id&&N.set(c.id,k)})});const S=[...new Set((v||[]).filter(c=>c.parent_workspace_id).map(c=>c.parent_workspace_id).filter(c=>!N.has(c)))];let A=[];if(S.length){let c=x.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",S);d||(c=c.eq("archived",!1));const{data:k,error:E}=await c;if(E)throw E;A=k||[]}const w=[...v||[],...A].map(c=>{var k,E,V;return{id:c.id,title:c.title,description:c.description||"No description",parent_workspace_id:c.parent_workspace_id,created_by:c.created_by,archived:c.archived,created_at:c.created_at,latest_activity:((E=(k=c.workspace_activities)==null?void 0:k[0])==null?void 0:E.updated_at)||c.created_at,hasAccess:N.has(c.id),accessType:((V=N.get(c.id))==null?void 0:V.access_type)||null}});return w.sort((c,k)=>new Date(k.latest_activity)-new Date(c.latest_activity)),m(w),w}catch(f){return console.error("loadWorkspaces error",f),[]}}}}),xe={class:"aiworkspace-header"},Le={key:0,class:"header-content header-loading"},We={key:1,class:"header-content header-fallback"},Be={key:2,class:"header-content"},Ue={class:"header-left"},De={class:"logo-section"},Pe={href:"/",class:"logo"},$e=["src"],Me={key:1,class:"text-logo"},Re={key:0,class:"header-center"},Te={class:"main-navigation"},Oe={class:"nav-item"},Je=["href"],ze={class:"workspace-icon"},Ye={key:1,class:"nav-divider"},Fe={class:"nav-item"},He=["href","onClick"],Ge={class:"header-right"},qe={class:"user-profile"},Ke={class:"user-info"},Ze={class:"user-name"},Xe={class:"user-avatar"},je=["src","alt"],Qe={key:1,class:"avatar-placeholder"},et={key:3,class:"unauth-message"},tt={class:"workspace-list"},at=["onClick"],ot={class:"workspace-icon"},st={class:"workspace-details"},rt={class:"workspace-members"},nt={key:0,class:"current-indicator"},F=50,ct=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(a,{emit:s}){const r=a,l=s,{authState:m,logout:O}=ke(),I=()=>{try{return fe()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},L=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},g=e.ref(I()),d=e.computed(()=>!!g.value),f=e.ref(0),y=()=>{if(!g.value&&f.value<F){if(L()){const o=I();if(o){g.value=o,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}f.value++,setTimeout(y,100)}else f.value>=F&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{g.value||y()});const v=e.ref(!1),C=e.ref([]),N=e.ref([]),S=e.ref({name:"",email:"",avatar_url:null,initials:""}),A=e.ref([]),p=e.ref([]);e.watch(p,async o=>{o.length>0&&d.value&&E.value&&await k()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{d.value&&E.value&&await k()},{immediate:!1});const w=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,o=>{w.value=o},{immediate:!0}),e.watch(d,o=>{!o&&f.value<F&&y()});const c=()=>{try{const o=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(o)return o[1];const n=new URLSearchParams(window.location.search).get("workspace_id");if(n)return n;const u=window.location.hash.match(/workspace_id=(\d+)/);return u?u[1]:null}catch(o){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",o),null}},k=async()=>{if(!g.value||!d.value)return;const o=c();if(o)try{p.value.length===0&&await h();const t=p.value.find(n=>n.id.toString()===o);t?(g.value.setCurrentWorkspace(t),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${t.title} (ID: ${t.id})`),l("workspaceChange",t)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${o} not found in available workspaces`)}catch(t){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",t)}},E=e.computed(()=>m.value.isAuthenticated),V=e.computed(()=>g.value?g.value.currentWorkspace:null),Y=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),G=e.computed(()=>{try{const o=w.value;let t="";const n=o.match(/\/single-workspace\/\d+\/([^\/]+)/);if(n)t=n[1];else{const u=o.match(/\/([^\/]+)$/);u&&(t=u[1])}if(t){const u=Y.value.find(_=>_.key===t||_.url.includes(`/${t}`)||_.url===`/${t}`);if(u)return u.label}return"Dashboard"}catch(o){return console.warn("[AIWorkspaceHeader] Error determining current section:",o),"Dashboard"}}),D=o=>{const t=new Map;o.forEach(_=>{t.set(_.id,{..._,children:[]})});const n=[];t.forEach(_=>{_.parent_workspace_id&&t.has(_.parent_workspace_id)?t.get(_.parent_workspace_id).children.push(_):n.push(_)});const u=_=>{_.sort((W,$)=>W.title.localeCompare($.title)),_.forEach(W=>{W.children&&u(W.children)})};return u(n),n},b=(o,t=0,n=[])=>(o.forEach(u=>{n.push({...u,level:t}),u.children&&u.children.length&&b(u.children,t+1,n)}),n),h=async()=>{var o,t,n;try{const u=await((o=g.value)==null?void 0:o.loadWorkspaces());if(A.value=D(u||[]),p.value=b(A.value),N.value=p.value,C.value=p.value,r.currentWorkspaceId){const _=p.value.find(W=>{var $;return W.id.toString()===(($=r.currentWorkspaceId)==null?void 0:$.toString())});_&&((t=g.value)==null||t.setCurrentWorkspace(_))}else!V.value&&p.value.length&&((n=g.value)==null||n.setCurrentWorkspace(p.value[0]))}catch(u){console.error("loadWorkspaces (header) error",u)}},P=o=>{if(console.log("Navigation command:",o),o==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const t=parseInt(o.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t}/dashboard`;return}},me=o=>{const t=V.value;switch(o.key){case"dashboard":t?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(t){const n=`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`;window.location.href=n}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(t){const n=`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`;window.location.href=n}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(t){const n=`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`;window.location.href=n}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(t){const n=`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`;window.location.href=n}else window.location.href="https://tasks.aiworkspace.pro";break;case"ai-portfolios":if(t){const n=`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`;window.location.href=n}else window.location.href="https://spreadsheet.aiworkspace.pro";break;default:if(t){const n=`https://app.aiworkspace.pro/single-workspace/${t.id}/${o.key}`;window.location.href=n}else{const n=`https://app.aiworkspace.pro/${o.key}`;window.location.href=n}break}},ge=o=>{const t=V.value;switch(o.key){case"dashboard":return t?`/single-workspace/${t.id}/dashboard`:"/";case"ai-portfolios":return t?`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return t?`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return t?`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return t?`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return t?`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`:"https://tasks.aiworkspace.pro";default:return t?`https://app.aiworkspace.pro/single-workspace/${t.id}/${o.key}`:`https://app.aiworkspace.pro/${o.key}`}},q=o=>{switch(o){case"profile":r.onProfileClick?r.onProfileClick():J.ElMessage.info("Profile settings coming soon");break;case"workspaces":v.value=!0;break;case"logout":we();break}},se=o=>{var t;(t=g.value)==null||t.setCurrentWorkspace(o),v.value=!1,l("workspaceChange",o),J.ElMessage.success(`Switched to ${o.title}`)},ve=()=>{J.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:o})=>{var n;const t={id:Date.now(),title:o,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};C.value.push(t),(n=g.value)==null||n.setWorkspaces(C.value),se(t),J.ElMessage.success(`Created workspace: ${o}`)}).catch(()=>{})},we=()=>{J.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var o;(o=g.value)==null||o.clearData(),await O(),l("logout"),J.ElMessage.success("Signed out successfully")}).catch(()=>{})},re=async()=>{var o,t;if(m.value.user){const n=m.value.user;S.value={name:n.name||((o=n.email)==null?void 0:o.split("@")[0])||"User",email:n.email||"",avatar_url:n.avatar_url||null,initials:(n.name||((t=n.email)==null?void 0:t.split("@")[0])||"U").split(" ").map(u=>u[0]).join("").toUpperCase().substring(0,2)},r.showWorkspaceSelector&&await h()}};e.watch(()=>m.value.user,o=>{var t;o?re():(S.value={name:"",email:"",avatar_url:null,initials:""},(t=g.value)==null||t.clearData())}),e.watch(()=>r.currentWorkspaceId,o=>{var t;if(o&&p.value.length){const n=p.value.find(u=>u.id.toString()===o.toString());n&&((t=g.value)==null||t.setCurrentWorkspace(n))}}),e.onMounted(async()=>{E.value&&(await re(),await k())});const _e=()=>{f.value=0,y(),J.ElMessage.success("Manual Pinia retry initiated.")};return(o,t)=>{const n=e.resolveComponent("el-icon"),u=e.resolveComponent("el-dropdown-item"),_=e.resolveComponent("el-tag"),W=e.resolveComponent("el-dropdown-menu"),$=e.resolveComponent("el-dropdown"),ne=e.resolveComponent("el-button"),Se=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",xe,[!d.value&&f.value<F?(e.openBlock(),e.createElementBlock("div",Le,[...t[6]||(t[6]=[e.createStaticVNode('<div class="header-left" data-v-c06fc7d7><div class="logo-section" data-v-c06fc7d7><a href="/" class="logo" data-v-c06fc7d7><div class="text-logo" data-v-c06fc7d7><span class="logo-text" data-v-c06fc7d7>AI Workspace</span></div></a></div></div><div class="header-center" data-v-c06fc7d7><span class="loading-text" data-v-c06fc7d7>Initializing...</span></div>',2)])])):!d.value&&f.value>=F?(e.openBlock(),e.createElementBlock("div",We,[t[8]||(t[8]=e.createStaticVNode('<div class="header-left" data-v-c06fc7d7><div class="logo-section" data-v-c06fc7d7><a href="/" class="logo" data-v-c06fc7d7><div class="text-logo" data-v-c06fc7d7><span class="logo-text" data-v-c06fc7d7>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[t[7]||(t[7]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:_e,class:"retry-button"},"Retry Pinia")]),t[9]||(t[9]=e.createStaticVNode('<div class="header-right" data-v-c06fc7d7><div class="user-profile" data-v-c06fc7d7><div class="user-info" data-v-c06fc7d7><span class="user-name" data-v-c06fc7d7>User</span></div><div class="user-avatar" data-v-c06fc7d7><span class="avatar-placeholder" data-v-c06fc7d7>U</span></div></div></div>',1))])):E.value?(e.openBlock(),e.createElementBlock("div",Be,[e.createElementVNode("div",Ue,[e.createElementVNode("div",De,[e.createElementVNode("a",Pe,[o.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:o.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,$e)):(e.openBlock(),e.createElementBlock("div",Me,[...t[10]||(t[10]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),o.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",Re,[e.createElementVNode("nav",Te,[o.showWorkspaceSelector?(e.openBlock(),e.createBlock($,{key:0,onCommand:P,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(W,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(u,{command:"all-workspace"},{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createElementVNode("a",{href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item"},[e.createElementVNode("span",{class:"workspace-icon"},"ðŸŒ"),e.createElementVNode("span",null,"All workspace")])],-1)])]),_:1}),p.value.length>0?(e.openBlock(),e.createBlock(u,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,i=>(e.openBlock(),e.createBlock(u,{key:i.id,command:`workspace-${i.id}`},{default:e.withCtx(()=>{var z;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${i.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(i.level||0)*16+"px"})},[e.createElementVNode("span",ze,e.toDisplayString(i.children&&i.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("span",null,e.toDisplayString(i.title),1),i.id===((z=V.value)==null?void 0:z.id)?(e.openBlock(),e.createBlock(_,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,Je)]}),_:2},1032,["command"]))),128)),p.value.length===0?(e.openBlock(),e.createBlock(u,{key:1,disabled:""},{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var i;return[e.createElementVNode("span",Oe,[e.createTextVNode(e.toDisplayString(((i=V.value)==null?void 0:i.title)||"Select Workspace")+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(le))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),o.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",Ye,"/")):e.createCommentVNode("",!0),o.showSecondaryNavigation?(e.openBlock(),e.createBlock($,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(W,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Y.value,i=>(e.openBlock(),e.createBlock(u,{key:i.label,class:e.normalizeClass({active:i.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:ge(i),class:"nav-link",onClick:e.withModifiers(z=>me(i),["prevent"])},e.toDisplayString(i.label),9,He)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",Fe,[e.createTextVNode(e.toDisplayString(G.value)+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(le))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ge,[e.createVNode($,{onCommand:q,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(W,null,{default:e.withCtx(()=>[e.createVNode(u,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:t[0]||(t[0]=e.withModifiers(i=>q("profile"),["prevent"]))},"Profile Settings")]),_:1}),o.showWorkspaceSelector?(e.openBlock(),e.createBlock(u,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:t[1]||(t[1]=e.withModifiers(i=>q("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(u,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:t[2]||(t[2]=e.withModifiers(i=>q("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",qe,[e.createElementVNode("div",Ke,[e.createElementVNode("span",Ze,e.toDisplayString(S.value.name),1)]),e.createElementVNode("div",Xe,[S.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:S.value.avatar_url,alt:S.value.name},null,8,je)):(e.openBlock(),e.createElementBlock("span",Qe,e.toDisplayString(S.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",et,[...t[14]||(t[14]=[e.createElementVNode("div",{class:"unauth-inner"},[e.createElementVNode("strong",null,"Authentication required."),e.createTextVNode(" Please log in to access the workspace. ")],-1)])])),E.value&&o.showWorkspaceSelector?(e.openBlock(),e.createBlock(Se,{key:4,modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=i=>v.value=i),title:"Switch Workspace",width:"500px",onClose:t[5]||(t[5]=i=>v.value=!1)},{footer:e.withCtx(()=>[e.createVNode(ne,{onClick:t[3]||(t[3]=i=>v.value=!1)},{default:e.withCtx(()=>[...t[15]||(t[15]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(ne,{type:"primary",onClick:ve},{default:e.withCtx(()=>[...t[16]||(t[16]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",tt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.value,i=>{var z,ce;return e.openBlock(),e.createElementBlock("div",{key:i.id,class:e.normalizeClass(["workspace-item",{active:i.id===((z=V.value)==null?void 0:z.id)}]),onClick:dt=>se(i)},[e.createElementVNode("div",ot,e.toDisplayString(i.children&&i.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("div",st,[e.createElementVNode("h3",null,e.toDisplayString(i.title),1),e.createElementVNode("p",null,e.toDisplayString(i.description),1),e.createElementVNode("span",rt,e.toDisplayString(i.hasAccess?"Active":"Inactive"),1)]),i.id===((ce=V.value)==null?void 0:ce.id)?(e.openBlock(),e.createElementBlock("div",nt,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ne))]),_:1})])):e.createCommentVNode("",!0)],10,at)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0)])}}});const lt=(a,s)=>{const r=a.__vccOpts||a;for(const[l,m]of s)r[l]=m;return r},it=lt(ct,[["__scopeId","data-v-c06fc7d7"]]),ie="aiworkspace_auth",ue="aiworkspace_user_id";function ut(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),s=I=>{var d;const g=`; ${document.cookie}`.split(`; ${I}=`);return g.length===2&&((d=g.pop())==null?void 0:d.split(";").shift())||null},r=(I,L,g=7)=>{const d=new Date;d.setTime(d.getTime()+g*24*60*60*1e3),document.cookie=`${I}=${L};expires=${d.toUTCString()};path=/;domain=.aiworkspace.pro`},l=I=>{document.cookie=`${I}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.aiworkspace.pro`},m=async()=>{try{const I=s(ie),L=s(ue);I&&L?a.value={user:{id:L,email:""},isAuthenticated:!0,isLoading:!1}:a.value={user:null,isAuthenticated:!1,isLoading:!1}}catch(I){console.error("Auth check failed:",I),a.value={user:null,isAuthenticated:!1,isLoading:!1}}},O=()=>{l(ie),l(ue),a.value={user:null,isAuthenticated:!1,isLoading:!1}};return e.onMounted(()=>{m()}),{authState:a,checkAuth:m,logout:O,getCookie:s,setCookie:r,clearCookie:l}}exports.ACCESS_COOKIE=B;exports.AIWorkspaceHeader=it;exports.LS_ACCESS_KEY=ee;exports.LS_REFRESH_KEY=te;exports.REFRESH_COOKIE=U;exports.buildOAuthRedirectUrl=be;exports.clearLocalStorageTokens=pe;exports.clearSessionCookie=X;exports.ensureCrossSubdomainCookies=Q;exports.getCookie=T;exports.getPostLoginBase=Ae;exports.restoreCrossSubdomainSession=Ve;exports.restoreSessionWithRetry=j;exports.setSessionCookie=M;exports.setupAuthStateListener=he;exports.supabase=x;exports.syncCookiesToLocalStorage=H;exports.useAuth=ut;exports.useEnhancedAuth=ke;exports.useWorkspaceStore=fe;
