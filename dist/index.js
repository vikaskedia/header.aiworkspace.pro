"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),U=require("element-plus"),W=require("./supabase-f6e2692f.js"),p=require("./utils/authRedirect.js"),ke=require("pinia"),he=require("./utils/universalCallback.js");require("@supabase/supabase-js");/*! Element Plus Icons Vue v2.3.2 */var me=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(c){return(u,d)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),X=me,fe=e.defineComponent({name:"Check",__name:"check",setup(c){return(u,d)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),we=fe,ge=e.defineComponent({name:"Lock",__name:"lock",setup(c){return(u,d)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96"}),e.createElementVNode("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32m192-160v-64a192 192 0 1 0-384 0v64zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64"})]))}}),Q=ge,ve=e.defineComponent({name:"Message",__name:"message",setup(c){return(u,d)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M128 224v512a64 64 0 0 0 64 64h640a64 64 0 0 0 64-64V224zm0-64h768a64 64 0 0 1 64 64v512a128 128 0 0 1-128 128H192A128 128 0 0 1 64 736V224a64 64 0 0 1 64-64"}),e.createElementVNode("path",{fill:"currentColor",d:"M904 224 656.512 506.88a192 192 0 0 1-289.024 0L120 224zm-698.944 0 210.56 240.704a128 128 0 0 0 192.704 0L818.944 224z"})]))}}),_e=ve,Ce=e.defineComponent({name:"User",__name:"user",setup(c){return(u,d)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"})]))}}),ye=Ce;function Z(){const c=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),u=e.ref(null),d=e.computed(()=>c.value.isAuthenticated),S=e.computed(()=>c.value.user),A=e.computed(()=>c.value.isLoading),N=async()=>{var o,h,r,b,V,I,E,k,m,l,C,f,w,$,M;try{const{data:{session:L}}=await W.supabase.auth.getSession();if(L&&L.user){const v=L.user,x={id:v.id,name:((o=v.user_metadata)==null?void 0:o.name)||((h=v.user_metadata)==null?void 0:h.user_name)||((r=v.user_metadata)==null?void 0:r.full_name)||((b=v.email)==null?void 0:b.split("@")[0])||"User",email:v.email,avatar_url:((V=v.user_metadata)==null?void 0:V.avatar_url)||null,user_metadata:v.user_metadata};return c.value={user:x,isAuthenticated:!0,isLoading:!1},u.value={user:x,access_token:L.access_token,refresh_token:L.refresh_token},{success:!0,session:u.value}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const B=await W.restoreSessionWithRetry();if(B.success&&B.session){console.log("[auth][enhanced] Session restored successfully");const v=B.session.user,x={id:v.id,name:((I=v.user_metadata)==null?void 0:I.name)||((E=v.user_metadata)==null?void 0:E.user_name)||((k=v.user_metadata)==null?void 0:k.full_name)||((m=v.email)==null?void 0:m.split("@")[0])||"User",email:v.email,avatar_url:((l=v.user_metadata)==null?void 0:l.avatar_url)||null,user_metadata:v.user_metadata};return c.value={user:x,isAuthenticated:!0,isLoading:!1},u.value=B.session,{success:!0,session:u.value}}else console.log("[auth][enhanced] Failed to restore session:",B.error)}catch(L){console.error("Error getting Supabase session:",L);try{const B=await W.restoreSessionWithRetry();if(B.success&&B.session){console.log("[auth][enhanced] Session restored after error");const v=B.session.user,x={id:v.id,name:((C=v.user_metadata)==null?void 0:C.name)||((f=v.user_metadata)==null?void 0:f.user_name)||((w=v.user_metadata)==null?void 0:w.full_name)||(($=v.email)==null?void 0:$.split("@")[0])||"User",email:v.email,avatar_url:((M=v.user_metadata)==null?void 0:M.avatar_url)||null,user_metadata:v.user_metadata};return c.value={user:x,isAuthenticated:!0,isLoading:!1},u.value=B.session,{success:!0,session:u.value}}}catch(B){console.error("Error restoring session:",B)}}return c.value={user:null,isAuthenticated:!1,isLoading:!1},u.value=null,{success:!1,error:"No valid session found"}},P=async()=>{try{await W.supabase.auth.signOut(),p.clearSessionCookie(p.ACCESS_COOKIE),p.clearSessionCookie(p.REFRESH_COOKIE),p.clearLocalStorageTokens(),c.value={user:null,isAuthenticated:!1,isLoading:!1},u.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(o){console.error("Error during logout:",o),c.value={user:null,isAuthenticated:!1,isLoading:!1},u.value=null}},O=async(o,h)=>{var r,b,V,I,E;try{c.value.isLoading=!0;const{data:k,error:m}=await W.supabase.auth.signInWithPassword({email:o,password:h});if(m)throw m;if(k.session){const l=k.session.user,C={id:l.id,name:((r=l.user_metadata)==null?void 0:r.name)||((b=l.user_metadata)==null?void 0:b.user_name)||((V=l.user_metadata)==null?void 0:V.full_name)||((I=l.email)==null?void 0:I.split("@")[0])||"User",email:l.email,avatar_url:((E=l.user_metadata)==null?void 0:E.avatar_url)||null,user_metadata:l.user_metadata};return c.value={user:C,isAuthenticated:!0,isLoading:!1},u.value={user:C,access_token:k.session.access_token,refresh_token:k.session.refresh_token},{success:!0,session:u.value}}return{success:!1,error:"No session returned"}}catch(k){return console.error("Sign in error:",k),c.value.isLoading=!1,{success:!1,error:k}}},y=async(o,h,r)=>{var b,V,I,E,k;try{c.value.isLoading=!0;const{data:m,error:l}=await W.supabase.auth.signUp({email:o,password:h,options:{data:r}});if(l)throw l;if(m.session){const C=m.session.user,f={id:C.id,name:((b=C.user_metadata)==null?void 0:b.name)||((V=C.user_metadata)==null?void 0:V.user_name)||((I=C.user_metadata)==null?void 0:I.full_name)||((E=C.email)==null?void 0:E.split("@")[0])||"User",email:C.email,avatar_url:((k=C.user_metadata)==null?void 0:k.avatar_url)||null,user_metadata:C.user_metadata};return c.value={user:f,isAuthenticated:!0,isLoading:!1},u.value={user:f,access_token:m.session.access_token,refresh_token:m.session.refresh_token},{success:!0,session:u.value}}return{success:!1,error:"No session returned"}}catch(m){return console.error("Sign up error:",m),c.value.isLoading=!1,{success:!1,error:m}}},i=async()=>{await N()};return e.onMounted(()=>{i()}),{authState:c,currentSession:u,isAuthenticated:d,currentUser:S,isLoading:A,loadUserInfo:N,logout:P,signIn:O,signUp:y,checkAuth:i}}const ee=ke.defineStore("workspace",()=>{const c=e.ref(null),u=e.ref([]),d=e.ref(null),S=i=>{c.value=i,localStorage.setItem("current_workspace",JSON.stringify(i))},A=i=>{u.value=i,localStorage.setItem("available_workspaces",JSON.stringify(i))};return{currentWorkspace:c,workspaces:u,user:d,setCurrentWorkspace:S,setWorkspaces:A,setUser:i=>{d.value=i,localStorage.setItem("user_info",JSON.stringify(i))},loadPersistedData:()=>{const i=localStorage.getItem("current_workspace");if(i)try{c.value=JSON.parse(i)}catch(r){console.error("Error loading persisted workspace:",r)}const o=localStorage.getItem("available_workspaces");if(o)try{u.value=JSON.parse(o)}catch(r){console.error("Error loading persisted workspaces:",r)}const h=localStorage.getItem("user_info");if(h)try{d.value=JSON.parse(h)}catch(r){console.error("Error loading persisted user:",r)}},clearData:()=>{c.value=null,u.value=[],d.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(i=!1)=>{try{const{data:{user:o}}=await W.supabase.auth.getUser();if(!o)return[];let h=W.supabase.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at,
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",o.id);i||(h=h.eq("archived",!1));const{data:r,error:b}=await h;if(b)throw b;const V=new Map;(r||[]).forEach(l=>{(l.workspace_access||[]).forEach(C=>{C.shared_with_user_id===o.id&&V.set(l.id,C)})});const I=[...new Set((r||[]).filter(l=>l.parent_workspace_id).map(l=>l.parent_workspace_id).filter(l=>!V.has(l)))];let E=[];if(I.length){let l=W.supabase.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",I);i||(l=l.eq("archived",!1));const{data:C,error:f}=await l;if(f)throw f;E=C||[]}const m=[...r||[],...E].map(l=>{var C,f,w;return{id:l.id,title:l.title,description:l.description||"No description",parent_workspace_id:l.parent_workspace_id,created_by:l.created_by,archived:l.archived,created_at:l.created_at,latest_activity:((f=(C=l.workspace_activities)==null?void 0:C[0])==null?void 0:f.updated_at)||l.created_at,hasAccess:V.has(l.id),accessType:((w=V.get(l.id))==null?void 0:w.access_type)||null}});return m.sort((l,C)=>new Date(C.latest_activity)-new Date(l.latest_activity)),A(m),m}catch(o){return console.error("loadWorkspaces error",o),[]}}}});function ae(){const c=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),u=e.ref(window.location.href),d=async()=>{var i,o,h,r,b,V,I,E;try{c.value.isLoading=!0;const{data:{session:k},error:m}=await W.supabase.auth.getSession();if(m){console.error("Error checking auth status:",m),c.value={user:null,isAuthenticated:!1,isLoading:!1,error:m.message};return}k!=null&&k.user?(c.value={user:{id:k.user.id,email:k.user.email||"",name:((i=k.user.user_metadata)==null?void 0:i.full_name)||((o=k.user.user_metadata)==null?void 0:o.name)||((h=k.user.email)==null?void 0:h.split("@")[0])||"User",avatar_url:((r=k.user.user_metadata)==null?void 0:r.avatar_url)||((b=k.user.user_metadata)==null?void 0:b.picture)||null,initials:(((V=k.user.user_metadata)==null?void 0:V.full_name)||((I=k.user.user_metadata)==null?void 0:I.name)||((E=k.user.email)==null?void 0:E.split("@")[0])||"U").split(" ").map(l=>l[0]).join("").toUpperCase().substring(0,2)},isAuthenticated:!0,isLoading:!1,error:null},k.access_token&&p.setSessionCookie(p.ACCESS_COOKIE,k.access_token),k.refresh_token&&p.setSessionCookie(p.REFRESH_COOKIE,k.refresh_token),p.syncCookiesToLocalStorage()):c.value={user:null,isAuthenticated:!1,isLoading:!1,error:null}}catch(k){console.error("Auth check failed:",k),c.value={user:null,isAuthenticated:!1,isLoading:!1,error:k.message||"Authentication check failed"}}},S=async(i,o)=>{try{const{error:h}=await W.supabase.auth.signInWithPassword({email:i,password:o});return h?{success:!1,error:h.message}:(await d(),sessionStorage.setItem("post-login-redirect",u.value),{success:!0})}catch(h){return console.error("Login error:",h),{success:!1,error:h.message||"Login failed"}}},A=async(i,o)=>{var h;try{const{data:r,error:b}=await W.supabase.auth.signUp({email:i,password:o});return b?{success:!1,error:b.message}:r.user&&!r.user.email_confirmed_at?{success:!0,needsConfirmation:!0}:(h=r.session)!=null&&h.user?(await d(),sessionStorage.setItem("post-login-redirect",u.value),{success:!0}):{success:!1,error:"No session created"}}catch(r){return console.error("Signup error:",r),{success:!1,error:r.message||"Signup failed"}}},N=async i=>{try{const o=`${window.location.origin}/auth/callback`;console.log("[OAuth] Starting login with provider:",i),console.log("[OAuth] Redirect URL:",o),console.log("[OAuth] Current URL:",u.value),console.log("[OAuth] Current origin:",window.location.origin);const{error:h}=await W.supabase.auth.signInWithOAuth({provider:i,options:{redirectTo:o,queryParams:{redirect_origin:u.value}}});if(h)return console.error("[OAuth] Error:",h),{success:!1,error:h.message};const r=u.value||window.location.href;return sessionStorage.setItem("post-login-redirect",r),localStorage.setItem("post-login-redirect",r),console.log("[OAuth] Stored redirect URL:",r),console.log("[OAuth] Current URL value:",u.value),console.log("[OAuth] Window location href:",window.location.href),{success:!0}}catch(o){return console.error("OAuth login error:",o),{success:!1,error:o.message||"OAuth login failed"}}},P=async()=>{try{const{error:i}=await W.supabase.auth.signOut();i&&console.error("Logout error:",i),c.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},p.clearSessionCookie(p.ACCESS_COOKIE),p.clearSessionCookie(p.REFRESH_COOKIE),p.clearLocalStorageTokens()}catch(i){console.error("Logout error:",i)}},O=async i=>{try{const{error:o}=await W.supabase.auth.resetPasswordForEmail(i,{redirectTo:`${window.location.origin}/auth/reset-password`});return o?{success:!1,error:o.message}:{success:!0}}catch(o){return console.error("Password reset error:",o),{success:!1,error:o.message||"Password reset failed"}}},y=()=>{W.supabase.auth.onAuthStateChange((i,o)=>{var h;switch(console.log("Auth state changed:",i,(h=o==null?void 0:o.user)==null?void 0:h.email),i){case"SIGNED_IN":o!=null&&o.user&&d();break;case"SIGNED_OUT":c.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},p.clearSessionCookie(p.ACCESS_COOKIE),p.clearSessionCookie(p.REFRESH_COOKIE),p.clearLocalStorageTokens();break;case"TOKEN_REFRESHED":o!=null&&o.access_token&&p.setSessionCookie(p.ACCESS_COOKIE,o.access_token),o!=null&&o.refresh_token&&p.setSessionCookie(p.REFRESH_COOKIE,o.refresh_token),p.syncCookiesToLocalStorage();break;case"USER_UPDATED":o!=null&&o.user&&d();break}})};return e.onMounted(async()=>{y(),await d()}),e.watch(()=>window.location.href,i=>{u.value=i}),{authState:e.computed(()=>c.value),isAuthenticated:e.computed(()=>c.value.isAuthenticated),user:e.computed(()=>c.value.user),isLoading:e.computed(()=>c.value.isLoading),checkAuthStatus:d,loginWithEmail:S,signupWithEmail:A,loginWithProvider:N,logout:P,resetPassword:O,currentUrl:e.computed(()=>u.value)}}const Ee={class:"login-container"},Se={class:"logo-section"},be={class:"login-buttons"},Ne={key:0,class:"forgot-password"},Ve={class:"signup-link"},Ae=e.defineComponent({__name:"LoginModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","login-success"],setup(c,{emit:u}){const d=c,S=u,A=e.computed({get:()=>d.modelValue,set:f=>S("update:modelValue",f)}),N=e.ref(!1),P=e.ref(!1),O=e.ref(),{loginWithEmail:y,signupWithEmail:i,loginWithProvider:o,resetPassword:h}=ae(),r=e.reactive({email:"",password:"",confirmPassword:""}),b=e.computed(()=>({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email",trigger:"blur"}],password:[{required:!0,message:"Please enter your password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],...N.value?{confirmPassword:[{required:!0,message:"Please confirm your password",trigger:"blur"},{validator:(f,w,$)=>{w!==r.password?$(new Error("Passwords do not match")):$()},trigger:"blur"}]}:{}})),V=()=>{var f;N.value=!N.value,r.email="",r.password="",r.confirmPassword="",(f=O.value)==null||f.clearValidate()},I=()=>{var f;A.value=!1,r.email="",r.password="",r.confirmPassword="",N.value=!1,(f=O.value)==null||f.clearValidate()},E=async()=>{if(O.value)try{await O.value.validate(),P.value=!0,N.value?await m():await k()}catch(f){console.error("Form validation failed:",f)}finally{P.value=!1}},k=async()=>{const f=await y(r.email,r.password);f.success?(U.ElMessage.success("Login successful"),S("login-success",{email:r.email}),I()):U.ElMessage.error("Login failed: "+f.error)},m=async()=>{const f=await i(r.email,r.password);f.success?f.needsConfirmation?U.ElMessage.success("Please check your email to confirm your account"):(U.ElMessage.success("Account created successfully"),S("login-success",{email:r.email}),I()):U.ElMessage.error("Signup failed: "+f.error)},l=async f=>{const w=await o(f);w.success?U.ElMessage.success("Redirecting to login provider..."):U.ElMessage.error("Login failed: "+w.error)},C=async()=>{if(!r.email){U.ElMessage.warning("Please enter your email address first");return}const f=await h(r.email);f.success?U.ElMessage.success("Password reset email sent! Please check your inbox."):U.ElMessage.error("Failed to send reset email: "+f.error)};return(f,w)=>{const $=e.resolveComponent("el-icon"),M=e.resolveComponent("el-input"),L=e.resolveComponent("el-form-item"),B=e.resolveComponent("el-button"),v=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(v,{modelValue:A.value,"onUpdate:modelValue":w[6]||(w[6]=x=>A.value=x),title:"",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!0,class:"login-modal",onClose:I},{default:e.withCtx(()=>[e.createElementVNode("div",Ee,[e.createElementVNode("div",Se,[e.createElementVNode("h2",null,e.toDisplayString(N.value?"Create Account":"Welcome Back"),1),e.createElementVNode("p",null,e.toDisplayString(N.value?"Sign up to get started with your account":"Sign in to continue to your account"),1)]),e.createVNode(e.unref(U.ElForm),{model:r,rules:b.value,ref_key:"formRef",ref:O,class:"login-form",onSubmit:e.withModifiers(E,["prevent"])},{default:e.withCtx(()=>[e.createVNode(L,{prop:"email"},{default:e.withCtx(()=>[e.createVNode(M,{modelValue:r.email,"onUpdate:modelValue":w[0]||(w[0]=x=>r.email=x),placeholder:"Email",type:"email",size:"large",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode($,null,{default:e.withCtx(()=>[e.createVNode(e.unref(_e))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(L,{prop:"password"},{default:e.withCtx(()=>[e.createVNode(M,{modelValue:r.password,"onUpdate:modelValue":w[1]||(w[1]=x=>r.password=x),placeholder:"Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode($,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Q))]),_:1})]),_:1},8,["modelValue"])]),_:1}),N.value?(e.openBlock(),e.createBlock(L,{key:0,prop:"confirmPassword"},{default:e.withCtx(()=>[e.createVNode(M,{modelValue:r.confirmPassword,"onUpdate:modelValue":w[2]||(w[2]=x=>r.confirmPassword=x),placeholder:"Confirm Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode($,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Q))]),_:1})]),_:1},8,["modelValue"])]),_:1})):e.createCommentVNode("",!0),e.createVNode(L,null,{default:e.withCtx(()=>[e.createVNode(B,{type:"primary",class:"submit-button",loading:P.value,onClick:E,size:"large"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(N.value?"Sign Up":"Sign In"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),w[10]||(w[10]=e.createElementVNode("div",{class:"divider"},[e.createElementVNode("span",null,"Or continue with")],-1)),e.createElementVNode("div",be,[e.createVNode(B,{class:"login-button google",onClick:w[3]||(w[3]=x=>l("google")),size:"large"},{default:e.withCtx(()=>[...w[7]||(w[7]=[e.createElementVNode("span",{class:"social-icon"},"G",-1),e.createTextVNode(" Google ",-1)])]),_:1}),e.createVNode(B,{class:"login-button github",onClick:w[4]||(w[4]=x=>l("github")),size:"large"},{default:e.withCtx(()=>[...w[8]||(w[8]=[e.createElementVNode("span",{class:"social-icon"},"âš¡",-1),e.createTextVNode(" GitHub ",-1)])]),_:1}),e.createVNode(B,{class:"login-button twitter",onClick:w[5]||(w[5]=x=>l("twitter")),size:"large"},{default:e.withCtx(()=>[...w[9]||(w[9]=[e.createElementVNode("span",{class:"social-icon"},"X",-1),e.createTextVNode(" X (Twitter) ",-1)])]),_:1})]),w[11]||(w[11]=e.createElementVNode("div",{class:"terms"}," By continuing, you agree to AI Workspace's Terms of Service and Privacy Policy ",-1)),N.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ne,[e.createElementVNode("a",{href:"#",onClick:e.withModifiers(C,["prevent"])},"Forgot Password?")])),e.createElementVNode("div",Ve,[e.createTextVNode(e.toDisplayString(N.value?"Already have an account?":"Don't have an account?")+" ",1),e.createElementVNode("a",{href:"#",onClick:e.withModifiers(V,["prevent"])},e.toDisplayString(N.value?"Sign in":"Sign up"),1)])])]),_:1},8,["modelValue"])}}});const q=(c,u)=>{const d=c.__vccOpts||c;for(const[S,A]of u)d[S]=A;return d},te=q(Ae,[["__scopeId","data-v-684a3f28"]]),We={class:"aiworkspace-header"},Ie={key:0,class:"header-content header-loading"},Le={key:1,class:"header-content header-fallback"},xe={key:2,class:"header-content"},Be={class:"header-left"},Ue={class:"logo-section"},Pe={href:"/",class:"logo"},Oe=["src"],$e={key:1,class:"text-logo"},Me={key:0,class:"header-center"},Re={class:"main-navigation"},Te={class:"nav-item"},De={href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},He={class:"workspace-dropdown-item"},Fe=["href"],ze={class:"workspace-icon"},Ke={key:1,class:"nav-divider"},qe={class:"nav-item"},Ge=["href","onClick"],Je={class:"header-right"},Ye={class:"user-profile"},je={class:"user-info"},Xe={class:"user-name"},Qe={class:"user-avatar"},Ze=["src","alt"],ea={key:1,class:"avatar-placeholder"},aa={key:3,class:"header-content header-unauthenticated"},ta={class:"header-left"},sa={class:"logo-section"},oa={href:"/",class:"logo"},ra=["src"],la={key:1,class:"text-logo"},na={class:"header-right"},ia={class:"workspace-list"},ca=["onClick"],ua={class:"workspace-icon"},da={class:"workspace-details"},pa={class:"workspace-members"},ka={key:0,class:"current-indicator"},H=50,ha=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(c,{emit:u}){const d=c,S=u,{authState:A,logout:N}=Z(),P=()=>{try{return ee()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},O=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},y=e.ref(P()),i=e.computed(()=>!!y.value),o=e.ref(0),h=()=>{if(!y.value&&o.value<H){if(O()){const t=P();if(t){y.value=t,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}o.value++,setTimeout(h,100)}else o.value>=H&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{y.value||h()});const r=e.ref(!1),b=e.ref(!1),V=e.ref([]),I=e.ref([]),E=e.ref({name:"",email:"",avatar_url:null,initials:""}),k=e.ref([]),m=e.ref([]),l=e.ref(!1);e.watch(m,async t=>{t.length>0&&i.value&&M.value&&await $()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{i.value&&M.value&&await $()},{immediate:!1});const C=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,t=>{C.value=t},{immediate:!0}),e.watch(i,t=>{!t&&o.value<H&&h()});const f=()=>{try{const t=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(t)return t[1];const s=new URLSearchParams(window.location.search).get("workspace_id");if(s)return s;const n=window.location.hash.match(/workspace_id=(\d+)/);return n?n[1]:null}catch(t){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",t),null}},w=()=>{try{return window.location.pathname.includes("/all-workspace/")}catch(t){return console.warn("[AIWorkspaceHeader] Error checking all-workspace mode:",t),!1}},$=async()=>{if(!y.value||!i.value)return;const t=w();if(l.value=t,t){y.value.currentWorkspace=null,localStorage.removeItem("current_workspace"),console.log("[AIWorkspaceHeader] Auto-selected all-workspace mode from URL");return}const a=f();if(a)try{m.value.length===0&&await J();const s=m.value.find(n=>n.id.toString()===a);s?(y.value.setCurrentWorkspace(s),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${s.title} (ID: ${s.id})`),S("workspaceChange",s)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${a} not found in available workspaces`)}catch(s){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",s)}},M=e.computed(()=>A.value.isAuthenticated),L=e.computed(()=>y.value?y.value.currentWorkspace:null),B=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),v=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"All Tasks",key:"tasks",url:"/tasks"},{label:"All Goals",key:"goals",url:"/goals"},{label:"All Events",key:"events",url:"/events"},{label:"All Drive",key:"files",url:"/files"},{label:"All Contacts",key:"contacts",url:"/contacts"},{label:"All Settings",key:"settings",url:"/settings"}]),x=e.computed(()=>l.value?v.value:B.value),se=e.computed(()=>{try{const t=C.value;let a="";const s=t.match(/\/all-workspace\/([^\/]+)/);if(s)a=s[1];else{const n=t.match(/\/single-workspace\/\d+\/([^\/]+)/);if(n)a=n[1];else{const _=t.match(/\/([^\/]+)$/);_&&(a=_[1])}}if(a){const n=x.value.find(_=>_.key===a||_.url.includes(`/${a}`)||_.url===`/${a}`);if(n)return n.label}return"Dashboard"}catch(t){return console.warn("[AIWorkspaceHeader] Error determining current section:",t),"Dashboard"}}),oe=t=>{const a=new Map;t.forEach(_=>{a.set(_.id,{..._,children:[]})});const s=[];a.forEach(_=>{_.parent_workspace_id&&a.has(_.parent_workspace_id)?a.get(_.parent_workspace_id).children.push(_):s.push(_)});const n=_=>{_.sort((R,T)=>R.title.localeCompare(T.title)),_.forEach(R=>{R.children&&n(R.children)})};return n(s),s},G=(t,a=0,s=[])=>(t.forEach(n=>{s.push({...n,level:a}),n.children&&n.children.length&&G(n.children,a+1,s)}),s),J=async()=>{var t,a,s;try{const n=await((t=y.value)==null?void 0:t.loadWorkspaces());if(k.value=oe(n||[]),m.value=G(k.value),I.value=m.value,V.value=m.value,d.currentWorkspaceId){const _=m.value.find(R=>{var T;return R.id.toString()===((T=d.currentWorkspaceId)==null?void 0:T.toString())});_&&((a=y.value)==null||a.setCurrentWorkspace(_))}else!L.value&&m.value.length&&((s=y.value)==null||s.setCurrentWorkspace(m.value[0]))}catch(n){console.error("loadWorkspaces (header) error",n)}},re=t=>{if(console.log("Navigation command:",t),t==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const a=parseInt(t.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${a}/dashboard`;return}},le=t=>{const a=L.value,s=l.value;switch(t.key){case"dashboard":s?window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":a?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${a.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(s)window.location.href="https://outline.aiworkspace.pro/all-workspace/outlines";else if(a){const n=`https://outline.aiworkspace.pro/single-workspace/${a.id}/outlines`;window.location.href=n}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(s)window.location.href="https://canvas.aiworkspace.pro/all-workspace/canvas";else if(a){const n=`https://canvas.aiworkspace.pro/single-workspace/${a.id}/canvas`;window.location.href=n}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(s)window.location.href="https://drive.aiworkspace.pro/all-workspace/files";else if(a){const n=`https://drive.aiworkspace.pro/single-workspace/${a.id}/files`;window.location.href=n}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(s)window.location.href="https://tasks.aiworkspace.pro/all-workspace/tasks";else if(a){const n=`https://tasks.aiworkspace.pro/single-workspace/${a.id}/tasks`;window.location.href=n}else window.location.href="https://tasks.aiworkspace.pro";break;case"goals":if(s)window.location.href="https://app.aiworkspace.pro/all-workspace/goals";else if(a){const n=`https://app.aiworkspace.pro/single-workspace/${a.id}/goals`;window.location.href=n}else window.location.href="https://app.aiworkspace.pro/all-workspace/goals";break;case"events":if(s)window.location.href="https://app.aiworkspace.pro/all-workspace/events";else if(a){const n=`https://app.aiworkspace.pro/single-workspace/${a.id}/events`;window.location.href=n}else window.location.href="https://app.aiworkspace.pro/all-workspace/events";break;case"contacts":if(s)window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";else if(a){const n=`https://app.aiworkspace.pro/single-workspace/${a.id}/contacts`;window.location.href=n}else window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";break;case"ai-portfolios":if(s)window.location.href="https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios";else if(a){const n=`https://spreadsheet.aiworkspace.pro/single-workspace/${a.id}/ai-portfolios`;window.location.href=n}else window.location.href="https://spreadsheet.aiworkspace.pro";break;case"settings":if(s)window.location.href="https://settings.aiworkspace.pro/all-workspace/settings";else if(a){const n=`https://settings.aiworkspace.pro/single-workspace/${a.id}/settings`;window.location.href=n}else window.location.href="https://settings.aiworkspace.pro";break;default:if(s){const n=`https://app.aiworkspace.pro/all-workspace/${t.key}`;window.location.href=n}else if(a){const n=`https://app.aiworkspace.pro/single-workspace/${a.id}/${t.key}`;window.location.href=n}else{const n=`https://app.aiworkspace.pro/${t.key}`;window.location.href=n}break}},ne=t=>{const a=L.value,s=l.value;switch(t.key){case"dashboard":return s?"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":a?`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${a.id}/dashboard`:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";case"ai-portfolios":return s?"https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios":a?`https://spreadsheet.aiworkspace.pro/single-workspace/${a.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return s?"https://outline.aiworkspace.pro/all-workspace/outlines":a?`https://outline.aiworkspace.pro/single-workspace/${a.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return s?"https://canvas.aiworkspace.pro/all-workspace/canvas":a?`https://canvas.aiworkspace.pro/single-workspace/${a.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return s?"https://drive.aiworkspace.pro/all-workspace/files":a?`https://drive.aiworkspace.pro/single-workspace/${a.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return s?"https://tasks.aiworkspace.pro/all-workspace/tasks":a?`https://tasks.aiworkspace.pro/single-workspace/${a.id}/tasks`:"https://tasks.aiworkspace.pro";case"goals":return s?"https://app.aiworkspace.pro/all-workspace/goals":a?`https://app.aiworkspace.pro/single-workspace/${a.id}/goals`:"https://app.aiworkspace.pro/all-workspace/goals";case"events":return s?"https://app.aiworkspace.pro/all-workspace/events":a?`https://app.aiworkspace.pro/single-workspace/${a.id}/events`:"https://app.aiworkspace.pro/all-workspace/events";case"contacts":return s?"https://app.aiworkspace.pro/all-workspace/contacts":a?`https://app.aiworkspace.pro/single-workspace/${a.id}/contacts`:"https://app.aiworkspace.pro/all-workspace/contacts";case"settings":return s?"https://settings.aiworkspace.pro/all-workspace/settings":a?`https://settings.aiworkspace.pro/single-workspace/${a.id}/settings`:"https://settings.aiworkspace.pro";default:return s?`https://app.aiworkspace.pro/all-workspace/${t.key}`:a?`https://app.aiworkspace.pro/single-workspace/${a.id}/${t.key}`:`https://app.aiworkspace.pro/${t.key}`}},F=t=>{switch(t){case"profile":d.onProfileClick?d.onProfileClick():U.ElMessage.info("Profile settings coming soon");break;case"workspaces":r.value=!0;break;case"logout":ce();break}},Y=t=>{var a;(a=y.value)==null||a.setCurrentWorkspace(t),r.value=!1,S("workspaceChange",t),U.ElMessage.success(`Switched to ${t.title}`)},ie=()=>{U.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:t})=>{var s;const a={id:Date.now(),title:t,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};V.value.push(a),(s=y.value)==null||s.setWorkspaces(V.value),Y(a),U.ElMessage.success(`Created workspace: ${t}`)}).catch(()=>{})},ce=()=>{U.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var t;(t=y.value)==null||t.clearData(),await N(),S("logout"),U.ElMessage.success("Signed out successfully")}).catch(()=>{})},z=async()=>{var t,a;if(A.value.user){const s=A.value.user;E.value={name:s.name||((t=s.email)==null?void 0:t.split("@")[0])||"User",email:s.email||"",avatar_url:s.avatar_url||null,initials:(s.name||((a=s.email)==null?void 0:a.split("@")[0])||"U").split(" ").map(n=>n[0]).join("").toUpperCase().substring(0,2)},d.showWorkspaceSelector&&await J()}};e.watch(()=>A.value.user,t=>{var a;t?z():(E.value={name:"",email:"",avatar_url:null,initials:""},(a=y.value)==null||a.clearData())}),e.watch(()=>d.currentWorkspaceId,t=>{var a;if(t&&m.value.length){const s=m.value.find(n=>n.id.toString()===t.toString());s&&((a=y.value)==null||a.setCurrentWorkspace(s))}}),e.onMounted(async()=>{M.value&&(await z(),await $())});const ue=async t=>{console.log("Login successful:",t),b.value=!1,await z(),S("login"),U.ElMessage.success("Welcome back!")},de=()=>{o.value=0,h(),U.ElMessage.success("Manual Pinia retry initiated.")};return(t,a)=>{const s=e.resolveComponent("el-icon"),n=e.resolveComponent("el-tag"),_=e.resolveComponent("el-dropdown-item"),R=e.resolveComponent("el-dropdown-menu"),T=e.resolveComponent("el-dropdown"),K=e.resolveComponent("el-button"),pe=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",We,[!i.value&&o.value<H?(e.openBlock(),e.createElementBlock("div",Ie,[...a[8]||(a[8]=[e.createStaticVNode('<div class="header-left" data-v-f830d242><div class="logo-section" data-v-f830d242><a href="/" class="logo" data-v-f830d242><div class="text-logo" data-v-f830d242><span class="logo-text" data-v-f830d242>AI Workspace</span></div></a></div></div><div class="header-center" data-v-f830d242><span class="loading-text" data-v-f830d242>Initializing...</span></div>',2)])])):!i.value&&o.value>=H?(e.openBlock(),e.createElementBlock("div",Le,[a[10]||(a[10]=e.createStaticVNode('<div class="header-left" data-v-f830d242><div class="logo-section" data-v-f830d242><a href="/" class="logo" data-v-f830d242><div class="text-logo" data-v-f830d242><span class="logo-text" data-v-f830d242>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[a[9]||(a[9]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:de,class:"retry-button"},"Retry Pinia")]),a[11]||(a[11]=e.createStaticVNode('<div class="header-right" data-v-f830d242><div class="user-profile" data-v-f830d242><div class="user-info" data-v-f830d242><span class="user-name" data-v-f830d242>User</span></div><div class="user-avatar" data-v-f830d242><span class="avatar-placeholder" data-v-f830d242>U</span></div></div></div>',1))])):M.value?(e.openBlock(),e.createElementBlock("div",xe,[e.createElementVNode("div",Be,[e.createElementVNode("div",Ue,[e.createElementVNode("a",Pe,[t.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Oe)):(e.openBlock(),e.createElementBlock("div",$e,[...a[12]||(a[12]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),t.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",Me,[e.createElementVNode("nav",Re,[t.showWorkspaceSelector?(e.openBlock(),e.createBlock(T,{key:0,onCommand:re,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(R,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(_,{command:"all-workspace",class:e.normalizeClass({active:l.value})},{default:e.withCtx(()=>[e.createElementVNode("a",De,[e.createElementVNode("div",He,[a[14]||(a[14]=e.createElementVNode("span",{class:"workspace-icon"},"ðŸŒ",-1)),a[15]||(a[15]=e.createElementVNode("span",null,"All workspace",-1)),l.value?(e.openBlock(),e.createBlock(n,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...a[13]||(a[13]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)])])]),_:1},8,["class"]),m.value.length>0?(e.openBlock(),e.createBlock(_,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,g=>(e.openBlock(),e.createBlock(_,{key:g.id,command:`workspace-${g.id}`},{default:e.withCtx(()=>{var D;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${g.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(g.level||0)*16+"px"})},[e.createElementVNode("span",ze,e.toDisplayString(g.children&&g.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("span",null,e.toDisplayString(g.title),1),g.id===((D=L.value)==null?void 0:D.id)?(e.openBlock(),e.createBlock(n,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...a[16]||(a[16]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,Fe)]}),_:2},1032,["command"]))),128)),m.value.length===0?(e.openBlock(),e.createBlock(_,{key:1,disabled:""},{default:e.withCtx(()=>[...a[17]||(a[17]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var g;return[e.createElementVNode("span",Te,[e.createTextVNode(e.toDisplayString(l.value?"All workspace":((g=L.value)==null?void 0:g.title)||"Select Workspace")+" ",1),e.createVNode(s,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(X))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),t.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",Ke,"/")):e.createCommentVNode("",!0),t.showSecondaryNavigation?(e.openBlock(),e.createBlock(T,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(R,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.value,g=>(e.openBlock(),e.createBlock(_,{key:g.label,class:e.normalizeClass({active:g.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:ne(g),class:"nav-link",onClick:e.withModifiers(D=>le(g),["prevent"])},e.toDisplayString(g.label),9,Ge)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",qe,[e.createTextVNode(e.toDisplayString(se.value)+" ",1),e.createVNode(s,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(X))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Je,[e.createVNode(T,{onCommand:F,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(R,null,{default:e.withCtx(()=>[e.createVNode(_,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:a[0]||(a[0]=e.withModifiers(g=>F("profile"),["prevent"]))},"Profile Settings")]),_:1}),t.showWorkspaceSelector?(e.openBlock(),e.createBlock(_,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:a[1]||(a[1]=e.withModifiers(g=>F("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(_,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:a[2]||(a[2]=e.withModifiers(g=>F("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",Ye,[e.createElementVNode("div",je,[e.createElementVNode("span",Xe,e.toDisplayString(E.value.name),1)]),e.createElementVNode("div",Qe,[E.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:E.value.avatar_url,alt:E.value.name},null,8,Ze)):(e.openBlock(),e.createElementBlock("span",ea,e.toDisplayString(E.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",aa,[e.createElementVNode("div",ta,[e.createElementVNode("div",sa,[e.createElementVNode("a",oa,[t.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,ra)):(e.openBlock(),e.createElementBlock("div",la,[...a[18]||(a[18]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),a[20]||(a[20]=e.createElementVNode("div",{class:"header-center"},[e.createElementVNode("span",{class:"welcome-text"},"Welcome to AI Workspace")],-1)),e.createElementVNode("div",na,[e.createVNode(K,{type:"primary",size:"large",class:"login-button",onClick:a[3]||(a[3]=g=>b.value=!0)},{default:e.withCtx(()=>[e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ye))]),_:1}),a[19]||(a[19]=e.createTextVNode(" Login / Signup ",-1))]),_:1})])])),M.value&&t.showWorkspaceSelector?(e.openBlock(),e.createBlock(pe,{key:4,modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=g=>r.value=g),title:"Switch Workspace",width:"500px",onClose:a[6]||(a[6]=g=>r.value=!1)},{footer:e.withCtx(()=>[e.createVNode(K,{onClick:a[4]||(a[4]=g=>r.value=!1)},{default:e.withCtx(()=>[...a[21]||(a[21]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(K,{type:"primary",onClick:ie},{default:e.withCtx(()=>[...a[22]||(a[22]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",ia,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(V.value,g=>{var D,j;return e.openBlock(),e.createElementBlock("div",{key:g.id,class:e.normalizeClass(["workspace-item",{active:g.id===((D=L.value)==null?void 0:D.id)}]),onClick:va=>Y(g)},[e.createElementVNode("div",ua,e.toDisplayString(g.children&&g.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("div",da,[e.createElementVNode("h3",null,e.toDisplayString(g.title),1),e.createElementVNode("p",null,e.toDisplayString(g.description),1),e.createElementVNode("span",pa,e.toDisplayString(g.hasAccess?"Active":"Inactive"),1)]),g.id===((j=L.value)==null?void 0:j.id)?(e.openBlock(),e.createElementBlock("div",ka,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(e.unref(we))]),_:1})])):e.createCommentVNode("",!0)],10,ca)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0),e.createVNode(te,{modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=g=>b.value=g),onLoginSuccess:ue},null,8,["modelValue"])])}}});const ma=q(ha,[["__scopeId","data-v-f830d242"]]),fa={class:"auth-callback"},wa=e.defineComponent({__name:"AuthCallback",setup(c){e.onMounted(async()=>{console.log("[AuthCallback] Component mounted, starting callback processing..."),console.log("[AuthCallback] Current URL:",window.location.href),console.log("[AuthCallback] Current hash:",window.location.hash);try{await new Promise(A=>setTimeout(A,500));const{data:d,error:S}=await W.supabase.auth.getSession();if(S){console.error("Error processing callback:",S),u();return}if(d!=null&&d.session){const A=d.session.user;console.log("OAuth login successful:",A.email),d.session.access_token&&p.setSessionCookie(p.ACCESS_COOKIE,d.session.access_token),d.session.refresh_token&&p.setSessionCookie(p.REFRESH_COOKIE,d.session.refresh_token),p.syncCookiesToLocalStorage();const N=p.getPostLoginBase();console.log("[callback] Post-login redirect URL:",N),console.log("[callback] Session storage redirect:",sessionStorage.getItem("post-login-redirect")),console.log("[callback] Local storage redirect:",localStorage.getItem("post-login-redirect"));const P=N||"/";if(console.log("[callback] Final redirect URL:",P),P.startsWith("/")){const O=window.location.origin,y=`${O}${P}`;console.log("[callback] redirecting to:",y,{hostname:window.location.hostname,origin:O}),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=y},100)}else console.log("[callback] redirecting to absolute URL:",P),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=P},100)}else u()}catch(d){console.error("Error processing callback:",d),u()}});const u=()=>{const S=window.location.href.replace("/auth/callback","");window.location.href=S};return(d,S)=>(e.openBlock(),e.createElementBlock("div",fa,[...S[0]||(S[0]=[e.createElementVNode("div",{class:"callback-container"},[e.createElementVNode("div",{class:"loading-spinner"},[e.createElementVNode("div",{class:"spinner"})]),e.createElementVNode("h2",null,"Processing login..."),e.createElementVNode("p",null,"Please wait while we complete your authentication.")],-1)])]))}});const ga=q(wa,[["__scopeId","data-v-acdf6325"]]);exports.restoreCrossSubdomainSession=W.restoreCrossSubdomainSession;exports.restoreSessionWithRetry=W.restoreSessionWithRetry;exports.setupAuthStateListener=W.setupAuthStateListener;exports.supabase=W.supabase;exports.ACCESS_COOKIE=p.ACCESS_COOKIE;exports.LS_ACCESS_KEY=p.LS_ACCESS_KEY;exports.LS_REFRESH_KEY=p.LS_REFRESH_KEY;exports.REFRESH_COOKIE=p.REFRESH_COOKIE;exports.buildOAuthRedirectUrl=p.buildOAuthRedirectUrl;exports.clearLocalStorageTokens=p.clearLocalStorageTokens;exports.clearSessionCookie=p.clearSessionCookie;exports.ensureCrossSubdomainCookies=p.ensureCrossSubdomainCookies;exports.getCookie=p.getCookie;exports.getPostLoginBase=p.getPostLoginBase;exports.setSessionCookie=p.setSessionCookie;exports.syncCookiesToLocalStorage=p.syncCookiesToLocalStorage;exports.setupUniversalCallback=he.setupUniversalCallback;exports.AIWorkspaceHeader=ma;exports.AuthCallback=ga;exports.LoginModal=te;exports.useAuth=ae;exports.useEnhancedAuth=Z;exports.useWorkspaceStore=ee;
