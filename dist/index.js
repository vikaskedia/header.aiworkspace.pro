"use strict";var co=Object.defineProperty;var uo=(a,t,s)=>t in a?co(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var se=(a,t,s)=>(uo(a,typeof t!="symbol"?t+"":t,s),s);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),A=require("element-plus"),R=require("./supabase-91bfc1cb.js"),S=require("./utils/authRedirect.js"),po=require("pinia"),fo=require("./utils/universalCallback.js");/*! Element Plus Icons Vue v2.3.2 */var mo=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(a){return(t,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),Ce=mo,go=e.defineComponent({name:"Check",__name:"check",setup(a){return(t,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),ho=go,wo=e.defineComponent({name:"Lock",__name:"lock",setup(a){return(t,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96"}),e.createElementVNode("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32m192-160v-64a192 192 0 1 0-384 0v64zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64"})]))}}),Ve=wo,vo=e.defineComponent({name:"Message",__name:"message",setup(a){return(t,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M128 224v512a64 64 0 0 0 64 64h640a64 64 0 0 0 64-64V224zm0-64h768a64 64 0 0 1 64 64v512a128 128 0 0 1-128 128H192A128 128 0 0 1 64 736V224a64 64 0 0 1 64-64"}),e.createElementVNode("path",{fill:"currentColor",d:"M904 224 656.512 506.88a192 192 0 0 1-289.024 0L120 224zm-698.944 0 210.56 240.704a128 128 0 0 0 192.704 0L818.944 224z"})]))}}),ko=vo,_o=e.defineComponent({name:"Refresh",__name:"refresh",setup(a){return(t,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M771.776 794.88A384 384 0 0 1 128 512h64a320 320 0 0 0 555.712 216.448H654.72a32 32 0 1 1 0-64h149.056a32 32 0 0 1 32 32v148.928a32 32 0 1 1-64 0v-50.56zM276.288 295.616h92.992a32 32 0 0 1 0 64H220.16a32 32 0 0 1-32-32V178.56a32 32 0 0 1 64 0v50.56A384 384 0 0 1 896.128 512h-64a320 320 0 0 0-555.776-216.384z"})]))}}),be=_o,So=e.defineComponent({name:"User",__name:"user",setup(a){return(t,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"})]))}}),pe=So,yo=e.defineComponent({name:"Warning",__name:"warning",setup(a){return(t,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 832a384 384 0 0 0 0-768 384 384 0 0 0 0 768m48-176a48 48 0 1 1-96 0 48 48 0 0 1 96 0m-48-464a32 32 0 0 1 32 32v288a32 32 0 0 1-64 0V288a32 32 0 0 1 32-32"})]))}}),Ae=yo;class re extends Error{constructor(s,n={},g){super(s);se(this,"context");se(this,"originalError");this.name="PackageError",this.context=n,this.originalError=g}}function Eo(a,t={},s){try{const n=a();return n instanceof Promise?n.catch(g=>{if(console.warn("[ErrorHandler] Async operation failed:",{context:t,error:g.message,stack:g.stack}),s!==void 0)return s;throw new re(`Async operation failed: ${g.message}`,t,g)}):n}catch(n){if(console.warn("[ErrorHandler] Operation failed:",{context:t,error:n instanceof Error?n.message:String(n),stack:n instanceof Error?n.stack:void 0}),s!==void 0)return s;throw new re(`Operation failed: ${n instanceof Error?n.message:String(n)}`,t,n instanceof Error?n:void 0)}}async function Co(a,t={},s){try{return await a()}catch(n){if(console.warn("[ErrorHandler] Async operation failed:",{context:t,error:n instanceof Error?n.message:String(n),stack:n instanceof Error?n.stack:void 0}),s!==void 0)return s;throw new re(`Async operation failed: ${n instanceof Error?n.message:String(n)}`,t,n instanceof Error?n:void 0)}}function Ie(a,t={}){const s=a.message.toLowerCase();if(s.includes("is not a function")||s.includes("cannot read property")||s.includes("undefined is not a function")){console.warn("[ErrorHandler] Bundling error detected:",{context:t,error:a.message,suggestion:"This may be due to minification or import issues. The package will continue with fallback behavior."});return}throw new re(`Unexpected error: ${a.message}`,t,a)}async function Vo(a,t={},s){try{return await a()}catch(n){return console.warn("[ErrorHandler] Import failed:",{context:t,error:n instanceof Error?n.message:String(n)}),s!==void 0?s:void 0}}function bo(a){var t;try{if(typeof document>"u")return null;const n=`; ${document.cookie}`.split(`; ${a}=`);return n.length===2&&((t=n.pop())==null?void 0:t.split(";").shift())||null}catch(s){return console.warn("[ErrorHandler] Cookie access failed:",{cookieName:a,error:s instanceof Error?s.message:String(s)}),null}}function No(a,t,s={}){try{if(typeof document>"u")return!1;let n=`${a}=${t}`;return s.domain&&(n+=`; domain=${s.domain}`),s.path&&(n+=`; path=${s.path}`),s.secure&&(n+="; secure"),s.sameSite&&(n+=`; samesite=${s.sameSite}`),s.maxAge&&(n+=`; max-age=${s.maxAge}`),document.cookie=n,!0}catch(n){return console.warn("[ErrorHandler] Cookie setting failed:",{cookieName:a,error:n instanceof Error?n.message:String(n)}),!1}}function Ao(a){try{return typeof localStorage>"u"?null:localStorage.getItem(a)}catch(t){return console.warn("[ErrorHandler] localStorage get failed:",{key:a,error:t instanceof Error?t.message:String(t)}),null}}function Io(a,t){try{return typeof localStorage>"u"?!1:(localStorage.setItem(a,t),!0)}catch(s){return console.warn("[ErrorHandler] localStorage set failed:",{key:a,error:s instanceof Error?s.message:String(s)}),!1}}function xo(a,t){try{return typeof window>"u"?t:a(window)}catch(s){return console.warn("[ErrorHandler] Window operation failed:",{error:s instanceof Error?s.message:String(s)}),t}}function xe(){typeof window>"u"||(window.addEventListener("unhandledrejection",a=>{const t=a.reason;if(t instanceof Error){const s=t.message.toLowerCase();if(s.includes("is not a function")||s.includes("cannot read property")||s.includes("undefined is not a function")){console.warn("[ErrorHandler] Unhandled promise rejection (bundling error):",{error:t.message,stack:t.stack}),a.preventDefault();return}}console.error("[ErrorHandler] Unhandled promise rejection:",a.reason)}),window.addEventListener("error",a=>{const t=a.error;if(t instanceof Error){const s=t.message.toLowerCase();if(s.includes("is not a function")||s.includes("cannot read property")||s.includes("undefined is not a function")){console.warn("[ErrorHandler] Uncaught error (bundling error):",{error:t.message,stack:t.stack}),a.preventDefault();return}}console.error("[ErrorHandler] Uncaught error:",a.error)}))}typeof window<"u"&&xe();function Le(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),t=e.ref(null),s=e.computed(()=>a.value.isAuthenticated),n=e.computed(()=>a.value.user),g=e.computed(()=>a.value.isLoading),v=async()=>{var w,d,l,L,p,c,V,N,_,f,b,m,k,G,F,O,U,Y,H,y,$;try{console.log("[auth][enhanced] Starting loadUserInfo..."),console.log("[auth][enhanced] Ensuring cross-subdomain cookie synchronization...");const W="sb-access-token",E="sb-refresh-token",D=I=>{try{const M=location.hostname;if(M==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(M)){console.log("[auth][enhanced] Skipping cookie sync for localhost");return}const K="aiworkspace.pro";if(!M.endsWith(`.${K}`)&&M!==K){console.log("[auth][enhanced] Skipping cookie sync - not under apex domain");return}console.log("[auth][enhanced] Performing cookie synchronization"),I.forEach(q=>{const X=document.cookie.split(";").find(Q=>Q.trim().startsWith(q+"="));if(X){console.log(`[auth][enhanced] Found cookie: ${q}`);const Q=X.split("=")[1];Q&&(document.cookie=`${q}=${Q}; domain=.${K}; path=/; secure; samesite=lax`)}})}catch(M){console.warn("[auth][enhanced] Error in cookie sync:",M)}};D([W,E]),await new Promise(I=>setTimeout(I,50)),D([W,E]),await new Promise(I=>setTimeout(I,50));let z=null;try{const M=await(await R.getSupabase()).auth.getSession();z=(w=M==null?void 0:M.data)==null?void 0:w.session}catch(I){console.warn("[auth][enhanced] Error getting Supabase session:",I)}if(z&&z.user){console.log("[auth][enhanced] Active Supabase session found");const I=z.user,M={id:I.id,name:((d=I.user_metadata)==null?void 0:d.name)||((l=I.user_metadata)==null?void 0:l.user_name)||((L=I.user_metadata)==null?void 0:L.full_name)||((p=I.email)==null?void 0:p.split("@")[0])||"User",email:I.email,avatar_url:((c=I.user_metadata)==null?void 0:c.avatar_url)||null,user_metadata:I.user_metadata};return a.value={user:M,isAuthenticated:!0,isLoading:!1,error:null},t.value={user:M,access_token:z.access_token,refresh_token:z.refresh_token},{user:M,session:t.value,error:null}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const J=await R.restoreSessionWithRetry();if(J.success&&J.session){console.log("[auth][enhanced] Session restored successfully from cookies");const I=J.session.user,M={id:I.id,name:((V=I.user_metadata)==null?void 0:V.name)||((N=I.user_metadata)==null?void 0:N.user_name)||((_=I.user_metadata)==null?void 0:_.full_name)||((f=I.email)==null?void 0:f.split("@")[0])||"User",email:I.email,avatar_url:((b=I.user_metadata)==null?void 0:b.avatar_url)||null,user_metadata:I.user_metadata};return a.value={user:M,isAuthenticated:!0,isLoading:!1,error:null},t.value=J.session,{user:M,session:t.value,error:null}}else{console.log("[auth][enhanced] Failed to restore session:",J.error),console.log("[auth][enhanced] Retrying session restoration with extended delay..."),await new Promise(M=>setTimeout(M,500)),D([W,E]);const I=await R.restoreSessionWithRetry();if(I.success&&I.session){console.log("[auth][enhanced] Session restored on retry");const M=I.session.user,K={id:M.id,name:((m=M.user_metadata)==null?void 0:m.name)||((k=M.user_metadata)==null?void 0:k.user_name)||((G=M.user_metadata)==null?void 0:G.full_name)||((F=M.email)==null?void 0:F.split("@")[0])||"User",email:M.email,avatar_url:((O=M.user_metadata)==null?void 0:O.avatar_url)||null,user_metadata:M.user_metadata};return a.value={user:K,isAuthenticated:!0,isLoading:!1,error:null},t.value=I.session,{user:K,session:t.value,error:null}}}}catch(W){console.error("Error getting Supabase session:",W),W instanceof Error&&Ie(W,{component:"useEnhancedAuth",function:"loadUserInfo",operation:"session_validation"});try{const E=await R.restoreSessionWithRetry();if(E.success&&E.session){console.log("[auth][enhanced] Session restored after error");const D=E.session.user,z={id:D.id,name:((U=D.user_metadata)==null?void 0:U.name)||((Y=D.user_metadata)==null?void 0:Y.user_name)||((H=D.user_metadata)==null?void 0:H.full_name)||((y=D.email)==null?void 0:y.split("@")[0])||"User",email:D.email,avatar_url:(($=D.user_metadata)==null?void 0:$.avatar_url)||null,user_metadata:D.user_metadata};return a.value={user:z,isAuthenticated:!0,isLoading:!1,error:null},t.value=E.session,{user:z,session:t.value,error:null}}}catch(E){console.error("Error restoring session:",E)}}return console.log("[auth][enhanced] No valid authentication found"),a.value={user:null,isAuthenticated:!1,isLoading:!1,error:"No valid session found"},t.value=null,{user:null,session:null,error:"No valid session found"}},x=async()=>{try{await(await R.getSupabase()).auth.signOut(),S.clearSessionCookie(S.ACCESS_COOKIE),S.clearSessionCookie(S.REFRESH_COOKIE),S.clearLocalStorageTokens(),a.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},t.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(w){console.error("Error during logout:",w),a.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},t.value=null}},B=async(w,d)=>{var l,L,p,c,V;try{a.value.isLoading=!0;const N=await R.getSupabase(),{data:_,error:f}=await N.auth.signInWithPassword({email:w,password:d});if(f)throw f;if(_.session){const b=_.session.user,m={id:b.id,name:((l=b.user_metadata)==null?void 0:l.name)||((L=b.user_metadata)==null?void 0:L.user_name)||((p=b.user_metadata)==null?void 0:p.full_name)||((c=b.email)==null?void 0:c.split("@")[0])||"User",email:b.email,avatar_url:((V=b.user_metadata)==null?void 0:V.avatar_url)||null,user_metadata:b.user_metadata};return a.value={user:m,isAuthenticated:!0,isLoading:!1,error:null},t.value={user:m,access_token:_.session.access_token,refresh_token:_.session.refresh_token},{user:m,session:t.value,error:null}}return{user:null,session:null,error:"No session returned"}}catch(N){return console.error("Sign in error:",N),a.value.isLoading=!1,{user:null,session:null,error:String(N)}}},T=async(w,d,l)=>{var L,p,c,V,N;try{a.value.isLoading=!0;const _=await R.getSupabase(),{data:f,error:b}=await _.auth.signUp({email:w,password:d,options:{data:l}});if(b)throw b;if(f.session){const m=f.session.user,k={id:m.id,name:((L=m.user_metadata)==null?void 0:L.name)||((p=m.user_metadata)==null?void 0:p.user_name)||((c=m.user_metadata)==null?void 0:c.full_name)||((V=m.email)==null?void 0:V.split("@")[0])||"User",email:m.email,avatar_url:((N=m.user_metadata)==null?void 0:N.avatar_url)||null,user_metadata:m.user_metadata};return a.value={user:k,isAuthenticated:!0,isLoading:!1,error:null},t.value={user:k,access_token:f.session.access_token,refresh_token:f.session.refresh_token},{user:k,session:t.value,error:null}}return{user:null,session:null,error:"No session returned"}}catch(_){return console.error("Sign up error:",_),a.value.isLoading=!1,{user:null,session:null,error:String(_)}}},h=async()=>{await v()};return e.onMounted(async()=>{await R.initializeCrossSubdomainAuth(),await h()}),{authState:a,currentSession:t,isAuthenticated:s,currentUser:n,isLoading:g,loadUserInfo:v,logout:x,signIn:B,signUp:T,checkAuth:h}}const ee={normalCheckInterval:45e3,fastCheckInterval:8e3,fastMonitoringDuration:18e4,maxRetryAttempts:3,retryDelay:2e3,validationCacheDuration:1e4,enableImmediateDetection:!0,enableFastMonitoring:!0,enableNetworkAwareness:!0},Me={...ee,normalCheckInterval:1e4,fastCheckInterval:2e3,fastMonitoringDuration:6e4,maxRetryAttempts:2,retryDelay:1e3},Be={...ee,normalCheckInterval:6e4,fastCheckInterval:1e4,fastMonitoringDuration:3e5,maxRetryAttempts:5,retryDelay:3e3,enableFastMonitoring:!1},fe={...ee,normalCheckInterval:1e4,fastCheckInterval:2e3,fastMonitoringDuration:3e4,validationCacheDuration:1e3},me={...ee,normalCheckInterval:45e3,fastCheckInterval:3e3,fastMonitoringDuration:9e4,validationCacheDuration:1e4};function ge(){switch("production"){case"production":return me;case"development":return fe;default:return ee}}function Lo(a){return{...ee,...a}}const Re={default:ee,fast:Me,conservative:Be,development:fe,production:me};function Mo(a){return Re[a]}const Bo={immediate:"Immediate (0-2 seconds) - When logout is detected via auth events",fast:"Fast (2-5 seconds) - When fast monitoring is active",normal:"Normal (up to 30 seconds) - Regular monitoring interval",conservative:"Conservative (up to 60 seconds) - Less frequent monitoring"},Ro={manualLogout:{timing:"Immediate (0-2 seconds)",description:"User clicks logout button",method:"Auth state change event + fast monitoring"},sessionExpiry:{timing:"Fast (2-5 seconds)",description:"Session token expires naturally",method:"Fast monitoring detects invalid session"},tokenInvalidation:{timing:"Normal (up to 30 seconds)",description:"Token is invalidated server-side",method:"Regular monitoring detects validation failure"},networkIssues:{timing:"Immediate (0-1 second)",description:"Network connection lost",method:"Network event listener"},crossTabLogout:{timing:"Fast (2-5 seconds)",description:"User logs out in another tab",method:"Storage event listener + fast monitoring"}};function Te(a){const t=e.ref(!0),s=e.ref(null),n=e.ref(!1),g=e.ref(!1),v=e.ref(null),x=e.ref(null),B=e.ref(null),T={...ge(),...a},h=T.normalCheckInterval,w=T.fastCheckInterval,d=T.fastMonitoringDuration,l=T.maxRetryAttempts,L=T.retryDelay,p=e.computed(()=>!t.value&&s.value!==null),c=e.computed(()=>{var y,$;return((y=s.value)==null?void 0:y.canRetry)&&(($=s.value)==null?void 0:$.type)!=="manual_check_failed"}),V=y=>{var E;if(typeof document>"u")return null;const W=`; ${document.cookie}`.split(`; ${y}=`);return W.length===2&&((E=W.pop())==null?void 0:E.split(";").shift())||null},N=async()=>{var y,$;try{console.log("[SessionMonitor] Validating session...");const W=V("sb-access-token"),E=V("sb-refresh-token");if(!W||!E)return console.log("[SessionMonitor] No tokens found in cookies"),!1;const D=await R.getSupabase();let z=null,J=null;for(let q=1;q<=2;q++)try{const X=await D.auth.getSession();z=X.data.session,J=X.error;break}catch(X){if(console.warn(`[SessionMonitor] Network error on attempt ${q}:`,X),q===2)return console.log("[SessionMonitor] Network issues detected, maintaining current session state"),t.value;await new Promise(Q=>setTimeout(Q,1e3))}if(J)return console.warn("[SessionMonitor] Error getting session:",J),(y=J.message)!=null&&y.includes("Invalid JWT")||($=J.message)!=null&&$.includes("JWT expired")?!1:t.value;if(!z||!z.user)return console.log("[SessionMonitor] No valid session found"),!1;const I=new Date,M=new Date(z.expires_at*1e3),K=5*60*1e3;return I>=new Date(M.getTime()-K)?(console.log("[SessionMonitor] Session is close to expiry or expired"),!1):(console.log("[SessionMonitor] Session is valid"),v.value=new Date,!0)}catch(W){return console.error("[SessionMonitor] Error validating session:",W),t.value}},_=async()=>{try{console.log("[SessionMonitor] Attempting to restore session...");const y=V("sb-access-token"),$=V("sb-refresh-token");if(!y||!$)return console.log("[SessionMonitor] No tokens available for restoration"),!1;const W=await R.getSupabase(),{data:E,error:D}=await W.auth.setSession({access_token:y,refresh_token:$});return D?(console.warn("[SessionMonitor] Error restoring session:",D),!1):E.session&&E.session.user?(console.log("[SessionMonitor] Session restored successfully"),v.value=new Date,!0):!1}catch(y){return console.error("[SessionMonitor] Error restoring session:",y),!1}},f=(y,$,W=!0)=>{console.warn("[SessionMonitor] Session loss detected:",{type:y,message:$}),t.value=!1,s.value={type:y,message:$,timestamp:new Date,canRetry:W}},b=async()=>{console.log("[SessionMonitor] Retrying session validation...");for(let y=1;y<=l;y++){if(console.log(`[SessionMonitor] Retry attempt ${y}/${l}`),y>1&&await new Promise(E=>setTimeout(E,L)),await _()&&await N())return console.log("[SessionMonitor] Session restored and validated successfully"),t.value=!0,s.value=null,!0;if(await N())return console.log("[SessionMonitor] Session validated successfully on retry"),t.value=!0,s.value=null,!0}return console.log("[SessionMonitor] All retry attempts failed"),!1},m=()=>{console.log("[SessionMonitor] Clearing session loss state"),t.value=!0,s.value=null},k=()=>{if(n.value){console.log("[SessionMonitor] Already monitoring, skipping start");return}console.log("[SessionMonitor] Starting session monitoring..."),n.value=!0,setTimeout(async()=>{console.log("[SessionMonitor] Performing initial session validation..."),await N()?console.log("[SessionMonitor] Initial validation successful"):(console.log("[SessionMonitor] Initial validation failed, but waiting for confirmation..."),setTimeout(async()=>{await N()||f("session_expired","Your session has expired. Please log in again.",!0)},3e3))},2e3),x.value=setInterval(async()=>{console.log("[SessionMonitor] Periodic session check...");const y=await N();!y&&t.value?(console.log("[SessionMonitor] Session validation failed, performing confirmation check..."),setTimeout(async()=>{await N()||f("session_expired","Your session has expired. Please log in again.",!0)},2e3)):y&&!t.value&&(console.log("[SessionMonitor] Session recovered"),m())},h)},G=()=>{if(g.value){console.log("[SessionMonitor] Fast monitoring already active");return}console.log("[SessionMonitor] Starting fast monitoring (5s intervals)..."),g.value=!0,B.value&&clearInterval(B.value),B.value=setInterval(async()=>{console.log("[SessionMonitor] Fast session check...");const y=await N();!y&&t.value?(console.log("[SessionMonitor] Fast monitoring detected potential session loss, confirming..."),setTimeout(async()=>{await N()||(f("session_expired","Your session has expired. Please log in again.",!0),F())},1e3)):y&&!t.value&&(console.log("[SessionMonitor] Session recovered"),m(),F())},w),setTimeout(()=>{g.value&&(console.log(`[SessionMonitor] Auto-stopping fast monitoring after ${d/1e3} seconds`),F())},d)},F=()=>{g.value&&(console.log("[SessionMonitor] Stopping fast monitoring..."),g.value=!1,B.value&&(clearInterval(B.value),B.value=null))},O=()=>{n.value&&(console.log("[SessionMonitor] Stopping session monitoring..."),n.value=!1,x.value&&(clearInterval(x.value),x.value=null),F())},U=async()=>{console.log("[SessionMonitor] Manual session check requested");const y=await N();return!y&&!await _()?(f("manual_check_failed","Session validation failed. Please log in again.",!1),!1):y},Y=()=>{console.log("[SessionMonitor] Network error detected, but not triggering immediate session loss"),t.value||f("network_error","Network connection lost. Please check your internet connection and try again.",!0)},H=()=>{if(typeof window>"u")return;const y=()=>{var E;console.log("[SessionMonitor] Network connection restored"),p.value&&((E=s.value)==null?void 0:E.type)==="network_error"&&setTimeout(()=>b(),1e3)},$=()=>{console.log("[SessionMonitor] Network connection lost"),Y()},W=E=>{console.log("[SessionMonitor] Logout detected, starting fast monitoring for immediate detection"),G()};return window.addEventListener("online",y),window.addEventListener("offline",$),window.addEventListener("session-logout-detected",W),()=>{window.removeEventListener("online",y),window.removeEventListener("offline",$),window.removeEventListener("session-logout-detected",W)}};return e.onMounted(()=>{console.log("[SessionMonitor] Mounted, setting up monitoring"),k(),H()}),e.onUnmounted(()=>{console.log("[SessionMonitor] Unmounted, cleaning up"),O()}),{isSessionValid:t,sessionLossEvent:s,isMonitoring:n,isFastMonitoring:g,lastValidSession:v,hasSessionLoss:p,canRetrySession:c,validateSession:N,restoreSession:_,retrySession:b,clearSessionLoss:m,startMonitoring:k,stopMonitoring:O,startFastMonitoring:G,stopFastMonitoring:F,checkSession:U,handleNetworkError:Y}}const $e=po.defineStore("workspace",()=>{const a=e.ref(null),t=e.ref([]),s=e.ref(null),n=h=>{a.value=h,localStorage.setItem("current_workspace",JSON.stringify(h))},g=h=>{t.value=h,localStorage.setItem("available_workspaces",JSON.stringify(h))};return{currentWorkspace:a,workspaces:t,user:s,setCurrentWorkspace:n,setWorkspaces:g,setUser:h=>{s.value=h,localStorage.setItem("user_info",JSON.stringify(h))},loadPersistedData:()=>{const h=localStorage.getItem("current_workspace");if(h)try{a.value=JSON.parse(h)}catch(l){console.error("Error loading persisted workspace:",l)}const w=localStorage.getItem("available_workspaces");if(w)try{t.value=JSON.parse(w)}catch(l){console.error("Error loading persisted workspaces:",l)}const d=localStorage.getItem("user_info");if(d)try{s.value=JSON.parse(d)}catch(l){console.error("Error loading persisted user:",l)}},clearData:()=>{a.value=null,t.value=[],s.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(h=!1)=>{try{const{data:{user:w}}=await R.supabase.auth.getUser();if(!w)return[];let d=R.supabase.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at, git_repo, 
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",w.id);h||(d=d.eq("archived",!1));const{data:l,error:L}=await d;if(L)throw L;const p=new Map;(l||[]).forEach(f=>{(f.workspace_access||[]).forEach(b=>{b.shared_with_user_id===w.id&&p.set(f.id,b)})});const c=[...new Set((l||[]).filter(f=>f.parent_workspace_id).map(f=>f.parent_workspace_id).filter(f=>!p.has(f)))];let V=[];if(c.length){let f=R.supabase.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",c);h||(f=f.eq("archived",!1));const{data:b,error:m}=await f;if(m)throw m;V=b||[]}const _=[...l||[],...V].map(f=>{var b,m,k;return{id:f.id,title:f.title,description:f.description||"No description",parent_workspace_id:f.parent_workspace_id,created_by:f.created_by,archived:f.archived,created_at:f.created_at,latest_activity:((m=(b=f.workspace_activities)==null?void 0:b[0])==null?void 0:m.updated_at)||f.created_at,hasAccess:p.has(f.id),accessType:((k=p.get(f.id))==null?void 0:k.access_type)||null}});return _.sort((f,b)=>new Date(b.latest_activity)-new Date(f.latest_activity)),g(_),_}catch(w){return console.error("loadWorkspaces error",w),[]}}}});function We(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),t=e.ref(window.location.href),s=async()=>{var h,w,d,l,L,p,c,V;try{a.value.isLoading=!0;const N=await R.getSupabase(),{data:{session:_},error:f}=await N.auth.getSession();if(f){console.error("Error checking auth status:",f),a.value={user:null,isAuthenticated:!1,isLoading:!1,error:f.message};return}_!=null&&_.user?(a.value={user:{id:_.user.id,email:_.user.email||"",name:((h=_.user.user_metadata)==null?void 0:h.full_name)||((w=_.user.user_metadata)==null?void 0:w.name)||((d=_.user.email)==null?void 0:d.split("@")[0])||"User",avatar_url:((l=_.user.user_metadata)==null?void 0:l.avatar_url)||((L=_.user.user_metadata)==null?void 0:L.picture)||null,initials:(((p=_.user.user_metadata)==null?void 0:p.full_name)||((c=_.user.user_metadata)==null?void 0:c.name)||((V=_.user.email)==null?void 0:V.split("@")[0])||"U").split(" ").map(b=>b[0]).join("").toUpperCase().substring(0,2)},isAuthenticated:!0,isLoading:!1,error:null},_.access_token&&S.setSessionCookie(S.ACCESS_COOKIE,_.access_token),_.refresh_token&&S.setSessionCookie(S.REFRESH_COOKIE,_.refresh_token),S.syncCookiesToLocalStorage()):a.value={user:null,isAuthenticated:!1,isLoading:!1,error:null}}catch(N){console.error("Auth check failed:",N),a.value={user:null,isAuthenticated:!1,isLoading:!1,error:N.message||"Authentication check failed"}}},n=async(h,w)=>{try{const d=await R.getSupabase(),{error:l}=await d.auth.signInWithPassword({email:h,password:w});return l?{success:!1,error:l.message}:(await s(),sessionStorage.setItem("post-login-redirect",t.value),{success:!0})}catch(d){return console.error("Login error:",d),{success:!1,error:d.message||"Login failed"}}},g=async(h,w)=>{var d;try{const l=await R.getSupabase(),{data:L,error:p}=await l.auth.signUp({email:h,password:w});return p?{success:!1,error:p.message}:L.user&&!L.user.email_confirmed_at?{success:!0,needsConfirmation:!0}:(d=L.session)!=null&&d.user?(await s(),sessionStorage.setItem("post-login-redirect",t.value),{success:!0}):{success:!1,error:"No session created"}}catch(l){return console.error("Signup error:",l),{success:!1,error:l.message||"Signup failed"}}},v=async h=>{try{const w=`${window.location.origin}/auth/callback`;console.log("[OAuth] Starting login with provider:",h),console.log("[OAuth] Redirect URL:",w),console.log("[OAuth] Current URL:",t.value),console.log("[OAuth] Current origin:",window.location.origin);const d=await R.getSupabase(),{error:l}=await d.auth.signInWithOAuth({provider:h,options:{redirectTo:w,queryParams:{redirect_origin:t.value}}});if(l)return console.error("[OAuth] Error:",l),{success:!1,error:l.message};const L=t.value||window.location.href;return sessionStorage.setItem("post-login-redirect",L),localStorage.setItem("post-login-redirect",L),console.log("[OAuth] Stored redirect URL:",L),console.log("[OAuth] Current URL value:",t.value),console.log("[OAuth] Window location href:",window.location.href),{success:!0}}catch(w){return console.error("OAuth login error:",w),{success:!1,error:w.message||"OAuth login failed"}}},x=async()=>{try{const h=await R.getSupabase(),{error:w}=await h.auth.signOut();w&&console.error("Logout error:",w),a.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},S.clearSessionCookie(S.ACCESS_COOKIE),S.clearSessionCookie(S.REFRESH_COOKIE),S.clearLocalStorageTokens()}catch(h){console.error("Logout error:",h)}},B=async h=>{try{const w=await R.getSupabase(),{error:d}=await w.auth.resetPasswordForEmail(h,{redirectTo:`${window.location.origin}/auth/reset-password`});return d?{success:!1,error:d.message}:{success:!0}}catch(w){return console.error("Password reset error:",w),{success:!1,error:w.message||"Password reset failed"}}},T=async()=>{try{(await R.getSupabase()).auth.onAuthStateChange((w,d)=>{var l;switch(console.log("Auth state changed:",w,(l=d==null?void 0:d.user)==null?void 0:l.email),w){case"SIGNED_IN":d!=null&&d.user&&s();break;case"SIGNED_OUT":a.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},S.clearSessionCookie(S.ACCESS_COOKIE),S.clearSessionCookie(S.REFRESH_COOKIE),S.clearLocalStorageTokens();break;case"TOKEN_REFRESHED":d!=null&&d.access_token&&S.setSessionCookie(S.ACCESS_COOKIE,d.access_token),d!=null&&d.refresh_token&&S.setSessionCookie(S.REFRESH_COOKIE,d.refresh_token),S.syncCookiesToLocalStorage();break;case"USER_UPDATED":d!=null&&d.user&&s();break}})}catch(h){console.warn("Failed to setup auth listener:",h)}};return e.onMounted(async()=>{T(),await s()}),e.watch(()=>window.location.href,h=>{t.value=h}),{authState:e.computed(()=>a.value),isAuthenticated:e.computed(()=>a.value.isAuthenticated),user:e.computed(()=>a.value.user),isLoading:e.computed(()=>a.value.isLoading),checkAuthStatus:s,loginWithEmail:n,signupWithEmail:g,loginWithProvider:v,logout:x,resetPassword:B,currentUrl:e.computed(()=>t.value)}}const To={class:"login-container"},$o={class:"logo-section"},Wo={class:"login-buttons"},Do={key:0,class:"forgot-password"},Uo={class:"signup-link"},Po=e.defineComponent({__name:"LoginModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","login-success"],setup(a,{emit:t}){const s=a,n=t,g=e.computed({get:()=>s.modelValue,set:m=>n("update:modelValue",m)}),v=e.ref(!1),x=e.ref(!1),B=e.ref(),{loginWithEmail:T,signupWithEmail:h,loginWithProvider:w,resetPassword:d}=We(),l=e.reactive({email:"",password:"",confirmPassword:""}),L=e.computed(()=>({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email",trigger:"blur"}],password:[{required:!0,message:"Please enter your password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],...v.value?{confirmPassword:[{required:!0,message:"Please confirm your password",trigger:"blur"},{validator:(m,k,G)=>{k!==l.password?G(new Error("Passwords do not match")):G()},trigger:"blur"}]}:{}})),p=()=>{var m;v.value=!v.value,l.email="",l.password="",l.confirmPassword="",(m=B.value)==null||m.clearValidate()},c=()=>{var m;g.value=!1,l.email="",l.password="",l.confirmPassword="",v.value=!1,(m=B.value)==null||m.clearValidate()},V=async()=>{if(B.value)try{await B.value.validate(),x.value=!0,v.value?await _():await N()}catch(m){console.error("Form validation failed:",m)}finally{x.value=!1}},N=async()=>{const m=await T(l.email,l.password);m.success?(A.ElMessage.success("Login successful"),n("login-success",{email:l.email}),c()):A.ElMessage.error("Login failed: "+m.error)},_=async()=>{const m=await h(l.email,l.password);m.success?m.needsConfirmation?A.ElMessage.success("Please check your email to confirm your account"):(A.ElMessage.success("Account created successfully"),n("login-success",{email:l.email}),c()):A.ElMessage.error("Signup failed: "+m.error)},f=async m=>{const k=await w(m);k.success?A.ElMessage.success("Redirecting to login provider..."):A.ElMessage.error("Login failed: "+k.error)},b=async()=>{if(!l.email){A.ElMessage.warning("Please enter your email address first");return}const m=await d(l.email);m.success?A.ElMessage.success("Password reset email sent! Please check your inbox."):A.ElMessage.error("Failed to send reset email: "+m.error)};return(m,k)=>{const G=e.resolveComponent("el-icon"),F=e.resolveComponent("el-input"),O=e.resolveComponent("el-form-item"),U=e.resolveComponent("el-button"),Y=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(Y,{modelValue:g.value,"onUpdate:modelValue":k[6]||(k[6]=H=>g.value=H),title:"",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!0,class:"login-modal",onClose:c},{default:e.withCtx(()=>[e.createElementVNode("div",To,[e.createElementVNode("div",$o,[e.createElementVNode("h2",null,e.toDisplayString(v.value?"Create Account":"Welcome Back"),1),e.createElementVNode("p",null,e.toDisplayString(v.value?"Sign up to get started with your account":"Sign in to continue to your account"),1)]),e.createVNode(e.unref(A.ElForm),{model:l,rules:L.value,ref_key:"formRef",ref:B,class:"login-form",onSubmit:e.withModifiers(V,["prevent"])},{default:e.withCtx(()=>[e.createVNode(O,{prop:"email"},{default:e.withCtx(()=>[e.createVNode(F,{modelValue:l.email,"onUpdate:modelValue":k[0]||(k[0]=H=>l.email=H),placeholder:"Email",type:"email",size:"large",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(G,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ko))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(O,{prop:"password"},{default:e.withCtx(()=>[e.createVNode(F,{modelValue:l.password,"onUpdate:modelValue":k[1]||(k[1]=H=>l.password=H),placeholder:"Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(G,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ve))]),_:1})]),_:1},8,["modelValue"])]),_:1}),v.value?(e.openBlock(),e.createBlock(O,{key:0,prop:"confirmPassword"},{default:e.withCtx(()=>[e.createVNode(F,{modelValue:l.confirmPassword,"onUpdate:modelValue":k[2]||(k[2]=H=>l.confirmPassword=H),placeholder:"Confirm Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(G,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ve))]),_:1})]),_:1},8,["modelValue"])]),_:1})):e.createCommentVNode("",!0),e.createVNode(O,null,{default:e.withCtx(()=>[e.createVNode(U,{type:"primary",class:"submit-button",loading:x.value,onClick:V,size:"large"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(v.value?"Sign Up":"Sign In"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),k[10]||(k[10]=e.createElementVNode("div",{class:"divider"},[e.createElementVNode("span",null,"Or continue with")],-1)),e.createElementVNode("div",Wo,[e.createVNode(U,{class:"login-button google",onClick:k[3]||(k[3]=H=>f("google")),size:"large"},{default:e.withCtx(()=>[...k[7]||(k[7]=[e.createElementVNode("span",{class:"social-icon"},"G",-1),e.createTextVNode(" Google ",-1)])]),_:1}),e.createVNode(U,{class:"login-button github",onClick:k[4]||(k[4]=H=>f("github")),size:"large"},{default:e.withCtx(()=>[...k[8]||(k[8]=[e.createElementVNode("span",{class:"social-icon"},"⚡",-1),e.createTextVNode(" GitHub ",-1)])]),_:1}),e.createVNode(U,{class:"login-button twitter",onClick:k[5]||(k[5]=H=>f("twitter")),size:"large"},{default:e.withCtx(()=>[...k[9]||(k[9]=[e.createElementVNode("span",{class:"social-icon"},"X",-1),e.createTextVNode(" X (Twitter) ",-1)])]),_:1})]),k[11]||(k[11]=e.createElementVNode("div",{class:"terms"}," By continuing, you agree to AI Workspace's Terms of Service and Privacy Policy ",-1)),v.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Do,[e.createElementVNode("a",{href:"#",onClick:e.withModifiers(b,["prevent"])},"Forgot Password?")])),e.createElementVNode("div",Uo,[e.createTextVNode(e.toDisplayString(v.value?"Already have an account?":"Don't have an account?")+" ",1),e.createElementVNode("a",{href:"#",onClick:e.withModifiers(p,["prevent"])},e.toDisplayString(v.value?"Sign in":"Sign up"),1)])])]),_:1},8,["modelValue"])}}});const le=(a,t)=>{const s=a.__vccOpts||a;for(const[n,g]of t)s[n]=g;return s},De=le(Po,[["__scopeId","data-v-684a3f28"]]),Oo={class:"session-loss-content"},Ho={class:"session-loss-icon"},Fo={class:"session-loss-message"},zo={key:0,class:"session-loss-details"},Ko={class:"detail-item"},qo={class:"detail-value"},jo={class:"detail-item"},Go={class:"detail-value"},Jo={class:"session-loss-actions"},Yo={key:0,class:"retry-status"},Xo={class:"retry-message"},Qo=e.defineComponent({__name:"SessionLossModal",props:{modelValue:{type:Boolean},sessionLossEvent:{},canRetrySession:{type:Boolean}},emits:["update:modelValue","retry","login","refresh"],setup(a,{emit:t}){const s=a,n=t,g=e.ref(!1),v=e.ref(0),x=e.ref(void 0),B=e.ref(""),T=e.computed({get:()=>s.modelValue,set:p=>n("update:modelValue",p)}),h=p=>{switch(p){case"session_expired":return"Authentication session has expired";case"token_invalid":return"Authentication token is invalid or corrupted";case"network_error":return"Network connection issue detected";case"manual_check_failed":return"Session validation failed";default:return"Unknown authentication issue"}},w=p=>p.toLocaleString(),d=async()=>{if(g.value)return;g.value=!0,v.value=0,x.value=void 0,B.value="Attempting to restore session...";const p=setInterval(()=>{v.value<90&&(v.value+=Math.random()*20)},200);try{n("retry"),await new Promise(c=>setTimeout(c,2e3)),v.value=100,x.value="success",B.value="Session restored successfully!",setTimeout(()=>{T.value=!1},1e3)}catch{v.value=100,x.value="exception",B.value="Failed to restore session. Please log in again.",A.ElMessage.error("Session restoration failed")}finally{clearInterval(p),setTimeout(()=>{g.value=!1,v.value=0,x.value=void 0,B.value=""},3e3)}},l=()=>{n("login"),T.value=!1},L=()=>{n("refresh"),window.location.reload()};return e.watch(()=>s.sessionLossEvent,p=>{p&&(g.value=!1,v.value=0,x.value=void 0,B.value="")}),(p,c)=>(e.openBlock(),e.createBlock(e.unref(A.ElDialog),{modelValue:T.value,"onUpdate:modelValue":c[0]||(c[0]=V=>T.value=V),title:"Session Expired",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,class:"session-loss-modal",center:""},{default:e.withCtx(()=>{var V;return[e.createElementVNode("div",Oo,[e.createElementVNode("div",Ho,[e.createVNode(e.unref(A.ElIcon),{size:"48",color:"#f56c6c"},{default:e.withCtx(()=>[e.createVNode(e.unref(Ae))]),_:1})]),e.createElementVNode("div",Fo,[c[3]||(c[3]=e.createElementVNode("h3",null,"Your session has expired",-1)),e.createElementVNode("p",null,e.toDisplayString(((V=p.sessionLossEvent)==null?void 0:V.message)||"Please log in again to continue using the application."),1),p.sessionLossEvent?(e.openBlock(),e.createElementBlock("div",zo,[e.createElementVNode("div",Ko,[c[1]||(c[1]=e.createElementVNode("span",{class:"detail-label"},"Issue:",-1)),e.createElementVNode("span",qo,e.toDisplayString(h(p.sessionLossEvent.type)),1)]),e.createElementVNode("div",jo,[c[2]||(c[2]=e.createElementVNode("span",{class:"detail-label"},"Time:",-1)),e.createElementVNode("span",Go,e.toDisplayString(w(p.sessionLossEvent.timestamp)),1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Jo,[p.canRetrySession&&!g.value?(e.openBlock(),e.createBlock(e.unref(A.ElButton),{key:0,type:"primary",onClick:d,loading:g.value},{default:e.withCtx(()=>[e.createVNode(e.unref(A.ElIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(be))]),_:1}),c[4]||(c[4]=e.createTextVNode(" Try Again ",-1))]),_:1},8,["loading"])):e.createCommentVNode("",!0),e.createVNode(e.unref(A.ElButton),{type:"primary",onClick:l,disabled:g.value},{default:e.withCtx(()=>[e.createVNode(e.unref(A.ElIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(pe))]),_:1}),c[5]||(c[5]=e.createTextVNode(" Log In ",-1))]),_:1},8,["disabled"]),p.canRetrySession?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(A.ElButton),{key:1,type:"info",onClick:L,disabled:g.value},{default:e.withCtx(()=>[e.createVNode(e.unref(A.ElIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(be))]),_:1}),c[6]||(c[6]=e.createTextVNode(" Refresh Page ",-1))]),_:1},8,["disabled"]))]),g.value?(e.openBlock(),e.createElementBlock("div",Yo,[e.createVNode(e.unref(A.ElProgress),{percentage:v.value,status:x.value,"stroke-width":6},null,8,["percentage","status"]),e.createElementVNode("p",Xo,e.toDisplayString(B.value),1)])):e.createCommentVNode("",!0)])]}),_:1},8,["modelValue"]))}});const Ue=le(Qo,[["__scopeId","data-v-0dd27f7f"]]),Zo={class:"aiworkspace-header"},et={key:0,class:"header-content header-loading"},ot={class:"header-center"},tt={class:"loading-text"},st={key:0},at={key:1},rt={key:1,class:"header-content header-fallback"},nt={key:2,class:"header-content header-restricted"},it={class:"header-center"},lt={class:"restricted-text"},ct={class:"header-right"},ut={key:3,class:"header-content"},dt={class:"header-left"},pt={class:"logo-section"},ft={href:"/",class:"logo"},mt=["src"],gt={key:1,class:"text-logo"},ht={key:0,class:"header-center"},wt={class:"main-navigation"},vt={class:"nav-item"},kt={href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},_t={class:"workspace-dropdown-item"},St=["href"],yt={class:"workspace-icon"},Et={key:1,class:"nav-divider"},Ct={class:"nav-item"},Vt=["href","onClick"],bt={class:"header-right"},Nt={class:"user-profile"},At={class:"user-info"},It={class:"user-name"},xt={class:"user-avatar"},Lt=["src","alt"],Mt={key:1,class:"avatar-placeholder"},Bt={class:"version-info"},Rt={class:"version-hash"},Tt={key:4,class:"header-content header-unauthenticated"},$t={class:"header-left"},Wt={class:"logo-section"},Dt={href:"/",class:"logo"},Ut=["src"],Pt={key:1,class:"text-logo"},Ot={class:"header-right"},Ht={class:"workspace-list"},Ft=["onClick"],zt={class:"workspace-icon"},Kt={class:"workspace-details"},qt={class:"workspace-members"},jt={key:0,class:"current-indicator"},Gt={class:"update-content"},Jt={class:"update-actions"},Yt={class:"setup-content"},Xt={class:"setup-actions"},ae=50,Ne=`node -e "const fs=require('fs');const{execSync}=require('child_process');const hash=execSync('git rev-parse HEAD').toString().trim();const data={fullCommitHash:hash,shortCommitHash:hash.substring(0,7),timestamp:new Date().toISOString(),buildTime:new Date().toISOString()};fs.mkdirSync('public',{recursive:true});fs.writeFileSync('public/version.json',JSON.stringify(data,null,2));console.log('✅ Created version.json with hash:',hash.substring(0,7));"`,Qt=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(a,{emit:t}){const s=a,n=t,{authState:g,logout:v,isLoading:x}=Le(),{isSessionValid:B,sessionLossEvent:T,hasSessionLoss:h,canRetrySession:w,retrySession:d,clearSessionLoss:l}=Te(),L=()=>{try{return $e()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},p=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},c=e.ref(L()),V=e.computed(()=>!!c.value),N=e.ref(0),_=()=>{if(!c.value&&N.value<ae){if(p()){const r=L();if(r){c.value=r,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}N.value++,setTimeout(_,100)}else N.value>=ae&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{c.value||_()});const f=e.ref(!1),b=e.ref(!1),m=e.ref(!1),k=e.ref([]),G=e.ref([]),F=e.ref({name:"",email:"",avatar_url:null,initials:""}),O=e.ref("unknown"),U=e.ref("unknown"),Y=e.ref(!1),H=e.ref(null),y=e.ref(null),$=e.ref(!1),W=e.ref([]),E=e.ref([]),D=e.ref(!1);e.watch(E,async r=>{r.length>0&&V.value&&K.value&&await M()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{V.value&&K.value&&await M()},{immediate:!1});const z=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,r=>{z.value=r},{immediate:!0}),e.watch(V,r=>{!r&&N.value<ae&&_()});const J=()=>{try{const r=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(r)return r[1];const i=new URLSearchParams(window.location.search).get("workspace_id");if(i)return i;const u=window.location.hash.match(/workspace_id=(\d+)/);return u?u[1]:null}catch(r){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",r),null}},I=()=>{try{return window.location.pathname.includes("/all-workspace/")}catch(r){return console.warn("[AIWorkspaceHeader] Error checking all-workspace mode:",r),!1}},M=async()=>{if(!c.value||!V.value)return;const r=I();if(D.value=r,r){c.value.currentWorkspace=null,localStorage.removeItem("current_workspace"),console.log("[AIWorkspaceHeader] Auto-selected all-workspace mode from URL");return}const o=J();if(o)try{E.value.length===0&&await ve();const i=E.value.find(u=>u.id.toString()===o);i?(c.value.setCurrentWorkspace(i),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${i.title} (ID: ${i.id})`),n("workspaceChange",i)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${o} not found in available workspaces`)}catch(i){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",i)}},K=e.computed(()=>g.value.isAuthenticated),q=e.computed(()=>c.value?c.value.currentWorkspace:null),X=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),Q=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"All Tasks",key:"tasks",url:"/tasks"},{label:"All Goals",key:"goals",url:"/goals"},{label:"All Events",key:"events",url:"/events"},{label:"All Drive",key:"files",url:"/files"},{label:"All Contacts",key:"contacts",url:"/contacts"},{label:"All Settings",key:"settings",url:"/settings"}]),he=e.computed(()=>D.value?Q.value:X.value),ze=e.computed(()=>{try{const r=z.value;let o="";const i=r.match(/\/all-workspace\/([^\/]+)/);if(i)o=i[1];else{const u=r.match(/\/single-workspace\/\d+\/([^\/]+)/);if(u)o=u[1];else{const P=r.match(/\/([^\/]+)$/);P&&(o=P[1])}}if(o){const u=he.value.find(P=>P.key===o||P.url.includes(`/${o}`)||P.url===`/${o}`);if(u)return u.label}return"Dashboard"}catch(r){return console.warn("[AIWorkspaceHeader] Error determining current section:",r),"Dashboard"}}),Ke=r=>{const o=new Map;r.forEach(P=>{o.set(P.id,{...P,children:[]})});const i=[];o.forEach(P=>{P.parent_workspace_id&&o.has(P.parent_workspace_id)?o.get(P.parent_workspace_id).children.push(P):i.push(P)});const u=P=>{P.sort((j,Z)=>j.title.localeCompare(Z.title)),P.forEach(j=>{j.children&&u(j.children)})};return u(i),i},we=(r,o=0,i=[])=>(r.forEach(u=>{i.push({...u,level:o}),u.children&&u.children.length&&we(u.children,o+1,i)}),i),ve=async()=>{var r,o,i;try{const u=await((r=c.value)==null?void 0:r.loadWorkspaces());if(W.value=Ke(u||[]),E.value=we(W.value),G.value=E.value,k.value=E.value,s.currentWorkspaceId){const P=E.value.find(j=>{var Z;return j.id.toString()===((Z=s.currentWorkspaceId)==null?void 0:Z.toString())});P&&((o=c.value)==null||o.setCurrentWorkspace(P))}else!q.value&&E.value.length&&((i=c.value)==null||i.setCurrentWorkspace(E.value[0]))}catch(u){console.error("loadWorkspaces (header) error",u)}},qe=r=>{if(console.log("Navigation command:",r),r==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const o=parseInt(r.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o}/dashboard`;return}},je=r=>{const o=q.value,i=D.value;switch(r.key){case"dashboard":i?window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":o?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(i)window.location.href="https://outline.aiworkspace.pro/all-workspace/outlines";else if(o){const u=`https://outline.aiworkspace.pro/single-workspace/${o.id}/outlines`;window.location.href=u}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(i)window.location.href="https://canvas.aiworkspace.pro/all-workspace/canvas";else if(o){const u=`https://canvas.aiworkspace.pro/single-workspace/${o.id}/canvas`;window.location.href=u}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(i)window.location.href="https://drive.aiworkspace.pro/all-workspace/files";else if(o){const u=`https://drive.aiworkspace.pro/single-workspace/${o.id}/files`;window.location.href=u}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(i)window.location.href="https://tasks.aiworkspace.pro/all-workspace/tasks";else if(o){const u=`https://tasks.aiworkspace.pro/single-workspace/${o.id}/tasks`;window.location.href=u}else window.location.href="https://tasks.aiworkspace.pro";break;case"goals":if(i)window.location.href="https://app.aiworkspace.pro/all-workspace/goals";else if(o){const u=`https://app.aiworkspace.pro/single-workspace/${o.id}/goals`;window.location.href=u}else window.location.href="https://app.aiworkspace.pro/all-workspace/goals";break;case"events":if(i)window.location.href="https://app.aiworkspace.pro/all-workspace/events";else if(o){const u=`https://app.aiworkspace.pro/single-workspace/${o.id}/events`;window.location.href=u}else window.location.href="https://app.aiworkspace.pro/all-workspace/events";break;case"contacts":if(i)window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";else if(o){const u=`https://app.aiworkspace.pro/single-workspace/${o.id}/contacts`;window.location.href=u}else window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";break;case"ai-portfolios":if(i)window.location.href="https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios";else if(o){const u=`https://spreadsheet.aiworkspace.pro/single-workspace/${o.id}/ai-portfolios`;window.location.href=u}else window.location.href="https://spreadsheet.aiworkspace.pro";break;case"settings":if(i)window.location.href="https://settings.aiworkspace.pro/all-workspace/settings";else if(o){const u=`https://settings.aiworkspace.pro/single-workspace/${o.id}/settings`;window.location.href=u}else window.location.href="https://settings.aiworkspace.pro";break;default:if(i){const u=`https://app.aiworkspace.pro/all-workspace/${r.key}`;window.location.href=u}else if(o){const u=`https://app.aiworkspace.pro/single-workspace/${o.id}/${r.key}`;window.location.href=u}else{const u=`https://app.aiworkspace.pro/${r.key}`;window.location.href=u}break}},Ge=r=>{const o=q.value,i=D.value;switch(r.key){case"dashboard":return i?"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":o?`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o.id}/dashboard`:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";case"ai-portfolios":return i?"https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios":o?`https://spreadsheet.aiworkspace.pro/single-workspace/${o.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return i?"https://outline.aiworkspace.pro/all-workspace/outlines":o?`https://outline.aiworkspace.pro/single-workspace/${o.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return i?"https://canvas.aiworkspace.pro/all-workspace/canvas":o?`https://canvas.aiworkspace.pro/single-workspace/${o.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return i?"https://drive.aiworkspace.pro/all-workspace/files":o?`https://drive.aiworkspace.pro/single-workspace/${o.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return i?"https://tasks.aiworkspace.pro/all-workspace/tasks":o?`https://tasks.aiworkspace.pro/single-workspace/${o.id}/tasks`:"https://tasks.aiworkspace.pro";case"goals":return i?"https://app.aiworkspace.pro/all-workspace/goals":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/goals`:"https://app.aiworkspace.pro/all-workspace/goals";case"events":return i?"https://app.aiworkspace.pro/all-workspace/events":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/events`:"https://app.aiworkspace.pro/all-workspace/events";case"contacts":return i?"https://app.aiworkspace.pro/all-workspace/contacts":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/contacts`:"https://app.aiworkspace.pro/all-workspace/contacts";case"settings":return i?"https://settings.aiworkspace.pro/all-workspace/settings":o?`https://settings.aiworkspace.pro/single-workspace/${o.id}/settings`:"https://settings.aiworkspace.pro";default:return i?`https://app.aiworkspace.pro/all-workspace/${r.key}`:o?`https://app.aiworkspace.pro/single-workspace/${o.id}/${r.key}`:`https://app.aiworkspace.pro/${r.key}`}},ne=r=>{switch(r){case"profile":s.onProfileClick?s.onProfileClick():A.ElMessage.info("Profile settings coming soon");break;case"workspaces":f.value=!0;break;case"logout":Ye();break}},ke=r=>{var o;(o=c.value)==null||o.setCurrentWorkspace(r),f.value=!1,n("workspaceChange",r),A.ElMessage.success(`Switched to ${r.title}`)},Je=()=>{A.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:r})=>{var i;const o={id:Date.now(),title:r,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};k.value.push(o),(i=c.value)==null||i.setWorkspaces(k.value),ke(o),A.ElMessage.success(`Created workspace: ${r}`)}).catch(()=>{})},Ye=()=>{A.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var r;(r=c.value)==null||r.clearData(),await v(),typeof window<"u"&&window.dispatchEvent(new CustomEvent("session-logout-detected",{detail:{timestamp:new Date,source:"manual-logout"}})),n("logout"),A.ElMessage.success("Signed out successfully")}).catch(()=>{})},ue=async()=>{var r,o;if(g.value.user){const i=g.value.user;F.value={name:i.name||((r=i.email)==null?void 0:r.split("@")[0])||"User",email:i.email||"",avatar_url:i.avatar_url||null,initials:(i.name||((o=i.email)==null?void 0:o.split("@")[0])||"U").split(" ").map(u=>u[0]).join("").toUpperCase().substring(0,2)},s.showWorkspaceSelector&&await ve()}};e.watch(()=>g.value.user,r=>{var o;r?ue():(F.value={name:"",email:"",avatar_url:null,initials:""},(o=c.value)==null||o.clearData())}),e.watch(h,r=>{r&&K.value&&(console.log("[AIWorkspaceHeader] Session loss detected, showing modal"),m.value=!0)}),e.watch(()=>s.currentWorkspaceId,r=>{var o;if(r&&E.value.length){const i=E.value.find(u=>u.id.toString()===r.toString());i&&((o=c.value)==null||o.setCurrentWorkspace(i))}}),e.onMounted(async()=>{K.value&&(await ue(),await M()),await to(),_e(),ao()});const Xe=async r=>{console.log("Login successful:",r),b.value=!1,await ue(),n("login"),A.ElMessage.success("Welcome back!")},Qe=async()=>{console.log("[AIWorkspaceHeader] Retrying session..."),await d()?(m.value=!1,l(),A.ElMessage.success("Session restored successfully!")):A.ElMessage.error("Failed to restore session. Please log in again.")},Ze=()=>{console.log("[AIWorkspaceHeader] Opening login modal from session loss"),m.value=!1,b.value=!0},eo=()=>{console.log("[AIWorkspaceHeader] Refreshing page due to session loss"),window.location.reload()},oo=()=>{N.value=0,_(),A.ElMessage.success("Manual Pinia retry initiated.")},to=async()=>{try{const r=await fetch("/version.json");if(console.log("Version.json response status:",r.status,"Content-Type:",r.headers.get("content-type")),r.ok){const o=r.headers.get("content-type");if(o&&o.includes("application/json"))try{const i=await r.json();console.log("Version data received:",i),O.value=i.shortCommitHash||"unknown",U.value=i.fullCommitHash||"unknown",console.log("✅ Loaded commit hash from consuming app:",O.value)}catch(i){console.error("Failed to parse version.json:",i),O.value="parse-error",U.value="parse-error"}else console.warn("❌ version.json returned non-JSON content type:",o),console.warn("📋 This means the consuming app has not set up version.json generation"),console.warn("🔧 The server is returning HTML instead of JSON - likely a 404 page or index.html"),console.warn("📖 Please follow the setup guide: QUICK_FIX_VERSION.md"),console.warn("🚀 Quick fix: Create a version.json file in your app's public directory"),console.warn(""),console.warn("🔧 IMMEDIATE FIX: Copy and run this in your app's terminal:"),console.warn(`   node -e "const fs=require('fs');const{execSync}=require('child_process');const path=require('path');const hash=execSync('git rev-parse HEAD').toString().trim();const data={fullCommitHash:hash,shortCommitHash:hash.substring(0,7),timestamp:new Date().toISOString(),buildTime:new Date().toISOString()};fs.mkdirSync('public',{recursive:true});fs.writeFileSync('public/version.json',JSON.stringify(data,null,2));console.log('✅ Created version.json with hash:',hash.substring(0,7));"`),console.warn(""),console.warn("📁 Or manually create public/version.json with your git commit hash"),O.value="setup-required",U.value="setup-required"}else console.warn("❌ Could not load version.json from consuming app - Status:",r.status),console.warn("📋 This usually means the consuming app has not set up version.json generation"),console.warn("📖 Please follow the setup guide: QUICK_FIX_VERSION.md"),O.value="not-found",U.value="not-found"}catch(r){console.warn("❌ Error loading commit hash from consuming app:",r),console.warn("📖 Please follow the setup guide: QUICK_FIX_VERSION.md"),O.value="error",U.value="error"}},so=async()=>{try{if(U.value==="setup-required"){A.ElMessage.warning("Version setup required - see console for details");return}if(U.value==="not-found"||U.value==="error"||U.value==="parse-error"){A.ElMessage.warning("Version information not available");return}await navigator.clipboard.writeText(U.value),A.ElMessage.success("Commit hash copied to clipboard!")}catch(r){console.error("Failed to copy commit hash:",r),A.ElMessage.error("Failed to copy commit hash")}},_e=async()=>{if(!$.value){$.value=!0;try{const r=Date.now(),o=await fetch(`/version.json?t=${r}`);if(!o.ok)throw new Error("Failed to fetch version info");const i=o.headers.get("content-type");if(!i||!i.includes("application/json")){console.warn("Version check skipped: version.json not properly configured");return}const u=await o.json();H.value=u.fullCommitHash,U.value!==H.value&&(Y.value=!0,console.log("Version mismatch detected:",{currentVersion:U.value,latestVersion:H.value,serverBuildTime:u.buildTime}))}catch(r){console.error("Error checking for updates:",r)}finally{$.value=!1}}},ao=()=>{y.value=setInterval(()=>{_e()},30*1e3)},ro=()=>{console.log("User reloaded for update:",{currentVersion:U.value,latestVersion:H.value}),window.location.reload()},Se=()=>{Y.value=!1,console.log("Update alert dismissed:",{currentVersion:U.value,latestVersion:H.value})},no=async()=>{try{await navigator.clipboard.writeText(Ne),A.ElMessage.success("Setup command copied to clipboard!")}catch(r){console.error("Failed to copy setup command:",r),A.ElMessage.error("Failed to copy setup command")}},io=()=>{window.open("https://github.com/aiworkspace/header-package/blob/main/README_VERSION_SETUP.md","_blank")};return e.onUnmounted(()=>{y.value&&clearInterval(y.value)}),(r,o)=>{const i=e.resolveComponent("el-icon"),u=e.resolveComponent("el-button"),P=e.resolveComponent("el-tag"),j=e.resolveComponent("el-dropdown-item"),Z=e.resolveComponent("el-dropdown-menu"),de=e.resolveComponent("el-dropdown"),lo=e.resolveComponent("el-dialog"),ye=e.resolveComponent("el-alert");return e.openBlock(),e.createElementBlock("header",Zo,[!V.value&&N.value<ae||e.unref(x)?(e.openBlock(),e.createElementBlock("div",et,[o[10]||(o[10]=e.createStaticVNode('<div class="header-left" data-v-cfb0a76e><div class="logo-section" data-v-cfb0a76e><a href="/" class="logo" data-v-cfb0a76e><div class="text-logo" data-v-cfb0a76e><span class="logo-text" data-v-cfb0a76e>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",ot,[e.createElementVNode("span",tt,[e.unref(x)?(e.openBlock(),e.createElementBlock("span",st,"Syncing authentication...")):(e.openBlock(),e.createElementBlock("span",at,"Initializing..."))])])])):!V.value&&N.value>=ae?(e.openBlock(),e.createElementBlock("div",rt,[o[12]||(o[12]=e.createStaticVNode('<div class="header-left" data-v-cfb0a76e><div class="logo-section" data-v-cfb0a76e><a href="/" class="logo" data-v-cfb0a76e><div class="text-logo" data-v-cfb0a76e><span class="logo-text" data-v-cfb0a76e>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[o[11]||(o[11]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:oo,class:"retry-button"},"Retry Pinia")]),o[13]||(o[13]=e.createStaticVNode('<div class="header-right" data-v-cfb0a76e><div class="user-profile" data-v-cfb0a76e><div class="user-info" data-v-cfb0a76e><span class="user-name" data-v-cfb0a76e>User</span></div><div class="user-avatar" data-v-cfb0a76e><span class="avatar-placeholder" data-v-cfb0a76e>U</span></div></div></div>',1))])):K.value&&!e.unref(B)?(e.openBlock(),e.createElementBlock("div",nt,[o[16]||(o[16]=e.createStaticVNode('<div class="header-left" data-v-cfb0a76e><div class="logo-section" data-v-cfb0a76e><a href="/" class="logo" data-v-cfb0a76e><div class="text-logo" data-v-cfb0a76e><span class="logo-text" data-v-cfb0a76e>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",it,[e.createElementVNode("span",lt,[e.createVNode(i,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ae))]),_:1}),o[14]||(o[14]=e.createTextVNode(" Session expired - Please log in again ",-1))])]),e.createElementVNode("div",ct,[e.createVNode(u,{type:"primary",onClick:o[0]||(o[0]=C=>b.value=!0)},{default:e.withCtx(()=>[e.createVNode(i,null,{default:e.withCtx(()=>[e.createVNode(e.unref(pe))]),_:1}),o[15]||(o[15]=e.createTextVNode(" Log In ",-1))]),_:1})])])):K.value&&e.unref(B)?(e.openBlock(),e.createElementBlock("div",ut,[e.createElementVNode("div",dt,[e.createElementVNode("div",pt,[e.createElementVNode("a",ft,[r.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:r.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,mt)):(e.openBlock(),e.createElementBlock("div",gt,[...o[17]||(o[17]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),r.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",ht,[e.createElementVNode("nav",wt,[r.showWorkspaceSelector?(e.openBlock(),e.createBlock(de,{key:0,onCommand:qe,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(Z,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(j,{command:"all-workspace",class:e.normalizeClass({active:D.value})},{default:e.withCtx(()=>[e.createElementVNode("a",kt,[e.createElementVNode("div",_t,[o[19]||(o[19]=e.createElementVNode("span",{class:"workspace-icon"},"🌐",-1)),o[20]||(o[20]=e.createElementVNode("span",null,"All workspace",-1)),D.value?(e.openBlock(),e.createBlock(P,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...o[18]||(o[18]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)])])]),_:1},8,["class"]),E.value.length>0?(e.openBlock(),e.createBlock(j,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.value,C=>(e.openBlock(),e.createBlock(j,{key:C.id,command:`workspace-${C.id}`},{default:e.withCtx(()=>{var te;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${C.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(C.level||0)*16+"px"})},[e.createElementVNode("span",yt,e.toDisplayString(C.children&&C.children.length?"📁":"📄"),1),e.createElementVNode("span",null,e.toDisplayString(C.title),1),C.id===((te=q.value)==null?void 0:te.id)?(e.openBlock(),e.createBlock(P,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...o[21]||(o[21]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,St)]}),_:2},1032,["command"]))),128)),E.value.length===0?(e.openBlock(),e.createBlock(j,{key:1,disabled:""},{default:e.withCtx(()=>[...o[22]||(o[22]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var C;return[e.createElementVNode("span",vt,[e.createTextVNode(e.toDisplayString(D.value?"All workspace":((C=q.value)==null?void 0:C.title)||"Select Workspace")+" ",1),e.createVNode(i,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(Ce))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),r.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",Et,"/")):e.createCommentVNode("",!0),r.showSecondaryNavigation?(e.openBlock(),e.createBlock(de,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(Z,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(he.value,C=>(e.openBlock(),e.createBlock(j,{key:C.label,class:e.normalizeClass({active:C.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:Ge(C),class:"nav-link",onClick:e.withModifiers(te=>je(C),["prevent"])},e.toDisplayString(C.label),9,Vt)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",Ct,[e.createTextVNode(e.toDisplayString(ze.value)+" ",1),e.createVNode(i,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(Ce))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",bt,[e.createVNode(de,{onCommand:ne,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(Z,null,{default:e.withCtx(()=>[e.createVNode(j,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:o[1]||(o[1]=e.withModifiers(C=>ne("profile"),["prevent"]))},"Profile Settings")]),_:1}),r.showWorkspaceSelector?(e.openBlock(),e.createBlock(j,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:o[2]||(o[2]=e.withModifiers(C=>ne("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(j,{onClick:so,class:"version-item"},{default:e.withCtx(()=>[e.createElementVNode("div",Bt,[o[23]||(o[23]=e.createElementVNode("span",{class:"version-label"},"Version:",-1)),e.createElementVNode("span",Rt,e.toDisplayString(O.value),1)])]),_:1}),e.createVNode(j,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:o[3]||(o[3]=e.withModifiers(C=>ne("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",Nt,[e.createElementVNode("div",At,[e.createElementVNode("span",It,e.toDisplayString(F.value.name),1)]),e.createElementVNode("div",xt,[F.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:F.value.avatar_url,alt:F.value.name},null,8,Lt)):(e.openBlock(),e.createElementBlock("span",Mt,e.toDisplayString(F.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",Tt,[e.createElementVNode("div",$t,[e.createElementVNode("div",Wt,[e.createElementVNode("a",Dt,[r.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:r.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Ut)):(e.openBlock(),e.createElementBlock("div",Pt,[...o[24]||(o[24]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),o[26]||(o[26]=e.createElementVNode("div",{class:"header-center"},[e.createElementVNode("span",{class:"welcome-text"},"Welcome to AI Workspace")],-1)),e.createElementVNode("div",Ot,[e.createVNode(u,{type:"primary",size:"large",class:"login-button",onClick:o[4]||(o[4]=C=>b.value=!0)},{default:e.withCtx(()=>[e.createVNode(i,null,{default:e.withCtx(()=>[e.createVNode(e.unref(pe))]),_:1}),o[25]||(o[25]=e.createTextVNode(" Login / Signup ",-1))]),_:1})])])),K.value&&r.showWorkspaceSelector?(e.openBlock(),e.createBlock(lo,{key:5,modelValue:f.value,"onUpdate:modelValue":o[6]||(o[6]=C=>f.value=C),title:"Switch Workspace",width:"500px",onClose:o[7]||(o[7]=C=>f.value=!1)},{footer:e.withCtx(()=>[e.createVNode(u,{onClick:o[5]||(o[5]=C=>f.value=!1)},{default:e.withCtx(()=>[...o[27]||(o[27]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(u,{type:"primary",onClick:Je},{default:e.withCtx(()=>[...o[28]||(o[28]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",Ht,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,C=>{var te,Ee;return e.openBlock(),e.createElementBlock("div",{key:C.id,class:e.normalizeClass(["workspace-item",{active:C.id===((te=q.value)==null?void 0:te.id)}]),onClick:as=>ke(C)},[e.createElementVNode("div",zt,e.toDisplayString(C.children&&C.children.length?"📁":"📄"),1),e.createElementVNode("div",Kt,[e.createElementVNode("h3",null,e.toDisplayString(C.title),1),e.createElementVNode("p",null,e.toDisplayString(C.description),1),e.createElementVNode("span",qt,e.toDisplayString(C.hasAccess?"Active":"Inactive"),1)]),C.id===((Ee=q.value)==null?void 0:Ee.id)?(e.openBlock(),e.createElementBlock("div",jt,[e.createVNode(i,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ho))]),_:1})])):e.createCommentVNode("",!0)],10,Ft)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0),e.createVNode(De,{modelValue:b.value,"onUpdate:modelValue":o[8]||(o[8]=C=>b.value=C),onLoginSuccess:Xe},null,8,["modelValue"]),e.createVNode(Ue,{modelValue:m.value,"onUpdate:modelValue":o[9]||(o[9]=C=>m.value=C),"session-loss-event":e.unref(T),"can-retry-session":e.unref(w)||!1,onRetry:Qe,onLogin:Ze,onRefresh:eo},null,8,["modelValue","session-loss-event","can-retry-session"]),Y.value?(e.openBlock(),e.createBlock(ye,{key:6,title:"New Version Available!",type:"warning",closable:!0,onClose:Se,"show-icon":"",class:"update-alert"},{default:e.withCtx(()=>[e.createElementVNode("div",Gt,[o[31]||(o[31]=e.createElementVNode("p",null,"A new version of the application is available. Please reload to get the latest updates and features.",-1)),e.createElementVNode("div",Jt,[e.createVNode(u,{type:"primary",size:"small",onClick:ro},{default:e.withCtx(()=>[...o[29]||(o[29]=[e.createTextVNode(" Reload Now ",-1)])]),_:1}),e.createVNode(u,{size:"small",onClick:Se},{default:e.withCtx(()=>[...o[30]||(o[30]=[e.createTextVNode(" Dismiss ",-1)])]),_:1})])])]),_:1})):e.createCommentVNode("",!0),O.value==="setup-required"||O.value==="not-found"||O.value==="error"||O.value==="parse-error"?(e.openBlock(),e.createBlock(ye,{key:7,title:"Version Setup Required",type:"error",closable:!1,"show-icon":"",class:"version-setup-alert"},{default:e.withCtx(()=>[e.createElementVNode("div",Yt,[o[35]||(o[35]=e.createElementVNode("p",null,[e.createElementVNode("strong",null,"The header package needs version.json to be set up in your app.")],-1)),o[36]||(o[36]=e.createElementVNode("p",null,`This allows the header to display your app's commit hash instead of "setup-required".`,-1)),e.createElementVNode("div",Xt,[e.createVNode(u,{type:"primary",size:"small",onClick:no},{default:e.withCtx(()=>[...o[32]||(o[32]=[e.createTextVNode(" Copy Fix Command ",-1)])]),_:1}),e.createVNode(u,{size:"small",onClick:io},{default:e.withCtx(()=>[...o[33]||(o[33]=[e.createTextVNode(" View Setup Guide ",-1)])]),_:1})]),e.createElementVNode("div",{class:"setup-command"},[o[34]||(o[34]=e.createElementVNode("p",null,[e.createElementVNode("strong",null,"Quick Fix:"),e.createTextVNode(" Run this command in your app's terminal:")],-1)),e.createElementVNode("pre",null,e.toDisplayString(Ne))])])]),_:1})):e.createCommentVNode("",!0)])}}});const Pe=le(Qt,[["__scopeId","data-v-cfb0a76e"]]),Zt={class:"auth-callback"},es=e.defineComponent({__name:"AuthCallback",setup(a){e.onMounted(async()=>{console.log("[AuthCallback] Component mounted, starting callback processing..."),console.log("[AuthCallback] Current URL:",window.location.href),console.log("[AuthCallback] Current hash:",window.location.hash);try{await new Promise(g=>setTimeout(g,500));const{data:s,error:n}=await R.supabase.auth.getSession();if(n){console.error("Error processing callback:",n),t();return}if(s!=null&&s.session){const g=s.session.user;console.log("OAuth login successful:",g.email),s.session.access_token&&S.setSessionCookie(S.ACCESS_COOKIE,s.session.access_token),s.session.refresh_token&&S.setSessionCookie(S.REFRESH_COOKIE,s.session.refresh_token),S.syncCookiesToLocalStorage();const v=S.getPostLoginBase();console.log("[callback] Post-login redirect URL:",v),console.log("[callback] Session storage redirect:",sessionStorage.getItem("post-login-redirect")),console.log("[callback] Local storage redirect:",localStorage.getItem("post-login-redirect"));const x=v||"/";if(console.log("[callback] Final redirect URL:",x),x.startsWith("/")){const B=window.location.origin,T=`${B}${x}`;console.log("[callback] redirecting to:",T,{hostname:window.location.hostname,origin:B}),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=T},100)}else console.log("[callback] redirecting to absolute URL:",x),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=x},100)}else t()}catch(s){console.error("Error processing callback:",s),t()}});const t=()=>{const n=window.location.href.replace("/auth/callback","");window.location.href=n};return(s,n)=>(e.openBlock(),e.createElementBlock("div",Zt,[...n[0]||(n[0]=[e.createElementVNode("div",{class:"callback-container"},[e.createElementVNode("div",{class:"loading-spinner"},[e.createElementVNode("div",{class:"spinner"})]),e.createElementVNode("h2",null,"Processing login..."),e.createElementVNode("p",null,"Please wait while we complete your authentication.")],-1)])]))}});const os=le(es,[["__scopeId","data-v-acdf6325"]]),oe=class oe{constructor(){se(this,"validationCache",new Map);se(this,"CACHE_DURATION",ge().validationCacheDuration)}getCookieValue(t){var g;if(typeof document>"u")return null;const n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2&&((g=n.pop())==null?void 0:g.split(";").shift())||null}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}async validateSession(t=!1){var n,g;const s="session_validation";if(!t){const v=this.validationCache.get(s);if(v&&Date.now()-v.timestamp<this.CACHE_DURATION)return console.log("[SessionValidator] Using cached validation result"),v.result}console.log("[SessionValidator] Validating session...");try{const v=this.getCookieValue("sb-access-token"),x=this.getCookieValue("sb-refresh-token");if(!v||!x){const p={isValid:!1,needsLogin:!0,error:"No authentication tokens found",canRetry:!1};return this.cacheResult(s,p),p}const B=await R.getSupabase();let T=null,h=null;for(let p=1;p<=2;p++)try{const c=await B.auth.getSession();T=c.data.session,h=c.error;break}catch(c){if(console.warn(`[SessionValidator] Network error on attempt ${p}:`,c),p===2){const V={isValid:!1,needsLogin:!1,error:"Network error during validation",canRetry:!0};return this.cacheResult(s,V),V}await new Promise(V=>setTimeout(V,1e3))}if(h){console.warn("[SessionValidator] Error getting session:",h);const c={isValid:!1,needsLogin:((n=h.message)==null?void 0:n.includes("Invalid JWT"))||((g=h.message)==null?void 0:g.includes("JWT expired")),error:`Session error: ${h.message}`,canRetry:!0};return this.cacheResult(s,c),c}if(!T||!T.user){const p={isValid:!1,needsLogin:!0,error:"No valid session found",canRetry:!0};return this.cacheResult(s,p),p}const w=new Date,d=new Date(T.expires_at*1e3),l=5*60*1e3;if(w>=new Date(d.getTime()-l)){const p={isValid:!1,needsLogin:!0,error:"Session is close to expiry or expired",canRetry:!0};return this.cacheResult(s,p),p}const L={isValid:!0,needsLogin:!1,canRetry:!1};return this.cacheResult(s,L),L}catch(v){console.error("[SessionValidator] Error validating session:",v);const x={isValid:!1,needsLogin:!1,error:`Validation error: ${v}`,canRetry:!0};return this.cacheResult(s,x),x}}async restoreSession(){console.log("[SessionValidator] Attempting to restore session...");try{const t=this.getCookieValue("sb-access-token"),s=this.getCookieValue("sb-refresh-token");if(!t||!s)return{isValid:!1,needsLogin:!0,error:"No tokens available for restoration",canRetry:!1};const n=await R.getSupabase(),{data:g,error:v}=await n.auth.setSession({access_token:t,refresh_token:s});return v?(console.warn("[SessionValidator] Error restoring session:",v),{isValid:!1,needsLogin:!0,error:`Restoration error: ${v.message}`,canRetry:!0}):g.session&&g.session.user?(console.log("[SessionValidator] Session restored successfully"),this.clearCache(),{isValid:!0,needsLogin:!1,canRetry:!1}):{isValid:!1,needsLogin:!0,error:"Session restoration failed",canRetry:!0}}catch(t){return console.error("[SessionValidator] Error restoring session:",t),{isValid:!1,needsLogin:!0,error:`Restoration error: ${t}`,canRetry:!0}}}clearCache(){this.validationCache.clear(),console.log("[SessionValidator] Cache cleared")}cacheResult(t,s){this.validationCache.set(t,{result:s,timestamp:Date.now()})}getCachedResult(){const t=this.validationCache.get("session_validation");return t&&Date.now()-t.timestamp<this.CACHE_DURATION?t.result:null}};se(oe,"instance");let ie=oe;const ce=ie.getInstance(),Oe=(a=!1)=>ce.validateSession(a),He=()=>ce.restoreSession(),Fe=()=>ce.clearCache();async function ts(){console.log("[SessionValidator] Initializing session validation...");let a=await Oe();return!a.isValid&&a.canRetry&&(console.log("[SessionValidator] Attempting session restoration..."),a=await He()),a}function ss(){if(typeof window>"u")return()=>{};const a=()=>{console.log("[SessionValidator] Network restored, clearing cache for revalidation"),Fe()},t=()=>{console.log("[SessionValidator] Network lost, session validation may fail")};return window.addEventListener("online",a),window.addEventListener("offline",t),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",t)}}exports.configureSupabase=R.configureSupabase;exports.getSupabase=R.getSupabase;exports.handleDomainChangeAuth=R.handleDomainChangeAuth;exports.initializeCrossSubdomainAuth=R.initializeCrossSubdomainAuth;exports.restoreCrossSubdomainSession=R.restoreCrossSubdomainSession;exports.restoreSessionWithRetry=R.restoreSessionWithRetry;exports.setupAuthStateListener=R.setupAuthStateListener;exports.setupImmediateCrossSubdomainAuth=R.setupImmediateCrossSubdomainAuth;Object.defineProperty(exports,"supabase",{enumerable:!0,get:()=>R.supabase});exports.ACCESS_COOKIE=S.ACCESS_COOKIE;exports.LS_ACCESS_KEY=S.LS_ACCESS_KEY;exports.LS_REFRESH_KEY=S.LS_REFRESH_KEY;exports.REFRESH_COOKIE=S.REFRESH_COOKIE;exports.buildOAuthRedirectUrl=S.buildOAuthRedirectUrl;exports.clearLocalStorageTokens=S.clearLocalStorageTokens;exports.clearSessionCookie=S.clearSessionCookie;exports.ensureCrossSubdomainCookies=S.ensureCrossSubdomainCookies;exports.getCookie=S.getCookie;exports.getPostLoginBase=S.getPostLoginBase;exports.setSessionCookie=S.setSessionCookie;exports.syncCookiesToLocalStorage=S.syncCookiesToLocalStorage;exports.setupUniversalCallback=fo.setupUniversalCallback;exports.AIWorkspaceHeader=Pe;exports.AuthCallback=os;exports.LoginModal=De;exports.PackageError=re;exports.SessionLossModal=Ue;exports.SessionValidator=ie;exports.clearSessionCache=Fe;exports.conservativeConfig=Be;exports.createSessionConfig=Lo;exports.default=Pe;exports.defaultSessionConfig=ee;exports.detectionScenarios=Ro;exports.developmentConfig=fe;exports.fastDetectionConfig=Me;exports.getConfigByPreset=Mo;exports.getSessionConfig=ge;exports.handleBundlingError=Ie;exports.initializeSessionValidation=ts;exports.productionConfig=me;exports.restoreSession=He;exports.safeExecute=Eo;exports.safeExecuteAsync=Co;exports.safeGetCookie=bo;exports.safeGetLocalStorage=Ao;exports.safeImport=Vo;exports.safeSetCookie=No;exports.safeSetLocalStorage=Io;exports.safeWindowOperation=xo;exports.sessionConfigPresets=Re;exports.sessionValidator=ce;exports.setupGlobalErrorHandler=xe;exports.setupNetworkAwareValidation=ss;exports.timingInfo=Bo;exports.useAuth=We;exports.useEnhancedAuth=Le;exports.useSessionMonitor=Te;exports.useWorkspaceStore=$e;exports.validateSession=Oe;
