"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),P=require("element-plus"),Be=require("@supabase/supabase-js"),Pe=require("pinia");/*! Element Plus Icons Vue v2.3.2 */var We=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(t){return(a,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),he=We,Re=e.defineComponent({name:"Check",__name:"check",setup(t){return(a,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Oe=Re,Me=e.defineComponent({name:"Lock",__name:"lock",setup(t){return(a,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96"}),e.createElementVNode("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32m192-160v-64a192 192 0 1 0-384 0v64zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64"})]))}}),ge=Me,$e=e.defineComponent({name:"Message",__name:"message",setup(t){return(a,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M128 224v512a64 64 0 0 0 64 64h640a64 64 0 0 0 64-64V224zm0-64h768a64 64 0 0 1 64 64v512a128 128 0 0 1-128 128H192A128 128 0 0 1 64 736V224a64 64 0 0 1 64-64"}),e.createElementVNode("path",{fill:"currentColor",d:"M904 224 656.512 506.88a192 192 0 0 1-289.024 0L120 224zm-698.944 0 210.56 240.704a128 128 0 0 0 192.704 0L818.944 224z"})]))}}),Te=$e,De=e.defineComponent({name:"User",__name:"user",setup(t){return(a,s)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"})]))}}),ze=De;const G="aiworkspace.pro";function j(t){return t==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(t)}function fe(t){return t===G||t.endsWith(`.${G}`)}function Z(t){return document.cookie.split(";").map(i=>i.trim()).filter(i=>t.some(v=>i.startsWith(v+"=")))}function M(t,a,s=60*60*24*365){const i=location.hostname;if(j(i)){document.cookie=`${t}=${encodeURIComponent(a)}; Path=/; Max-Age=${s}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:i,name:t,valuePreview:a.slice(0,20)+"..."}),console.log("[auth][cookie][after]",Z([t]));return}document.cookie=`${t}=${encodeURIComponent(a)}; Domain=.${G}; Path=/; Max-Age=${s}; SameSite=Lax; Secure`,document.cookie=`${t}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:i,apex:G,name:t,valuePreview:a.slice(0,20)+"..."}),console.log("[auth][cookie][after]",Z([t]))}function z(t){const a=new RegExp("(?:^|; )"+t.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),s=document.cookie.match(a);return s?decodeURIComponent(s[1]):null}function J(t){const a=location.hostname;if(j(a)){document.cookie=`${t}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:a,name:t});return}document.cookie=`${t}=; Domain=.${G}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${t}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:a,apex:G,name:t}),console.log("[auth][cookie][after]",Z([t]))}function Q(t){const a=location.hostname;if(j(a)){console.log("[auth][cookie][promote] skip (local host)",a);return}if(!fe(a)){console.log("[auth][cookie][promote] skip (not under apex)",{host:a,apex:G});return}console.log("[auth][cookie][promote] start",{host:a,apex:G,names:t}),t.forEach(s=>{const i=z(s);i?M(s,i,60*60*24*365):console.log("[auth][cookie][promote] missing",s)}),console.log("[auth][cookie][promote] done",Z(t))}function ke(){return`${window.location.origin}/auth/callback`}function re(){try{const t=new URLSearchParams(location.search),a=["redirect","redirect_to","returnTo","next"].find(i=>t.get(i));let s=a?t.get(a):"";if(console.log("[getPostLoginBase] URL params:",Object.fromEntries(t)),console.log("[getPostLoginBase] Found param key:",a),console.log("[getPostLoginBase] Candidate from params:",s),s||(s=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||"",console.log("[getPostLoginBase] Candidate from storage:",s)),s||(s={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/",console.log("[getPostLoginBase] Using default:",s)),s.startsWith("http"))try{const i=new URL(s);return fe(i.hostname)||j(i.hostname)?(console.log("[getPostLoginBase] Returning absolute URL:",s),s):(console.log("[getPostLoginBase] Invalid hostname, returning /"),"/")}catch{return console.log("[getPostLoginBase] Invalid URL, returning /"),"/"}return s.startsWith("/")||(s="/"+s),console.log("[getPostLoginBase] Final candidate:",s),s}catch(t){return console.log("[getPostLoginBase] Error:",t),"/"}}const R="sb-access-token",O="sb-refresh-token",ee="sb-access-token",oe="sb-refresh-token";function F(){try{const t=z(R),a=z(O);t&&localStorage.setItem(ee,t),a&&localStorage.setItem(oe,a),console.log("[auth][cookie->ls] sync",{hasAccess:!!t,hasRefresh:!!a})}catch(t){console.log("[auth][cookie->ls] error",t)}}function q(){try{localStorage.removeItem(ee),localStorage.removeItem(oe),console.log("[auth][cookie->ls] cleared localStorage")}catch(t){console.log("[auth][cookie->ls] clear error",t)}}const Fe=Object.freeze(Object.defineProperty({__proto__:null,ACCESS_COOKIE:R,LS_ACCESS_KEY:ee,LS_REFRESH_KEY:oe,REFRESH_COOKIE:O,buildOAuthRedirectUrl:ke,clearLocalStorageTokens:q,clearSessionCookie:J,ensureCrossSubdomainCookies:Q,getCookie:z,getPostLoginBase:re,setSessionCookie:M,syncCookiesToLocalStorage:F},Symbol.toStringTag,{value:"Module"}));async function He(){try{Q([R,O]);const t=z(R),a=z(O);if(t&&a){const{data:{session:s}}=await L.auth.getSession();if(!s){const{data:i,error:v}=await L.auth.setSession({access_token:t,refresh_token:a});v?console.log("[auth][restore] error",v):console.log("[auth][restore] done",!!i.session)}}else console.log("[auth][restore] no cookies present");F()}catch(t){console.log("[auth][restore] exception",t)}}function me(){console.log("[auth][listener] Setting up auth state listener..."),L.auth.onAuthStateChange(async(t,a)=>{switch(console.log("[auth][listener] Auth state changed:",t,!!a),t){case"TOKEN_REFRESHED":console.log("[auth][listener] Token refreshed successfully"),a&&(M(R,a.access_token,60*60*24*365),M(O,a.refresh_token,60*60*24*365),F());break;case"SIGNED_IN":console.log("[auth][listener] User signed in"),a&&(M(R,a.access_token,60*60*24*365),M(O,a.refresh_token,60*60*24*365),F());break;case"SIGNED_OUT":console.log("[auth][listener] User signed out");break;case"USER_UPDATED":console.log("[auth][listener] User updated");break;default:console.log("[auth][listener] Unhandled auth event:",t)}})}async function se(){try{const{data:{session:t}}=await L.auth.getSession();if(t&&t.user)return console.log("[auth][restore] Active session found"),{success:!0,session:t};const a=z(R),s=z(O);if(a&&s){console.log("[auth][restore] Attempting to restore session from cookies...");const{data:i,error:v}=await L.auth.setSession({access_token:a,refresh_token:s});if(v)return console.log("[auth][restore] Failed to restore session:",v.message),{success:!1,error:v};if(i.session)return console.log("[auth][restore] Session restored successfully"),M(R,i.session.access_token,60*60*24*365),M(O,i.session.refresh_token,60*60*24*365),F(),{success:!0,session:i.session}}return console.log("[auth][restore] No valid session or cookies found"),{success:!1,error:"No valid session or cookies"}}catch(t){return console.log("[auth][restore] Exception during session restoration:",t),{success:!1,error:t}}}const ne="https://oqdnbpmmgntqtigstaow.supabase.co",le="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",L=Be.createClient(ne,le,{db:{schema:"public"},auth:{storageKey:"sb-auth-token",storage:localStorage,autoRefreshToken:!0,persistSession:!0,cookieOptions:{domain:window.location.hostname==="localhost"?"localhost":".aiworkspace.pro",path:"/",sameSite:"Lax",secure:window.location.protocol==="https:",maxAge:365*24*60*60}}});typeof window<"u"&&(Q([R,O]),me());console.log("Supabase Configuration:",{url:ne,hasKey:!!le,autoRefreshToken:!0,persistSession:!0});console.log("URL:",ne.replace(/https:\/\/(.+)\.supabase\.co/,"https://*****.supabase.co"));console.log("Key configured:",!le.includes("your-anon-key"));console.log("Environment mode:","production");const Je=Object.freeze(Object.defineProperty({__proto__:null,supabase:L},Symbol.toStringTag,{value:"Module"}));function we(){const t=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),a=e.ref(null),s=e.computed(()=>t.value.isAuthenticated),i=e.computed(()=>t.value.user),v=e.computed(()=>t.value.isLoading),S=async()=>{var n,h,c,y,V,I,N,g,f,u,b,k,m,$,T;try{const{data:{session:U}}=await L.auth.getSession();if(U&&U.user){const C=U.user,x={id:C.id,name:((n=C.user_metadata)==null?void 0:n.name)||((h=C.user_metadata)==null?void 0:h.user_name)||((c=C.user_metadata)==null?void 0:c.full_name)||((y=C.email)==null?void 0:y.split("@")[0])||"User",email:C.email,avatar_url:((V=C.user_metadata)==null?void 0:V.avatar_url)||null,user_metadata:C.user_metadata};return t.value={user:x,isAuthenticated:!0,isLoading:!1},a.value={user:x,access_token:U.access_token,refresh_token:U.refresh_token},{success:!0,session:a.value}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const B=await se();if(B.success&&B.session){console.log("[auth][enhanced] Session restored successfully");const C=B.session.user,x={id:C.id,name:((I=C.user_metadata)==null?void 0:I.name)||((N=C.user_metadata)==null?void 0:N.user_name)||((g=C.user_metadata)==null?void 0:g.full_name)||((f=C.email)==null?void 0:f.split("@")[0])||"User",email:C.email,avatar_url:((u=C.user_metadata)==null?void 0:u.avatar_url)||null,user_metadata:C.user_metadata};return t.value={user:x,isAuthenticated:!0,isLoading:!1},a.value=B.session,{success:!0,session:a.value}}else console.log("[auth][enhanced] Failed to restore session:",B.error)}catch(U){console.error("Error getting Supabase session:",U);try{const B=await se();if(B.success&&B.session){console.log("[auth][enhanced] Session restored after error");const C=B.session.user,x={id:C.id,name:((b=C.user_metadata)==null?void 0:b.name)||((k=C.user_metadata)==null?void 0:k.user_name)||((m=C.user_metadata)==null?void 0:m.full_name)||(($=C.email)==null?void 0:$.split("@")[0])||"User",email:C.email,avatar_url:((T=C.user_metadata)==null?void 0:T.avatar_url)||null,user_metadata:C.user_metadata};return t.value={user:x,isAuthenticated:!0,isLoading:!1},a.value=B.session,{success:!0,session:a.value}}}catch(B){console.error("Error restoring session:",B)}}return t.value={user:null,isAuthenticated:!1,isLoading:!1},a.value=null,{success:!1,error:"No valid session found"}},A=async()=>{try{await L.auth.signOut(),J(R),J(O),q(),t.value={user:null,isAuthenticated:!1,isLoading:!1},a.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(n){console.error("Error during logout:",n),t.value={user:null,isAuthenticated:!1,isLoading:!1},a.value=null}},W=async(n,h)=>{var c,y,V,I,N;try{t.value.isLoading=!0;const{data:g,error:f}=await L.auth.signInWithPassword({email:n,password:h});if(f)throw f;if(g.session){const u=g.session.user,b={id:u.id,name:((c=u.user_metadata)==null?void 0:c.name)||((y=u.user_metadata)==null?void 0:y.user_name)||((V=u.user_metadata)==null?void 0:V.full_name)||((I=u.email)==null?void 0:I.split("@")[0])||"User",email:u.email,avatar_url:((N=u.user_metadata)==null?void 0:N.avatar_url)||null,user_metadata:u.user_metadata};return t.value={user:b,isAuthenticated:!0,isLoading:!1},a.value={user:b,access_token:g.session.access_token,refresh_token:g.session.refresh_token},{success:!0,session:a.value}}return{success:!1,error:"No session returned"}}catch(g){return console.error("Sign in error:",g),t.value.isLoading=!1,{success:!1,error:g}}},_=async(n,h,c)=>{var y,V,I,N,g;try{t.value.isLoading=!0;const{data:f,error:u}=await L.auth.signUp({email:n,password:h,options:{data:c}});if(u)throw u;if(f.session){const b=f.session.user,k={id:b.id,name:((y=b.user_metadata)==null?void 0:y.name)||((V=b.user_metadata)==null?void 0:V.user_name)||((I=b.user_metadata)==null?void 0:I.full_name)||((N=b.email)==null?void 0:N.split("@")[0])||"User",email:b.email,avatar_url:((g=b.user_metadata)==null?void 0:g.avatar_url)||null,user_metadata:b.user_metadata};return t.value={user:k,isAuthenticated:!0,isLoading:!1},a.value={user:k,access_token:f.session.access_token,refresh_token:f.session.refresh_token},{success:!0,session:a.value}}return{success:!1,error:"No session returned"}}catch(f){return console.error("Sign up error:",f),t.value.isLoading=!1,{success:!1,error:f}}},d=async()=>{await S()};return e.onMounted(()=>{d()}),{authState:t,currentSession:a,isAuthenticated:s,currentUser:i,isLoading:v,loadUserInfo:S,logout:A,signIn:W,signUp:_,checkAuth:d}}const ve=Pe.defineStore("workspace",()=>{const t=e.ref(null),a=e.ref([]),s=e.ref(null),i=d=>{t.value=d,localStorage.setItem("current_workspace",JSON.stringify(d))},v=d=>{a.value=d,localStorage.setItem("available_workspaces",JSON.stringify(d))};return{currentWorkspace:t,workspaces:a,user:s,setCurrentWorkspace:i,setWorkspaces:v,setUser:d=>{s.value=d,localStorage.setItem("user_info",JSON.stringify(d))},loadPersistedData:()=>{const d=localStorage.getItem("current_workspace");if(d)try{t.value=JSON.parse(d)}catch(c){console.error("Error loading persisted workspace:",c)}const n=localStorage.getItem("available_workspaces");if(n)try{a.value=JSON.parse(n)}catch(c){console.error("Error loading persisted workspaces:",c)}const h=localStorage.getItem("user_info");if(h)try{s.value=JSON.parse(h)}catch(c){console.error("Error loading persisted user:",c)}},clearData:()=>{t.value=null,a.value=[],s.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(d=!1)=>{try{const{data:{user:n}}=await L.auth.getUser();if(!n)return[];let h=L.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at,
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",n.id);d||(h=h.eq("archived",!1));const{data:c,error:y}=await h;if(y)throw y;const V=new Map;(c||[]).forEach(u=>{(u.workspace_access||[]).forEach(b=>{b.shared_with_user_id===n.id&&V.set(u.id,b)})});const I=[...new Set((c||[]).filter(u=>u.parent_workspace_id).map(u=>u.parent_workspace_id).filter(u=>!V.has(u)))];let N=[];if(I.length){let u=L.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",I);d||(u=u.eq("archived",!1));const{data:b,error:k}=await u;if(k)throw k;N=b||[]}const f=[...c||[],...N].map(u=>{var b,k,m;return{id:u.id,title:u.title,description:u.description||"No description",parent_workspace_id:u.parent_workspace_id,created_by:u.created_by,archived:u.archived,created_at:u.created_at,latest_activity:((k=(b=u.workspace_activities)==null?void 0:b[0])==null?void 0:k.updated_at)||u.created_at,hasAccess:V.has(u.id),accessType:((m=V.get(u.id))==null?void 0:m.access_type)||null}});return f.sort((u,b)=>new Date(b.latest_activity)-new Date(u.latest_activity)),v(f),f}catch(n){return console.error("loadWorkspaces error",n),[]}}}});function _e(){const t=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),a=e.ref(window.location.href),s=async()=>{var d,n,h,c,y,V,I,N;try{t.value.isLoading=!0;const{data:{session:g},error:f}=await L.auth.getSession();if(f){console.error("Error checking auth status:",f),t.value={user:null,isAuthenticated:!1,isLoading:!1,error:f.message};return}g!=null&&g.user?(t.value={user:{id:g.user.id,email:g.user.email||"",name:((d=g.user.user_metadata)==null?void 0:d.full_name)||((n=g.user.user_metadata)==null?void 0:n.name)||((h=g.user.email)==null?void 0:h.split("@")[0])||"User",avatar_url:((c=g.user.user_metadata)==null?void 0:c.avatar_url)||((y=g.user.user_metadata)==null?void 0:y.picture)||null,initials:(((V=g.user.user_metadata)==null?void 0:V.full_name)||((I=g.user.user_metadata)==null?void 0:I.name)||((N=g.user.email)==null?void 0:N.split("@")[0])||"U").split(" ").map(u=>u[0]).join("").toUpperCase().substring(0,2)},isAuthenticated:!0,isLoading:!1,error:null},g.access_token&&M(R,g.access_token),g.refresh_token&&M(O,g.refresh_token),F()):t.value={user:null,isAuthenticated:!1,isLoading:!1,error:null}}catch(g){console.error("Auth check failed:",g),t.value={user:null,isAuthenticated:!1,isLoading:!1,error:g.message||"Authentication check failed"}}},i=async(d,n)=>{try{const{error:h}=await L.auth.signInWithPassword({email:d,password:n});return h?{success:!1,error:h.message}:(await s(),sessionStorage.setItem("post-login-redirect",a.value),{success:!0})}catch(h){return console.error("Login error:",h),{success:!1,error:h.message||"Login failed"}}},v=async(d,n)=>{var h;try{const{data:c,error:y}=await L.auth.signUp({email:d,password:n});return y?{success:!1,error:y.message}:c.user&&!c.user.email_confirmed_at?{success:!0,needsConfirmation:!0}:(h=c.session)!=null&&h.user?(await s(),sessionStorage.setItem("post-login-redirect",a.value),{success:!0}):{success:!1,error:"No session created"}}catch(c){return console.error("Signup error:",c),{success:!1,error:c.message||"Signup failed"}}},S=async d=>{try{const n=`${window.location.origin}/auth/callback`;console.log("[OAuth] Starting login with provider:",d),console.log("[OAuth] Redirect URL:",n),console.log("[OAuth] Current URL:",a.value),console.log("[OAuth] Current origin:",window.location.origin);const{error:h}=await L.auth.signInWithOAuth({provider:d,options:{redirectTo:n,queryParams:{redirect_origin:a.value}}});if(h)return console.error("[OAuth] Error:",h),{success:!1,error:h.message};const c=a.value||window.location.href;return sessionStorage.setItem("post-login-redirect",c),localStorage.setItem("post-login-redirect",c),console.log("[OAuth] Stored redirect URL:",c),console.log("[OAuth] Current URL value:",a.value),console.log("[OAuth] Window location href:",window.location.href),{success:!0}}catch(n){return console.error("OAuth login error:",n),{success:!1,error:n.message||"OAuth login failed"}}},A=async()=>{try{const{error:d}=await L.auth.signOut();d&&console.error("Logout error:",d),t.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},J(R),J(O),q()}catch(d){console.error("Logout error:",d)}},W=async d=>{try{const{error:n}=await L.auth.resetPasswordForEmail(d,{redirectTo:`${window.location.origin}/auth/reset-password`});return n?{success:!1,error:n.message}:{success:!0}}catch(n){return console.error("Password reset error:",n),{success:!1,error:n.message||"Password reset failed"}}},_=()=>{L.auth.onAuthStateChange((d,n)=>{var h;switch(console.log("Auth state changed:",d,(h=n==null?void 0:n.user)==null?void 0:h.email),d){case"SIGNED_IN":n!=null&&n.user&&s();break;case"SIGNED_OUT":t.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},J(R),J(O),q();break;case"TOKEN_REFRESHED":n!=null&&n.access_token&&M(R,n.access_token),n!=null&&n.refresh_token&&M(O,n.refresh_token),F();break;case"USER_UPDATED":n!=null&&n.user&&s();break}})};return e.onMounted(async()=>{_(),await s()}),e.watch(()=>window.location.href,d=>{a.value=d}),{authState:e.computed(()=>t.value),isAuthenticated:e.computed(()=>t.value.isAuthenticated),user:e.computed(()=>t.value.user),isLoading:e.computed(()=>t.value.isLoading),checkAuthStatus:s,loginWithEmail:i,signupWithEmail:v,loginWithProvider:S,logout:A,resetPassword:W,currentUrl:e.computed(()=>a.value)}}const Ge={class:"login-container"},Ke={class:"logo-section"},Ye={class:"login-buttons"},qe={key:0,class:"forgot-password"},Xe={class:"signup-link"},Ze=e.defineComponent({__name:"LoginModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","login-success"],setup(t,{emit:a}){const s=t,i=a,v=e.computed({get:()=>s.modelValue,set:k=>i("update:modelValue",k)}),S=e.ref(!1),A=e.ref(!1),W=e.ref(),{loginWithEmail:_,signupWithEmail:d,loginWithProvider:n,resetPassword:h}=_e(),c=e.reactive({email:"",password:"",confirmPassword:""}),y=e.computed(()=>({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email",trigger:"blur"}],password:[{required:!0,message:"Please enter your password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],...S.value?{confirmPassword:[{required:!0,message:"Please confirm your password",trigger:"blur"},{validator:(k,m,$)=>{m!==c.password?$(new Error("Passwords do not match")):$()},trigger:"blur"}]}:{}})),V=()=>{var k;S.value=!S.value,c.email="",c.password="",c.confirmPassword="",(k=W.value)==null||k.clearValidate()},I=()=>{var k;v.value=!1,c.email="",c.password="",c.confirmPassword="",S.value=!1,(k=W.value)==null||k.clearValidate()},N=async()=>{if(W.value)try{await W.value.validate(),A.value=!0,S.value?await f():await g()}catch(k){console.error("Form validation failed:",k)}finally{A.value=!1}},g=async()=>{const k=await _(c.email,c.password);k.success?(P.ElMessage.success("Login successful"),i("login-success",{email:c.email}),I()):P.ElMessage.error("Login failed: "+k.error)},f=async()=>{const k=await d(c.email,c.password);k.success?k.needsConfirmation?P.ElMessage.success("Please check your email to confirm your account"):(P.ElMessage.success("Account created successfully"),i("login-success",{email:c.email}),I()):P.ElMessage.error("Signup failed: "+k.error)},u=async k=>{const m=await n(k);m.success?P.ElMessage.success("Redirecting to login provider..."):P.ElMessage.error("Login failed: "+m.error)},b=async()=>{if(!c.email){P.ElMessage.warning("Please enter your email address first");return}const k=await h(c.email);k.success?P.ElMessage.success("Password reset email sent! Please check your inbox."):P.ElMessage.error("Failed to send reset email: "+k.error)};return(k,m)=>{const $=e.resolveComponent("el-icon"),T=e.resolveComponent("el-input"),U=e.resolveComponent("el-form-item"),B=e.resolveComponent("el-button"),C=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(C,{modelValue:v.value,"onUpdate:modelValue":m[6]||(m[6]=x=>v.value=x),title:"",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!0,class:"login-modal",onClose:I},{default:e.withCtx(()=>[e.createElementVNode("div",Ge,[e.createElementVNode("div",Ke,[e.createElementVNode("h2",null,e.toDisplayString(S.value?"Create Account":"Welcome Back"),1),e.createElementVNode("p",null,e.toDisplayString(S.value?"Sign up to get started with your account":"Sign in to continue to your account"),1)]),e.createVNode(e.unref(P.ElForm),{model:c,rules:y.value,ref_key:"formRef",ref:W,class:"login-form",onSubmit:e.withModifiers(N,["prevent"])},{default:e.withCtx(()=>[e.createVNode(U,{prop:"email"},{default:e.withCtx(()=>[e.createVNode(T,{modelValue:c.email,"onUpdate:modelValue":m[0]||(m[0]=x=>c.email=x),placeholder:"Email",type:"email",size:"large",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode($,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Te))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(U,{prop:"password"},{default:e.withCtx(()=>[e.createVNode(T,{modelValue:c.password,"onUpdate:modelValue":m[1]||(m[1]=x=>c.password=x),placeholder:"Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode($,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ge))]),_:1})]),_:1},8,["modelValue"])]),_:1}),S.value?(e.openBlock(),e.createBlock(U,{key:0,prop:"confirmPassword"},{default:e.withCtx(()=>[e.createVNode(T,{modelValue:c.confirmPassword,"onUpdate:modelValue":m[2]||(m[2]=x=>c.confirmPassword=x),placeholder:"Confirm Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode($,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ge))]),_:1})]),_:1},8,["modelValue"])]),_:1})):e.createCommentVNode("",!0),e.createVNode(U,null,{default:e.withCtx(()=>[e.createVNode(B,{type:"primary",class:"submit-button",loading:A.value,onClick:N,size:"large"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.value?"Sign Up":"Sign In"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),m[10]||(m[10]=e.createElementVNode("div",{class:"divider"},[e.createElementVNode("span",null,"Or continue with")],-1)),e.createElementVNode("div",Ye,[e.createVNode(B,{class:"login-button google",onClick:m[3]||(m[3]=x=>u("google")),size:"large"},{default:e.withCtx(()=>[...m[7]||(m[7]=[e.createElementVNode("span",{class:"social-icon"},"G",-1),e.createTextVNode(" Google ",-1)])]),_:1}),e.createVNode(B,{class:"login-button github",onClick:m[4]||(m[4]=x=>u("github")),size:"large"},{default:e.withCtx(()=>[...m[8]||(m[8]=[e.createElementVNode("span",{class:"social-icon"},"⚡",-1),e.createTextVNode(" GitHub ",-1)])]),_:1}),e.createVNode(B,{class:"login-button twitter",onClick:m[5]||(m[5]=x=>u("twitter")),size:"large"},{default:e.withCtx(()=>[...m[9]||(m[9]=[e.createElementVNode("span",{class:"social-icon"},"X",-1),e.createTextVNode(" X (Twitter) ",-1)])]),_:1})]),m[11]||(m[11]=e.createElementVNode("div",{class:"terms"}," By continuing, you agree to AI Workspace's Terms of Service and Privacy Policy ",-1)),S.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",qe,[e.createElementVNode("a",{href:"#",onClick:e.withModifiers(b,["prevent"])},"Forgot Password?")])),e.createElementVNode("div",Xe,[e.createTextVNode(e.toDisplayString(S.value?"Already have an account?":"Don't have an account?")+" ",1),e.createElementVNode("a",{href:"#",onClick:e.withModifiers(V,["prevent"])},e.toDisplayString(S.value?"Sign in":"Sign up"),1)])])]),_:1},8,["modelValue"])}}});const ce=(t,a)=>{const s=t.__vccOpts||t;for(const[i,v]of a)s[i]=v;return s},ye=ce(Ze,[["__scopeId","data-v-684a3f28"]]),je={class:"aiworkspace-header"},Qe={key:0,class:"header-content header-loading"},eo={key:1,class:"header-content header-fallback"},oo={key:2,class:"header-content"},to={class:"header-left"},ao={class:"logo-section"},so={href:"/",class:"logo"},ro=["src"],no={key:1,class:"text-logo"},lo={key:0,class:"header-center"},co={class:"main-navigation"},io={class:"nav-item"},uo={href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},po={class:"workspace-dropdown-item"},ho=["href"],go={class:"workspace-icon"},fo={key:1,class:"nav-divider"},ko={class:"nav-item"},mo=["href","onClick"],wo={class:"header-right"},vo={class:"user-profile"},_o={class:"user-info"},yo={class:"user-name"},So={class:"user-avatar"},Co=["src","alt"],Eo={key:1,class:"avatar-placeholder"},bo={key:3,class:"header-content header-unauthenticated"},No={class:"header-left"},Vo={class:"logo-section"},Io={href:"/",class:"logo"},Ao=["src"],Lo={key:1,class:"text-logo"},Uo={class:"header-right"},xo={class:"workspace-list"},Bo=["onClick"],Po={class:"workspace-icon"},Wo={class:"workspace-details"},Ro={class:"workspace-members"},Oo={key:0,class:"current-indicator"},Y=50,Mo=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(t,{emit:a}){const s=t,i=a,{authState:v,logout:S}=we(),A=()=>{try{return ve()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},W=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},_=e.ref(A()),d=e.computed(()=>!!_.value),n=e.ref(0),h=()=>{if(!_.value&&n.value<Y){if(W()){const r=A();if(r){_.value=r,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}n.value++,setTimeout(h,100)}else n.value>=Y&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{_.value||h()});const c=e.ref(!1),y=e.ref(!1),V=e.ref([]),I=e.ref([]),N=e.ref({name:"",email:"",avatar_url:null,initials:""}),g=e.ref([]),f=e.ref([]),u=e.ref(!1);e.watch(f,async r=>{r.length>0&&d.value&&T.value&&await $()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{d.value&&T.value&&await $()},{immediate:!1});const b=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,r=>{b.value=r},{immediate:!0}),e.watch(d,r=>{!r&&n.value<Y&&h()});const k=()=>{try{const r=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(r)return r[1];const l=new URLSearchParams(window.location.search).get("workspace_id");if(l)return l;const p=window.location.hash.match(/workspace_id=(\d+)/);return p?p[1]:null}catch(r){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",r),null}},m=()=>{try{return window.location.pathname.includes("/all-workspace/")}catch(r){return console.warn("[AIWorkspaceHeader] Error checking all-workspace mode:",r),!1}},$=async()=>{if(!_.value||!d.value)return;const r=m();if(u.value=r,r){_.value.currentWorkspace=null,localStorage.removeItem("current_workspace"),console.log("[AIWorkspaceHeader] Auto-selected all-workspace mode from URL");return}const o=k();if(o)try{f.value.length===0&&await ue();const l=f.value.find(p=>p.id.toString()===o);l?(_.value.setCurrentWorkspace(l),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${l.title} (ID: ${l.id})`),i("workspaceChange",l)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${o} not found in available workspaces`)}catch(l){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",l)}},T=e.computed(()=>v.value.isAuthenticated),U=e.computed(()=>_.value?_.value.currentWorkspace:null),B=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),C=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"All Tasks",key:"tasks",url:"/tasks"},{label:"All Goals",key:"goals",url:"/goals"},{label:"All Events",key:"events",url:"/events"},{label:"All Drive",key:"files",url:"/files"},{label:"All Contacts",key:"contacts",url:"/contacts"},{label:"All Settings",key:"settings",url:"/settings"}]),x=e.computed(()=>u.value?C.value:B.value),Ce=e.computed(()=>{try{const r=b.value;let o="";const l=r.match(/\/all-workspace\/([^\/]+)/);if(l)o=l[1];else{const p=r.match(/\/single-workspace\/\d+\/([^\/]+)/);if(p)o=p[1];else{const E=r.match(/\/([^\/]+)$/);E&&(o=E[1])}}if(o){const p=x.value.find(E=>E.key===o||E.url.includes(`/${o}`)||E.url===`/${o}`);if(p)return p.label}return"Dashboard"}catch(r){return console.warn("[AIWorkspaceHeader] Error determining current section:",r),"Dashboard"}}),Ee=r=>{const o=new Map;r.forEach(E=>{o.set(E.id,{...E,children:[]})});const l=[];o.forEach(E=>{E.parent_workspace_id&&o.has(E.parent_workspace_id)?o.get(E.parent_workspace_id).children.push(E):l.push(E)});const p=E=>{E.sort((D,H)=>D.title.localeCompare(H.title)),E.forEach(D=>{D.children&&p(D.children)})};return p(l),l},ie=(r,o=0,l=[])=>(r.forEach(p=>{l.push({...p,level:o}),p.children&&p.children.length&&ie(p.children,o+1,l)}),l),ue=async()=>{var r,o,l;try{const p=await((r=_.value)==null?void 0:r.loadWorkspaces());if(g.value=Ee(p||[]),f.value=ie(g.value),I.value=f.value,V.value=f.value,s.currentWorkspaceId){const E=f.value.find(D=>{var H;return D.id.toString()===((H=s.currentWorkspaceId)==null?void 0:H.toString())});E&&((o=_.value)==null||o.setCurrentWorkspace(E))}else!U.value&&f.value.length&&((l=_.value)==null||l.setCurrentWorkspace(f.value[0]))}catch(p){console.error("loadWorkspaces (header) error",p)}},be=r=>{if(console.log("Navigation command:",r),r==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const o=parseInt(r.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o}/dashboard`;return}},Ne=r=>{const o=U.value,l=u.value;switch(r.key){case"dashboard":l?window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":o?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(l)window.location.href="https://outline.aiworkspace.pro/all-workspace/outlines";else if(o){const p=`https://outline.aiworkspace.pro/single-workspace/${o.id}/outlines`;window.location.href=p}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(l)window.location.href="https://canvas.aiworkspace.pro/all-workspace/canvas";else if(o){const p=`https://canvas.aiworkspace.pro/single-workspace/${o.id}/canvas`;window.location.href=p}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(l)window.location.href="https://drive.aiworkspace.pro/all-workspace/files";else if(o){const p=`https://drive.aiworkspace.pro/single-workspace/${o.id}/files`;window.location.href=p}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(l)window.location.href="https://tasks.aiworkspace.pro/all-workspace/tasks";else if(o){const p=`https://tasks.aiworkspace.pro/single-workspace/${o.id}/tasks`;window.location.href=p}else window.location.href="https://tasks.aiworkspace.pro";break;case"goals":if(l)window.location.href="https://app.aiworkspace.pro/all-workspace/goals";else if(o){const p=`https://app.aiworkspace.pro/single-workspace/${o.id}/goals`;window.location.href=p}else window.location.href="https://app.aiworkspace.pro/all-workspace/goals";break;case"events":if(l)window.location.href="https://app.aiworkspace.pro/all-workspace/events";else if(o){const p=`https://app.aiworkspace.pro/single-workspace/${o.id}/events`;window.location.href=p}else window.location.href="https://app.aiworkspace.pro/all-workspace/events";break;case"contacts":if(l)window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";else if(o){const p=`https://app.aiworkspace.pro/single-workspace/${o.id}/contacts`;window.location.href=p}else window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";break;case"ai-portfolios":if(l)window.location.href="https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios";else if(o){const p=`https://spreadsheet.aiworkspace.pro/single-workspace/${o.id}/ai-portfolios`;window.location.href=p}else window.location.href="https://spreadsheet.aiworkspace.pro";break;case"settings":if(l)window.location.href="https://settings.aiworkspace.pro/all-workspace/settings";else if(o){const p=`https://settings.aiworkspace.pro/single-workspace/${o.id}/settings`;window.location.href=p}else window.location.href="https://settings.aiworkspace.pro";break;default:if(l){const p=`https://app.aiworkspace.pro/all-workspace/${r.key}`;window.location.href=p}else if(o){const p=`https://app.aiworkspace.pro/single-workspace/${o.id}/${r.key}`;window.location.href=p}else{const p=`https://app.aiworkspace.pro/${r.key}`;window.location.href=p}break}},Ve=r=>{const o=U.value,l=u.value;switch(r.key){case"dashboard":return l?"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":o?`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o.id}/dashboard`:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";case"ai-portfolios":return l?"https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios":o?`https://spreadsheet.aiworkspace.pro/single-workspace/${o.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return l?"https://outline.aiworkspace.pro/all-workspace/outlines":o?`https://outline.aiworkspace.pro/single-workspace/${o.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return l?"https://canvas.aiworkspace.pro/all-workspace/canvas":o?`https://canvas.aiworkspace.pro/single-workspace/${o.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return l?"https://drive.aiworkspace.pro/all-workspace/files":o?`https://drive.aiworkspace.pro/single-workspace/${o.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return l?"https://tasks.aiworkspace.pro/all-workspace/tasks":o?`https://tasks.aiworkspace.pro/single-workspace/${o.id}/tasks`:"https://tasks.aiworkspace.pro";case"goals":return l?"https://app.aiworkspace.pro/all-workspace/goals":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/goals`:"https://app.aiworkspace.pro/all-workspace/goals";case"events":return l?"https://app.aiworkspace.pro/all-workspace/events":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/events`:"https://app.aiworkspace.pro/all-workspace/events";case"contacts":return l?"https://app.aiworkspace.pro/all-workspace/contacts":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/contacts`:"https://app.aiworkspace.pro/all-workspace/contacts";case"settings":return l?"https://settings.aiworkspace.pro/all-workspace/settings":o?`https://settings.aiworkspace.pro/single-workspace/${o.id}/settings`:"https://settings.aiworkspace.pro";default:return l?`https://app.aiworkspace.pro/all-workspace/${r.key}`:o?`https://app.aiworkspace.pro/single-workspace/${o.id}/${r.key}`:`https://app.aiworkspace.pro/${r.key}`}},X=r=>{switch(r){case"profile":s.onProfileClick?s.onProfileClick():P.ElMessage.info("Profile settings coming soon");break;case"workspaces":c.value=!0;break;case"logout":Ae();break}},de=r=>{var o;(o=_.value)==null||o.setCurrentWorkspace(r),c.value=!1,i("workspaceChange",r),P.ElMessage.success(`Switched to ${r.title}`)},Ie=()=>{P.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:r})=>{var l;const o={id:Date.now(),title:r,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};V.value.push(o),(l=_.value)==null||l.setWorkspaces(V.value),de(o),P.ElMessage.success(`Created workspace: ${r}`)}).catch(()=>{})},Ae=()=>{P.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var r;(r=_.value)==null||r.clearData(),await S(),i("logout"),P.ElMessage.success("Signed out successfully")}).catch(()=>{})},te=async()=>{var r,o;if(v.value.user){const l=v.value.user;N.value={name:l.name||((r=l.email)==null?void 0:r.split("@")[0])||"User",email:l.email||"",avatar_url:l.avatar_url||null,initials:(l.name||((o=l.email)==null?void 0:o.split("@")[0])||"U").split(" ").map(p=>p[0]).join("").toUpperCase().substring(0,2)},s.showWorkspaceSelector&&await ue()}};e.watch(()=>v.value.user,r=>{var o;r?te():(N.value={name:"",email:"",avatar_url:null,initials:""},(o=_.value)==null||o.clearData())}),e.watch(()=>s.currentWorkspaceId,r=>{var o;if(r&&f.value.length){const l=f.value.find(p=>p.id.toString()===r.toString());l&&((o=_.value)==null||o.setCurrentWorkspace(l))}}),e.onMounted(async()=>{T.value&&(await te(),await $())});const Le=async r=>{console.log("Login successful:",r),y.value=!1,await te(),i("login"),P.ElMessage.success("Welcome back!")},Ue=()=>{n.value=0,h(),P.ElMessage.success("Manual Pinia retry initiated.")};return(r,o)=>{const l=e.resolveComponent("el-icon"),p=e.resolveComponent("el-tag"),E=e.resolveComponent("el-dropdown-item"),D=e.resolveComponent("el-dropdown-menu"),H=e.resolveComponent("el-dropdown"),ae=e.resolveComponent("el-button"),xe=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",je,[!d.value&&n.value<Y?(e.openBlock(),e.createElementBlock("div",Qe,[...o[8]||(o[8]=[e.createStaticVNode('<div class="header-left" data-v-f830d242><div class="logo-section" data-v-f830d242><a href="/" class="logo" data-v-f830d242><div class="text-logo" data-v-f830d242><span class="logo-text" data-v-f830d242>AI Workspace</span></div></a></div></div><div class="header-center" data-v-f830d242><span class="loading-text" data-v-f830d242>Initializing...</span></div>',2)])])):!d.value&&n.value>=Y?(e.openBlock(),e.createElementBlock("div",eo,[o[10]||(o[10]=e.createStaticVNode('<div class="header-left" data-v-f830d242><div class="logo-section" data-v-f830d242><a href="/" class="logo" data-v-f830d242><div class="text-logo" data-v-f830d242><span class="logo-text" data-v-f830d242>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[o[9]||(o[9]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:Ue,class:"retry-button"},"Retry Pinia")]),o[11]||(o[11]=e.createStaticVNode('<div class="header-right" data-v-f830d242><div class="user-profile" data-v-f830d242><div class="user-info" data-v-f830d242><span class="user-name" data-v-f830d242>User</span></div><div class="user-avatar" data-v-f830d242><span class="avatar-placeholder" data-v-f830d242>U</span></div></div></div>',1))])):T.value?(e.openBlock(),e.createElementBlock("div",oo,[e.createElementVNode("div",to,[e.createElementVNode("div",ao,[e.createElementVNode("a",so,[r.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:r.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,ro)):(e.openBlock(),e.createElementBlock("div",no,[...o[12]||(o[12]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),r.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",lo,[e.createElementVNode("nav",co,[r.showWorkspaceSelector?(e.openBlock(),e.createBlock(H,{key:0,onCommand:be,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(D,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(E,{command:"all-workspace",class:e.normalizeClass({active:u.value})},{default:e.withCtx(()=>[e.createElementVNode("a",uo,[e.createElementVNode("div",po,[o[14]||(o[14]=e.createElementVNode("span",{class:"workspace-icon"},"🌐",-1)),o[15]||(o[15]=e.createElementVNode("span",null,"All workspace",-1)),u.value?(e.openBlock(),e.createBlock(p,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...o[13]||(o[13]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)])])]),_:1},8,["class"]),f.value.length>0?(e.openBlock(),e.createBlock(E,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,w=>(e.openBlock(),e.createBlock(E,{key:w.id,command:`workspace-${w.id}`},{default:e.withCtx(()=>{var K;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${w.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(w.level||0)*16+"px"})},[e.createElementVNode("span",go,e.toDisplayString(w.children&&w.children.length?"📁":"📄"),1),e.createElementVNode("span",null,e.toDisplayString(w.title),1),w.id===((K=U.value)==null?void 0:K.id)?(e.openBlock(),e.createBlock(p,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...o[16]||(o[16]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,ho)]}),_:2},1032,["command"]))),128)),f.value.length===0?(e.openBlock(),e.createBlock(E,{key:1,disabled:""},{default:e.withCtx(()=>[...o[17]||(o[17]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var w;return[e.createElementVNode("span",io,[e.createTextVNode(e.toDisplayString(u.value?"All workspace":((w=U.value)==null?void 0:w.title)||"Select Workspace")+" ",1),e.createVNode(l,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(he))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),r.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",fo,"/")):e.createCommentVNode("",!0),r.showSecondaryNavigation?(e.openBlock(),e.createBlock(H,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.value,w=>(e.openBlock(),e.createBlock(E,{key:w.label,class:e.normalizeClass({active:w.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:Ve(w),class:"nav-link",onClick:e.withModifiers(K=>Ne(w),["prevent"])},e.toDisplayString(w.label),9,mo)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",ko,[e.createTextVNode(e.toDisplayString(Ce.value)+" ",1),e.createVNode(l,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(he))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",wo,[e.createVNode(H,{onCommand:X,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(E,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:o[0]||(o[0]=e.withModifiers(w=>X("profile"),["prevent"]))},"Profile Settings")]),_:1}),r.showWorkspaceSelector?(e.openBlock(),e.createBlock(E,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:o[1]||(o[1]=e.withModifiers(w=>X("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(E,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:o[2]||(o[2]=e.withModifiers(w=>X("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",vo,[e.createElementVNode("div",_o,[e.createElementVNode("span",yo,e.toDisplayString(N.value.name),1)]),e.createElementVNode("div",So,[N.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:N.value.avatar_url,alt:N.value.name},null,8,Co)):(e.openBlock(),e.createElementBlock("span",Eo,e.toDisplayString(N.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",bo,[e.createElementVNode("div",No,[e.createElementVNode("div",Vo,[e.createElementVNode("a",Io,[r.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:r.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Ao)):(e.openBlock(),e.createElementBlock("div",Lo,[...o[18]||(o[18]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),o[20]||(o[20]=e.createElementVNode("div",{class:"header-center"},[e.createElementVNode("span",{class:"welcome-text"},"Welcome to AI Workspace")],-1)),e.createElementVNode("div",Uo,[e.createVNode(ae,{type:"primary",size:"large",class:"login-button",onClick:o[3]||(o[3]=w=>y.value=!0)},{default:e.withCtx(()=>[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ze))]),_:1}),o[19]||(o[19]=e.createTextVNode(" Login / Signup ",-1))]),_:1})])])),T.value&&r.showWorkspaceSelector?(e.openBlock(),e.createBlock(xe,{key:4,modelValue:c.value,"onUpdate:modelValue":o[5]||(o[5]=w=>c.value=w),title:"Switch Workspace",width:"500px",onClose:o[6]||(o[6]=w=>c.value=!1)},{footer:e.withCtx(()=>[e.createVNode(ae,{onClick:o[4]||(o[4]=w=>c.value=!1)},{default:e.withCtx(()=>[...o[21]||(o[21]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(ae,{type:"primary",onClick:Ie},{default:e.withCtx(()=>[...o[22]||(o[22]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",xo,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(V.value,w=>{var K,pe;return e.openBlock(),e.createElementBlock("div",{key:w.id,class:e.normalizeClass(["workspace-item",{active:w.id===((K=U.value)==null?void 0:K.id)}]),onClick:Fo=>de(w)},[e.createElementVNode("div",Po,e.toDisplayString(w.children&&w.children.length?"📁":"📄"),1),e.createElementVNode("div",Wo,[e.createElementVNode("h3",null,e.toDisplayString(w.title),1),e.createElementVNode("p",null,e.toDisplayString(w.description),1),e.createElementVNode("span",Ro,e.toDisplayString(w.hasAccess?"Active":"Inactive"),1)]),w.id===((pe=U.value)==null?void 0:pe.id)?(e.openBlock(),e.createElementBlock("div",Oo,[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Oe))]),_:1})])):e.createCommentVNode("",!0)],10,Bo)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0),e.createVNode(ye,{modelValue:y.value,"onUpdate:modelValue":o[7]||(o[7]=w=>y.value=w),onLoginSuccess:Le},null,8,["modelValue"])])}}});const $o=ce(Mo,[["__scopeId","data-v-f830d242"]]),To={class:"auth-callback"},Do=e.defineComponent({__name:"AuthCallback",setup(t){e.onMounted(async()=>{console.log("[AuthCallback] Component mounted, starting callback processing..."),console.log("[AuthCallback] Current URL:",window.location.href),console.log("[AuthCallback] Current hash:",window.location.hash);try{await new Promise(v=>setTimeout(v,500));const{data:s,error:i}=await L.auth.getSession();if(i){console.error("Error processing callback:",i),a();return}if(s!=null&&s.session){const v=s.session.user;console.log("OAuth login successful:",v.email),s.session.access_token&&M(R,s.session.access_token),s.session.refresh_token&&M(O,s.session.refresh_token),F();const S=re();console.log("[callback] Post-login redirect URL:",S),console.log("[callback] Session storage redirect:",sessionStorage.getItem("post-login-redirect")),console.log("[callback] Local storage redirect:",localStorage.getItem("post-login-redirect"));const A=S||"/";if(console.log("[callback] Final redirect URL:",A),A.startsWith("/")){const W=window.location.origin,_=`${W}${A}`;console.log("[callback] redirecting to:",_,{hostname:window.location.hostname,origin:W}),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=_},100)}else console.log("[callback] redirecting to absolute URL:",A),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=A},100)}else a()}catch(s){console.error("Error processing callback:",s),a()}});const a=()=>{const i=window.location.href.replace("/auth/callback","");window.location.href=i};return(s,i)=>(e.openBlock(),e.createElementBlock("div",To,[...i[0]||(i[0]=[e.createElementVNode("div",{class:"callback-container"},[e.createElementVNode("div",{class:"loading-spinner"},[e.createElementVNode("div",{class:"spinner"})]),e.createElementVNode("h2",null,"Processing login..."),e.createElementVNode("p",null,"Please wait while we complete your authentication.")],-1)])]))}});const zo=ce(Do,[["__scopeId","data-v-acdf6325"]]);function Se(){const t=()=>{const i=window.location.hash,v=window.location.pathname,S=window.location.search;return i.includes("access_token=")||i.includes("refresh_token=")||S.includes("access_token=")||S.includes("refresh_token=")||v.includes("/auth/callback")||i.includes("#/auth/callback")},a=async i=>{const v=i.user;console.log("[UniversalCallback] OAuth login successful:",v.email),i.access_token&&setSessionCookie(ACCESS_COOKIE,i.access_token),i.refresh_token&&setSessionCookie(REFRESH_COOKIE,i.refresh_token),syncCookiesToLocalStorage();const S=getPostLoginBase();console.log("[UniversalCallback] Post-login redirect URL:",S),console.log("[UniversalCallback] Session storage redirect:",sessionStorage.getItem("post-login-redirect")),console.log("[UniversalCallback] Local storage redirect:",localStorage.getItem("post-login-redirect"));const A=S||"/";return console.log("[UniversalCallback] Final redirect URL:",A),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{if(A.startsWith("/")){const _=`${window.location.origin}${A}`;console.log("[UniversalCallback] redirecting to:",_),window.location.href=_}else console.log("[UniversalCallback] redirecting to absolute URL:",A),window.location.href=A},100),!0},s=async()=>{if(!t())return!1;console.log("[UniversalCallback] Processing OAuth callback..."),console.log("[UniversalCallback] Current URL:",window.location.href),console.log("[UniversalCallback] Current hash:",window.location.hash);try{const{supabase:i}=await Promise.resolve().then(()=>Je),{setSessionCookie:v,syncCookiesToLocalStorage:S,ACCESS_COOKIE:A,REFRESH_COOKIE:W,getPostLoginBase:_}=await Promise.resolve().then(()=>Fe);await new Promise(y=>setTimeout(y,500));const{data:d,error:n}=await i.auth.getSession();if(!(d!=null&&d.session)&&(window.location.hash.includes("access_token=")||window.location.search.includes("access_token="))){console.log("[UniversalCallback] No session found, trying to process URL tokens...");const{data:y,error:V}=await i.auth.getUser();if(y!=null&&y.user&&!V){console.log("[UniversalCallback] Successfully processed URL tokens for user:",y.user.email);const{data:I,error:N}=await i.auth.getSession();if(I!=null&&I.session)return console.log("[UniversalCallback] Session established after URL processing"),a(I.session)}}const{data:h,error:c}={data:d,error:n};return c?(console.error("[UniversalCallback] Error processing callback:",c),!1):h!=null&&h.session?await a(h.session):(console.log("[UniversalCallback] No session found"),!1)}catch(i){return console.error("[UniversalCallback] Error processing callback:",i),!1}};return typeof window<"u"&&(t()&&s(),window.addEventListener("hashchange",()=>{t()&&s()})),{isOAuthCallback:t,processCallback:s}}typeof window<"u"&&Se();exports.ACCESS_COOKIE=R;exports.AIWorkspaceHeader=$o;exports.AuthCallback=zo;exports.LS_ACCESS_KEY=ee;exports.LS_REFRESH_KEY=oe;exports.LoginModal=ye;exports.REFRESH_COOKIE=O;exports.buildOAuthRedirectUrl=ke;exports.clearLocalStorageTokens=q;exports.clearSessionCookie=J;exports.ensureCrossSubdomainCookies=Q;exports.getCookie=z;exports.getPostLoginBase=re;exports.restoreCrossSubdomainSession=He;exports.restoreSessionWithRetry=se;exports.setSessionCookie=M;exports.setupAuthStateListener=me;exports.setupUniversalCallback=Se;exports.supabase=L;exports.syncCookiesToLocalStorage=F;exports.useAuth=_e;exports.useEnhancedAuth=we;exports.useWorkspaceStore=ve;
