"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),x=require("element-plus"),N=require("./supabase-baea06dc.js"),k=require("./utils/authRedirect.js"),ke=require("pinia"),fe=require("./utils/universalCallback.js");/*! Element Plus Icons Vue v2.3.2 */var me=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(d){return(p,h)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),le=me,we=e.defineComponent({name:"Check",__name:"check",setup(d){return(p,h)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),ge=we,ve=e.defineComponent({name:"Lock",__name:"lock",setup(d){return(p,h)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96"}),e.createElementVNode("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32m192-160v-64a192 192 0 1 0-384 0v64zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64"})]))}}),ie=ve,_e=e.defineComponent({name:"Message",__name:"message",setup(d){return(p,h)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M128 224v512a64 64 0 0 0 64 64h640a64 64 0 0 0 64-64V224zm0-64h768a64 64 0 0 1 64 64v512a128 128 0 0 1-128 128H192A128 128 0 0 1 64 736V224a64 64 0 0 1 64-64"}),e.createElementVNode("path",{fill:"currentColor",d:"M904 224 656.512 506.88a192 192 0 0 1-289.024 0L120 224zm-698.944 0 210.56 240.704a128 128 0 0 0 192.704 0L818.944 224z"})]))}}),Ce=_e,ye=e.defineComponent({name:"User",__name:"user",setup(d){return(p,h)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"})]))}}),Se=ye;function ce(){const d=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),p=e.ref(null),h=e.computed(()=>d.value.isAuthenticated),E=e.computed(()=>d.value.user),I=e.computed(()=>d.value.isLoading),V=async()=>{var c,l,s,_,S,A,W,b,w,r,v,u,m,D,H,M,R,j,P,Q,ee,ae;try{console.log("[auth][enhanced] Starting loadUserInfo..."),console.log("[auth][enhanced] Ensuring cross-subdomain cookie synchronization...");let B=null,$="sb-access-token",O="sb-refresh-token";const J=f=>{try{const C=location.hostname;if(C==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(C)){console.log("[auth][enhanced][fallback] Skipping cookie sync for localhost");return}const G="aiworkspace.pro";if(!C.endsWith(`.${G}`)&&C!==G){console.log("[auth][enhanced][fallback] Skipping cookie sync - not under apex domain");return}console.log("[auth][enhanced][fallback] Performing basic cookie synchronization"),f.forEach(Y=>{document.cookie.split(";").find(oe=>oe.trim().startsWith(Y+"="))&&console.log(`[auth][enhanced][fallback] Found cookie: ${Y}`)})}catch(C){console.warn("[auth][enhanced][fallback] Error in fallback cookie sync:",C)}};try{const f=await Promise.resolve().then(()=>require("./utils/authRedirect.js"));B=f.ensureCrossSubdomainCookies,$=f.ACCESS_COOKIE||"sb-access-token",O=f.REFRESH_COOKIE||"sb-refresh-token",console.log("[auth][enhanced] Successfully imported authRedirect module")}catch(f){console.warn("[auth][enhanced] Failed to import authRedirect module:",f),typeof window<"u"&&((c=window.authRedirectGlobal)!=null&&c.ensureCrossSubdomainCookies?(B=window.authRedirectGlobal.ensureCrossSubdomainCookies,$=window.authRedirectGlobal.ACCESS_COOKIE||"sb-access-token",O=window.authRedirectGlobal.REFRESH_COOKIE||"sb-refresh-token",console.log("[auth][enhanced] Using global authRedirectGlobal object")):window.ensureCrossSubdomainCookies&&(B=window.ensureCrossSubdomainCookies,$=window.ACCESS_COOKIE||"sb-access-token",O=window.REFRESH_COOKIE||"sb-refresh-token",console.log("[auth][enhanced] Using individual global ensureCrossSubdomainCookies")))}if(B&&typeof B=="function")try{B([$,O]),console.log("[auth][enhanced] Cross-subdomain cookies synchronized")}catch(f){console.warn("[auth][enhanced] Error calling ensureCrossSubdomainCookies:",f),console.warn("[auth][enhanced] Continuing without cookie synchronization...")}else{console.warn("[auth][enhanced] ensureCrossSubdomainCookies not available, using fallback cookie sync"),console.warn("[auth][enhanced] This is expected in some bundling scenarios and will not affect core functionality");try{J([$,O])}catch(f){console.warn("[auth][enhanced] Fallback cookie sync also failed:",f)}}await new Promise(f=>setTimeout(f,100));let K=null;try{const C=await(await N.getSupabase()).auth.getSession();K=(l=C==null?void 0:C.data)==null?void 0:l.session}catch(f){console.warn("[auth][enhanced] Error getting Supabase session:",f)}if(K&&K.user){console.log("[auth][enhanced] Active Supabase session found");const f=K.user,C={id:f.id,name:((s=f.user_metadata)==null?void 0:s.name)||((_=f.user_metadata)==null?void 0:_.user_name)||((S=f.user_metadata)==null?void 0:S.full_name)||((A=f.email)==null?void 0:A.split("@")[0])||"User",email:f.email,avatar_url:((W=f.user_metadata)==null?void 0:W.avatar_url)||null,user_metadata:f.user_metadata};return d.value={user:C,isAuthenticated:!0,isLoading:!1,error:null},p.value={user:C,access_token:K.access_token,refresh_token:K.refresh_token},{user:C,session:p.value,error:null}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const F=await N.restoreSessionWithRetry();if(F.success&&F.session){console.log("[auth][enhanced] Session restored successfully from cookies");const f=F.session.user,C={id:f.id,name:((b=f.user_metadata)==null?void 0:b.name)||((w=f.user_metadata)==null?void 0:w.user_name)||((r=f.user_metadata)==null?void 0:r.full_name)||((v=f.email)==null?void 0:v.split("@")[0])||"User",email:f.email,avatar_url:((u=f.user_metadata)==null?void 0:u.avatar_url)||null,user_metadata:f.user_metadata};return d.value={user:C,isAuthenticated:!0,isLoading:!1,error:null},p.value=F.session,{user:C,session:p.value,error:null}}else{console.log("[auth][enhanced] Failed to restore session:",F.error),console.log("[auth][enhanced] Retrying session restoration with extended delay..."),await new Promise(C=>setTimeout(C,500)),B([$,O]);const f=await N.restoreSessionWithRetry();if(f.success&&f.session){console.log("[auth][enhanced] Session restored on retry");const C=f.session.user,G={id:C.id,name:((m=C.user_metadata)==null?void 0:m.name)||((D=C.user_metadata)==null?void 0:D.user_name)||((H=C.user_metadata)==null?void 0:H.full_name)||((M=C.email)==null?void 0:M.split("@")[0])||"User",email:C.email,avatar_url:((R=C.user_metadata)==null?void 0:R.avatar_url)||null,user_metadata:C.user_metadata};return d.value={user:G,isAuthenticated:!0,isLoading:!1,error:null},p.value=f.session,{user:G,session:p.value,error:null}}}}catch(B){console.error("Error getting Supabase session:",B),B&&typeof B=="object"&&"message"in B&&typeof B.message=="string"&&B.message.includes("ne is not a function")&&(console.warn('[auth][enhanced] Caught "ne is not a function" error - this is handled gracefully'),console.warn("[auth][enhanced] The ensureCrossSubdomainCookies function import failed, but continuing..."));try{const $=await N.restoreSessionWithRetry();if($.success&&$.session){console.log("[auth][enhanced] Session restored after error");const O=$.session.user,J={id:O.id,name:((j=O.user_metadata)==null?void 0:j.name)||((P=O.user_metadata)==null?void 0:P.user_name)||((Q=O.user_metadata)==null?void 0:Q.full_name)||((ee=O.email)==null?void 0:ee.split("@")[0])||"User",email:O.email,avatar_url:((ae=O.user_metadata)==null?void 0:ae.avatar_url)||null,user_metadata:O.user_metadata};return d.value={user:J,isAuthenticated:!0,isLoading:!1,error:null},p.value=$.session,{user:J,session:p.value,error:null}}}catch($){console.error("Error restoring session:",$)}}return console.log("[auth][enhanced] No valid authentication found"),d.value={user:null,isAuthenticated:!1,isLoading:!1,error:"No valid session found"},p.value=null,{user:null,session:null,error:"No valid session found"}},L=async()=>{try{await(await N.getSupabase()).auth.signOut(),k.clearSessionCookie(k.ACCESS_COOKIE),k.clearSessionCookie(k.REFRESH_COOKIE),k.clearLocalStorageTokens(),d.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},p.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(c){console.error("Error during logout:",c),d.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},p.value=null}},U=async(c,l)=>{var s,_,S,A,W;try{d.value.isLoading=!0;const b=await N.getSupabase(),{data:w,error:r}=await b.auth.signInWithPassword({email:c,password:l});if(r)throw r;if(w.session){const v=w.session.user,u={id:v.id,name:((s=v.user_metadata)==null?void 0:s.name)||((_=v.user_metadata)==null?void 0:_.user_name)||((S=v.user_metadata)==null?void 0:S.full_name)||((A=v.email)==null?void 0:A.split("@")[0])||"User",email:v.email,avatar_url:((W=v.user_metadata)==null?void 0:W.avatar_url)||null,user_metadata:v.user_metadata};return d.value={user:u,isAuthenticated:!0,isLoading:!1,error:null},p.value={user:u,access_token:w.session.access_token,refresh_token:w.session.refresh_token},{user:u,session:p.value,error:null}}return{user:null,session:null,error:"No session returned"}}catch(b){return console.error("Sign in error:",b),d.value.isLoading=!1,{user:null,session:null,error:String(b)}}},T=async(c,l,s)=>{var _,S,A,W,b;try{d.value.isLoading=!0;const w=await N.getSupabase(),{data:r,error:v}=await w.auth.signUp({email:c,password:l,options:{data:s}});if(v)throw v;if(r.session){const u=r.session.user,m={id:u.id,name:((_=u.user_metadata)==null?void 0:_.name)||((S=u.user_metadata)==null?void 0:S.user_name)||((A=u.user_metadata)==null?void 0:A.full_name)||((W=u.email)==null?void 0:W.split("@")[0])||"User",email:u.email,avatar_url:((b=u.user_metadata)==null?void 0:b.avatar_url)||null,user_metadata:u.user_metadata};return d.value={user:m,isAuthenticated:!0,isLoading:!1,error:null},p.value={user:m,access_token:r.session.access_token,refresh_token:r.session.refresh_token},{user:m,session:p.value,error:null}}return{user:null,session:null,error:"No session returned"}}catch(w){return console.error("Sign up error:",w),d.value.isLoading=!1,{user:null,session:null,error:String(w)}}},n=async()=>{await V()};return e.onMounted(async()=>{await N.initializeCrossSubdomainAuth(),await n()}),{authState:d,currentSession:p,isAuthenticated:h,currentUser:E,isLoading:I,loadUserInfo:V,logout:L,signIn:U,signUp:T,checkAuth:n}}const ue=ke.defineStore("workspace",()=>{const d=e.ref(null),p=e.ref([]),h=e.ref(null),E=n=>{d.value=n,localStorage.setItem("current_workspace",JSON.stringify(n))},I=n=>{p.value=n,localStorage.setItem("available_workspaces",JSON.stringify(n))};return{currentWorkspace:d,workspaces:p,user:h,setCurrentWorkspace:E,setWorkspaces:I,setUser:n=>{h.value=n,localStorage.setItem("user_info",JSON.stringify(n))},loadPersistedData:()=>{const n=localStorage.getItem("current_workspace");if(n)try{d.value=JSON.parse(n)}catch(s){console.error("Error loading persisted workspace:",s)}const c=localStorage.getItem("available_workspaces");if(c)try{p.value=JSON.parse(c)}catch(s){console.error("Error loading persisted workspaces:",s)}const l=localStorage.getItem("user_info");if(l)try{h.value=JSON.parse(l)}catch(s){console.error("Error loading persisted user:",s)}},clearData:()=>{d.value=null,p.value=[],h.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(n=!1)=>{try{const{data:{user:c}}=await N.supabase.auth.getUser();if(!c)return[];let l=N.supabase.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at, git_repo, 
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",c.id);n||(l=l.eq("archived",!1));const{data:s,error:_}=await l;if(_)throw _;const S=new Map;(s||[]).forEach(r=>{(r.workspace_access||[]).forEach(v=>{v.shared_with_user_id===c.id&&S.set(r.id,v)})});const A=[...new Set((s||[]).filter(r=>r.parent_workspace_id).map(r=>r.parent_workspace_id).filter(r=>!S.has(r)))];let W=[];if(A.length){let r=N.supabase.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",A);n||(r=r.eq("archived",!1));const{data:v,error:u}=await r;if(u)throw u;W=v||[]}const w=[...s||[],...W].map(r=>{var v,u,m;return{id:r.id,title:r.title,description:r.description||"No description",parent_workspace_id:r.parent_workspace_id,created_by:r.created_by,archived:r.archived,created_at:r.created_at,latest_activity:((u=(v=r.workspace_activities)==null?void 0:v[0])==null?void 0:u.updated_at)||r.created_at,hasAccess:S.has(r.id),accessType:((m=S.get(r.id))==null?void 0:m.access_type)||null}});return w.sort((r,v)=>new Date(v.latest_activity)-new Date(r.latest_activity)),I(w),w}catch(c){return console.error("loadWorkspaces error",c),[]}}}});function de(){const d=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),p=e.ref(window.location.href),h=async()=>{var n,c,l,s,_,S,A,W;try{d.value.isLoading=!0;const b=await N.getSupabase(),{data:{session:w},error:r}=await b.auth.getSession();if(r){console.error("Error checking auth status:",r),d.value={user:null,isAuthenticated:!1,isLoading:!1,error:r.message};return}w!=null&&w.user?(d.value={user:{id:w.user.id,email:w.user.email||"",name:((n=w.user.user_metadata)==null?void 0:n.full_name)||((c=w.user.user_metadata)==null?void 0:c.name)||((l=w.user.email)==null?void 0:l.split("@")[0])||"User",avatar_url:((s=w.user.user_metadata)==null?void 0:s.avatar_url)||((_=w.user.user_metadata)==null?void 0:_.picture)||null,initials:(((S=w.user.user_metadata)==null?void 0:S.full_name)||((A=w.user.user_metadata)==null?void 0:A.name)||((W=w.user.email)==null?void 0:W.split("@")[0])||"U").split(" ").map(v=>v[0]).join("").toUpperCase().substring(0,2)},isAuthenticated:!0,isLoading:!1,error:null},w.access_token&&k.setSessionCookie(k.ACCESS_COOKIE,w.access_token),w.refresh_token&&k.setSessionCookie(k.REFRESH_COOKIE,w.refresh_token),k.syncCookiesToLocalStorage()):d.value={user:null,isAuthenticated:!1,isLoading:!1,error:null}}catch(b){console.error("Auth check failed:",b),d.value={user:null,isAuthenticated:!1,isLoading:!1,error:b.message||"Authentication check failed"}}},E=async(n,c)=>{try{const l=await N.getSupabase(),{error:s}=await l.auth.signInWithPassword({email:n,password:c});return s?{success:!1,error:s.message}:(await h(),sessionStorage.setItem("post-login-redirect",p.value),{success:!0})}catch(l){return console.error("Login error:",l),{success:!1,error:l.message||"Login failed"}}},I=async(n,c)=>{var l;try{const s=await N.getSupabase(),{data:_,error:S}=await s.auth.signUp({email:n,password:c});return S?{success:!1,error:S.message}:_.user&&!_.user.email_confirmed_at?{success:!0,needsConfirmation:!0}:(l=_.session)!=null&&l.user?(await h(),sessionStorage.setItem("post-login-redirect",p.value),{success:!0}):{success:!1,error:"No session created"}}catch(s){return console.error("Signup error:",s),{success:!1,error:s.message||"Signup failed"}}},V=async n=>{try{const c=`${window.location.origin}/auth/callback`;console.log("[OAuth] Starting login with provider:",n),console.log("[OAuth] Redirect URL:",c),console.log("[OAuth] Current URL:",p.value),console.log("[OAuth] Current origin:",window.location.origin);const l=await N.getSupabase(),{error:s}=await l.auth.signInWithOAuth({provider:n,options:{redirectTo:c,queryParams:{redirect_origin:p.value}}});if(s)return console.error("[OAuth] Error:",s),{success:!1,error:s.message};const _=p.value||window.location.href;return sessionStorage.setItem("post-login-redirect",_),localStorage.setItem("post-login-redirect",_),console.log("[OAuth] Stored redirect URL:",_),console.log("[OAuth] Current URL value:",p.value),console.log("[OAuth] Window location href:",window.location.href),{success:!0}}catch(c){return console.error("OAuth login error:",c),{success:!1,error:c.message||"OAuth login failed"}}},L=async()=>{try{const n=await N.getSupabase(),{error:c}=await n.auth.signOut();c&&console.error("Logout error:",c),d.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},k.clearSessionCookie(k.ACCESS_COOKIE),k.clearSessionCookie(k.REFRESH_COOKIE),k.clearLocalStorageTokens()}catch(n){console.error("Logout error:",n)}},U=async n=>{try{const c=await N.getSupabase(),{error:l}=await c.auth.resetPasswordForEmail(n,{redirectTo:`${window.location.origin}/auth/reset-password`});return l?{success:!1,error:l.message}:{success:!0}}catch(c){return console.error("Password reset error:",c),{success:!1,error:c.message||"Password reset failed"}}},T=async()=>{try{(await N.getSupabase()).auth.onAuthStateChange((c,l)=>{var s;switch(console.log("Auth state changed:",c,(s=l==null?void 0:l.user)==null?void 0:s.email),c){case"SIGNED_IN":l!=null&&l.user&&h();break;case"SIGNED_OUT":d.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},k.clearSessionCookie(k.ACCESS_COOKIE),k.clearSessionCookie(k.REFRESH_COOKIE),k.clearLocalStorageTokens();break;case"TOKEN_REFRESHED":l!=null&&l.access_token&&k.setSessionCookie(k.ACCESS_COOKIE,l.access_token),l!=null&&l.refresh_token&&k.setSessionCookie(k.REFRESH_COOKIE,l.refresh_token),k.syncCookiesToLocalStorage();break;case"USER_UPDATED":l!=null&&l.user&&h();break}})}catch(n){console.warn("Failed to setup auth listener:",n)}};return e.onMounted(async()=>{T(),await h()}),e.watch(()=>window.location.href,n=>{p.value=n}),{authState:e.computed(()=>d.value),isAuthenticated:e.computed(()=>d.value.isAuthenticated),user:e.computed(()=>d.value.user),isLoading:e.computed(()=>d.value.isLoading),checkAuthStatus:h,loginWithEmail:E,signupWithEmail:I,loginWithProvider:V,logout:L,resetPassword:U,currentUrl:e.computed(()=>p.value)}}const be={class:"login-container"},Ee={class:"logo-section"},Ne={class:"login-buttons"},Ve={key:0,class:"forgot-password"},Ae={class:"signup-link"},Ie=e.defineComponent({__name:"LoginModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","login-success"],setup(d,{emit:p}){const h=d,E=p,I=e.computed({get:()=>h.modelValue,set:u=>E("update:modelValue",u)}),V=e.ref(!1),L=e.ref(!1),U=e.ref(),{loginWithEmail:T,signupWithEmail:n,loginWithProvider:c,resetPassword:l}=de(),s=e.reactive({email:"",password:"",confirmPassword:""}),_=e.computed(()=>({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email",trigger:"blur"}],password:[{required:!0,message:"Please enter your password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],...V.value?{confirmPassword:[{required:!0,message:"Please confirm your password",trigger:"blur"},{validator:(u,m,D)=>{m!==s.password?D(new Error("Passwords do not match")):D()},trigger:"blur"}]}:{}})),S=()=>{var u;V.value=!V.value,s.email="",s.password="",s.confirmPassword="",(u=U.value)==null||u.clearValidate()},A=()=>{var u;I.value=!1,s.email="",s.password="",s.confirmPassword="",V.value=!1,(u=U.value)==null||u.clearValidate()},W=async()=>{if(U.value)try{await U.value.validate(),L.value=!0,V.value?await w():await b()}catch(u){console.error("Form validation failed:",u)}finally{L.value=!1}},b=async()=>{const u=await T(s.email,s.password);u.success?(x.ElMessage.success("Login successful"),E("login-success",{email:s.email}),A()):x.ElMessage.error("Login failed: "+u.error)},w=async()=>{const u=await n(s.email,s.password);u.success?u.needsConfirmation?x.ElMessage.success("Please check your email to confirm your account"):(x.ElMessage.success("Account created successfully"),E("login-success",{email:s.email}),A()):x.ElMessage.error("Signup failed: "+u.error)},r=async u=>{const m=await c(u);m.success?x.ElMessage.success("Redirecting to login provider..."):x.ElMessage.error("Login failed: "+m.error)},v=async()=>{if(!s.email){x.ElMessage.warning("Please enter your email address first");return}const u=await l(s.email);u.success?x.ElMessage.success("Password reset email sent! Please check your inbox."):x.ElMessage.error("Failed to send reset email: "+u.error)};return(u,m)=>{const D=e.resolveComponent("el-icon"),H=e.resolveComponent("el-input"),M=e.resolveComponent("el-form-item"),R=e.resolveComponent("el-button"),j=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(j,{modelValue:I.value,"onUpdate:modelValue":m[6]||(m[6]=P=>I.value=P),title:"",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!0,class:"login-modal",onClose:A},{default:e.withCtx(()=>[e.createElementVNode("div",be,[e.createElementVNode("div",Ee,[e.createElementVNode("h2",null,e.toDisplayString(V.value?"Create Account":"Welcome Back"),1),e.createElementVNode("p",null,e.toDisplayString(V.value?"Sign up to get started with your account":"Sign in to continue to your account"),1)]),e.createVNode(e.unref(x.ElForm),{model:s,rules:_.value,ref_key:"formRef",ref:U,class:"login-form",onSubmit:e.withModifiers(W,["prevent"])},{default:e.withCtx(()=>[e.createVNode(M,{prop:"email"},{default:e.withCtx(()=>[e.createVNode(H,{modelValue:s.email,"onUpdate:modelValue":m[0]||(m[0]=P=>s.email=P),placeholder:"Email",type:"email",size:"large",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ce))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(M,{prop:"password"},{default:e.withCtx(()=>[e.createVNode(H,{modelValue:s.password,"onUpdate:modelValue":m[1]||(m[1]=P=>s.password=P),placeholder:"Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ie))]),_:1})]),_:1},8,["modelValue"])]),_:1}),V.value?(e.openBlock(),e.createBlock(M,{key:0,prop:"confirmPassword"},{default:e.withCtx(()=>[e.createVNode(H,{modelValue:s.confirmPassword,"onUpdate:modelValue":m[2]||(m[2]=P=>s.confirmPassword=P),placeholder:"Confirm Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ie))]),_:1})]),_:1},8,["modelValue"])]),_:1})):e.createCommentVNode("",!0),e.createVNode(M,null,{default:e.withCtx(()=>[e.createVNode(R,{type:"primary",class:"submit-button",loading:L.value,onClick:W,size:"large"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(V.value?"Sign Up":"Sign In"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),m[10]||(m[10]=e.createElementVNode("div",{class:"divider"},[e.createElementVNode("span",null,"Or continue with")],-1)),e.createElementVNode("div",Ne,[e.createVNode(R,{class:"login-button google",onClick:m[3]||(m[3]=P=>r("google")),size:"large"},{default:e.withCtx(()=>[...m[7]||(m[7]=[e.createElementVNode("span",{class:"social-icon"},"G",-1),e.createTextVNode(" Google ",-1)])]),_:1}),e.createVNode(R,{class:"login-button github",onClick:m[4]||(m[4]=P=>r("github")),size:"large"},{default:e.withCtx(()=>[...m[8]||(m[8]=[e.createElementVNode("span",{class:"social-icon"},"âš¡",-1),e.createTextVNode(" GitHub ",-1)])]),_:1}),e.createVNode(R,{class:"login-button twitter",onClick:m[5]||(m[5]=P=>r("twitter")),size:"large"},{default:e.withCtx(()=>[...m[9]||(m[9]=[e.createElementVNode("span",{class:"social-icon"},"X",-1),e.createTextVNode(" X (Twitter) ",-1)])]),_:1})]),m[11]||(m[11]=e.createElementVNode("div",{class:"terms"}," By continuing, you agree to AI Workspace's Terms of Service and Privacy Policy ",-1)),V.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ve,[e.createElementVNode("a",{href:"#",onClick:e.withModifiers(v,["prevent"])},"Forgot Password?")])),e.createElementVNode("div",Ae,[e.createTextVNode(e.toDisplayString(V.value?"Already have an account?":"Don't have an account?")+" ",1),e.createElementVNode("a",{href:"#",onClick:e.withModifiers(S,["prevent"])},e.toDisplayString(V.value?"Sign in":"Sign up"),1)])])]),_:1},8,["modelValue"])}}});const se=(d,p)=>{const h=d.__vccOpts||d;for(const[E,I]of p)h[E]=I;return h},pe=se(Ie,[["__scopeId","data-v-684a3f28"]]),We={class:"aiworkspace-header"},xe={key:0,class:"header-content header-loading"},Le={class:"header-center"},Be={class:"loading-text"},Oe={key:0},Ue={key:1},$e={key:1,class:"header-content header-fallback"},Re={key:2,class:"header-content"},Pe={class:"header-left"},Me={class:"logo-section"},Te={href:"/",class:"logo"},De=["src"],He={key:1,class:"text-logo"},Fe={key:0,class:"header-center"},ze={class:"main-navigation"},Ke={class:"nav-item"},qe={href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},Ge={class:"workspace-dropdown-item"},je=["href"],Je={class:"workspace-icon"},Ye={key:1,class:"nav-divider"},Xe={class:"nav-item"},Qe=["href","onClick"],Ze={class:"header-right"},ea={class:"user-profile"},aa={class:"user-info"},oa={class:"user-name"},ta={class:"user-avatar"},sa=["src","alt"],ra={key:1,class:"avatar-placeholder"},na={key:3,class:"header-content header-unauthenticated"},la={class:"header-left"},ia={class:"logo-section"},ca={href:"/",class:"logo"},ua=["src"],da={key:1,class:"text-logo"},pa={class:"header-right"},ha={class:"workspace-list"},ka=["onClick"],fa={class:"workspace-icon"},ma={class:"workspace-details"},wa={class:"workspace-members"},ga={key:0,class:"current-indicator"},Z=50,va=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(d,{emit:p}){const h=d,E=p,{authState:I,logout:V,isLoading:L}=ce(),U=()=>{try{return ue()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},T=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},n=e.ref(U()),c=e.computed(()=>!!n.value),l=e.ref(0),s=()=>{if(!n.value&&l.value<Z){if(T()){const o=U();if(o){n.value=o,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}l.value++,setTimeout(s,100)}else l.value>=Z&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{n.value||s()});const _=e.ref(!1),S=e.ref(!1),A=e.ref([]),W=e.ref([]),b=e.ref({name:"",email:"",avatar_url:null,initials:""}),w=e.ref([]),r=e.ref([]),v=e.ref(!1);e.watch(r,async o=>{o.length>0&&c.value&&M.value&&await H()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{c.value&&M.value&&await H()},{immediate:!1});const u=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,o=>{u.value=o},{immediate:!0}),e.watch(c,o=>{!o&&l.value<Z&&s()});const m=()=>{try{const o=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(o)return o[1];const t=new URLSearchParams(window.location.search).get("workspace_id");if(t)return t;const i=window.location.hash.match(/workspace_id=(\d+)/);return i?i[1]:null}catch(o){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",o),null}},D=()=>{try{return window.location.pathname.includes("/all-workspace/")}catch(o){return console.warn("[AIWorkspaceHeader] Error checking all-workspace mode:",o),!1}},H=async()=>{if(!n.value||!c.value)return;const o=D();if(v.value=o,o){n.value.currentWorkspace=null,localStorage.removeItem("current_workspace"),console.log("[AIWorkspaceHeader] Auto-selected all-workspace mode from URL");return}const a=m();if(a)try{r.value.length===0&&await $();const t=r.value.find(i=>i.id.toString()===a);t?(n.value.setCurrentWorkspace(t),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${t.title} (ID: ${t.id})`),E("workspaceChange",t)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${a} not found in available workspaces`)}catch(t){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",t)}},M=e.computed(()=>I.value.isAuthenticated),R=e.computed(()=>n.value?n.value.currentWorkspace:null),j=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),P=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"All Tasks",key:"tasks",url:"/tasks"},{label:"All Goals",key:"goals",url:"/goals"},{label:"All Events",key:"events",url:"/events"},{label:"All Drive",key:"files",url:"/files"},{label:"All Contacts",key:"contacts",url:"/contacts"},{label:"All Settings",key:"settings",url:"/settings"}]),Q=e.computed(()=>v.value?P.value:j.value),ee=e.computed(()=>{try{const o=u.value;let a="";const t=o.match(/\/all-workspace\/([^\/]+)/);if(t)a=t[1];else{const i=o.match(/\/single-workspace\/\d+\/([^\/]+)/);if(i)a=i[1];else{const y=o.match(/\/([^\/]+)$/);y&&(a=y[1])}}if(a){const i=Q.value.find(y=>y.key===a||y.url.includes(`/${a}`)||y.url===`/${a}`);if(i)return i.label}return"Dashboard"}catch(o){return console.warn("[AIWorkspaceHeader] Error determining current section:",o),"Dashboard"}}),ae=o=>{const a=new Map;o.forEach(y=>{a.set(y.id,{...y,children:[]})});const t=[];a.forEach(y=>{y.parent_workspace_id&&a.has(y.parent_workspace_id)?a.get(y.parent_workspace_id).children.push(y):t.push(y)});const i=y=>{y.sort((z,q)=>z.title.localeCompare(q.title)),y.forEach(z=>{z.children&&i(z.children)})};return i(t),t},B=(o,a=0,t=[])=>(o.forEach(i=>{t.push({...i,level:a}),i.children&&i.children.length&&B(i.children,a+1,t)}),t),$=async()=>{var o,a,t;try{const i=await((o=n.value)==null?void 0:o.loadWorkspaces());if(w.value=ae(i||[]),r.value=B(w.value),W.value=r.value,A.value=r.value,h.currentWorkspaceId){const y=r.value.find(z=>{var q;return z.id.toString()===((q=h.currentWorkspaceId)==null?void 0:q.toString())});y&&((a=n.value)==null||a.setCurrentWorkspace(y))}else!R.value&&r.value.length&&((t=n.value)==null||t.setCurrentWorkspace(r.value[0]))}catch(i){console.error("loadWorkspaces (header) error",i)}},O=o=>{if(console.log("Navigation command:",o),o==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const a=parseInt(o.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${a}/dashboard`;return}},J=o=>{const a=R.value,t=v.value;switch(o.key){case"dashboard":t?window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":a?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${a.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(t)window.location.href="https://outline.aiworkspace.pro/all-workspace/outlines";else if(a){const i=`https://outline.aiworkspace.pro/single-workspace/${a.id}/outlines`;window.location.href=i}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(t)window.location.href="https://canvas.aiworkspace.pro/all-workspace/canvas";else if(a){const i=`https://canvas.aiworkspace.pro/single-workspace/${a.id}/canvas`;window.location.href=i}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(t)window.location.href="https://drive.aiworkspace.pro/all-workspace/files";else if(a){const i=`https://drive.aiworkspace.pro/single-workspace/${a.id}/files`;window.location.href=i}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(t)window.location.href="https://tasks.aiworkspace.pro/all-workspace/tasks";else if(a){const i=`https://tasks.aiworkspace.pro/single-workspace/${a.id}/tasks`;window.location.href=i}else window.location.href="https://tasks.aiworkspace.pro";break;case"goals":if(t)window.location.href="https://app.aiworkspace.pro/all-workspace/goals";else if(a){const i=`https://app.aiworkspace.pro/single-workspace/${a.id}/goals`;window.location.href=i}else window.location.href="https://app.aiworkspace.pro/all-workspace/goals";break;case"events":if(t)window.location.href="https://app.aiworkspace.pro/all-workspace/events";else if(a){const i=`https://app.aiworkspace.pro/single-workspace/${a.id}/events`;window.location.href=i}else window.location.href="https://app.aiworkspace.pro/all-workspace/events";break;case"contacts":if(t)window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";else if(a){const i=`https://app.aiworkspace.pro/single-workspace/${a.id}/contacts`;window.location.href=i}else window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";break;case"ai-portfolios":if(t)window.location.href="https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios";else if(a){const i=`https://spreadsheet.aiworkspace.pro/single-workspace/${a.id}/ai-portfolios`;window.location.href=i}else window.location.href="https://spreadsheet.aiworkspace.pro";break;case"settings":if(t)window.location.href="https://settings.aiworkspace.pro/all-workspace/settings";else if(a){const i=`https://settings.aiworkspace.pro/single-workspace/${a.id}/settings`;window.location.href=i}else window.location.href="https://settings.aiworkspace.pro";break;default:if(t){const i=`https://app.aiworkspace.pro/all-workspace/${o.key}`;window.location.href=i}else if(a){const i=`https://app.aiworkspace.pro/single-workspace/${a.id}/${o.key}`;window.location.href=i}else{const i=`https://app.aiworkspace.pro/${o.key}`;window.location.href=i}break}},K=o=>{const a=R.value,t=v.value;switch(o.key){case"dashboard":return t?"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":a?`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${a.id}/dashboard`:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";case"ai-portfolios":return t?"https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios":a?`https://spreadsheet.aiworkspace.pro/single-workspace/${a.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return t?"https://outline.aiworkspace.pro/all-workspace/outlines":a?`https://outline.aiworkspace.pro/single-workspace/${a.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return t?"https://canvas.aiworkspace.pro/all-workspace/canvas":a?`https://canvas.aiworkspace.pro/single-workspace/${a.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return t?"https://drive.aiworkspace.pro/all-workspace/files":a?`https://drive.aiworkspace.pro/single-workspace/${a.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return t?"https://tasks.aiworkspace.pro/all-workspace/tasks":a?`https://tasks.aiworkspace.pro/single-workspace/${a.id}/tasks`:"https://tasks.aiworkspace.pro";case"goals":return t?"https://app.aiworkspace.pro/all-workspace/goals":a?`https://app.aiworkspace.pro/single-workspace/${a.id}/goals`:"https://app.aiworkspace.pro/all-workspace/goals";case"events":return t?"https://app.aiworkspace.pro/all-workspace/events":a?`https://app.aiworkspace.pro/single-workspace/${a.id}/events`:"https://app.aiworkspace.pro/all-workspace/events";case"contacts":return t?"https://app.aiworkspace.pro/all-workspace/contacts":a?`https://app.aiworkspace.pro/single-workspace/${a.id}/contacts`:"https://app.aiworkspace.pro/all-workspace/contacts";case"settings":return t?"https://settings.aiworkspace.pro/all-workspace/settings":a?`https://settings.aiworkspace.pro/single-workspace/${a.id}/settings`:"https://settings.aiworkspace.pro";default:return t?`https://app.aiworkspace.pro/all-workspace/${o.key}`:a?`https://app.aiworkspace.pro/single-workspace/${a.id}/${o.key}`:`https://app.aiworkspace.pro/${o.key}`}},F=o=>{switch(o){case"profile":h.onProfileClick?h.onProfileClick():x.ElMessage.info("Profile settings coming soon");break;case"workspaces":_.value=!0;break;case"logout":G();break}},f=o=>{var a;(a=n.value)==null||a.setCurrentWorkspace(o),_.value=!1,E("workspaceChange",o),x.ElMessage.success(`Switched to ${o.title}`)},C=()=>{x.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:o})=>{var t;const a={id:Date.now(),title:o,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};A.value.push(a),(t=n.value)==null||t.setWorkspaces(A.value),f(a),x.ElMessage.success(`Created workspace: ${o}`)}).catch(()=>{})},G=()=>{x.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var o;(o=n.value)==null||o.clearData(),await V(),E("logout"),x.ElMessage.success("Signed out successfully")}).catch(()=>{})},Y=async()=>{var o,a;if(I.value.user){const t=I.value.user;b.value={name:t.name||((o=t.email)==null?void 0:o.split("@")[0])||"User",email:t.email||"",avatar_url:t.avatar_url||null,initials:(t.name||((a=t.email)==null?void 0:a.split("@")[0])||"U").split(" ").map(i=>i[0]).join("").toUpperCase().substring(0,2)},h.showWorkspaceSelector&&await $()}};e.watch(()=>I.value.user,o=>{var a;o?Y():(b.value={name:"",email:"",avatar_url:null,initials:""},(a=n.value)==null||a.clearData())}),e.watch(()=>h.currentWorkspaceId,o=>{var a;if(o&&r.value.length){const t=r.value.find(i=>i.id.toString()===o.toString());t&&((a=n.value)==null||a.setCurrentWorkspace(t))}}),e.onMounted(async()=>{M.value&&(await Y(),await H())});const re=async o=>{console.log("Login successful:",o),S.value=!1,await Y(),E("login"),x.ElMessage.success("Welcome back!")},oe=()=>{l.value=0,s(),x.ElMessage.success("Manual Pinia retry initiated.")};return(o,a)=>{const t=e.resolveComponent("el-icon"),i=e.resolveComponent("el-tag"),y=e.resolveComponent("el-dropdown-item"),z=e.resolveComponent("el-dropdown-menu"),q=e.resolveComponent("el-dropdown"),te=e.resolveComponent("el-button"),he=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",We,[!c.value&&l.value<Z||e.unref(L)?(e.openBlock(),e.createElementBlock("div",xe,[a[8]||(a[8]=e.createStaticVNode('<div class="header-left" data-v-f98a8f3a><div class="logo-section" data-v-f98a8f3a><a href="/" class="logo" data-v-f98a8f3a><div class="text-logo" data-v-f98a8f3a><span class="logo-text" data-v-f98a8f3a>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",Le,[e.createElementVNode("span",Be,[e.unref(L)?(e.openBlock(),e.createElementBlock("span",Oe,"Syncing authentication...")):(e.openBlock(),e.createElementBlock("span",Ue,"Initializing..."))])])])):!c.value&&l.value>=Z?(e.openBlock(),e.createElementBlock("div",$e,[a[10]||(a[10]=e.createStaticVNode('<div class="header-left" data-v-f98a8f3a><div class="logo-section" data-v-f98a8f3a><a href="/" class="logo" data-v-f98a8f3a><div class="text-logo" data-v-f98a8f3a><span class="logo-text" data-v-f98a8f3a>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[a[9]||(a[9]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:oe,class:"retry-button"},"Retry Pinia")]),a[11]||(a[11]=e.createStaticVNode('<div class="header-right" data-v-f98a8f3a><div class="user-profile" data-v-f98a8f3a><div class="user-info" data-v-f98a8f3a><span class="user-name" data-v-f98a8f3a>User</span></div><div class="user-avatar" data-v-f98a8f3a><span class="avatar-placeholder" data-v-f98a8f3a>U</span></div></div></div>',1))])):M.value?(e.openBlock(),e.createElementBlock("div",Re,[e.createElementVNode("div",Pe,[e.createElementVNode("div",Me,[e.createElementVNode("a",Te,[o.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:o.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,De)):(e.openBlock(),e.createElementBlock("div",He,[...a[12]||(a[12]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),o.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",Fe,[e.createElementVNode("nav",ze,[o.showWorkspaceSelector?(e.openBlock(),e.createBlock(q,{key:0,onCommand:O,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(z,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(y,{command:"all-workspace",class:e.normalizeClass({active:v.value})},{default:e.withCtx(()=>[e.createElementVNode("a",qe,[e.createElementVNode("div",Ge,[a[14]||(a[14]=e.createElementVNode("span",{class:"workspace-icon"},"ðŸŒ",-1)),a[15]||(a[15]=e.createElementVNode("span",null,"All workspace",-1)),v.value?(e.openBlock(),e.createBlock(i,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...a[13]||(a[13]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)])])]),_:1},8,["class"]),r.value.length>0?(e.openBlock(),e.createBlock(y,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,g=>(e.openBlock(),e.createBlock(y,{key:g.id,command:`workspace-${g.id}`},{default:e.withCtx(()=>{var X;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${g.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(g.level||0)*16+"px"})},[e.createElementVNode("span",Je,e.toDisplayString(g.children&&g.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("span",null,e.toDisplayString(g.title),1),g.id===((X=R.value)==null?void 0:X.id)?(e.openBlock(),e.createBlock(i,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...a[16]||(a[16]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,je)]}),_:2},1032,["command"]))),128)),r.value.length===0?(e.openBlock(),e.createBlock(y,{key:1,disabled:""},{default:e.withCtx(()=>[...a[17]||(a[17]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var g;return[e.createElementVNode("span",Ke,[e.createTextVNode(e.toDisplayString(v.value?"All workspace":((g=R.value)==null?void 0:g.title)||"Select Workspace")+" ",1),e.createVNode(t,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(le))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),o.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",Ye,"/")):e.createCommentVNode("",!0),o.showSecondaryNavigation?(e.openBlock(),e.createBlock(q,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(z,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Q.value,g=>(e.openBlock(),e.createBlock(y,{key:g.label,class:e.normalizeClass({active:g.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:K(g),class:"nav-link",onClick:e.withModifiers(X=>J(g),["prevent"])},e.toDisplayString(g.label),9,Qe)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",Xe,[e.createTextVNode(e.toDisplayString(ee.value)+" ",1),e.createVNode(t,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(le))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ze,[e.createVNode(q,{onCommand:F,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(z,null,{default:e.withCtx(()=>[e.createVNode(y,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:a[0]||(a[0]=e.withModifiers(g=>F("profile"),["prevent"]))},"Profile Settings")]),_:1}),o.showWorkspaceSelector?(e.openBlock(),e.createBlock(y,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:a[1]||(a[1]=e.withModifiers(g=>F("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(y,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:a[2]||(a[2]=e.withModifiers(g=>F("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",ea,[e.createElementVNode("div",aa,[e.createElementVNode("span",oa,e.toDisplayString(b.value.name),1)]),e.createElementVNode("div",ta,[b.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:b.value.avatar_url,alt:b.value.name},null,8,sa)):(e.openBlock(),e.createElementBlock("span",ra,e.toDisplayString(b.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",na,[e.createElementVNode("div",la,[e.createElementVNode("div",ia,[e.createElementVNode("a",ca,[o.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:o.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,ua)):(e.openBlock(),e.createElementBlock("div",da,[...a[18]||(a[18]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),a[20]||(a[20]=e.createElementVNode("div",{class:"header-center"},[e.createElementVNode("span",{class:"welcome-text"},"Welcome to AI Workspace")],-1)),e.createElementVNode("div",pa,[e.createVNode(te,{type:"primary",size:"large",class:"login-button",onClick:a[3]||(a[3]=g=>S.value=!0)},{default:e.withCtx(()=>[e.createVNode(t,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Se))]),_:1}),a[19]||(a[19]=e.createTextVNode(" Login / Signup ",-1))]),_:1})])])),M.value&&o.showWorkspaceSelector?(e.openBlock(),e.createBlock(he,{key:4,modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=g=>_.value=g),title:"Switch Workspace",width:"500px",onClose:a[6]||(a[6]=g=>_.value=!1)},{footer:e.withCtx(()=>[e.createVNode(te,{onClick:a[4]||(a[4]=g=>_.value=!1)},{default:e.withCtx(()=>[...a[21]||(a[21]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(te,{type:"primary",onClick:C},{default:e.withCtx(()=>[...a[22]||(a[22]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",ha,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(A.value,g=>{var X,ne;return e.openBlock(),e.createElementBlock("div",{key:g.id,class:e.normalizeClass(["workspace-item",{active:g.id===((X=R.value)==null?void 0:X.id)}]),onClick:ba=>f(g)},[e.createElementVNode("div",fa,e.toDisplayString(g.children&&g.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("div",ma,[e.createElementVNode("h3",null,e.toDisplayString(g.title),1),e.createElementVNode("p",null,e.toDisplayString(g.description),1),e.createElementVNode("span",wa,e.toDisplayString(g.hasAccess?"Active":"Inactive"),1)]),g.id===((ne=R.value)==null?void 0:ne.id)?(e.openBlock(),e.createElementBlock("div",ga,[e.createVNode(t,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ge))]),_:1})])):e.createCommentVNode("",!0)],10,ka)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0),e.createVNode(pe,{modelValue:S.value,"onUpdate:modelValue":a[7]||(a[7]=g=>S.value=g),onLoginSuccess:re},null,8,["modelValue"])])}}});const _a=se(va,[["__scopeId","data-v-f98a8f3a"]]),Ca={class:"auth-callback"},ya=e.defineComponent({__name:"AuthCallback",setup(d){e.onMounted(async()=>{console.log("[AuthCallback] Component mounted, starting callback processing..."),console.log("[AuthCallback] Current URL:",window.location.href),console.log("[AuthCallback] Current hash:",window.location.hash);try{await new Promise(I=>setTimeout(I,500));const{data:h,error:E}=await N.supabase.auth.getSession();if(E){console.error("Error processing callback:",E),p();return}if(h!=null&&h.session){const I=h.session.user;console.log("OAuth login successful:",I.email),h.session.access_token&&k.setSessionCookie(k.ACCESS_COOKIE,h.session.access_token),h.session.refresh_token&&k.setSessionCookie(k.REFRESH_COOKIE,h.session.refresh_token),k.syncCookiesToLocalStorage();const V=k.getPostLoginBase();console.log("[callback] Post-login redirect URL:",V),console.log("[callback] Session storage redirect:",sessionStorage.getItem("post-login-redirect")),console.log("[callback] Local storage redirect:",localStorage.getItem("post-login-redirect"));const L=V||"/";if(console.log("[callback] Final redirect URL:",L),L.startsWith("/")){const U=window.location.origin,T=`${U}${L}`;console.log("[callback] redirecting to:",T,{hostname:window.location.hostname,origin:U}),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=T},100)}else console.log("[callback] redirecting to absolute URL:",L),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=L},100)}else p()}catch(h){console.error("Error processing callback:",h),p()}});const p=()=>{const E=window.location.href.replace("/auth/callback","");window.location.href=E};return(h,E)=>(e.openBlock(),e.createElementBlock("div",Ca,[...E[0]||(E[0]=[e.createElementVNode("div",{class:"callback-container"},[e.createElementVNode("div",{class:"loading-spinner"},[e.createElementVNode("div",{class:"spinner"})]),e.createElementVNode("h2",null,"Processing login..."),e.createElementVNode("p",null,"Please wait while we complete your authentication.")],-1)])]))}});const Sa=se(ya,[["__scopeId","data-v-acdf6325"]]);exports.initializeCrossSubdomainAuth=N.initializeCrossSubdomainAuth;exports.restoreCrossSubdomainSession=N.restoreCrossSubdomainSession;exports.restoreSessionWithRetry=N.restoreSessionWithRetry;exports.setupAuthStateListener=N.setupAuthStateListener;Object.defineProperty(exports,"supabase",{enumerable:!0,get:()=>N.supabase});exports.ACCESS_COOKIE=k.ACCESS_COOKIE;exports.LS_ACCESS_KEY=k.LS_ACCESS_KEY;exports.LS_REFRESH_KEY=k.LS_REFRESH_KEY;exports.REFRESH_COOKIE=k.REFRESH_COOKIE;exports.buildOAuthRedirectUrl=k.buildOAuthRedirectUrl;exports.clearLocalStorageTokens=k.clearLocalStorageTokens;exports.clearSessionCookie=k.clearSessionCookie;exports.ensureCrossSubdomainCookies=k.ensureCrossSubdomainCookies;exports.getCookie=k.getCookie;exports.getPostLoginBase=k.getPostLoginBase;exports.setSessionCookie=k.setSessionCookie;exports.syncCookiesToLocalStorage=k.syncCookiesToLocalStorage;exports.setupUniversalCallback=fe.setupUniversalCallback;exports.AIWorkspaceHeader=_a;exports.AuthCallback=Sa;exports.LoginModal=pe;exports.useAuth=de;exports.useEnhancedAuth=ce;exports.useWorkspaceStore=ue;
