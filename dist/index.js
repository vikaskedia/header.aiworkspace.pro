"use strict";var vo=Object.defineProperty;var ko=(r,s,a)=>s in r?vo(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a;var se=(r,s,a)=>(ko(r,typeof s!="symbol"?s+"":s,a),a);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),B=require("element-plus"),$=require("./supabase-91bfc1cb.js"),y=require("./utils/authRedirect.js"),_o=require("pinia"),yo=require("./utils/universalCallback.js");/*! Element Plus Icons Vue v2.3.2 */var So=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(r){return(s,a)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),Me=So,Co=e.defineComponent({name:"Check",__name:"check",setup(r){return(s,a)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Eo=Co,Vo=e.defineComponent({name:"Lock",__name:"lock",setup(r){return(s,a)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96"}),e.createElementVNode("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32m192-160v-64a192 192 0 1 0-384 0v64zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64"})]))}}),Be=Vo,bo=e.defineComponent({name:"Message",__name:"message",setup(r){return(s,a)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M128 224v512a64 64 0 0 0 64 64h640a64 64 0 0 0 64-64V224zm0-64h768a64 64 0 0 1 64 64v512a128 128 0 0 1-128 128H192A128 128 0 0 1 64 736V224a64 64 0 0 1 64-64"}),e.createElementVNode("path",{fill:"currentColor",d:"M904 224 656.512 506.88a192 192 0 0 1-289.024 0L120 224zm-698.944 0 210.56 240.704a128 128 0 0 0 192.704 0L818.944 224z"})]))}}),No=bo,Ao=e.defineComponent({name:"Refresh",__name:"refresh",setup(r){return(s,a)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M771.776 794.88A384 384 0 0 1 128 512h64a320 320 0 0 0 555.712 216.448H654.72a32 32 0 1 1 0-64h149.056a32 32 0 0 1 32 32v148.928a32 32 0 1 1-64 0v-50.56zM276.288 295.616h92.992a32 32 0 0 1 0 64H220.16a32 32 0 0 1-32-32V178.56a32 32 0 0 1 64 0v50.56A384 384 0 0 1 896.128 512h-64a320 320 0 0 0-555.776-216.384z"})]))}}),fe=Ao,Io=e.defineComponent({name:"User",__name:"user",setup(r){return(s,a)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"})]))}}),ge=Io,Lo=e.defineComponent({name:"Warning",__name:"warning",setup(r){return(s,a)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 832a384 384 0 0 0 0-768 384 384 0 0 0 0 768m48-176a48 48 0 1 1-96 0 48 48 0 0 1 96 0m-48-464a32 32 0 0 1 32 32v288a32 32 0 0 1-64 0V288a32 32 0 0 1 32-32"})]))}}),Re=Lo;class re extends Error{constructor(a,i={},m){super(a);se(this,"context");se(this,"originalError");this.name="PackageError",this.context=i,this.originalError=m}}function xo(r,s={},a){try{const i=r();return i instanceof Promise?i.catch(m=>{if(console.warn("[ErrorHandler] Async operation failed:",{context:s,error:m.message,stack:m.stack}),a!==void 0)return a;throw new re(`Async operation failed: ${m.message}`,s,m)}):i}catch(i){if(console.warn("[ErrorHandler] Operation failed:",{context:s,error:i instanceof Error?i.message:String(i),stack:i instanceof Error?i.stack:void 0}),a!==void 0)return a;throw new re(`Operation failed: ${i instanceof Error?i.message:String(i)}`,s,i instanceof Error?i:void 0)}}async function Mo(r,s={},a){try{return await r()}catch(i){if(console.warn("[ErrorHandler] Async operation failed:",{context:s,error:i instanceof Error?i.message:String(i),stack:i instanceof Error?i.stack:void 0}),a!==void 0)return a;throw new re(`Async operation failed: ${i instanceof Error?i.message:String(i)}`,s,i instanceof Error?i:void 0)}}function $e(r,s={}){const a=r.message.toLowerCase();if(a.includes("is not a function")||a.includes("cannot read property")||a.includes("undefined is not a function")){console.warn("[ErrorHandler] Bundling error detected:",{context:s,error:r.message,suggestion:"This may be due to minification or import issues. The package will continue with fallback behavior."});return}throw new re(`Unexpected error: ${r.message}`,s,r)}async function Bo(r,s={},a){try{return await r()}catch(i){return console.warn("[ErrorHandler] Import failed:",{context:s,error:i instanceof Error?i.message:String(i)}),a!==void 0?a:void 0}}function Ro(r){var s;try{if(typeof document>"u")return null;const i=`; ${document.cookie}`.split(`; ${r}=`);return i.length===2&&((s=i.pop())==null?void 0:s.split(";").shift())||null}catch(a){return console.warn("[ErrorHandler] Cookie access failed:",{cookieName:r,error:a instanceof Error?a.message:String(a)}),null}}function $o(r,s,a={}){try{if(typeof document>"u")return!1;let i=`${r}=${s}`;return a.domain&&(i+=`; domain=${a.domain}`),a.path&&(i+=`; path=${a.path}`),a.secure&&(i+="; secure"),a.sameSite&&(i+=`; samesite=${a.sameSite}`),a.maxAge&&(i+=`; max-age=${a.maxAge}`),document.cookie=i,!0}catch(i){return console.warn("[ErrorHandler] Cookie setting failed:",{cookieName:r,error:i instanceof Error?i.message:String(i)}),!1}}function To(r){try{return typeof localStorage>"u"?null:localStorage.getItem(r)}catch(s){return console.warn("[ErrorHandler] localStorage get failed:",{key:r,error:s instanceof Error?s.message:String(s)}),null}}function Po(r,s){try{return typeof localStorage>"u"?!1:(localStorage.setItem(r,s),!0)}catch(a){return console.warn("[ErrorHandler] localStorage set failed:",{key:r,error:a instanceof Error?a.message:String(a)}),!1}}function Wo(r,s){try{return typeof window>"u"?s:r(window)}catch(a){return console.warn("[ErrorHandler] Window operation failed:",{error:a instanceof Error?a.message:String(a)}),s}}function Te(){typeof window>"u"||(window.addEventListener("unhandledrejection",r=>{const s=r.reason;if(s instanceof Error){const a=s.message.toLowerCase();if(a.includes("is not a function")||a.includes("cannot read property")||a.includes("undefined is not a function")){console.warn("[ErrorHandler] Unhandled promise rejection (bundling error):",{error:s.message,stack:s.stack}),r.preventDefault();return}}console.error("[ErrorHandler] Unhandled promise rejection:",r.reason)}),window.addEventListener("error",r=>{const s=r.error;if(s instanceof Error){const a=s.message.toLowerCase();if(a.includes("is not a function")||a.includes("cannot read property")||a.includes("undefined is not a function")){console.warn("[ErrorHandler] Uncaught error (bundling error):",{error:s.message,stack:s.stack}),r.preventDefault();return}}console.error("[ErrorHandler] Uncaught error:",r.error)}))}typeof window<"u"&&Te();function Pe(){const r=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),s=e.ref(null),a=e.computed(()=>r.value.isAuthenticated),i=e.computed(()=>r.value.user),m=e.computed(()=>r.value.isLoading),v=async()=>{var w,d,c,x,p,u,V,N,_,f,b,g,k,q,z,O,W,Y,F,S,T;try{console.log("[auth][enhanced] Starting loadUserInfo..."),console.log("[auth][enhanced] Ensuring cross-subdomain cookie synchronization...");const D="sb-access-token",C="sb-refresh-token",U=I=>{try{const M=location.hostname;if(M==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(M)){console.log("[auth][enhanced] Skipping cookie sync for localhost");return}const G="aiworkspace.pro";if(!M.endsWith(`.${G}`)&&M!==G){console.log("[auth][enhanced] Skipping cookie sync - not under apex domain");return}console.log("[auth][enhanced] Performing cookie synchronization"),I.forEach(K=>{const Q=document.cookie.split(";").find(Z=>Z.trim().startsWith(K+"="));if(Q){console.log(`[auth][enhanced] Found cookie: ${K}`);const Z=Q.split("=")[1];Z&&(document.cookie=`${K}=${Z}; domain=.${G}; path=/; secure; samesite=lax`)}})}catch(M){console.warn("[auth][enhanced] Error in cookie sync:",M)}};U([D,C]),await new Promise(I=>setTimeout(I,50)),U([D,C]),await new Promise(I=>setTimeout(I,50));let j=null;try{const M=await(await $.getSupabase()).auth.getSession();j=(w=M==null?void 0:M.data)==null?void 0:w.session}catch(I){console.warn("[auth][enhanced] Error getting Supabase session:",I)}if(j&&j.user){console.log("[auth][enhanced] Active Supabase session found");const I=j.user,M={id:I.id,name:((d=I.user_metadata)==null?void 0:d.name)||((c=I.user_metadata)==null?void 0:c.user_name)||((x=I.user_metadata)==null?void 0:x.full_name)||((p=I.email)==null?void 0:p.split("@")[0])||"User",email:I.email,avatar_url:((u=I.user_metadata)==null?void 0:u.avatar_url)||null,user_metadata:I.user_metadata};return r.value={user:M,isAuthenticated:!0,isLoading:!1,error:null},s.value={user:M,access_token:j.access_token,refresh_token:j.refresh_token},{user:M,session:s.value,error:null}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const J=await $.restoreSessionWithRetry();if(J.success&&J.session){console.log("[auth][enhanced] Session restored successfully from cookies");const I=J.session.user,M={id:I.id,name:((V=I.user_metadata)==null?void 0:V.name)||((N=I.user_metadata)==null?void 0:N.user_name)||((_=I.user_metadata)==null?void 0:_.full_name)||((f=I.email)==null?void 0:f.split("@")[0])||"User",email:I.email,avatar_url:((b=I.user_metadata)==null?void 0:b.avatar_url)||null,user_metadata:I.user_metadata};return r.value={user:M,isAuthenticated:!0,isLoading:!1,error:null},s.value=J.session,{user:M,session:s.value,error:null}}else{console.log("[auth][enhanced] Failed to restore session:",J.error),console.log("[auth][enhanced] Retrying session restoration with extended delay..."),await new Promise(M=>setTimeout(M,500)),U([D,C]);const I=await $.restoreSessionWithRetry();if(I.success&&I.session){console.log("[auth][enhanced] Session restored on retry");const M=I.session.user,G={id:M.id,name:((g=M.user_metadata)==null?void 0:g.name)||((k=M.user_metadata)==null?void 0:k.user_name)||((q=M.user_metadata)==null?void 0:q.full_name)||((z=M.email)==null?void 0:z.split("@")[0])||"User",email:M.email,avatar_url:((O=M.user_metadata)==null?void 0:O.avatar_url)||null,user_metadata:M.user_metadata};return r.value={user:G,isAuthenticated:!0,isLoading:!1,error:null},s.value=I.session,{user:G,session:s.value,error:null}}}}catch(D){console.error("Error getting Supabase session:",D),D instanceof Error&&$e(D,{component:"useEnhancedAuth",function:"loadUserInfo",operation:"session_validation"});try{const C=await $.restoreSessionWithRetry();if(C.success&&C.session){console.log("[auth][enhanced] Session restored after error");const U=C.session.user,j={id:U.id,name:((W=U.user_metadata)==null?void 0:W.name)||((Y=U.user_metadata)==null?void 0:Y.user_name)||((F=U.user_metadata)==null?void 0:F.full_name)||((S=U.email)==null?void 0:S.split("@")[0])||"User",email:U.email,avatar_url:((T=U.user_metadata)==null?void 0:T.avatar_url)||null,user_metadata:U.user_metadata};return r.value={user:j,isAuthenticated:!0,isLoading:!1,error:null},s.value=C.session,{user:j,session:s.value,error:null}}}catch(C){console.error("Error restoring session:",C)}}return console.log("[auth][enhanced] No valid authentication found"),r.value={user:null,isAuthenticated:!1,isLoading:!1,error:"No valid session found"},s.value=null,{user:null,session:null,error:"No valid session found"}},L=async()=>{try{await(await $.getSupabase()).auth.signOut(),y.clearSessionCookie(y.ACCESS_COOKIE),y.clearSessionCookie(y.REFRESH_COOKIE),y.clearLocalStorageTokens(),r.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},s.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(w){console.error("Error during logout:",w),r.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},s.value=null}},R=async(w,d)=>{var c,x,p,u,V;try{r.value.isLoading=!0;const N=await $.getSupabase(),{data:_,error:f}=await N.auth.signInWithPassword({email:w,password:d});if(f)throw f;if(_.session){const b=_.session.user,g={id:b.id,name:((c=b.user_metadata)==null?void 0:c.name)||((x=b.user_metadata)==null?void 0:x.user_name)||((p=b.user_metadata)==null?void 0:p.full_name)||((u=b.email)==null?void 0:u.split("@")[0])||"User",email:b.email,avatar_url:((V=b.user_metadata)==null?void 0:V.avatar_url)||null,user_metadata:b.user_metadata};return r.value={user:g,isAuthenticated:!0,isLoading:!1,error:null},s.value={user:g,access_token:_.session.access_token,refresh_token:_.session.refresh_token},{user:g,session:s.value,error:null}}return{user:null,session:null,error:"No session returned"}}catch(N){return console.error("Sign in error:",N),r.value.isLoading=!1,{user:null,session:null,error:String(N)}}},P=async(w,d,c)=>{var x,p,u,V,N;try{r.value.isLoading=!0;const _=await $.getSupabase(),{data:f,error:b}=await _.auth.signUp({email:w,password:d,options:{data:c}});if(b)throw b;if(f.session){const g=f.session.user,k={id:g.id,name:((x=g.user_metadata)==null?void 0:x.name)||((p=g.user_metadata)==null?void 0:p.user_name)||((u=g.user_metadata)==null?void 0:u.full_name)||((V=g.email)==null?void 0:V.split("@")[0])||"User",email:g.email,avatar_url:((N=g.user_metadata)==null?void 0:N.avatar_url)||null,user_metadata:g.user_metadata};return r.value={user:k,isAuthenticated:!0,isLoading:!1,error:null},s.value={user:k,access_token:f.session.access_token,refresh_token:f.session.refresh_token},{user:k,session:s.value,error:null}}return{user:null,session:null,error:"No session returned"}}catch(_){return console.error("Sign up error:",_),r.value.isLoading=!1,{user:null,session:null,error:String(_)}}},h=async()=>{await v()};return e.onMounted(async()=>{await $.initializeCrossSubdomainAuth(),await h()}),{authState:r,currentSession:s,isAuthenticated:a,currentUser:i,isLoading:m,loadUserInfo:v,logout:L,signIn:R,signUp:P,checkAuth:h}}const ee={normalCheckInterval:45e3,fastCheckInterval:8e3,fastMonitoringDuration:18e4,maxRetryAttempts:3,retryDelay:2e3,validationCacheDuration:1e4,enableImmediateDetection:!0,enableFastMonitoring:!0,enableNetworkAwareness:!0},We={...ee,normalCheckInterval:1e4,fastCheckInterval:2e3,fastMonitoringDuration:6e4,maxRetryAttempts:2,retryDelay:1e3},De={...ee,normalCheckInterval:6e4,fastCheckInterval:1e4,fastMonitoringDuration:3e5,maxRetryAttempts:5,retryDelay:3e3,enableFastMonitoring:!1},me={...ee,normalCheckInterval:1e4,fastCheckInterval:2e3,fastMonitoringDuration:3e4,validationCacheDuration:1e3},he={...ee,normalCheckInterval:45e3,fastCheckInterval:3e3,fastMonitoringDuration:9e4,validationCacheDuration:1e4};function we(){switch("production"){case"production":return he;case"development":return me;default:return ee}}function Do(r){return{...ee,...r}}const Ue={default:ee,fast:We,conservative:De,development:me,production:he};function Uo(r){return Ue[r]}const Oo={immediate:"Immediate (0-2 seconds) - When logout is detected via auth events",fast:"Fast (2-5 seconds) - When fast monitoring is active",normal:"Normal (up to 30 seconds) - Regular monitoring interval",conservative:"Conservative (up to 60 seconds) - Less frequent monitoring"},Ho={manualLogout:{timing:"Immediate (0-2 seconds)",description:"User clicks logout button",method:"Auth state change event + fast monitoring"},sessionExpiry:{timing:"Fast (2-5 seconds)",description:"Session token expires naturally",method:"Fast monitoring detects invalid session"},tokenInvalidation:{timing:"Normal (up to 30 seconds)",description:"Token is invalidated server-side",method:"Regular monitoring detects validation failure"},networkIssues:{timing:"Immediate (0-1 second)",description:"Network connection lost",method:"Network event listener"},crossTabLogout:{timing:"Fast (2-5 seconds)",description:"User logs out in another tab",method:"Storage event listener + fast monitoring"}};function Oe(r){const s=e.ref(!0),a=e.ref(null),i=e.ref(!1),m=e.ref(!1),v=e.ref(null),L=e.ref(null),R=e.ref(null),P={...we(),...r},h=P.normalCheckInterval,w=P.fastCheckInterval,d=P.fastMonitoringDuration,c=P.maxRetryAttempts,x=P.retryDelay,p=e.computed(()=>!s.value&&a.value!==null),u=e.computed(()=>{var S,T;return((S=a.value)==null?void 0:S.canRetry)&&((T=a.value)==null?void 0:T.type)!=="manual_check_failed"}),V=S=>{var C;if(typeof document>"u")return null;const D=`; ${document.cookie}`.split(`; ${S}=`);return D.length===2&&((C=D.pop())==null?void 0:C.split(";").shift())||null},N=async()=>{var S,T;try{console.log("[SessionMonitor] Validating session...");const D=V("sb-access-token"),C=V("sb-refresh-token");if(!D||!C)return console.log("[SessionMonitor] No tokens found in cookies"),!1;const U=await $.getSupabase();let j=null,J=null;for(let K=1;K<=2;K++)try{const Q=await U.auth.getSession();j=Q.data.session,J=Q.error;break}catch(Q){if(console.warn(`[SessionMonitor] Network error on attempt ${K}:`,Q),K===2)return console.log("[SessionMonitor] Network issues detected, maintaining current session state"),s.value;await new Promise(Z=>setTimeout(Z,1e3))}if(J)return console.warn("[SessionMonitor] Error getting session:",J),(S=J.message)!=null&&S.includes("Invalid JWT")||(T=J.message)!=null&&T.includes("JWT expired")?!1:s.value;if(!j||!j.user)return console.log("[SessionMonitor] No valid session found"),!1;const I=new Date,M=new Date(j.expires_at*1e3),G=5*60*1e3;return I>=new Date(M.getTime()-G)?(console.log("[SessionMonitor] Session is close to expiry or expired"),!1):(console.log("[SessionMonitor] Session is valid"),v.value=new Date,!0)}catch(D){return console.error("[SessionMonitor] Error validating session:",D),s.value}},_=async()=>{try{console.log("[SessionMonitor] Attempting to restore session...");const S=V("sb-access-token"),T=V("sb-refresh-token");if(!S||!T)return console.log("[SessionMonitor] No tokens available for restoration"),!1;const D=await $.getSupabase(),{data:C,error:U}=await D.auth.setSession({access_token:S,refresh_token:T});return U?(console.warn("[SessionMonitor] Error restoring session:",U),!1):C.session&&C.session.user?(console.log("[SessionMonitor] Session restored successfully"),v.value=new Date,!0):!1}catch(S){return console.error("[SessionMonitor] Error restoring session:",S),!1}},f=(S,T,D=!0)=>{console.warn("[SessionMonitor] Session loss detected:",{type:S,message:T}),s.value=!1,a.value={type:S,message:T,timestamp:new Date,canRetry:D}},b=async()=>{console.log("[SessionMonitor] Retrying session validation...");for(let S=1;S<=c;S++){if(console.log(`[SessionMonitor] Retry attempt ${S}/${c}`),S>1&&await new Promise(C=>setTimeout(C,x)),await _()&&await N())return console.log("[SessionMonitor] Session restored and validated successfully"),s.value=!0,a.value=null,!0;if(await N())return console.log("[SessionMonitor] Session validated successfully on retry"),s.value=!0,a.value=null,!0}return console.log("[SessionMonitor] All retry attempts failed"),!1},g=()=>{console.log("[SessionMonitor] Clearing session loss state"),s.value=!0,a.value=null},k=()=>{if(i.value){console.log("[SessionMonitor] Already monitoring, skipping start");return}console.log("[SessionMonitor] Starting session monitoring..."),i.value=!0,setTimeout(async()=>{console.log("[SessionMonitor] Performing initial session validation..."),await N()?console.log("[SessionMonitor] Initial validation successful"):(console.log("[SessionMonitor] Initial validation failed, but waiting for confirmation..."),setTimeout(async()=>{await N()||f("session_expired","Your session has expired. Please log in again.",!0)},3e3))},2e3),L.value=setInterval(async()=>{console.log("[SessionMonitor] Periodic session check...");const S=await N();!S&&s.value?(console.log("[SessionMonitor] Session validation failed, performing confirmation check..."),setTimeout(async()=>{await N()||f("session_expired","Your session has expired. Please log in again.",!0)},2e3)):S&&!s.value&&(console.log("[SessionMonitor] Session recovered"),g())},h)},q=()=>{if(m.value){console.log("[SessionMonitor] Fast monitoring already active");return}console.log("[SessionMonitor] Starting fast monitoring (5s intervals)..."),m.value=!0,R.value&&clearInterval(R.value),R.value=setInterval(async()=>{console.log("[SessionMonitor] Fast session check...");const S=await N();!S&&s.value?(console.log("[SessionMonitor] Fast monitoring detected potential session loss, confirming..."),setTimeout(async()=>{await N()||(f("session_expired","Your session has expired. Please log in again.",!0),z())},1e3)):S&&!s.value&&(console.log("[SessionMonitor] Session recovered"),g(),z())},w),setTimeout(()=>{m.value&&(console.log(`[SessionMonitor] Auto-stopping fast monitoring after ${d/1e3} seconds`),z())},d)},z=()=>{m.value&&(console.log("[SessionMonitor] Stopping fast monitoring..."),m.value=!1,R.value&&(clearInterval(R.value),R.value=null))},O=()=>{i.value&&(console.log("[SessionMonitor] Stopping session monitoring..."),i.value=!1,L.value&&(clearInterval(L.value),L.value=null),z())},W=async()=>{console.log("[SessionMonitor] Manual session check requested");const S=await N();return!S&&!await _()?(f("manual_check_failed","Session validation failed. Please log in again.",!1),!1):S},Y=()=>{console.log("[SessionMonitor] Network error detected, but not triggering immediate session loss"),s.value||f("network_error","Network connection lost. Please check your internet connection and try again.",!0)},F=()=>{if(typeof window>"u")return;const S=()=>{var C;console.log("[SessionMonitor] Network connection restored"),p.value&&((C=a.value)==null?void 0:C.type)==="network_error"&&setTimeout(()=>b(),1e3)},T=()=>{console.log("[SessionMonitor] Network connection lost"),Y()},D=C=>{console.log("[SessionMonitor] Logout detected, starting fast monitoring for immediate detection"),q()};return window.addEventListener("online",S),window.addEventListener("offline",T),window.addEventListener("session-logout-detected",D),()=>{window.removeEventListener("online",S),window.removeEventListener("offline",T),window.removeEventListener("session-logout-detected",D)}};return e.onMounted(()=>{console.log("[SessionMonitor] Mounted, setting up monitoring"),k(),F()}),e.onUnmounted(()=>{console.log("[SessionMonitor] Unmounted, cleaning up"),O()}),{isSessionValid:s,sessionLossEvent:a,isMonitoring:i,isFastMonitoring:m,lastValidSession:v,hasSessionLoss:p,canRetrySession:u,validateSession:N,restoreSession:_,retrySession:b,clearSessionLoss:g,startMonitoring:k,stopMonitoring:O,startFastMonitoring:q,stopFastMonitoring:z,checkSession:W,handleNetworkError:Y}}const He=_o.defineStore("workspace",()=>{const r=e.ref(null),s=e.ref([]),a=e.ref(null),i=h=>{r.value=h,localStorage.setItem("current_workspace",JSON.stringify(h))},m=h=>{s.value=h,localStorage.setItem("available_workspaces",JSON.stringify(h))};return{currentWorkspace:r,workspaces:s,user:a,setCurrentWorkspace:i,setWorkspaces:m,setUser:h=>{a.value=h,localStorage.setItem("user_info",JSON.stringify(h))},loadPersistedData:()=>{const h=localStorage.getItem("current_workspace");if(h)try{r.value=JSON.parse(h)}catch(c){console.error("Error loading persisted workspace:",c)}const w=localStorage.getItem("available_workspaces");if(w)try{s.value=JSON.parse(w)}catch(c){console.error("Error loading persisted workspaces:",c)}const d=localStorage.getItem("user_info");if(d)try{a.value=JSON.parse(d)}catch(c){console.error("Error loading persisted user:",c)}},clearData:()=>{r.value=null,s.value=[],a.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(h=!1)=>{try{const{data:{user:w}}=await $.supabase.auth.getUser();if(!w)return[];let d=$.supabase.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at, git_repo, 
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",w.id);h||(d=d.eq("archived",!1));const{data:c,error:x}=await d;if(x)throw x;const p=new Map;(c||[]).forEach(f=>{(f.workspace_access||[]).forEach(b=>{b.shared_with_user_id===w.id&&p.set(f.id,b)})});const u=[...new Set((c||[]).filter(f=>f.parent_workspace_id).map(f=>f.parent_workspace_id).filter(f=>!p.has(f)))];let V=[];if(u.length){let f=$.supabase.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",u);h||(f=f.eq("archived",!1));const{data:b,error:g}=await f;if(g)throw g;V=b||[]}const _=[...c||[],...V].map(f=>{var b,g,k;return{id:f.id,title:f.title,description:f.description||"No description",parent_workspace_id:f.parent_workspace_id,created_by:f.created_by,archived:f.archived,created_at:f.created_at,latest_activity:((g=(b=f.workspace_activities)==null?void 0:b[0])==null?void 0:g.updated_at)||f.created_at,hasAccess:p.has(f.id),accessType:((k=p.get(f.id))==null?void 0:k.access_type)||null}});return _.sort((f,b)=>new Date(b.latest_activity)-new Date(f.latest_activity)),m(_),_}catch(w){return console.error("loadWorkspaces error",w),[]}}}});function Fe(){const r=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),s=e.ref(window.location.href),a=async()=>{var h,w,d,c,x,p,u,V;try{r.value.isLoading=!0;const N=await $.getSupabase(),{data:{session:_},error:f}=await N.auth.getSession();if(f){console.error("Error checking auth status:",f),r.value={user:null,isAuthenticated:!1,isLoading:!1,error:f.message};return}_!=null&&_.user?(r.value={user:{id:_.user.id,email:_.user.email||"",name:((h=_.user.user_metadata)==null?void 0:h.full_name)||((w=_.user.user_metadata)==null?void 0:w.name)||((d=_.user.email)==null?void 0:d.split("@")[0])||"User",avatar_url:((c=_.user.user_metadata)==null?void 0:c.avatar_url)||((x=_.user.user_metadata)==null?void 0:x.picture)||null,initials:(((p=_.user.user_metadata)==null?void 0:p.full_name)||((u=_.user.user_metadata)==null?void 0:u.name)||((V=_.user.email)==null?void 0:V.split("@")[0])||"U").split(" ").map(b=>b[0]).join("").toUpperCase().substring(0,2)},isAuthenticated:!0,isLoading:!1,error:null},_.access_token&&y.setSessionCookie(y.ACCESS_COOKIE,_.access_token),_.refresh_token&&y.setSessionCookie(y.REFRESH_COOKIE,_.refresh_token),y.syncCookiesToLocalStorage()):r.value={user:null,isAuthenticated:!1,isLoading:!1,error:null}}catch(N){console.error("Auth check failed:",N),r.value={user:null,isAuthenticated:!1,isLoading:!1,error:N.message||"Authentication check failed"}}},i=async(h,w)=>{try{const d=await $.getSupabase(),{error:c}=await d.auth.signInWithPassword({email:h,password:w});return c?{success:!1,error:c.message}:(await a(),sessionStorage.setItem("post-login-redirect",s.value),{success:!0})}catch(d){return console.error("Login error:",d),{success:!1,error:d.message||"Login failed"}}},m=async(h,w)=>{var d;try{const c=await $.getSupabase(),{data:x,error:p}=await c.auth.signUp({email:h,password:w});return p?{success:!1,error:p.message}:x.user&&!x.user.email_confirmed_at?{success:!0,needsConfirmation:!0}:(d=x.session)!=null&&d.user?(await a(),sessionStorage.setItem("post-login-redirect",s.value),{success:!0}):{success:!1,error:"No session created"}}catch(c){return console.error("Signup error:",c),{success:!1,error:c.message||"Signup failed"}}},v=async h=>{try{const w=`${window.location.origin}/auth/callback`;console.log("[OAuth] Starting login with provider:",h),console.log("[OAuth] Redirect URL:",w),console.log("[OAuth] Current URL:",s.value),console.log("[OAuth] Current origin:",window.location.origin);const d=await $.getSupabase(),{error:c}=await d.auth.signInWithOAuth({provider:h,options:{redirectTo:w,queryParams:{redirect_origin:s.value}}});if(c)return console.error("[OAuth] Error:",c),{success:!1,error:c.message};const x=s.value||window.location.href;return sessionStorage.setItem("post-login-redirect",x),localStorage.setItem("post-login-redirect",x),console.log("[OAuth] Stored redirect URL:",x),console.log("[OAuth] Current URL value:",s.value),console.log("[OAuth] Window location href:",window.location.href),{success:!0}}catch(w){return console.error("OAuth login error:",w),{success:!1,error:w.message||"OAuth login failed"}}},L=async()=>{try{const h=await $.getSupabase(),{error:w}=await h.auth.signOut();w&&console.error("Logout error:",w),r.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},y.clearSessionCookie(y.ACCESS_COOKIE),y.clearSessionCookie(y.REFRESH_COOKIE),y.clearLocalStorageTokens()}catch(h){console.error("Logout error:",h)}},R=async h=>{try{const w=await $.getSupabase(),{error:d}=await w.auth.resetPasswordForEmail(h,{redirectTo:`${window.location.origin}/auth/reset-password`});return d?{success:!1,error:d.message}:{success:!0}}catch(w){return console.error("Password reset error:",w),{success:!1,error:w.message||"Password reset failed"}}},P=async()=>{try{(await $.getSupabase()).auth.onAuthStateChange((w,d)=>{var c;switch(console.log("Auth state changed:",w,(c=d==null?void 0:d.user)==null?void 0:c.email),w){case"SIGNED_IN":d!=null&&d.user&&a();break;case"SIGNED_OUT":r.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},y.clearSessionCookie(y.ACCESS_COOKIE),y.clearSessionCookie(y.REFRESH_COOKIE),y.clearLocalStorageTokens();break;case"TOKEN_REFRESHED":d!=null&&d.access_token&&y.setSessionCookie(y.ACCESS_COOKIE,d.access_token),d!=null&&d.refresh_token&&y.setSessionCookie(y.REFRESH_COOKIE,d.refresh_token),y.syncCookiesToLocalStorage();break;case"USER_UPDATED":d!=null&&d.user&&a();break}})}catch(h){console.warn("Failed to setup auth listener:",h)}};return e.onMounted(async()=>{P(),await a()}),e.watch(()=>window.location.href,h=>{s.value=h}),{authState:e.computed(()=>r.value),isAuthenticated:e.computed(()=>r.value.isAuthenticated),user:e.computed(()=>r.value.user),isLoading:e.computed(()=>r.value.isLoading),checkAuthStatus:a,loginWithEmail:i,signupWithEmail:m,loginWithProvider:v,logout:L,resetPassword:R,currentUrl:e.computed(()=>s.value)}}const Fo={class:"login-container"},zo={class:"logo-section"},jo={class:"login-buttons"},Go={key:0,class:"forgot-password"},Ko={class:"signup-link"},qo=e.defineComponent({__name:"LoginModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","login-success"],setup(r,{emit:s}){const a=r,i=s,m=e.computed({get:()=>a.modelValue,set:g=>i("update:modelValue",g)}),v=e.ref(!1),L=e.ref(!1),R=e.ref(),{loginWithEmail:P,signupWithEmail:h,loginWithProvider:w,resetPassword:d}=Fe(),c=e.reactive({email:"",password:"",confirmPassword:""}),x=e.computed(()=>({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email",trigger:"blur"}],password:[{required:!0,message:"Please enter your password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],...v.value?{confirmPassword:[{required:!0,message:"Please confirm your password",trigger:"blur"},{validator:(g,k,q)=>{k!==c.password?q(new Error("Passwords do not match")):q()},trigger:"blur"}]}:{}})),p=()=>{var g;v.value=!v.value,c.email="",c.password="",c.confirmPassword="",(g=R.value)==null||g.clearValidate()},u=()=>{var g;m.value=!1,c.email="",c.password="",c.confirmPassword="",v.value=!1,(g=R.value)==null||g.clearValidate()},V=async()=>{if(R.value)try{await R.value.validate(),L.value=!0,v.value?await _():await N()}catch(g){console.error("Form validation failed:",g)}finally{L.value=!1}},N=async()=>{const g=await P(c.email,c.password);g.success?(B.ElMessage.success("Login successful"),i("login-success",{email:c.email}),u()):B.ElMessage.error("Login failed: "+g.error)},_=async()=>{const g=await h(c.email,c.password);g.success?g.needsConfirmation?B.ElMessage.success("Please check your email to confirm your account"):(B.ElMessage.success("Account created successfully"),i("login-success",{email:c.email}),u()):B.ElMessage.error("Signup failed: "+g.error)},f=async g=>{const k=await w(g);k.success?B.ElMessage.success("Redirecting to login provider..."):B.ElMessage.error("Login failed: "+k.error)},b=async()=>{if(!c.email){B.ElMessage.warning("Please enter your email address first");return}const g=await d(c.email);g.success?B.ElMessage.success("Password reset email sent! Please check your inbox."):B.ElMessage.error("Failed to send reset email: "+g.error)};return(g,k)=>{const q=e.resolveComponent("el-icon"),z=e.resolveComponent("el-input"),O=e.resolveComponent("el-form-item"),W=e.resolveComponent("el-button"),Y=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(Y,{modelValue:m.value,"onUpdate:modelValue":k[6]||(k[6]=F=>m.value=F),title:"",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!0,class:"login-modal",onClose:u},{default:e.withCtx(()=>[e.createElementVNode("div",Fo,[e.createElementVNode("div",zo,[e.createElementVNode("h2",null,e.toDisplayString(v.value?"Create Account":"Welcome Back"),1),e.createElementVNode("p",null,e.toDisplayString(v.value?"Sign up to get started with your account":"Sign in to continue to your account"),1)]),e.createVNode(e.unref(B.ElForm),{model:c,rules:x.value,ref_key:"formRef",ref:R,class:"login-form",onSubmit:e.withModifiers(V,["prevent"])},{default:e.withCtx(()=>[e.createVNode(O,{prop:"email"},{default:e.withCtx(()=>[e.createVNode(z,{modelValue:c.email,"onUpdate:modelValue":k[0]||(k[0]=F=>c.email=F),placeholder:"Email",type:"email",size:"large",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(q,null,{default:e.withCtx(()=>[e.createVNode(e.unref(No))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(O,{prop:"password"},{default:e.withCtx(()=>[e.createVNode(z,{modelValue:c.password,"onUpdate:modelValue":k[1]||(k[1]=F=>c.password=F),placeholder:"Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(q,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Be))]),_:1})]),_:1},8,["modelValue"])]),_:1}),v.value?(e.openBlock(),e.createBlock(O,{key:0,prop:"confirmPassword"},{default:e.withCtx(()=>[e.createVNode(z,{modelValue:c.confirmPassword,"onUpdate:modelValue":k[2]||(k[2]=F=>c.confirmPassword=F),placeholder:"Confirm Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(q,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Be))]),_:1})]),_:1},8,["modelValue"])]),_:1})):e.createCommentVNode("",!0),e.createVNode(O,null,{default:e.withCtx(()=>[e.createVNode(W,{type:"primary",class:"submit-button",loading:L.value,onClick:V,size:"large"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(v.value?"Sign Up":"Sign In"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),k[10]||(k[10]=e.createElementVNode("div",{class:"divider"},[e.createElementVNode("span",null,"Or continue with")],-1)),e.createElementVNode("div",jo,[e.createVNode(W,{class:"login-button google",onClick:k[3]||(k[3]=F=>f("google")),size:"large"},{default:e.withCtx(()=>[...k[7]||(k[7]=[e.createElementVNode("span",{class:"social-icon"},"G",-1),e.createTextVNode(" Google ",-1)])]),_:1}),e.createVNode(W,{class:"login-button github",onClick:k[4]||(k[4]=F=>f("github")),size:"large"},{default:e.withCtx(()=>[...k[8]||(k[8]=[e.createElementVNode("span",{class:"social-icon"},"⚡",-1),e.createTextVNode(" GitHub ",-1)])]),_:1}),e.createVNode(W,{class:"login-button twitter",onClick:k[5]||(k[5]=F=>f("twitter")),size:"large"},{default:e.withCtx(()=>[...k[9]||(k[9]=[e.createElementVNode("span",{class:"social-icon"},"X",-1),e.createTextVNode(" X (Twitter) ",-1)])]),_:1})]),k[11]||(k[11]=e.createElementVNode("div",{class:"terms"}," By continuing, you agree to AI Workspace's Terms of Service and Privacy Policy ",-1)),v.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Go,[e.createElementVNode("a",{href:"#",onClick:e.withModifiers(b,["prevent"])},"Forgot Password?")])),e.createElementVNode("div",Ko,[e.createTextVNode(e.toDisplayString(v.value?"Already have an account?":"Don't have an account?")+" ",1),e.createElementVNode("a",{href:"#",onClick:e.withModifiers(p,["prevent"])},e.toDisplayString(v.value?"Sign in":"Sign up"),1)])])]),_:1},8,["modelValue"])}}});const le=(r,s)=>{const a=r.__vccOpts||r;for(const[i,m]of s)a[i]=m;return a},ze=le(qo,[["__scopeId","data-v-684a3f28"]]),Yo={class:"session-loss-content"},Jo={class:"session-loss-icon"},Xo={class:"session-loss-message"},Qo={key:0,class:"session-loss-details"},Zo={class:"detail-item"},et={class:"detail-value"},ot={class:"detail-item"},tt={class:"detail-value"},st={class:"session-loss-actions"},at={key:0,class:"retry-status"},rt={class:"retry-message"},nt=e.defineComponent({__name:"SessionLossModal",props:{modelValue:{type:Boolean},sessionLossEvent:{},canRetrySession:{type:Boolean}},emits:["update:modelValue","retry","login","refresh"],setup(r,{emit:s}){const a=r,i=s,m=e.ref(!1),v=e.ref(0),L=e.ref(void 0),R=e.ref(""),P=e.computed({get:()=>a.modelValue,set:p=>i("update:modelValue",p)}),h=p=>{switch(p){case"session_expired":return"Authentication session has expired";case"token_invalid":return"Authentication token is invalid or corrupted";case"network_error":return"Network connection issue detected";case"manual_check_failed":return"Session validation failed";default:return"Unknown authentication issue"}},w=p=>p.toLocaleString(),d=async()=>{if(m.value)return;m.value=!0,v.value=0,L.value=void 0,R.value="Attempting to restore session...";const p=setInterval(()=>{v.value<90&&(v.value+=Math.random()*20)},200);try{i("retry"),await new Promise(u=>setTimeout(u,2e3)),v.value=100,L.value="success",R.value="Session restored successfully!",setTimeout(()=>{P.value=!1},1e3)}catch{v.value=100,L.value="exception",R.value="Failed to restore session. Please log in again.",B.ElMessage.error("Session restoration failed")}finally{clearInterval(p),setTimeout(()=>{m.value=!1,v.value=0,L.value=void 0,R.value=""},3e3)}},c=()=>{i("login"),P.value=!1},x=()=>{i("refresh"),window.location.reload()};return e.watch(()=>a.sessionLossEvent,p=>{p&&(m.value=!1,v.value=0,L.value=void 0,R.value="")}),(p,u)=>(e.openBlock(),e.createBlock(e.unref(B.ElDialog),{modelValue:P.value,"onUpdate:modelValue":u[0]||(u[0]=V=>P.value=V),title:"Session Expired",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,class:"session-loss-modal",center:""},{default:e.withCtx(()=>{var V;return[e.createElementVNode("div",Yo,[e.createElementVNode("div",Jo,[e.createVNode(e.unref(B.ElIcon),{size:"48",color:"#f56c6c"},{default:e.withCtx(()=>[e.createVNode(e.unref(Re))]),_:1})]),e.createElementVNode("div",Xo,[u[3]||(u[3]=e.createElementVNode("h3",null,"Your session has expired",-1)),e.createElementVNode("p",null,e.toDisplayString(((V=p.sessionLossEvent)==null?void 0:V.message)||"Please log in again to continue using the application."),1),p.sessionLossEvent?(e.openBlock(),e.createElementBlock("div",Qo,[e.createElementVNode("div",Zo,[u[1]||(u[1]=e.createElementVNode("span",{class:"detail-label"},"Issue:",-1)),e.createElementVNode("span",et,e.toDisplayString(h(p.sessionLossEvent.type)),1)]),e.createElementVNode("div",ot,[u[2]||(u[2]=e.createElementVNode("span",{class:"detail-label"},"Time:",-1)),e.createElementVNode("span",tt,e.toDisplayString(w(p.sessionLossEvent.timestamp)),1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",st,[p.canRetrySession&&!m.value?(e.openBlock(),e.createBlock(e.unref(B.ElButton),{key:0,type:"primary",onClick:d,loading:m.value},{default:e.withCtx(()=>[e.createVNode(e.unref(B.ElIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(fe))]),_:1}),u[4]||(u[4]=e.createTextVNode(" Try Again ",-1))]),_:1},8,["loading"])):e.createCommentVNode("",!0),e.createVNode(e.unref(B.ElButton),{type:"primary",onClick:c,disabled:m.value},{default:e.withCtx(()=>[e.createVNode(e.unref(B.ElIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(ge))]),_:1}),u[5]||(u[5]=e.createTextVNode(" Log In ",-1))]),_:1},8,["disabled"]),p.canRetrySession?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(B.ElButton),{key:1,type:"info",onClick:x,disabled:m.value},{default:e.withCtx(()=>[e.createVNode(e.unref(B.ElIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(fe))]),_:1}),u[6]||(u[6]=e.createTextVNode(" Refresh Page ",-1))]),_:1},8,["disabled"]))]),m.value?(e.openBlock(),e.createElementBlock("div",at,[e.createVNode(e.unref(B.ElProgress),{percentage:v.value,status:L.value,"stroke-width":6},null,8,["percentage","status"]),e.createElementVNode("p",rt,e.toDisplayString(R.value),1)])):e.createCommentVNode("",!0)])]}),_:1},8,["modelValue"]))}});const je=le(nt,[["__scopeId","data-v-0dd27f7f"]]),it={class:"aiworkspace-header"},lt={key:0,class:"header-content header-loading"},ct={class:"header-center"},ut={class:"loading-text"},dt={key:0},pt={key:1},ft={key:1,class:"header-content header-fallback"},gt={key:2,class:"header-content header-restricted"},mt={class:"header-center"},ht={class:"restricted-text"},wt={class:"header-right"},vt={key:3,class:"header-content"},kt={class:"header-left"},_t={class:"logo-section"},yt={href:"/",class:"logo"},St=["src"],Ct={key:1,class:"text-logo"},Et={key:0,class:"header-center"},Vt={class:"main-navigation"},bt={class:"nav-item"},Nt={href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},At={class:"workspace-dropdown-item"},It=["href"],Lt={class:"workspace-icon"},xt={key:1,class:"nav-divider"},Mt={class:"nav-item"},Bt=["href","onClick"],Rt={class:"header-right"},$t={class:"user-profile"},Tt={class:"user-info"},Pt={class:"user-name"},Wt={class:"user-avatar"},Dt=["src","alt"],Ut={key:1,class:"avatar-placeholder"},Ot={class:"version-info"},Ht={class:"version-hash"},Ft={key:4,class:"header-content header-unauthenticated"},zt={class:"header-left"},jt={class:"logo-section"},Gt={href:"/",class:"logo"},Kt=["src"],qt={key:1,class:"text-logo"},Yt={class:"header-right"},Jt={class:"workspace-list"},Xt=["onClick"],Qt={class:"workspace-icon"},Zt={class:"workspace-details"},es={class:"workspace-members"},os={key:0,class:"current-indicator"},ts={class:"update-content"},ss={class:"update-actions"},ae=50,as=6e4,rs=30,ns=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(r,{emit:s}){const a=r,i=s,{authState:m,logout:v,isLoading:L}=Pe(),{isSessionValid:R,sessionLossEvent:P,hasSessionLoss:h,canRetrySession:w,retrySession:d,clearSessionLoss:c}=Oe(),x=()=>{try{return He()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},p=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},u=e.ref(x()),V=e.computed(()=>!!u.value),N=e.ref(0),_=()=>{if(!u.value&&N.value<ae){if(p()){const t=x();if(t){u.value=t,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}N.value++,setTimeout(_,100)}else N.value>=ae&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{u.value||_()});const f=e.ref(!1),b=e.ref(!1),g=e.ref(!1),k=e.ref([]),q=e.ref([]),z=e.ref({name:"",email:"",avatar_url:null,initials:""}),O=e.ref("unknown"),W=e.ref("unknown"),Y=e.ref(!1),F=e.ref(null),S=e.ref(null),T=e.ref(!1),D=e.ref([]),C=e.ref([]),U=e.ref(!1);e.watch(C,async t=>{t.length>0&&V.value&&G.value&&await M()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{V.value&&G.value&&await M()},{immediate:!1});const j=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,t=>{j.value=t},{immediate:!0}),e.watch(V,t=>{!t&&N.value<ae&&_()});const J=()=>{try{const t=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(t)return t[1];const n=new URLSearchParams(window.location.search).get("workspace_id");if(n)return n;const l=window.location.hash.match(/workspace_id=(\d+)/);return l?l[1]:null}catch(t){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",t),null}},I=()=>{try{return window.location.pathname.includes("/all-workspace/")}catch(t){return console.warn("[AIWorkspaceHeader] Error checking all-workspace mode:",t),!1}},M=async()=>{if(!u.value||!V.value)return;const t=I();if(U.value=t,t){u.value.currentWorkspace=null,localStorage.removeItem("current_workspace"),console.log("[AIWorkspaceHeader] Auto-selected all-workspace mode from URL");return}const o=J();if(o)try{C.value.length===0&&await _e();const n=C.value.find(l=>l.id.toString()===o);n?(u.value.setCurrentWorkspace(n),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${n.title} (ID: ${n.id})`),i("workspaceChange",n)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${o} not found in available workspaces`)}catch(n){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",n)}},G=e.computed(()=>m.value.isAuthenticated),K=e.computed(()=>u.value?u.value.currentWorkspace:null),Q=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),Z=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"All Tasks",key:"tasks",url:"/tasks"},{label:"All Goals",key:"goals",url:"/goals"},{label:"All Events",key:"events",url:"/events"},{label:"All Drive",key:"files",url:"/files"},{label:"All Contacts",key:"contacts",url:"/contacts"},{label:"All Settings",key:"settings",url:"/settings"}]),ve=e.computed(()=>U.value?Z.value:Q.value),Je=e.computed(()=>{try{const t=j.value;let o="";const n=t.match(/\/all-workspace\/([^\/]+)/);if(n)o=n[1];else{const l=t.match(/\/single-workspace\/\d+\/([^\/]+)/);if(l)o=l[1];else{const A=t.match(/\/([^\/]+)$/);A&&(o=A[1])}}if(o){const l=ve.value.find(A=>A.key===o||A.url.includes(`/${o}`)||A.url===`/${o}`);if(l)return l.label}return"Dashboard"}catch(t){return console.warn("[AIWorkspaceHeader] Error determining current section:",t),"Dashboard"}}),Xe=t=>{const o=new Map;t.forEach(A=>{o.set(A.id,{...A,children:[]})});const n=[];o.forEach(A=>{A.parent_workspace_id&&o.has(A.parent_workspace_id)?o.get(A.parent_workspace_id).children.push(A):n.push(A)});const l=A=>{A.sort((H,X)=>H.title.localeCompare(X.title)),A.forEach(H=>{H.children&&l(H.children)})};return l(n),n},ke=(t,o=0,n=[])=>(t.forEach(l=>{n.push({...l,level:o}),l.children&&l.children.length&&ke(l.children,o+1,n)}),n),_e=async()=>{var t,o,n;try{const l=await((t=u.value)==null?void 0:t.loadWorkspaces());if(D.value=Xe(l||[]),C.value=ke(D.value),q.value=C.value,k.value=C.value,a.currentWorkspaceId){const A=C.value.find(H=>{var X;return H.id.toString()===((X=a.currentWorkspaceId)==null?void 0:X.toString())});A&&((o=u.value)==null||o.setCurrentWorkspace(A))}else!K.value&&C.value.length&&((n=u.value)==null||n.setCurrentWorkspace(C.value[0]))}catch(l){console.error("loadWorkspaces (header) error",l)}},Qe=t=>{if(console.log("Navigation command:",t),t==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const o=parseInt(t.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o}/dashboard`;return}},Ze=t=>{const o=K.value,n=U.value;switch(t.key){case"dashboard":n?window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":o?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(n)window.location.href="https://outline.aiworkspace.pro/all-workspace/outlines";else if(o){const l=`https://outline.aiworkspace.pro/single-workspace/${o.id}/outlines`;window.location.href=l}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(n)window.location.href="https://canvas.aiworkspace.pro/all-workspace/canvas";else if(o){const l=`https://canvas.aiworkspace.pro/single-workspace/${o.id}/canvas`;window.location.href=l}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(n)window.location.href="https://drive.aiworkspace.pro/all-workspace/files";else if(o){const l=`https://drive.aiworkspace.pro/single-workspace/${o.id}/files`;window.location.href=l}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(n)window.location.href="https://tasks.aiworkspace.pro/all-workspace/tasks";else if(o){const l=`https://tasks.aiworkspace.pro/single-workspace/${o.id}/tasks`;window.location.href=l}else window.location.href="https://tasks.aiworkspace.pro";break;case"goals":if(n)window.location.href="https://app.aiworkspace.pro/all-workspace/goals";else if(o){const l=`https://app.aiworkspace.pro/single-workspace/${o.id}/goals`;window.location.href=l}else window.location.href="https://app.aiworkspace.pro/all-workspace/goals";break;case"events":if(n)window.location.href="https://app.aiworkspace.pro/all-workspace/events";else if(o){const l=`https://app.aiworkspace.pro/single-workspace/${o.id}/events`;window.location.href=l}else window.location.href="https://app.aiworkspace.pro/all-workspace/events";break;case"contacts":if(n)window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";else if(o){const l=`https://app.aiworkspace.pro/single-workspace/${o.id}/contacts`;window.location.href=l}else window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";break;case"ai-portfolios":if(n)window.location.href="https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios";else if(o){const l=`https://spreadsheet.aiworkspace.pro/single-workspace/${o.id}/ai-portfolios`;window.location.href=l}else window.location.href="https://spreadsheet.aiworkspace.pro";break;case"settings":if(n)window.location.href="https://settings.aiworkspace.pro/all-workspace/settings";else if(o){const l=`https://settings.aiworkspace.pro/single-workspace/${o.id}/settings`;window.location.href=l}else window.location.href="https://settings.aiworkspace.pro";break;default:if(n){const l=`https://app.aiworkspace.pro/all-workspace/${t.key}`;window.location.href=l}else if(o){const l=`https://app.aiworkspace.pro/single-workspace/${o.id}/${t.key}`;window.location.href=l}else{const l=`https://app.aiworkspace.pro/${t.key}`;window.location.href=l}break}},eo=t=>{const o=K.value,n=U.value;switch(t.key){case"dashboard":return n?"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":o?`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${o.id}/dashboard`:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";case"ai-portfolios":return n?"https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios":o?`https://spreadsheet.aiworkspace.pro/single-workspace/${o.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return n?"https://outline.aiworkspace.pro/all-workspace/outlines":o?`https://outline.aiworkspace.pro/single-workspace/${o.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return n?"https://canvas.aiworkspace.pro/all-workspace/canvas":o?`https://canvas.aiworkspace.pro/single-workspace/${o.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return n?"https://drive.aiworkspace.pro/all-workspace/files":o?`https://drive.aiworkspace.pro/single-workspace/${o.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return n?"https://tasks.aiworkspace.pro/all-workspace/tasks":o?`https://tasks.aiworkspace.pro/single-workspace/${o.id}/tasks`:"https://tasks.aiworkspace.pro";case"goals":return n?"https://app.aiworkspace.pro/all-workspace/goals":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/goals`:"https://app.aiworkspace.pro/all-workspace/goals";case"events":return n?"https://app.aiworkspace.pro/all-workspace/events":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/events`:"https://app.aiworkspace.pro/all-workspace/events";case"contacts":return n?"https://app.aiworkspace.pro/all-workspace/contacts":o?`https://app.aiworkspace.pro/single-workspace/${o.id}/contacts`:"https://app.aiworkspace.pro/all-workspace/contacts";case"settings":return n?"https://settings.aiworkspace.pro/all-workspace/settings":o?`https://settings.aiworkspace.pro/single-workspace/${o.id}/settings`:"https://settings.aiworkspace.pro";default:return n?`https://app.aiworkspace.pro/all-workspace/${t.key}`:o?`https://app.aiworkspace.pro/single-workspace/${o.id}/${t.key}`:`https://app.aiworkspace.pro/${t.key}`}},ne=t=>{switch(t){case"profile":a.onProfileClick?a.onProfileClick():B.ElMessage.info("Profile settings coming soon");break;case"workspaces":f.value=!0;break;case"logout":to();break}},ye=t=>{var o;(o=u.value)==null||o.setCurrentWorkspace(t),f.value=!1,i("workspaceChange",t),B.ElMessage.success(`Switched to ${t.title}`)},oo=()=>{B.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:t})=>{var n;const o={id:Date.now(),title:t,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};k.value.push(o),(n=u.value)==null||n.setWorkspaces(k.value),ye(o),B.ElMessage.success(`Created workspace: ${t}`)}).catch(()=>{})},to=()=>{B.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var t;(t=u.value)==null||t.clearData(),await v(),typeof window<"u"&&window.dispatchEvent(new CustomEvent("session-logout-detected",{detail:{timestamp:new Date,source:"manual-logout"}})),i("logout"),B.ElMessage.success("Signed out successfully")}).catch(()=>{})},ue=async()=>{var t,o;if(m.value.user){const n=m.value.user;z.value={name:n.name||((t=n.email)==null?void 0:t.split("@")[0])||"User",email:n.email||"",avatar_url:n.avatar_url||null,initials:(n.name||((o=n.email)==null?void 0:o.split("@")[0])||"U").split(" ").map(l=>l[0]).join("").toUpperCase().substring(0,2)},a.showWorkspaceSelector&&await _e()}};e.watch(()=>m.value.user,t=>{var o;t?ue():(z.value={name:"",email:"",avatar_url:null,initials:""},(o=u.value)==null||o.clearData())}),e.watch(h,t=>{t&&G.value&&(console.log("[AIWorkspaceHeader] Session loss detected, showing modal"),g.value=!0)}),e.watch(()=>a.currentWorkspaceId,t=>{var o;if(t&&C.value.length){const n=C.value.find(l=>l.id.toString()===t.toString());n&&((o=u.value)==null||o.setCurrentWorkspace(n))}}),e.onMounted(async()=>{G.value&&(await ue(),await M()),await lo(),Ie(),go()});const so=async t=>{console.log("Login successful:",t),b.value=!1,await ue(),i("login"),B.ElMessage.success("Welcome back!")},ao=async()=>{console.log("[AIWorkspaceHeader] Retrying session..."),await d()?(g.value=!1,c(),B.ElMessage.success("Session restored successfully!")):B.ElMessage.error("Failed to restore session. Please log in again.")},ro=()=>{console.log("[AIWorkspaceHeader] Opening login modal from session loss"),g.value=!1,b.value=!0},no=()=>{console.log("[AIWorkspaceHeader] Refreshing page due to session loss"),window.location.reload()},io=()=>{N.value=0,_(),B.ElMessage.success("Manual Pinia retry initiated.")},lo=async()=>{try{const t=await fetch("/version.json");if(t.ok){const o=t.headers.get("content-type");if(o&&o.includes("application/json"))try{const n=await t.json();console.log("Version data received:",n),O.value=n.shortCommitHash||"unknown",W.value=n.fullCommitHash||"unknown",console.log("✅ Loaded commit hash from version.json:",O.value);return}catch{console.log("Failed to parse version.json, trying fallback methods...")}}console.log("🔄 version.json not available, trying automatic detection..."),await Ce()}catch(t){console.log("Error loading version.json, trying automatic detection...",t),await Ce()}},Se=async()=>{try{let t=await Ve();if(t||(t=Ee()),t){const o=await Ae(t);o&&o!==W.value&&(console.log("🔄 New commit detected:",W.value,"→",o),W.value!=="unknown"&&!Y.value&&(Y.value=!0,F.value=o))}}catch(t){console.log("Error checking for new commits:",t)}},Ce=async()=>{try{let t=await Ve();if(t||(t=Ee()),t){const A=await Ae(t);if(A){O.value=A.substring(0,7),W.value=A,console.log("✅ Loaded commit hash from GitHub API:",O.value);return}}const o=await uo();if(o&&o.version){O.value=o.version,W.value=o.version,console.log("✅ Loaded version from package.json:",O.value);return}const n=await po();if(n){O.value=n,W.value=n,console.log("✅ Loaded version from build info:",O.value);return}const l=Date.now().toString(36);O.value=l.substring(0,7),W.value=l,console.log("✅ Using timestamp-based version:",O.value)}catch(t){console.warn("❌ All automatic detection methods failed:",t),O.value="unknown",W.value="unknown"}},Ee=()=>{try{const t=window.location.hostname;if(t.includes("github.io")){const o=t.split(".");if(o.length>=3){const n=o[0],l=window.location.pathname.split("/")[1]||"unknown";return console.log("✅ Detected GitHub Pages repo:",n,l),{owner:n,repo:l}}}return console.log("Could not detect repository from domain:",t),null}catch(t){return console.log("Error detecting repo from domain:",t),null}},Ve=async()=>{try{const t=await fetch("/package.json");if(!t.ok)return console.log("package.json not found or not accessible"),null;const o=t.headers.get("content-type");if(!o||!o.includes("application/json"))return console.log("package.json returned non-JSON content (likely HTML), skipping GitHub API"),null;const n=await t.json();if(n.repository&&n.repository.url){const A=n.repository.url.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(A)return console.log("✅ Found GitHub repo info:",A[1],A[2].replace(".git","")),{owner:A[1],repo:A[2].replace(".git","")}}return console.log("No valid GitHub repository found in package.json"),null}catch(t){return console.log("Could not get repo info from package.json:",t),null}},be=e.ref(0),de=e.ref(0),Ne=e.ref(Date.now()),co=()=>{const t=Date.now();t-Ne.value>60*60*1e3&&(de.value=0,Ne.value=t,console.log("🔄 GitHub API call counter reset"))},Ae=async t=>{var o;try{const n=Date.now();if(co(),n-be.value<as)return console.log("⏳ GitHub API rate limit: waiting before next call"),null;if(de.value>=rs)return console.log("🚫 GitHub API hourly limit reached, skipping call"),null;const l=["main","master"];for(const A of l)try{const H=await fetch(`https://api.github.com/repos/${t.owner}/${t.repo}/commits/${A}`);if(be.value=n,de.value++,H.ok){const X=await H.json();return console.log("✅ GitHub API call successful:",X.sha.substring(0,7)),X.sha}else if(H.status===403&&(o=(await H.json()).message)!=null&&o.includes("rate limit"))return console.log("🚫 GitHub API rate limit exceeded, will retry later"),null}catch(H){console.log(`Failed to get commit from ${A} branch:`,H)}}catch(n){console.log("Could not get commit from GitHub API:",n)}return null},uo=async()=>{try{const t=await fetch("/package.json");if(!t.ok)return console.log("package.json not found or not accessible"),null;const o=t.headers.get("content-type");return!o||!o.includes("application/json")?(console.log("package.json returned non-JSON content (likely HTML), skipping"),null):await t.json()}catch(t){console.log("Could not get package.json:",t)}return null},po=async()=>{try{const t=["/build-manifest.json","/build-info.json","/.next/build-manifest.json"];for(const o of t)try{const n=await fetch(o);if(n.ok){const l=await n.json();if(l.version||l.commitHash||l.buildId)return l.version||l.commitHash||l.buildId}}catch{}}catch(t){console.log("Could not get build info:",t)}return null},fo=async()=>{try{if(W.value==="unknown"){B.ElMessage.warning("Version information not available");return}await navigator.clipboard.writeText(W.value),B.ElMessage.success("Version information copied to clipboard!")}catch(t){console.error("Failed to copy version info:",t),B.ElMessage.error("Failed to copy version info")}},Ie=async()=>{if(!T.value){T.value=!0;try{const t=Date.now(),o=await fetch(`/version.json?t=${t}`);if(!o.ok)throw new Error("Failed to fetch version info");const n=o.headers.get("content-type");if(!n||!n.includes("application/json")){console.warn("Version check skipped: version.json not properly configured");return}const l=await o.json();F.value=l.fullCommitHash,W.value!==F.value&&(Y.value||(Y.value=!0,console.log("Version mismatch detected:",{currentVersion:W.value,latestVersion:F.value,serverBuildTime:l.buildTime})))}catch(t){console.error("Error checking for updates:",t)}finally{T.value=!1}}},go=()=>{S.value=setInterval(()=>{Ie(),Se()},5*60*1e3)},mo=()=>{console.log("User reloaded for update:",{currentVersion:W.value,latestVersion:F.value}),window.location.reload()},Le=()=>{Y.value=!1,console.log("Update alert dismissed:",{currentVersion:W.value,latestVersion:F.value})};return e.onUnmounted(()=>{S.value&&clearInterval(S.value)}),(t,o)=>{const n=e.resolveComponent("el-icon"),l=e.resolveComponent("el-button"),A=e.resolveComponent("el-tag"),H=e.resolveComponent("el-dropdown-item"),X=e.resolveComponent("el-dropdown-menu"),pe=e.resolveComponent("el-dropdown"),ho=e.resolveComponent("el-dialog"),wo=e.resolveComponent("el-alert");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("header",it,[!V.value&&N.value<ae||e.unref(L)?(e.openBlock(),e.createElementBlock("div",lt,[o[10]||(o[10]=e.createStaticVNode('<div class="header-left" data-v-0456ef41><div class="logo-section" data-v-0456ef41><a href="/" class="logo" data-v-0456ef41><div class="text-logo" data-v-0456ef41><span class="logo-text" data-v-0456ef41>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",ct,[e.createElementVNode("span",ut,[e.unref(L)?(e.openBlock(),e.createElementBlock("span",dt,"Syncing authentication...")):(e.openBlock(),e.createElementBlock("span",pt,"Initializing..."))])])])):!V.value&&N.value>=ae?(e.openBlock(),e.createElementBlock("div",ft,[o[12]||(o[12]=e.createStaticVNode('<div class="header-left" data-v-0456ef41><div class="logo-section" data-v-0456ef41><a href="/" class="logo" data-v-0456ef41><div class="text-logo" data-v-0456ef41><span class="logo-text" data-v-0456ef41>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[o[11]||(o[11]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:io,class:"retry-button"},"Retry Pinia")]),o[13]||(o[13]=e.createStaticVNode('<div class="header-right" data-v-0456ef41><div class="user-profile" data-v-0456ef41><div class="user-info" data-v-0456ef41><span class="user-name" data-v-0456ef41>User</span></div><div class="user-avatar" data-v-0456ef41><span class="avatar-placeholder" data-v-0456ef41>U</span></div></div></div>',1))])):G.value&&!e.unref(R)?(e.openBlock(),e.createElementBlock("div",gt,[o[16]||(o[16]=e.createStaticVNode('<div class="header-left" data-v-0456ef41><div class="logo-section" data-v-0456ef41><a href="/" class="logo" data-v-0456ef41><div class="text-logo" data-v-0456ef41><span class="logo-text" data-v-0456ef41>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",mt,[e.createElementVNode("span",ht,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Re))]),_:1}),o[14]||(o[14]=e.createTextVNode(" Session expired - Please log in again ",-1))])]),e.createElementVNode("div",wt,[e.createVNode(l,{type:"primary",onClick:o[0]||(o[0]=E=>b.value=!0)},{default:e.withCtx(()=>[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ge))]),_:1}),o[15]||(o[15]=e.createTextVNode(" Log In ",-1))]),_:1})])])):G.value&&e.unref(R)?(e.openBlock(),e.createElementBlock("div",vt,[e.createElementVNode("div",kt,[e.createElementVNode("div",_t,[e.createElementVNode("a",yt,[t.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,St)):(e.openBlock(),e.createElementBlock("div",Ct,[...o[17]||(o[17]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),t.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",Et,[e.createElementVNode("nav",Vt,[t.showWorkspaceSelector?(e.openBlock(),e.createBlock(pe,{key:0,onCommand:Qe,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(X,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(H,{command:"all-workspace",class:e.normalizeClass({active:U.value})},{default:e.withCtx(()=>[e.createElementVNode("a",Nt,[e.createElementVNode("div",At,[o[19]||(o[19]=e.createElementVNode("span",{class:"workspace-icon"},"🌐",-1)),o[20]||(o[20]=e.createElementVNode("span",null,"All workspace",-1)),U.value?(e.openBlock(),e.createBlock(A,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...o[18]||(o[18]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)])])]),_:1},8,["class"]),C.value.length>0?(e.openBlock(),e.createBlock(H,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.value,E=>(e.openBlock(),e.createBlock(H,{key:E.id,command:`workspace-${E.id}`},{default:e.withCtx(()=>{var te;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${E.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(E.level||0)*16+"px"})},[e.createElementVNode("span",Lt,e.toDisplayString(E.children&&E.children.length?"📁":"📄"),1),e.createElementVNode("span",null,e.toDisplayString(E.title),1),E.id===((te=K.value)==null?void 0:te.id)?(e.openBlock(),e.createBlock(A,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...o[21]||(o[21]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,It)]}),_:2},1032,["command"]))),128)),C.value.length===0?(e.openBlock(),e.createBlock(H,{key:1,disabled:""},{default:e.withCtx(()=>[...o[22]||(o[22]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var E;return[e.createElementVNode("span",bt,[e.createTextVNode(e.toDisplayString(U.value?"All workspace":((E=K.value)==null?void 0:E.title)||"Select Workspace")+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(Me))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),t.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",xt,"/")):e.createCommentVNode("",!0),t.showSecondaryNavigation?(e.openBlock(),e.createBlock(pe,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(X,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(ve.value,E=>(e.openBlock(),e.createBlock(H,{key:E.label,class:e.normalizeClass({active:E.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:eo(E),class:"nav-link",onClick:e.withModifiers(te=>Ze(E),["prevent"])},e.toDisplayString(E.label),9,Bt)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",Mt,[e.createTextVNode(e.toDisplayString(Je.value)+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(Me))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Rt,[e.createVNode(pe,{onCommand:ne,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(X,null,{default:e.withCtx(()=>[e.createVNode(H,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:o[1]||(o[1]=e.withModifiers(E=>ne("profile"),["prevent"]))},"Profile Settings")]),_:1}),t.showWorkspaceSelector?(e.openBlock(),e.createBlock(H,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:o[2]||(o[2]=e.withModifiers(E=>ne("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(H,{onClick:fo,class:"version-item"},{default:e.withCtx(()=>[e.createElementVNode("div",Ot,[o[23]||(o[23]=e.createElementVNode("span",{class:"version-label"},"Version:",-1)),e.createElementVNode("span",Ht,e.toDisplayString(O.value),1),e.createVNode(l,{size:"small",type:"text",onClick:e.withModifiers(Se,["stop"]),class:"refresh-button",loading:T.value},{default:e.withCtx(()=>[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(fe))]),_:1})]),_:1},8,["loading"])])]),_:1}),e.createVNode(H,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:o[3]||(o[3]=e.withModifiers(E=>ne("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",$t,[e.createElementVNode("div",Tt,[e.createElementVNode("span",Pt,e.toDisplayString(z.value.name),1)]),e.createElementVNode("div",Wt,[z.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:z.value.avatar_url,alt:z.value.name},null,8,Dt)):(e.openBlock(),e.createElementBlock("span",Ut,e.toDisplayString(z.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",Ft,[e.createElementVNode("div",zt,[e.createElementVNode("div",jt,[e.createElementVNode("a",Gt,[t.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Kt)):(e.openBlock(),e.createElementBlock("div",qt,[...o[24]||(o[24]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),o[26]||(o[26]=e.createElementVNode("div",{class:"header-center"},[e.createElementVNode("span",{class:"welcome-text"},"Welcome to AI Workspace")],-1)),e.createElementVNode("div",Yt,[e.createVNode(l,{type:"primary",size:"large",class:"login-button",onClick:o[4]||(o[4]=E=>b.value=!0)},{default:e.withCtx(()=>[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(ge))]),_:1}),o[25]||(o[25]=e.createTextVNode(" Login / Signup ",-1))]),_:1})])])),G.value&&t.showWorkspaceSelector?(e.openBlock(),e.createBlock(ho,{key:5,modelValue:f.value,"onUpdate:modelValue":o[6]||(o[6]=E=>f.value=E),title:"Switch Workspace",width:"500px",onClose:o[7]||(o[7]=E=>f.value=!1)},{footer:e.withCtx(()=>[e.createVNode(l,{onClick:o[5]||(o[5]=E=>f.value=!1)},{default:e.withCtx(()=>[...o[27]||(o[27]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(l,{type:"primary",onClick:oo},{default:e.withCtx(()=>[...o[28]||(o[28]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",Jt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,E=>{var te,xe;return e.openBlock(),e.createElementBlock("div",{key:E.id,class:e.normalizeClass(["workspace-item",{active:E.id===((te=K.value)==null?void 0:te.id)}]),onClick:ps=>ye(E)},[e.createElementVNode("div",Qt,e.toDisplayString(E.children&&E.children.length?"📁":"📄"),1),e.createElementVNode("div",Zt,[e.createElementVNode("h3",null,e.toDisplayString(E.title),1),e.createElementVNode("p",null,e.toDisplayString(E.description),1),e.createElementVNode("span",es,e.toDisplayString(E.hasAccess?"Active":"Inactive"),1)]),E.id===((xe=K.value)==null?void 0:xe.id)?(e.openBlock(),e.createElementBlock("div",os,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Eo))]),_:1})])):e.createCommentVNode("",!0)],10,Xt)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0),e.createVNode(ze,{modelValue:b.value,"onUpdate:modelValue":o[8]||(o[8]=E=>b.value=E),onLoginSuccess:so},null,8,["modelValue"]),e.createVNode(je,{modelValue:g.value,"onUpdate:modelValue":o[9]||(o[9]=E=>g.value=E),"session-loss-event":e.unref(P),"can-retry-session":e.unref(w)||!1,onRetry:ao,onLogin:ro,onRefresh:no},null,8,["modelValue","session-loss-event","can-retry-session"])]),Y.value?(e.openBlock(),e.createBlock(wo,{key:0,title:"New Version Available!",type:"warning",closable:!0,onClose:Le,"show-icon":"",class:"update-alert"},{default:e.withCtx(()=>[e.createElementVNode("div",ts,[o[31]||(o[31]=e.createElementVNode("p",null,"A new version of the application is available. Please reload to get the latest updates and features.",-1)),e.createElementVNode("div",ss,[e.createVNode(l,{type:"primary",size:"small",onClick:mo},{default:e.withCtx(()=>[...o[29]||(o[29]=[e.createTextVNode(" Reload Now ",-1)])]),_:1}),e.createVNode(l,{size:"small",onClick:Le},{default:e.withCtx(()=>[...o[30]||(o[30]=[e.createTextVNode(" Dismiss ",-1)])]),_:1})])])]),_:1})):e.createCommentVNode("",!0)],64)}}});const Ge=le(ns,[["__scopeId","data-v-0456ef41"]]),is={class:"auth-callback"},ls=e.defineComponent({__name:"AuthCallback",setup(r){e.onMounted(async()=>{console.log("[AuthCallback] Component mounted, starting callback processing..."),console.log("[AuthCallback] Current URL:",window.location.href),console.log("[AuthCallback] Current hash:",window.location.hash);try{await new Promise(m=>setTimeout(m,500));const{data:a,error:i}=await $.supabase.auth.getSession();if(i){console.error("Error processing callback:",i),s();return}if(a!=null&&a.session){const m=a.session.user;console.log("OAuth login successful:",m.email),a.session.access_token&&y.setSessionCookie(y.ACCESS_COOKIE,a.session.access_token),a.session.refresh_token&&y.setSessionCookie(y.REFRESH_COOKIE,a.session.refresh_token),y.syncCookiesToLocalStorage();const v=y.getPostLoginBase();console.log("[callback] Post-login redirect URL:",v),console.log("[callback] Session storage redirect:",sessionStorage.getItem("post-login-redirect")),console.log("[callback] Local storage redirect:",localStorage.getItem("post-login-redirect"));const L=v||"/";if(console.log("[callback] Final redirect URL:",L),L.startsWith("/")){const R=window.location.origin,P=`${R}${L}`;console.log("[callback] redirecting to:",P,{hostname:window.location.hostname,origin:R}),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=P},100)}else console.log("[callback] redirecting to absolute URL:",L),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=L},100)}else s()}catch(a){console.error("Error processing callback:",a),s()}});const s=()=>{const i=window.location.href.replace("/auth/callback","");window.location.href=i};return(a,i)=>(e.openBlock(),e.createElementBlock("div",is,[...i[0]||(i[0]=[e.createElementVNode("div",{class:"callback-container"},[e.createElementVNode("div",{class:"loading-spinner"},[e.createElementVNode("div",{class:"spinner"})]),e.createElementVNode("h2",null,"Processing login..."),e.createElementVNode("p",null,"Please wait while we complete your authentication.")],-1)])]))}});const cs=le(ls,[["__scopeId","data-v-acdf6325"]]),oe=class oe{constructor(){se(this,"validationCache",new Map);se(this,"CACHE_DURATION",we().validationCacheDuration)}getCookieValue(s){var m;if(typeof document>"u")return null;const i=`; ${document.cookie}`.split(`; ${s}=`);return i.length===2&&((m=i.pop())==null?void 0:m.split(";").shift())||null}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}async validateSession(s=!1){var i,m;const a="session_validation";if(!s){const v=this.validationCache.get(a);if(v&&Date.now()-v.timestamp<this.CACHE_DURATION)return console.log("[SessionValidator] Using cached validation result"),v.result}console.log("[SessionValidator] Validating session...");try{const v=this.getCookieValue("sb-access-token"),L=this.getCookieValue("sb-refresh-token");if(!v||!L){const p={isValid:!1,needsLogin:!0,error:"No authentication tokens found",canRetry:!1};return this.cacheResult(a,p),p}const R=await $.getSupabase();let P=null,h=null;for(let p=1;p<=2;p++)try{const u=await R.auth.getSession();P=u.data.session,h=u.error;break}catch(u){if(console.warn(`[SessionValidator] Network error on attempt ${p}:`,u),p===2){const V={isValid:!1,needsLogin:!1,error:"Network error during validation",canRetry:!0};return this.cacheResult(a,V),V}await new Promise(V=>setTimeout(V,1e3))}if(h){console.warn("[SessionValidator] Error getting session:",h);const u={isValid:!1,needsLogin:((i=h.message)==null?void 0:i.includes("Invalid JWT"))||((m=h.message)==null?void 0:m.includes("JWT expired")),error:`Session error: ${h.message}`,canRetry:!0};return this.cacheResult(a,u),u}if(!P||!P.user){const p={isValid:!1,needsLogin:!0,error:"No valid session found",canRetry:!0};return this.cacheResult(a,p),p}const w=new Date,d=new Date(P.expires_at*1e3),c=5*60*1e3;if(w>=new Date(d.getTime()-c)){const p={isValid:!1,needsLogin:!0,error:"Session is close to expiry or expired",canRetry:!0};return this.cacheResult(a,p),p}const x={isValid:!0,needsLogin:!1,canRetry:!1};return this.cacheResult(a,x),x}catch(v){console.error("[SessionValidator] Error validating session:",v);const L={isValid:!1,needsLogin:!1,error:`Validation error: ${v}`,canRetry:!0};return this.cacheResult(a,L),L}}async restoreSession(){console.log("[SessionValidator] Attempting to restore session...");try{const s=this.getCookieValue("sb-access-token"),a=this.getCookieValue("sb-refresh-token");if(!s||!a)return{isValid:!1,needsLogin:!0,error:"No tokens available for restoration",canRetry:!1};const i=await $.getSupabase(),{data:m,error:v}=await i.auth.setSession({access_token:s,refresh_token:a});return v?(console.warn("[SessionValidator] Error restoring session:",v),{isValid:!1,needsLogin:!0,error:`Restoration error: ${v.message}`,canRetry:!0}):m.session&&m.session.user?(console.log("[SessionValidator] Session restored successfully"),this.clearCache(),{isValid:!0,needsLogin:!1,canRetry:!1}):{isValid:!1,needsLogin:!0,error:"Session restoration failed",canRetry:!0}}catch(s){return console.error("[SessionValidator] Error restoring session:",s),{isValid:!1,needsLogin:!0,error:`Restoration error: ${s}`,canRetry:!0}}}clearCache(){this.validationCache.clear(),console.log("[SessionValidator] Cache cleared")}cacheResult(s,a){this.validationCache.set(s,{result:a,timestamp:Date.now()})}getCachedResult(){const s=this.validationCache.get("session_validation");return s&&Date.now()-s.timestamp<this.CACHE_DURATION?s.result:null}};se(oe,"instance");let ie=oe;const ce=ie.getInstance(),Ke=(r=!1)=>ce.validateSession(r),qe=()=>ce.restoreSession(),Ye=()=>ce.clearCache();async function us(){console.log("[SessionValidator] Initializing session validation...");let r=await Ke();return!r.isValid&&r.canRetry&&(console.log("[SessionValidator] Attempting session restoration..."),r=await qe()),r}function ds(){if(typeof window>"u")return()=>{};const r=()=>{console.log("[SessionValidator] Network restored, clearing cache for revalidation"),Ye()},s=()=>{console.log("[SessionValidator] Network lost, session validation may fail")};return window.addEventListener("online",r),window.addEventListener("offline",s),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",s)}}exports.configureSupabase=$.configureSupabase;exports.getSupabase=$.getSupabase;exports.handleDomainChangeAuth=$.handleDomainChangeAuth;exports.initializeCrossSubdomainAuth=$.initializeCrossSubdomainAuth;exports.restoreCrossSubdomainSession=$.restoreCrossSubdomainSession;exports.restoreSessionWithRetry=$.restoreSessionWithRetry;exports.setupAuthStateListener=$.setupAuthStateListener;exports.setupImmediateCrossSubdomainAuth=$.setupImmediateCrossSubdomainAuth;Object.defineProperty(exports,"supabase",{enumerable:!0,get:()=>$.supabase});exports.ACCESS_COOKIE=y.ACCESS_COOKIE;exports.LS_ACCESS_KEY=y.LS_ACCESS_KEY;exports.LS_REFRESH_KEY=y.LS_REFRESH_KEY;exports.REFRESH_COOKIE=y.REFRESH_COOKIE;exports.buildOAuthRedirectUrl=y.buildOAuthRedirectUrl;exports.clearLocalStorageTokens=y.clearLocalStorageTokens;exports.clearSessionCookie=y.clearSessionCookie;exports.ensureCrossSubdomainCookies=y.ensureCrossSubdomainCookies;exports.getCookie=y.getCookie;exports.getPostLoginBase=y.getPostLoginBase;exports.setSessionCookie=y.setSessionCookie;exports.syncCookiesToLocalStorage=y.syncCookiesToLocalStorage;exports.setupUniversalCallback=yo.setupUniversalCallback;exports.AIWorkspaceHeader=Ge;exports.AuthCallback=cs;exports.LoginModal=ze;exports.PackageError=re;exports.SessionLossModal=je;exports.SessionValidator=ie;exports.clearSessionCache=Ye;exports.conservativeConfig=De;exports.createSessionConfig=Do;exports.default=Ge;exports.defaultSessionConfig=ee;exports.detectionScenarios=Ho;exports.developmentConfig=me;exports.fastDetectionConfig=We;exports.getConfigByPreset=Uo;exports.getSessionConfig=we;exports.handleBundlingError=$e;exports.initializeSessionValidation=us;exports.productionConfig=he;exports.restoreSession=qe;exports.safeExecute=xo;exports.safeExecuteAsync=Mo;exports.safeGetCookie=Ro;exports.safeGetLocalStorage=To;exports.safeImport=Bo;exports.safeSetCookie=$o;exports.safeSetLocalStorage=Po;exports.safeWindowOperation=Wo;exports.sessionConfigPresets=Ue;exports.sessionValidator=ce;exports.setupGlobalErrorHandler=Te;exports.setupNetworkAwareValidation=ds;exports.timingInfo=Oo;exports.useAuth=Fe;exports.useEnhancedAuth=Pe;exports.useSessionMonitor=Oe;exports.useWorkspaceStore=He;exports.validateSession=Ke;
