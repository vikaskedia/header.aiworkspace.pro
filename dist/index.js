"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),J=require("element-plus"),ge=require("@supabase/supabase-js"),we=require("pinia");/*! Element Plus Icons Vue v2.3.2 */var Se=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(t){return(s,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),ce=Se,ye=e.defineComponent({name:"Check",__name:"check",setup(t){return(s,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Ee=ye;const T="aiworkspace.pro";function H(t){return t==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(t)}function ue(t){return t===T||t.endsWith(`.${T}`)}function K(t){return document.cookie.split(";").map(l=>l.trim()).filter(l=>t.some(m=>l.startsWith(m+"=")))}function M(t,s,r=60*60*24*365){const l=location.hostname;if(H(l)){document.cookie=`${t}=${encodeURIComponent(s)}; Path=/; Max-Age=${r}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:l,name:t,valuePreview:s.slice(0,20)+"..."}),console.log("[auth][cookie][after]",K([t]));return}document.cookie=`${t}=${encodeURIComponent(s)}; Domain=.${T}; Path=/; Max-Age=${r}; SameSite=Lax; Secure`,document.cookie=`${t}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:l,apex:T,name:t,valuePreview:s.slice(0,20)+"..."}),console.log("[auth][cookie][after]",K([t]))}function $(t){const s=new RegExp("(?:^|; )"+t.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),r=document.cookie.match(s);return r?decodeURIComponent(r[1]):null}function j(t){const s=location.hostname;if(H(s)){document.cookie=`${t}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:s,name:t});return}document.cookie=`${t}=; Domain=.${T}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${t}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:s,apex:T,name:t}),console.log("[auth][cookie][after]",K([t]))}function ee(t){const s=location.hostname;if(H(s)){console.log("[auth][cookie][promote] skip (local host)",s);return}if(!ue(s)){console.log("[auth][cookie][promote] skip (not under apex)",{host:s,apex:T});return}console.log("[auth][cookie][promote] start",{host:s,apex:T,names:t}),t.forEach(r=>{const l=$(r);l?M(r,l,60*60*24*365):console.log("[auth][cookie][promote] missing",r)}),console.log("[auth][cookie][promote] done",K(t))}function Ce(){return`${window.location.origin}/callback`}function Ne(){try{const t=new URLSearchParams(location.search),s=["redirect","redirect_to","returnTo","next"].find(l=>t.get(l));let r=s?t.get(s):"";if(r||(r=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||""),r||(r={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/"),r.startsWith("http"))try{const l=new URL(r);return ue(l.hostname)||H(l.hostname)?r:"/"}catch{return"/"}return r.startsWith("/")||(r="/"+r),r}catch{return"/"}}const W="sb-access-token",U="sb-refresh-token",te="sb-access-token",ae="sb-refresh-token";function G(){try{const t=$(W),s=$(U);t&&localStorage.setItem(te,t),s&&localStorage.setItem(ae,s),console.log("[auth][cookie->ls] sync",{hasAccess:!!t,hasRefresh:!!s})}catch(t){console.log("[auth][cookie->ls] error",t)}}function de(){try{localStorage.removeItem(te),localStorage.removeItem(ae),console.log("[auth][cookie->ls] cleared localStorage")}catch(t){console.log("[auth][cookie->ls] clear error",t)}}async function be(){try{ee([W,U]);const t=$(W),s=$(U);if(t&&s){const{data:{session:r}}=await V.auth.getSession();if(!r){const{data:l,error:m}=await V.auth.setSession({access_token:t,refresh_token:s});m?console.log("[auth][restore] error",m):console.log("[auth][restore] done",!!l.session)}}else console.log("[auth][restore] no cookies present");G()}catch(t){console.log("[auth][restore] exception",t)}}function pe(){console.log("[auth][listener] Setting up auth state listener..."),V.auth.onAuthStateChange(async(t,s)=>{switch(console.log("[auth][listener] Auth state changed:",t,!!s),t){case"TOKEN_REFRESHED":console.log("[auth][listener] Token refreshed successfully"),s&&(M(W,s.access_token,60*60*24*365),M(U,s.refresh_token,60*60*24*365),G());break;case"SIGNED_IN":console.log("[auth][listener] User signed in"),s&&(M(W,s.access_token,60*60*24*365),M(U,s.refresh_token,60*60*24*365),G());break;case"SIGNED_OUT":console.log("[auth][listener] User signed out");break;case"USER_UPDATED":console.log("[auth][listener] User updated");break;default:console.log("[auth][listener] Unhandled auth event:",t)}})}async function Q(){try{const{data:{session:t}}=await V.auth.getSession();if(t&&t.user)return console.log("[auth][restore] Active session found"),{success:!0,session:t};const s=$(W),r=$(U);if(s&&r){console.log("[auth][restore] Attempting to restore session from cookies...");const{data:l,error:m}=await V.auth.setSession({access_token:s,refresh_token:r});if(m)return console.log("[auth][restore] Failed to restore session:",m.message),{success:!1,error:m};if(l.session)return console.log("[auth][restore] Session restored successfully"),M(W,l.session.access_token,60*60*24*365),M(U,l.session.refresh_token,60*60*24*365),G(),{success:!0,session:l.session}}return console.log("[auth][restore] No valid session or cookies found"),{success:!1,error:"No valid session or cookies"}}catch(t){return console.log("[auth][restore] Exception during session restoration:",t),{success:!1,error:t}}}if(typeof window<"u")try{ee([W,U])}catch(t){console.log("[auth][cookie][promote] error (pre-init)",t)}const se="https://oqdnbpmmgntqtigstaow.supabase.co",oe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",V=ge.createClient(se,oe,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});typeof window<"u"&&pe();console.log("Supabase Configuration:",{url:se,hasKey:!!oe,autoRefreshToken:!0,persistSession:!0});console.log("URL:",se.replace(/https:\/\/(.+)\.supabase\.co/,"https://*****.supabase.co"));console.log("Key configured:",!oe.includes("your-anon-key"));console.log("Environment mode:","production");function he(){const t=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),s=e.ref(null),r=e.computed(()=>t.value.isAuthenticated),l=e.computed(()=>t.value.user),m=e.computed(()=>t.value.isLoading),O=async()=>{var f,S,v,y,E,w,b,p,g,n,h,A,R,Y,q;try{const{data:{session:D}}=await V.auth.getSession();if(D&&D.user){const d=D.user,x={id:d.id,name:((f=d.user_metadata)==null?void 0:f.name)||((S=d.user_metadata)==null?void 0:S.user_name)||((v=d.user_metadata)==null?void 0:v.full_name)||((y=d.email)==null?void 0:y.split("@")[0])||"User",email:d.email,avatar_url:((E=d.user_metadata)==null?void 0:E.avatar_url)||null,user_metadata:d.user_metadata};return t.value={user:x,isAuthenticated:!0,isLoading:!1},s.value={user:x,access_token:D.access_token,refresh_token:D.refresh_token},{success:!0,session:s.value}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const I=await Q();if(I.success&&I.session){console.log("[auth][enhanced] Session restored successfully");const d=I.session.user,x={id:d.id,name:((w=d.user_metadata)==null?void 0:w.name)||((b=d.user_metadata)==null?void 0:b.user_name)||((p=d.user_metadata)==null?void 0:p.full_name)||((g=d.email)==null?void 0:g.split("@")[0])||"User",email:d.email,avatar_url:((n=d.user_metadata)==null?void 0:n.avatar_url)||null,user_metadata:d.user_metadata};return t.value={user:x,isAuthenticated:!0,isLoading:!1},s.value=I.session,{success:!0,session:s.value}}else console.log("[auth][enhanced] Failed to restore session:",I.error)}catch(D){console.error("Error getting Supabase session:",D);try{const I=await Q();if(I.success&&I.session){console.log("[auth][enhanced] Session restored after error");const d=I.session.user,x={id:d.id,name:((h=d.user_metadata)==null?void 0:h.name)||((A=d.user_metadata)==null?void 0:A.user_name)||((R=d.user_metadata)==null?void 0:R.full_name)||((Y=d.email)==null?void 0:Y.split("@")[0])||"User",email:d.email,avatar_url:((q=d.user_metadata)==null?void 0:q.avatar_url)||null,user_metadata:d.user_metadata};return t.value={user:x,isAuthenticated:!0,isLoading:!1},s.value=I.session,{success:!0,session:s.value}}}catch(I){console.error("Error restoring session:",I)}}return t.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null,{success:!1,error:"No valid session found"}},N=async()=>{try{await V.auth.signOut(),j(W),j(U),de(),t.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(f){console.error("Error during logout:",f),t.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null}},B=async(f,S)=>{var v,y,E,w,b;try{t.value.isLoading=!0;const{data:p,error:g}=await V.auth.signInWithPassword({email:f,password:S});if(g)throw g;if(p.session){const n=p.session.user,h={id:n.id,name:((v=n.user_metadata)==null?void 0:v.name)||((y=n.user_metadata)==null?void 0:y.user_name)||((E=n.user_metadata)==null?void 0:E.full_name)||((w=n.email)==null?void 0:w.split("@")[0])||"User",email:n.email,avatar_url:((b=n.user_metadata)==null?void 0:b.avatar_url)||null,user_metadata:n.user_metadata};return t.value={user:h,isAuthenticated:!0,isLoading:!1},s.value={user:h,access_token:p.session.access_token,refresh_token:p.session.refresh_token},{success:!0,session:s.value}}return{success:!1,error:"No session returned"}}catch(p){return console.error("Sign in error:",p),t.value.isLoading=!1,{success:!1,error:p}}},_=async(f,S,v)=>{var y,E,w,b,p;try{t.value.isLoading=!0;const{data:g,error:n}=await V.auth.signUp({email:f,password:S,options:{data:v}});if(n)throw n;if(g.session){const h=g.session.user,A={id:h.id,name:((y=h.user_metadata)==null?void 0:y.name)||((E=h.user_metadata)==null?void 0:E.user_name)||((w=h.user_metadata)==null?void 0:w.full_name)||((b=h.email)==null?void 0:b.split("@")[0])||"User",email:h.email,avatar_url:((p=h.user_metadata)==null?void 0:p.avatar_url)||null,user_metadata:h.user_metadata};return t.value={user:A,isAuthenticated:!0,isLoading:!1},s.value={user:A,access_token:g.session.access_token,refresh_token:g.session.refresh_token},{success:!0,session:s.value}}return{success:!1,error:"No session returned"}}catch(g){return console.error("Sign up error:",g),t.value.isLoading=!1,{success:!1,error:g}}},u=async()=>{await O()};return e.onMounted(()=>{u()}),{authState:t,currentSession:s,isAuthenticated:r,currentUser:l,isLoading:m,loadUserInfo:O,logout:N,signIn:B,signUp:_,checkAuth:u}}const ke=we.defineStore("workspace",()=>{const t=e.ref(null),s=e.ref([]),r=e.ref(null),l=u=>{t.value=u,localStorage.setItem("current_workspace",JSON.stringify(u))},m=u=>{s.value=u,localStorage.setItem("available_workspaces",JSON.stringify(u))};return{currentWorkspace:t,workspaces:s,user:r,setCurrentWorkspace:l,setWorkspaces:m,setUser:u=>{r.value=u,localStorage.setItem("user_info",JSON.stringify(u))},loadPersistedData:()=>{const u=localStorage.getItem("current_workspace");if(u)try{t.value=JSON.parse(u)}catch(v){console.error("Error loading persisted workspace:",v)}const f=localStorage.getItem("available_workspaces");if(f)try{s.value=JSON.parse(f)}catch(v){console.error("Error loading persisted workspaces:",v)}const S=localStorage.getItem("user_info");if(S)try{r.value=JSON.parse(S)}catch(v){console.error("Error loading persisted user:",v)}},clearData:()=>{t.value=null,s.value=[],r.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(u=!1)=>{try{const{data:{user:f}}=await V.auth.getUser();if(!f)return[];let S=V.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at,
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",f.id);u||(S=S.eq("archived",!1));const{data:v,error:y}=await S;if(y)throw y;const E=new Map;(v||[]).forEach(n=>{(n.workspace_access||[]).forEach(h=>{h.shared_with_user_id===f.id&&E.set(n.id,h)})});const w=[...new Set((v||[]).filter(n=>n.parent_workspace_id).map(n=>n.parent_workspace_id).filter(n=>!E.has(n)))];let b=[];if(w.length){let n=V.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",w);u||(n=n.eq("archived",!1));const{data:h,error:A}=await n;if(A)throw A;b=h||[]}const g=[...v||[],...b].map(n=>{var h,A,R;return{id:n.id,title:n.title,description:n.description||"No description",parent_workspace_id:n.parent_workspace_id,created_by:n.created_by,archived:n.archived,created_at:n.created_at,latest_activity:((A=(h=n.workspace_activities)==null?void 0:h[0])==null?void 0:A.updated_at)||n.created_at,hasAccess:E.has(n.id),accessType:((R=E.get(n.id))==null?void 0:R.access_type)||null}});return g.sort((n,h)=>new Date(h.latest_activity)-new Date(n.latest_activity)),m(g),g}catch(f){return console.error("loadWorkspaces error",f),[]}}}}),Ie={class:"aiworkspace-header"},Ae={key:0,class:"header-content header-loading"},Ve={key:1,class:"header-content header-fallback"},xe={key:2,class:"header-content"},Be={class:"header-left"},Le={class:"logo-section"},We={href:"/",class:"logo"},Ue=["src"],De={key:1,class:"text-logo"},Pe={key:0,class:"header-center"},Me={class:"main-navigation"},Te={class:"nav-item"},$e=["href","onClick"],Oe={class:"workspace-icon"},Re={key:1,class:"nav-divider"},Je={class:"nav-item"},ze=["href","onClick"],Ye={class:"header-right"},Fe={class:"user-profile"},Ge={class:"user-info"},qe={class:"user-name"},Ze={class:"user-avatar"},Ke=["src","alt"],He={key:1,class:"avatar-placeholder"},Xe={key:3,class:"unauth-message"},je={class:"workspace-list"},Qe=["onClick"],et={class:"workspace-icon"},tt={class:"workspace-details"},at={class:"workspace-members"},st={key:0,class:"current-indicator"},F=50,ot=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(t,{emit:s}){const r=t,l=s,{authState:m,logout:O}=he(),N=()=>{try{return ke()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},B=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},_=e.ref(N()),u=e.computed(()=>!!_.value),f=e.ref(0),S=()=>{if(!_.value&&f.value<F){if(B()){const o=N();if(o){_.value=o,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}f.value++,setTimeout(S,100)}else f.value>=F&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{_.value||S()}),e.watch(u,o=>{!o&&f.value<F&&S()});const v=e.ref(!1),y=e.ref([]),E=e.ref([]),w=e.ref({name:"",email:"",avatar_url:null,initials:""}),b=e.ref([]),p=e.ref([]),g=e.computed(()=>m.value.isAuthenticated),n=e.computed(()=>_.value?_.value.currentWorkspace:null),h=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),A=e.computed(()=>"Dashboard"),R=o=>{const a=new Map;o.forEach(C=>{a.set(C.id,{...C,children:[]})});const c=[];a.forEach(C=>{C.parent_workspace_id&&a.has(C.parent_workspace_id)?a.get(C.parent_workspace_id).children.push(C):c.push(C)});const k=C=>{C.sort((L,P)=>L.title.localeCompare(P.title)),C.forEach(L=>{L.children&&k(L.children)})};return k(c),c},Y=(o,a=0,c=[])=>(o.forEach(k=>{c.push({...k,level:a}),k.children&&k.children.length&&Y(k.children,a+1,c)}),c),q=async()=>{var o,a,c;try{const k=await((o=_.value)==null?void 0:o.loadWorkspaces());if(b.value=R(k||[]),p.value=Y(b.value),E.value=p.value,y.value=p.value,r.currentWorkspaceId){const C=p.value.find(L=>{var P;return L.id.toString()===((P=r.currentWorkspaceId)==null?void 0:P.toString())});C&&((a=_.value)==null||a.setCurrentWorkspace(C))}else!n.value&&p.value.length&&((c=_.value)==null||c.setCurrentWorkspace(p.value[0]))}catch(k){console.error("loadWorkspaces (header) error",k)}},D=o=>{if(console.log("Navigation command:",o),o==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}if(o.startsWith("workspace-")){const a=o.replace("workspace-",""),c=E.value.find(k=>k.id===parseInt(a));c&&Z(c);return}},I=o=>{const a=n.value;switch(o.key){case"dashboard":a?window.location.href=`/single-workspace/${a.id}/dashboard`:window.location.href="/";break;case"outlines":if(a){const c=`https://outline.aiworkspace.pro/single-workspace/${a.id}/outlines`;window.location.href=c}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(a){const c=`https://canvas.aiworkspace.pro/single-workspace/${a.id}/canvas`;window.location.href=c}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(a){const c=`https://drive.aiworkspace.pro/single-workspace/${a.id}/files`;window.location.href=c}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(a){const c=`https://tasks.aiworkspace.pro/single-workspace/${a.id}/tasks`;window.location.href=c}else window.location.href="https://tasks.aiworkspace.pro";break;case"ai-portfolios":if(a){const c=`https://spreadsheet.aiworkspace.pro/single-workspace/${a.id}/ai-portfolios`;window.location.href=c}else window.location.href="https://spreadsheet.aiworkspace.pro";break;default:if(a){const c=`https://app.aiworkspace.pro/single-workspace/${a.id}/${o.key}`;window.location.href=c}else{const c=`https://app.aiworkspace.pro/${o.key}`;window.location.href=c}break}},d=o=>{const a=n.value;switch(o.key){case"dashboard":return a?`/single-workspace/${a.id}/dashboard`:"/";case"ai-portfolios":return a?`https://spreadsheet.aiworkspace.pro/single-workspace/${a.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return a?`https://outline.aiworkspace.pro/single-workspace/${a.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return a?`https://canvas.aiworkspace.pro/single-workspace/${a.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return a?`https://drive.aiworkspace.pro/single-workspace/${a.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return a?`https://tasks.aiworkspace.pro/single-workspace/${a.id}/tasks`:"https://tasks.aiworkspace.pro";default:return a?`https://app.aiworkspace.pro/single-workspace/${a.id}/${o.key}`:`https://app.aiworkspace.pro/${o.key}`}},x=o=>{switch(o){case"profile":r.onProfileClick?r.onProfileClick():J.ElMessage.info("Profile settings coming soon");break;case"workspaces":v.value=!0;break;case"logout":me();break}},Z=o=>{var a;(a=_.value)==null||a.setCurrentWorkspace(o),v.value=!1,l("workspaceChange",o),J.ElMessage.success(`Switched to ${o.title}`)},fe=()=>{J.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:o})=>{var c;const a={id:Date.now(),title:o,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};y.value.push(a),(c=_.value)==null||c.setWorkspaces(y.value),Z(a),J.ElMessage.success(`Created workspace: ${o}`)}).catch(()=>{})},me=()=>{J.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var o;(o=_.value)==null||o.clearData(),await O(),l("logout"),J.ElMessage.success("Signed out successfully")}).catch(()=>{})},re=async()=>{var o,a;if(m.value.user){const c=m.value.user;w.value={name:c.name||((o=c.email)==null?void 0:o.split("@")[0])||"User",email:c.email||"",avatar_url:c.avatar_url||null,initials:(c.name||((a=c.email)==null?void 0:a.split("@")[0])||"U").split(" ").map(k=>k[0]).join("").toUpperCase().substring(0,2)},r.showWorkspaceSelector&&await q()}};e.watch(()=>m.value.user,o=>{var a;o?re():(w.value={name:"",email:"",avatar_url:null,initials:""},(a=_.value)==null||a.clearData())}),e.watch(()=>r.currentWorkspaceId,o=>{var a;if(o&&p.value.length){const c=p.value.find(k=>k.id.toString()===o.toString());c&&((a=_.value)==null||a.setCurrentWorkspace(c))}}),e.onMounted(async()=>{g.value&&await re()});const ve=()=>{f.value=0,S(),J.ElMessage.success("Manual Pinia retry initiated.")};return(o,a)=>{const c=e.resolveComponent("el-icon"),k=e.resolveComponent("el-dropdown-item"),C=e.resolveComponent("el-tag"),L=e.resolveComponent("el-dropdown-menu"),P=e.resolveComponent("el-dropdown"),ne=e.resolveComponent("el-button"),_e=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",Ie,[!u.value&&f.value<F?(e.openBlock(),e.createElementBlock("div",Ae,[...a[6]||(a[6]=[e.createStaticVNode('<div class="header-left" data-v-cdeebf53><div class="logo-section" data-v-cdeebf53><a href="/" class="logo" data-v-cdeebf53><div class="text-logo" data-v-cdeebf53><span class="logo-text" data-v-cdeebf53>AI Workspace</span></div></a></div></div><div class="header-center" data-v-cdeebf53><span class="loading-text" data-v-cdeebf53>Initializing...</span></div>',2)])])):!u.value&&f.value>=F?(e.openBlock(),e.createElementBlock("div",Ve,[a[8]||(a[8]=e.createStaticVNode('<div class="header-left" data-v-cdeebf53><div class="logo-section" data-v-cdeebf53><a href="/" class="logo" data-v-cdeebf53><div class="text-logo" data-v-cdeebf53><span class="logo-text" data-v-cdeebf53>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[a[7]||(a[7]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:ve,class:"retry-button"},"Retry Pinia")]),a[9]||(a[9]=e.createStaticVNode('<div class="header-right" data-v-cdeebf53><div class="user-profile" data-v-cdeebf53><div class="user-info" data-v-cdeebf53><span class="user-name" data-v-cdeebf53>User</span></div><div class="user-avatar" data-v-cdeebf53><span class="avatar-placeholder" data-v-cdeebf53>U</span></div></div></div>',1))])):g.value?(e.openBlock(),e.createElementBlock("div",xe,[e.createElementVNode("div",Be,[e.createElementVNode("div",Le,[e.createElementVNode("a",We,[o.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:o.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Ue)):(e.openBlock(),e.createElementBlock("div",De,[...a[10]||(a[10]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),o.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",Pe,[e.createElementVNode("nav",Me,[o.showWorkspaceSelector?(e.openBlock(),e.createBlock(P,{key:0,onCommand:D,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(L,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(k,{command:"all-workspace"},{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createElementVNode("a",{href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item"},[e.createElementVNode("span",{class:"workspace-icon"},"ðŸŒ"),e.createElementVNode("span",null,"All workspace")])],-1)])]),_:1}),p.value.length>0?(e.openBlock(),e.createBlock(k,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,i=>(e.openBlock(),e.createBlock(k,{key:i.id,command:`workspace-${i.id}`},{default:e.withCtx(()=>{var z;return[e.createElementVNode("a",{href:`/single-workspace/${i.id}/dashboard`,class:"nav-link",onClick:e.withModifiers(X=>Z(i),["prevent"])},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(i.level||0)*16+"px"})},[e.createElementVNode("span",Oe,e.toDisplayString(i.children&&i.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("span",null,e.toDisplayString(i.title),1),i.id===((z=n.value)==null?void 0:z.id)?(e.openBlock(),e.createBlock(C,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,$e)]}),_:2},1032,["command"]))),128)),p.value.length===0?(e.openBlock(),e.createBlock(k,{key:1,disabled:""},{default:e.withCtx(()=>[...a[13]||(a[13]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var i;return[e.createElementVNode("span",Te,[e.createTextVNode(e.toDisplayString(((i=n.value)==null?void 0:i.title)||"Select Workspace")+" ",1),e.createVNode(c,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(ce))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),o.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",Re,"/")):e.createCommentVNode("",!0),o.showSecondaryNavigation?(e.openBlock(),e.createBlock(P,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(L,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,i=>(e.openBlock(),e.createBlock(k,{key:i.label,class:e.normalizeClass({active:i.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:d(i),class:"nav-link",onClick:e.withModifiers(z=>I(i),["prevent"])},e.toDisplayString(i.label),9,ze)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",Je,[e.createTextVNode(e.toDisplayString(A.value)+" ",1),e.createVNode(c,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(ce))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ye,[e.createVNode(P,{onCommand:x,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(L,null,{default:e.withCtx(()=>[e.createVNode(k,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:a[0]||(a[0]=e.withModifiers(i=>x("profile"),["prevent"]))},"Profile Settings")]),_:1}),o.showWorkspaceSelector?(e.openBlock(),e.createBlock(k,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:a[1]||(a[1]=e.withModifiers(i=>x("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(k,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:a[2]||(a[2]=e.withModifiers(i=>x("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",Fe,[e.createElementVNode("div",Ge,[e.createElementVNode("span",qe,e.toDisplayString(w.value.name),1)]),e.createElementVNode("div",Ze,[w.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:w.value.avatar_url,alt:w.value.name},null,8,Ke)):(e.openBlock(),e.createElementBlock("span",He,e.toDisplayString(w.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",Xe,[...a[14]||(a[14]=[e.createElementVNode("div",{class:"unauth-inner"},[e.createElementVNode("strong",null,"Authentication required."),e.createTextVNode(" Please log in to access the workspace. ")],-1)])])),g.value&&o.showWorkspaceSelector?(e.openBlock(),e.createBlock(_e,{key:4,modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=i=>v.value=i),title:"Switch Workspace",width:"500px",onClose:a[5]||(a[5]=i=>v.value=!1)},{footer:e.withCtx(()=>[e.createVNode(ne,{onClick:a[3]||(a[3]=i=>v.value=!1)},{default:e.withCtx(()=>[...a[15]||(a[15]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(ne,{type:"primary",onClick:fe},{default:e.withCtx(()=>[...a[16]||(a[16]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",je,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,i=>{var z,X;return e.openBlock(),e.createElementBlock("div",{key:i.id,class:e.normalizeClass(["workspace-item",{active:i.id===((z=n.value)==null?void 0:z.id)}]),onClick:lt=>Z(i)},[e.createElementVNode("div",et,e.toDisplayString(i.children&&i.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("div",tt,[e.createElementVNode("h3",null,e.toDisplayString(i.title),1),e.createElementVNode("p",null,e.toDisplayString(i.description),1),e.createElementVNode("span",at,e.toDisplayString(i.hasAccess?"Active":"Inactive"),1)]),i.id===((X=n.value)==null?void 0:X.id)?(e.openBlock(),e.createElementBlock("div",st,[e.createVNode(c,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ee))]),_:1})])):e.createCommentVNode("",!0)],10,Qe)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0)])}}});const rt=(t,s)=>{const r=t.__vccOpts||t;for(const[l,m]of s)r[l]=m;return r},nt=rt(ot,[["__scopeId","data-v-cdeebf53"]]),le="aiworkspace_auth",ie="aiworkspace_user_id";function ct(){const t=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),s=N=>{var u;const _=`; ${document.cookie}`.split(`; ${N}=`);return _.length===2&&((u=_.pop())==null?void 0:u.split(";").shift())||null},r=(N,B,_=7)=>{const u=new Date;u.setTime(u.getTime()+_*24*60*60*1e3),document.cookie=`${N}=${B};expires=${u.toUTCString()};path=/;domain=.aiworkspace.pro`},l=N=>{document.cookie=`${N}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.aiworkspace.pro`},m=async()=>{try{const N=s(le),B=s(ie);N&&B?t.value={user:{id:B,email:""},isAuthenticated:!0,isLoading:!1}:t.value={user:null,isAuthenticated:!1,isLoading:!1}}catch(N){console.error("Auth check failed:",N),t.value={user:null,isAuthenticated:!1,isLoading:!1}}},O=()=>{l(le),l(ie),t.value={user:null,isAuthenticated:!1,isLoading:!1}};return e.onMounted(()=>{m()}),{authState:t,checkAuth:m,logout:O,getCookie:s,setCookie:r,clearCookie:l}}exports.ACCESS_COOKIE=W;exports.AIWorkspaceHeader=nt;exports.LS_ACCESS_KEY=te;exports.LS_REFRESH_KEY=ae;exports.REFRESH_COOKIE=U;exports.buildOAuthRedirectUrl=Ce;exports.clearLocalStorageTokens=de;exports.clearSessionCookie=j;exports.ensureCrossSubdomainCookies=ee;exports.getCookie=$;exports.getPostLoginBase=Ne;exports.restoreCrossSubdomainSession=be;exports.restoreSessionWithRetry=Q;exports.setSessionCookie=M;exports.setupAuthStateListener=pe;exports.supabase=V;exports.syncCookiesToLocalStorage=G;exports.useAuth=ct;exports.useEnhancedAuth=he;exports.useWorkspaceStore=ke;
