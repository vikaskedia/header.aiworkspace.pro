"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),J=require("element-plus"),Se=require("@supabase/supabase-js"),ye=require("pinia");/*! Element Plus Icons Vue v2.3.2 */var Ee=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(a){return(o,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),le=Ee,Ce=e.defineComponent({name:"Check",__name:"check",setup(a){return(o,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Ie=Ce;const $="aiworkspace.pro";function K(a){return a==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(a)}function de(a){return a===$||a.endsWith(`.${$}`)}function Z(a){return document.cookie.split(";").map(l=>l.trim()).filter(l=>a.some(f=>l.startsWith(f+"=")))}function R(a,o,r=60*60*24*365){const l=location.hostname;if(K(l)){document.cookie=`${a}=${encodeURIComponent(o)}; Path=/; Max-Age=${r}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:l,name:a,valuePreview:o.slice(0,20)+"..."}),console.log("[auth][cookie][after]",Z([a]));return}document.cookie=`${a}=${encodeURIComponent(o)}; Domain=.${$}; Path=/; Max-Age=${r}; SameSite=Lax; Secure`,document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:l,apex:$,name:a,valuePreview:o.slice(0,20)+"..."}),console.log("[auth][cookie][after]",Z([a]))}function M(a){const o=new RegExp("(?:^|; )"+a.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),r=document.cookie.match(o);return r?decodeURIComponent(r[1]):null}function X(a){const o=location.hostname;if(K(o)){document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:o,name:a});return}document.cookie=`${a}=; Domain=.${$}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:o,apex:$,name:a}),console.log("[auth][cookie][after]",Z([a]))}function Q(a){const o=location.hostname;if(K(o)){console.log("[auth][cookie][promote] skip (local host)",o);return}if(!de(o)){console.log("[auth][cookie][promote] skip (not under apex)",{host:o,apex:$});return}console.log("[auth][cookie][promote] start",{host:o,apex:$,names:a}),a.forEach(r=>{const l=M(r);l?R(r,l,60*60*24*365):console.log("[auth][cookie][promote] missing",r)}),console.log("[auth][cookie][promote] done",Z(a))}function Ne(){return`${window.location.origin}/callback`}function be(){try{const a=new URLSearchParams(location.search),o=["redirect","redirect_to","returnTo","next"].find(l=>a.get(l));let r=o?a.get(o):"";if(r||(r=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||""),r||(r={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/"),r.startsWith("http"))try{const l=new URL(r);return de(l.hostname)||K(l.hostname)?r:"/"}catch{return"/"}return r.startsWith("/")||(r="/"+r),r}catch{return"/"}}const W="sb-access-token",U="sb-refresh-token",ee="sb-access-token",te="sb-refresh-token";function F(){try{const a=M(W),o=M(U);a&&localStorage.setItem(ee,a),o&&localStorage.setItem(te,o),console.log("[auth][cookie->ls] sync",{hasAccess:!!a,hasRefresh:!!o})}catch(a){console.log("[auth][cookie->ls] error",a)}}function pe(){try{localStorage.removeItem(ee),localStorage.removeItem(te),console.log("[auth][cookie->ls] cleared localStorage")}catch(a){console.log("[auth][cookie->ls] clear error",a)}}async function Ae(){try{Q([W,U]);const a=M(W),o=M(U);if(a&&o){const{data:{session:r}}=await V.auth.getSession();if(!r){const{data:l,error:f}=await V.auth.setSession({access_token:a,refresh_token:o});f?console.log("[auth][restore] error",f):console.log("[auth][restore] done",!!l.session)}}else console.log("[auth][restore] no cookies present");F()}catch(a){console.log("[auth][restore] exception",a)}}function he(){console.log("[auth][listener] Setting up auth state listener..."),V.auth.onAuthStateChange(async(a,o)=>{switch(console.log("[auth][listener] Auth state changed:",a,!!o),a){case"TOKEN_REFRESHED":console.log("[auth][listener] Token refreshed successfully"),o&&(R(W,o.access_token,60*60*24*365),R(U,o.refresh_token,60*60*24*365),F());break;case"SIGNED_IN":console.log("[auth][listener] User signed in"),o&&(R(W,o.access_token,60*60*24*365),R(U,o.refresh_token,60*60*24*365),F());break;case"SIGNED_OUT":console.log("[auth][listener] User signed out");break;case"USER_UPDATED":console.log("[auth][listener] User updated");break;default:console.log("[auth][listener] Unhandled auth event:",a)}})}async function j(){try{const{data:{session:a}}=await V.auth.getSession();if(a&&a.user)return console.log("[auth][restore] Active session found"),{success:!0,session:a};const o=M(W),r=M(U);if(o&&r){console.log("[auth][restore] Attempting to restore session from cookies...");const{data:l,error:f}=await V.auth.setSession({access_token:o,refresh_token:r});if(f)return console.log("[auth][restore] Failed to restore session:",f.message),{success:!1,error:f};if(l.session)return console.log("[auth][restore] Session restored successfully"),R(W,l.session.access_token,60*60*24*365),R(U,l.session.refresh_token,60*60*24*365),F(),{success:!0,session:l.session}}return console.log("[auth][restore] No valid session or cookies found"),{success:!1,error:"No valid session or cookies"}}catch(a){return console.log("[auth][restore] Exception during session restoration:",a),{success:!1,error:a}}}if(typeof window<"u")try{Q([W,U])}catch(a){console.log("[auth][cookie][promote] error (pre-init)",a)}const ae="https://oqdnbpmmgntqtigstaow.supabase.co",oe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",V=Se.createClient(ae,oe,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});typeof window<"u"&&he();console.log("Supabase Configuration:",{url:ae,hasKey:!!oe,autoRefreshToken:!0,persistSession:!0});console.log("URL:",ae.replace(/https:\/\/(.+)\.supabase\.co/,"https://*****.supabase.co"));console.log("Key configured:",!oe.includes("your-anon-key"));console.log("Environment mode:","production");function ke(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),o=e.ref(null),r=e.computed(()=>a.value.isAuthenticated),l=e.computed(()=>a.value.user),f=e.computed(()=>a.value.isLoading),T=async()=>{var m,y,g,E,N,_,A,p,w,c,d,S,O,G,H;try{const{data:{session:L}}=await V.auth.getSession();if(L&&L.user){const h=L.user,D={id:h.id,name:((m=h.user_metadata)==null?void 0:m.name)||((y=h.user_metadata)==null?void 0:y.user_name)||((g=h.user_metadata)==null?void 0:g.full_name)||((E=h.email)==null?void 0:E.split("@")[0])||"User",email:h.email,avatar_url:((N=h.user_metadata)==null?void 0:N.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:D,isAuthenticated:!0,isLoading:!1},o.value={user:D,access_token:L.access_token,refresh_token:L.refresh_token},{success:!0,session:o.value}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const b=await j();if(b.success&&b.session){console.log("[auth][enhanced] Session restored successfully");const h=b.session.user,D={id:h.id,name:((_=h.user_metadata)==null?void 0:_.name)||((A=h.user_metadata)==null?void 0:A.user_name)||((p=h.user_metadata)==null?void 0:p.full_name)||((w=h.email)==null?void 0:w.split("@")[0])||"User",email:h.email,avatar_url:((c=h.user_metadata)==null?void 0:c.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:D,isAuthenticated:!0,isLoading:!1},o.value=b.session,{success:!0,session:o.value}}else console.log("[auth][enhanced] Failed to restore session:",b.error)}catch(L){console.error("Error getting Supabase session:",L);try{const b=await j();if(b.success&&b.session){console.log("[auth][enhanced] Session restored after error");const h=b.session.user,D={id:h.id,name:((d=h.user_metadata)==null?void 0:d.name)||((S=h.user_metadata)==null?void 0:S.user_name)||((O=h.user_metadata)==null?void 0:O.full_name)||((G=h.email)==null?void 0:G.split("@")[0])||"User",email:h.email,avatar_url:((H=h.user_metadata)==null?void 0:H.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:D,isAuthenticated:!0,isLoading:!1},o.value=b.session,{success:!0,session:o.value}}}catch(b){console.error("Error restoring session:",b)}}return a.value={user:null,isAuthenticated:!1,isLoading:!1},o.value=null,{success:!1,error:"No valid session found"}},I=async()=>{try{await V.auth.signOut(),X(W),X(U),pe(),a.value={user:null,isAuthenticated:!1,isLoading:!1},o.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(m){console.error("Error during logout:",m),a.value={user:null,isAuthenticated:!1,isLoading:!1},o.value=null}},x=async(m,y)=>{var g,E,N,_,A;try{a.value.isLoading=!0;const{data:p,error:w}=await V.auth.signInWithPassword({email:m,password:y});if(w)throw w;if(p.session){const c=p.session.user,d={id:c.id,name:((g=c.user_metadata)==null?void 0:g.name)||((E=c.user_metadata)==null?void 0:E.user_name)||((N=c.user_metadata)==null?void 0:N.full_name)||((_=c.email)==null?void 0:_.split("@")[0])||"User",email:c.email,avatar_url:((A=c.user_metadata)==null?void 0:A.avatar_url)||null,user_metadata:c.user_metadata};return a.value={user:d,isAuthenticated:!0,isLoading:!1},o.value={user:d,access_token:p.session.access_token,refresh_token:p.session.refresh_token},{success:!0,session:o.value}}return{success:!1,error:"No session returned"}}catch(p){return console.error("Sign in error:",p),a.value.isLoading=!1,{success:!1,error:p}}},v=async(m,y,g)=>{var E,N,_,A,p;try{a.value.isLoading=!0;const{data:w,error:c}=await V.auth.signUp({email:m,password:y,options:{data:g}});if(c)throw c;if(w.session){const d=w.session.user,S={id:d.id,name:((E=d.user_metadata)==null?void 0:E.name)||((N=d.user_metadata)==null?void 0:N.user_name)||((_=d.user_metadata)==null?void 0:_.full_name)||((A=d.email)==null?void 0:A.split("@")[0])||"User",email:d.email,avatar_url:((p=d.user_metadata)==null?void 0:p.avatar_url)||null,user_metadata:d.user_metadata};return a.value={user:S,isAuthenticated:!0,isLoading:!1},o.value={user:S,access_token:w.session.access_token,refresh_token:w.session.refresh_token},{success:!0,session:o.value}}return{success:!1,error:"No session returned"}}catch(w){return console.error("Sign up error:",w),a.value.isLoading=!1,{success:!1,error:w}}},u=async()=>{await T()};return e.onMounted(()=>{u()}),{authState:a,currentSession:o,isAuthenticated:r,currentUser:l,isLoading:f,loadUserInfo:T,logout:I,signIn:x,signUp:v,checkAuth:u}}const me=ye.defineStore("workspace",()=>{const a=e.ref(null),o=e.ref([]),r=e.ref(null),l=u=>{a.value=u,localStorage.setItem("current_workspace",JSON.stringify(u))},f=u=>{o.value=u,localStorage.setItem("available_workspaces",JSON.stringify(u))};return{currentWorkspace:a,workspaces:o,user:r,setCurrentWorkspace:l,setWorkspaces:f,setUser:u=>{r.value=u,localStorage.setItem("user_info",JSON.stringify(u))},loadPersistedData:()=>{const u=localStorage.getItem("current_workspace");if(u)try{a.value=JSON.parse(u)}catch(g){console.error("Error loading persisted workspace:",g)}const m=localStorage.getItem("available_workspaces");if(m)try{o.value=JSON.parse(m)}catch(g){console.error("Error loading persisted workspaces:",g)}const y=localStorage.getItem("user_info");if(y)try{r.value=JSON.parse(y)}catch(g){console.error("Error loading persisted user:",g)}},clearData:()=>{a.value=null,o.value=[],r.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(u=!1)=>{try{const{data:{user:m}}=await V.auth.getUser();if(!m)return[];let y=V.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at,
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",m.id);u||(y=y.eq("archived",!1));const{data:g,error:E}=await y;if(E)throw E;const N=new Map;(g||[]).forEach(c=>{(c.workspace_access||[]).forEach(d=>{d.shared_with_user_id===m.id&&N.set(c.id,d)})});const _=[...new Set((g||[]).filter(c=>c.parent_workspace_id).map(c=>c.parent_workspace_id).filter(c=>!N.has(c)))];let A=[];if(_.length){let c=V.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",_);u||(c=c.eq("archived",!1));const{data:d,error:S}=await c;if(S)throw S;A=d||[]}const w=[...g||[],...A].map(c=>{var d,S,O;return{id:c.id,title:c.title,description:c.description||"No description",parent_workspace_id:c.parent_workspace_id,created_by:c.created_by,archived:c.archived,created_at:c.created_at,latest_activity:((S=(d=c.workspace_activities)==null?void 0:d[0])==null?void 0:S.updated_at)||c.created_at,hasAccess:N.has(c.id),accessType:((O=N.get(c.id))==null?void 0:O.access_type)||null}});return w.sort((c,d)=>new Date(d.latest_activity)-new Date(c.latest_activity)),f(w),w}catch(m){return console.error("loadWorkspaces error",m),[]}}}}),Ve={class:"aiworkspace-header"},xe={key:0,class:"header-content header-loading"},Le={key:1,class:"header-content header-fallback"},Be={key:2,class:"header-content"},We={class:"header-left"},Ue={class:"logo-section"},De={href:"/",class:"logo"},Pe=["src"],Re={key:1,class:"text-logo"},$e={key:0,class:"header-center"},Me={class:"main-navigation"},Te={class:"nav-item"},Oe=["href"],Je={class:"workspace-icon"},ze={key:1,class:"nav-divider"},Ye={class:"nav-item"},Fe=["href","onClick"],Ge={class:"header-right"},He={class:"user-profile"},qe={class:"user-info"},Ze={class:"user-name"},Ke={class:"user-avatar"},Xe=["src","alt"],je={key:1,class:"avatar-placeholder"},Qe={key:3,class:"unauth-message"},et={class:"workspace-list"},tt=["onClick"],at={class:"workspace-icon"},ot={class:"workspace-details"},st={class:"workspace-members"},rt={key:0,class:"current-indicator"},Y=50,nt=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(a,{emit:o}){const r=a,l=o,{authState:f,logout:T}=ke(),I=()=>{try{return me()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},x=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},v=e.ref(I()),u=e.computed(()=>!!v.value),m=e.ref(0),y=()=>{if(!v.value&&m.value<Y){if(x()){const s=I();if(s){v.value=s,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}m.value++,setTimeout(y,100)}else m.value>=Y&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{v.value||y()});const g=e.ref(!1),E=e.ref([]),N=e.ref([]),_=e.ref({name:"",email:"",avatar_url:null,initials:""}),A=e.ref([]),p=e.ref([]);e.watch(p,async s=>{s.length>0&&u.value&&d.value&&await c()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{u.value&&d.value&&await c()},{immediate:!1}),e.watch(u,s=>{!s&&m.value<Y&&y()});const w=()=>{try{const s=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(s)return s[1];const n=new URLSearchParams(window.location.search).get("workspace_id");if(n)return n;const k=window.location.hash.match(/workspace_id=(\d+)/);return k?k[1]:null}catch(s){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",s),null}},c=async()=>{if(!v.value||!u.value)return;const s=w();if(s)try{p.value.length===0&&await b();const t=p.value.find(n=>n.id.toString()===s);t?(v.value.setCurrentWorkspace(t),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${t.title} (ID: ${t.id})`),l("workspaceChange",t)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${s} not found in available workspaces`)}catch(t){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",t)}},d=e.computed(()=>f.value.isAuthenticated),S=e.computed(()=>v.value?v.value.currentWorkspace:null),O=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),G=e.computed(()=>"Dashboard"),H=s=>{const t=new Map;s.forEach(C=>{t.set(C.id,{...C,children:[]})});const n=[];t.forEach(C=>{C.parent_workspace_id&&t.has(C.parent_workspace_id)?t.get(C.parent_workspace_id).children.push(C):n.push(C)});const k=C=>{C.sort((B,P)=>B.title.localeCompare(P.title)),C.forEach(B=>{B.children&&k(B.children)})};return k(n),n},L=(s,t=0,n=[])=>(s.forEach(k=>{n.push({...k,level:t}),k.children&&k.children.length&&L(k.children,t+1,n)}),n),b=async()=>{var s,t,n;try{const k=await((s=v.value)==null?void 0:s.loadWorkspaces());if(A.value=H(k||[]),p.value=L(A.value),N.value=p.value,E.value=p.value,r.currentWorkspaceId){const C=p.value.find(B=>{var P;return B.id.toString()===((P=r.currentWorkspaceId)==null?void 0:P.toString())});C&&((t=v.value)==null||t.setCurrentWorkspace(C))}else!S.value&&p.value.length&&((n=v.value)==null||n.setCurrentWorkspace(p.value[0]))}catch(k){console.error("loadWorkspaces (header) error",k)}},h=s=>{if(console.log("Navigation command:",s),s==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const t=parseInt(s.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t}/dashboard`;return}},D=s=>{const t=S.value;switch(s.key){case"dashboard":t?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(t){const n=`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`;window.location.href=n}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(t){const n=`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`;window.location.href=n}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(t){const n=`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`;window.location.href=n}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(t){const n=`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`;window.location.href=n}else window.location.href="https://tasks.aiworkspace.pro";break;case"ai-portfolios":if(t){const n=`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`;window.location.href=n}else window.location.href="https://spreadsheet.aiworkspace.pro";break;default:if(t){const n=`https://app.aiworkspace.pro/single-workspace/${t.id}/${s.key}`;window.location.href=n}else{const n=`https://app.aiworkspace.pro/${s.key}`;window.location.href=n}break}},fe=s=>{const t=S.value;switch(s.key){case"dashboard":return t?`/single-workspace/${t.id}/dashboard`:"/";case"ai-portfolios":return t?`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return t?`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return t?`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return t?`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return t?`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`:"https://tasks.aiworkspace.pro";default:return t?`https://app.aiworkspace.pro/single-workspace/${t.id}/${s.key}`:`https://app.aiworkspace.pro/${s.key}`}},q=s=>{switch(s){case"profile":r.onProfileClick?r.onProfileClick():J.ElMessage.info("Profile settings coming soon");break;case"workspaces":g.value=!0;break;case"logout":ge();break}},se=s=>{var t;(t=v.value)==null||t.setCurrentWorkspace(s),g.value=!1,l("workspaceChange",s),J.ElMessage.success(`Switched to ${s.title}`)},ve=()=>{J.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:s})=>{var n;const t={id:Date.now(),title:s,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};E.value.push(t),(n=v.value)==null||n.setWorkspaces(E.value),se(t),J.ElMessage.success(`Created workspace: ${s}`)}).catch(()=>{})},ge=()=>{J.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var s;(s=v.value)==null||s.clearData(),await T(),l("logout"),J.ElMessage.success("Signed out successfully")}).catch(()=>{})},re=async()=>{var s,t;if(f.value.user){const n=f.value.user;_.value={name:n.name||((s=n.email)==null?void 0:s.split("@")[0])||"User",email:n.email||"",avatar_url:n.avatar_url||null,initials:(n.name||((t=n.email)==null?void 0:t.split("@")[0])||"U").split(" ").map(k=>k[0]).join("").toUpperCase().substring(0,2)},r.showWorkspaceSelector&&await b()}};e.watch(()=>f.value.user,s=>{var t;s?re():(_.value={name:"",email:"",avatar_url:null,initials:""},(t=v.value)==null||t.clearData())}),e.watch(()=>r.currentWorkspaceId,s=>{var t;if(s&&p.value.length){const n=p.value.find(k=>k.id.toString()===s.toString());n&&((t=v.value)==null||t.setCurrentWorkspace(n))}}),e.onMounted(async()=>{d.value&&(await re(),await c())});const _e=()=>{m.value=0,y(),J.ElMessage.success("Manual Pinia retry initiated.")};return(s,t)=>{const n=e.resolveComponent("el-icon"),k=e.resolveComponent("el-dropdown-item"),C=e.resolveComponent("el-tag"),B=e.resolveComponent("el-dropdown-menu"),P=e.resolveComponent("el-dropdown"),ne=e.resolveComponent("el-button"),we=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",Ve,[!u.value&&m.value<Y?(e.openBlock(),e.createElementBlock("div",xe,[...t[6]||(t[6]=[e.createStaticVNode('<div class="header-left" data-v-54ecdd64><div class="logo-section" data-v-54ecdd64><a href="/" class="logo" data-v-54ecdd64><div class="text-logo" data-v-54ecdd64><span class="logo-text" data-v-54ecdd64>AI Workspace</span></div></a></div></div><div class="header-center" data-v-54ecdd64><span class="loading-text" data-v-54ecdd64>Initializing...</span></div>',2)])])):!u.value&&m.value>=Y?(e.openBlock(),e.createElementBlock("div",Le,[t[8]||(t[8]=e.createStaticVNode('<div class="header-left" data-v-54ecdd64><div class="logo-section" data-v-54ecdd64><a href="/" class="logo" data-v-54ecdd64><div class="text-logo" data-v-54ecdd64><span class="logo-text" data-v-54ecdd64>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[t[7]||(t[7]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:_e,class:"retry-button"},"Retry Pinia")]),t[9]||(t[9]=e.createStaticVNode('<div class="header-right" data-v-54ecdd64><div class="user-profile" data-v-54ecdd64><div class="user-info" data-v-54ecdd64><span class="user-name" data-v-54ecdd64>User</span></div><div class="user-avatar" data-v-54ecdd64><span class="avatar-placeholder" data-v-54ecdd64>U</span></div></div></div>',1))])):d.value?(e.openBlock(),e.createElementBlock("div",Be,[e.createElementVNode("div",We,[e.createElementVNode("div",Ue,[e.createElementVNode("a",De,[s.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:s.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Pe)):(e.openBlock(),e.createElementBlock("div",Re,[...t[10]||(t[10]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),s.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",$e,[e.createElementVNode("nav",Me,[s.showWorkspaceSelector?(e.openBlock(),e.createBlock(P,{key:0,onCommand:h,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(B,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(k,{command:"all-workspace"},{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createElementVNode("a",{href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item"},[e.createElementVNode("span",{class:"workspace-icon"},"ðŸŒ"),e.createElementVNode("span",null,"All workspace")])],-1)])]),_:1}),p.value.length>0?(e.openBlock(),e.createBlock(k,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,i=>(e.openBlock(),e.createBlock(k,{key:i.id,command:`workspace-${i.id}`},{default:e.withCtx(()=>{var z;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${i.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(i.level||0)*16+"px"})},[e.createElementVNode("span",Je,e.toDisplayString(i.children&&i.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("span",null,e.toDisplayString(i.title),1),i.id===((z=S.value)==null?void 0:z.id)?(e.openBlock(),e.createBlock(C,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,Oe)]}),_:2},1032,["command"]))),128)),p.value.length===0?(e.openBlock(),e.createBlock(k,{key:1,disabled:""},{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var i;return[e.createElementVNode("span",Te,[e.createTextVNode(e.toDisplayString(((i=S.value)==null?void 0:i.title)||"Select Workspace")+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(le))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),s.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",ze,"/")):e.createCommentVNode("",!0),s.showSecondaryNavigation?(e.openBlock(),e.createBlock(P,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(B,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.value,i=>(e.openBlock(),e.createBlock(k,{key:i.label,class:e.normalizeClass({active:i.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:fe(i),class:"nav-link",onClick:e.withModifiers(z=>D(i),["prevent"])},e.toDisplayString(i.label),9,Fe)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",Ye,[e.createTextVNode(e.toDisplayString(G.value)+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(le))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ge,[e.createVNode(P,{onCommand:q,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(B,null,{default:e.withCtx(()=>[e.createVNode(k,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:t[0]||(t[0]=e.withModifiers(i=>q("profile"),["prevent"]))},"Profile Settings")]),_:1}),s.showWorkspaceSelector?(e.openBlock(),e.createBlock(k,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:t[1]||(t[1]=e.withModifiers(i=>q("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(k,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:t[2]||(t[2]=e.withModifiers(i=>q("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",He,[e.createElementVNode("div",qe,[e.createElementVNode("span",Ze,e.toDisplayString(_.value.name),1)]),e.createElementVNode("div",Ke,[_.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:_.value.avatar_url,alt:_.value.name},null,8,Xe)):(e.openBlock(),e.createElementBlock("span",je,e.toDisplayString(_.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",Qe,[...t[14]||(t[14]=[e.createElementVNode("div",{class:"unauth-inner"},[e.createElementVNode("strong",null,"Authentication required."),e.createTextVNode(" Please log in to access the workspace. ")],-1)])])),d.value&&s.showWorkspaceSelector?(e.openBlock(),e.createBlock(we,{key:4,modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=i=>g.value=i),title:"Switch Workspace",width:"500px",onClose:t[5]||(t[5]=i=>g.value=!1)},{footer:e.withCtx(()=>[e.createVNode(ne,{onClick:t[3]||(t[3]=i=>g.value=!1)},{default:e.withCtx(()=>[...t[15]||(t[15]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(ne,{type:"primary",onClick:ve},{default:e.withCtx(()=>[...t[16]||(t[16]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",et,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.value,i=>{var z,ce;return e.openBlock(),e.createElementBlock("div",{key:i.id,class:e.normalizeClass(["workspace-item",{active:i.id===((z=S.value)==null?void 0:z.id)}]),onClick:ut=>se(i)},[e.createElementVNode("div",at,e.toDisplayString(i.children&&i.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("div",ot,[e.createElementVNode("h3",null,e.toDisplayString(i.title),1),e.createElementVNode("p",null,e.toDisplayString(i.description),1),e.createElementVNode("span",st,e.toDisplayString(i.hasAccess?"Active":"Inactive"),1)]),i.id===((ce=S.value)==null?void 0:ce.id)?(e.openBlock(),e.createElementBlock("div",rt,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ie))]),_:1})])):e.createCommentVNode("",!0)],10,tt)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0)])}}});const ct=(a,o)=>{const r=a.__vccOpts||a;for(const[l,f]of o)r[l]=f;return r},lt=ct(nt,[["__scopeId","data-v-54ecdd64"]]),ie="aiworkspace_auth",ue="aiworkspace_user_id";function it(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),o=I=>{var u;const v=`; ${document.cookie}`.split(`; ${I}=`);return v.length===2&&((u=v.pop())==null?void 0:u.split(";").shift())||null},r=(I,x,v=7)=>{const u=new Date;u.setTime(u.getTime()+v*24*60*60*1e3),document.cookie=`${I}=${x};expires=${u.toUTCString()};path=/;domain=.aiworkspace.pro`},l=I=>{document.cookie=`${I}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.aiworkspace.pro`},f=async()=>{try{const I=o(ie),x=o(ue);I&&x?a.value={user:{id:x,email:""},isAuthenticated:!0,isLoading:!1}:a.value={user:null,isAuthenticated:!1,isLoading:!1}}catch(I){console.error("Auth check failed:",I),a.value={user:null,isAuthenticated:!1,isLoading:!1}}},T=()=>{l(ie),l(ue),a.value={user:null,isAuthenticated:!1,isLoading:!1}};return e.onMounted(()=>{f()}),{authState:a,checkAuth:f,logout:T,getCookie:o,setCookie:r,clearCookie:l}}exports.ACCESS_COOKIE=W;exports.AIWorkspaceHeader=lt;exports.LS_ACCESS_KEY=ee;exports.LS_REFRESH_KEY=te;exports.REFRESH_COOKIE=U;exports.buildOAuthRedirectUrl=Ne;exports.clearLocalStorageTokens=pe;exports.clearSessionCookie=X;exports.ensureCrossSubdomainCookies=Q;exports.getCookie=M;exports.getPostLoginBase=be;exports.restoreCrossSubdomainSession=Ae;exports.restoreSessionWithRetry=j;exports.setSessionCookie=R;exports.setupAuthStateListener=he;exports.supabase=V;exports.syncCookiesToLocalStorage=F;exports.useAuth=it;exports.useEnhancedAuth=ke;exports.useWorkspaceStore=me;
