"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),U=require("element-plus"),Le=require("@supabase/supabase-js"),Be=require("pinia");/*! Element Plus Icons Vue v2.3.2 */var Ue=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(o){return(a,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),pe=Ue,We=e.defineComponent({name:"Check",__name:"check",setup(o){return(a,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Pe=We,Me=e.defineComponent({name:"Lock",__name:"lock",setup(o){return(a,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96"}),e.createElementVNode("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32m192-160v-64a192 192 0 1 0-384 0v64zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64"})]))}}),he=Me,$e=e.defineComponent({name:"Message",__name:"message",setup(o){return(a,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M128 224v512a64 64 0 0 0 64 64h640a64 64 0 0 0 64-64V224zm0-64h768a64 64 0 0 1 64 64v512a128 128 0 0 1-128 128H192A128 128 0 0 1 64 736V224a64 64 0 0 1 64-64"}),e.createElementVNode("path",{fill:"currentColor",d:"M904 224 656.512 506.88a192 192 0 0 1-289.024 0L120 224zm-698.944 0 210.56 240.704a128 128 0 0 0 192.704 0L818.944 224z"})]))}}),Re=$e,De=e.defineComponent({name:"User",__name:"user",setup(o){return(a,r)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"})]))}}),Oe=De;const F="aiworkspace.pro";function j(o){return o==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(o)}function me(o){return o===F||o.endsWith(`.${F}`)}function Z(o){return document.cookie.split(";").map(p=>p.trim()).filter(p=>o.some(v=>p.startsWith(v+"=")))}function R(o,a,r=60*60*24*365){const p=location.hostname;if(j(p)){document.cookie=`${o}=${encodeURIComponent(a)}; Path=/; Max-Age=${r}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:p,name:o,valuePreview:a.slice(0,20)+"..."}),console.log("[auth][cookie][after]",Z([o]));return}document.cookie=`${o}=${encodeURIComponent(a)}; Domain=.${F}; Path=/; Max-Age=${r}; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:p,apex:F,name:o,valuePreview:a.slice(0,20)+"..."}),console.log("[auth][cookie][after]",Z([o]))}function H(o){const a=new RegExp("(?:^|; )"+o.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),r=document.cookie.match(a);return r?decodeURIComponent(r[1]):null}function G(o){const a=location.hostname;if(j(a)){document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:a,name:o});return}document.cookie=`${o}=; Domain=.${F}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${o}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:a,apex:F,name:o}),console.log("[auth][cookie][after]",Z([o]))}function oe(o){const a=location.hostname;if(j(a)){console.log("[auth][cookie][promote] skip (local host)",a);return}if(!me(a)){console.log("[auth][cookie][promote] skip (not under apex)",{host:a,apex:F});return}console.log("[auth][cookie][promote] start",{host:a,apex:F,names:o}),o.forEach(r=>{const p=H(r);p?R(r,p,60*60*24*365):console.log("[auth][cookie][promote] missing",r)}),console.log("[auth][cookie][promote] done",Z(o))}function Te(){return`${window.location.origin}/callback`}function fe(){try{const o=new URLSearchParams(location.search),a=["redirect","redirect_to","returnTo","next"].find(p=>o.get(p));let r=a?o.get(a):"";if(console.log("[getPostLoginBase] URL params:",Object.fromEntries(o)),console.log("[getPostLoginBase] Found param key:",a),console.log("[getPostLoginBase] Candidate from params:",r),r||(r=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||"",console.log("[getPostLoginBase] Candidate from storage:",r)),r||(r={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/",console.log("[getPostLoginBase] Using default:",r)),r.startsWith("http"))try{const p=new URL(r);return me(p.hostname)||j(p.hostname)?(console.log("[getPostLoginBase] Returning absolute URL:",r),r):(console.log("[getPostLoginBase] Invalid hostname, returning /"),"/")}catch{return console.log("[getPostLoginBase] Invalid URL, returning /"),"/"}return r.startsWith("/")||(r="/"+r),console.log("[getPostLoginBase] Final candidate:",r),r}catch(o){return console.log("[getPostLoginBase] Error:",o),"/"}}const M="sb-access-token",$="sb-refresh-token",ae="sb-access-token",se="sb-refresh-token";function J(){try{const o=H(M),a=H($);o&&localStorage.setItem(ae,o),a&&localStorage.setItem(se,a),console.log("[auth][cookie->ls] sync",{hasAccess:!!o,hasRefresh:!!a})}catch(o){console.log("[auth][cookie->ls] error",o)}}function K(){try{localStorage.removeItem(ae),localStorage.removeItem(se),console.log("[auth][cookie->ls] cleared localStorage")}catch(o){console.log("[auth][cookie->ls] clear error",o)}}async function ze(){try{oe([M,$]);const o=H(M),a=H($);if(o&&a){const{data:{session:r}}=await I.auth.getSession();if(!r){const{data:p,error:v}=await I.auth.setSession({access_token:o,refresh_token:a});v?console.log("[auth][restore] error",v):console.log("[auth][restore] done",!!p.session)}}else console.log("[auth][restore] no cookies present");J()}catch(o){console.log("[auth][restore] exception",o)}}function ke(){console.log("[auth][listener] Setting up auth state listener..."),I.auth.onAuthStateChange(async(o,a)=>{switch(console.log("[auth][listener] Auth state changed:",o,!!a),o){case"TOKEN_REFRESHED":console.log("[auth][listener] Token refreshed successfully"),a&&(R(M,a.access_token,60*60*24*365),R($,a.refresh_token,60*60*24*365),J());break;case"SIGNED_IN":console.log("[auth][listener] User signed in"),a&&(R(M,a.access_token,60*60*24*365),R($,a.refresh_token,60*60*24*365),J());break;case"SIGNED_OUT":console.log("[auth][listener] User signed out");break;case"USER_UPDATED":console.log("[auth][listener] User updated");break;default:console.log("[auth][listener] Unhandled auth event:",o)}})}async function te(){try{const{data:{session:o}}=await I.auth.getSession();if(o&&o.user)return console.log("[auth][restore] Active session found"),{success:!0,session:o};const a=H(M),r=H($);if(a&&r){console.log("[auth][restore] Attempting to restore session from cookies...");const{data:p,error:v}=await I.auth.setSession({access_token:a,refresh_token:r});if(v)return console.log("[auth][restore] Failed to restore session:",v.message),{success:!1,error:v};if(p.session)return console.log("[auth][restore] Session restored successfully"),R(M,p.session.access_token,60*60*24*365),R($,p.session.refresh_token,60*60*24*365),J(),{success:!0,session:p.session}}return console.log("[auth][restore] No valid session or cookies found"),{success:!1,error:"No valid session or cookies"}}catch(o){return console.log("[auth][restore] Exception during session restoration:",o),{success:!1,error:o}}}const re="https://oqdnbpmmgntqtigstaow.supabase.co",ne="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",I=Le.createClient(re,ne,{db:{schema:"public"},auth:{storageKey:"sb-auth-token",storage:localStorage,autoRefreshToken:!0,persistSession:!0,cookieOptions:{domain:window.location.hostname==="localhost"?"localhost":".aiworkspace.pro",path:"/",sameSite:"Lax",secure:window.location.protocol==="https:",maxAge:365*24*60*60}}});typeof window<"u"&&(oe([M,$]),ke());console.log("Supabase Configuration:",{url:re,hasKey:!!ne,autoRefreshToken:!0,persistSession:!0});console.log("URL:",re.replace(/https:\/\/(.+)\.supabase\.co/,"https://*****.supabase.co"));console.log("Key configured:",!ne.includes("your-anon-key"));console.log("Environment mode:","production");function ge(){const o=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),a=e.ref(null),r=e.computed(()=>o.value.isAuthenticated),p=e.computed(()=>o.value.user),v=e.computed(()=>o.value.isLoading),b=async()=>{var l,m,c,N,V,A,C,h,f,i,S,k,g,D,O;try{const{data:{session:x}}=await I.auth.getSession();if(x&&x.user){const _=x.user,L={id:_.id,name:((l=_.user_metadata)==null?void 0:l.name)||((m=_.user_metadata)==null?void 0:m.user_name)||((c=_.user_metadata)==null?void 0:c.full_name)||((N=_.email)==null?void 0:N.split("@")[0])||"User",email:_.email,avatar_url:((V=_.user_metadata)==null?void 0:V.avatar_url)||null,user_metadata:_.user_metadata};return o.value={user:L,isAuthenticated:!0,isLoading:!1},a.value={user:L,access_token:x.access_token,refresh_token:x.refresh_token},{success:!0,session:a.value}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const B=await te();if(B.success&&B.session){console.log("[auth][enhanced] Session restored successfully");const _=B.session.user,L={id:_.id,name:((A=_.user_metadata)==null?void 0:A.name)||((C=_.user_metadata)==null?void 0:C.user_name)||((h=_.user_metadata)==null?void 0:h.full_name)||((f=_.email)==null?void 0:f.split("@")[0])||"User",email:_.email,avatar_url:((i=_.user_metadata)==null?void 0:i.avatar_url)||null,user_metadata:_.user_metadata};return o.value={user:L,isAuthenticated:!0,isLoading:!1},a.value=B.session,{success:!0,session:a.value}}else console.log("[auth][enhanced] Failed to restore session:",B.error)}catch(x){console.error("Error getting Supabase session:",x);try{const B=await te();if(B.success&&B.session){console.log("[auth][enhanced] Session restored after error");const _=B.session.user,L={id:_.id,name:((S=_.user_metadata)==null?void 0:S.name)||((k=_.user_metadata)==null?void 0:k.user_name)||((g=_.user_metadata)==null?void 0:g.full_name)||((D=_.email)==null?void 0:D.split("@")[0])||"User",email:_.email,avatar_url:((O=_.user_metadata)==null?void 0:O.avatar_url)||null,user_metadata:_.user_metadata};return o.value={user:L,isAuthenticated:!0,isLoading:!1},a.value=B.session,{success:!0,session:a.value}}}catch(B){console.error("Error restoring session:",B)}}return o.value={user:null,isAuthenticated:!1,isLoading:!1},a.value=null,{success:!1,error:"No valid session found"}},W=async()=>{try{await I.auth.signOut(),G(M),G($),K(),o.value={user:null,isAuthenticated:!1,isLoading:!1},a.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(l){console.error("Error during logout:",l),o.value={user:null,isAuthenticated:!1,isLoading:!1},a.value=null}},P=async(l,m)=>{var c,N,V,A,C;try{o.value.isLoading=!0;const{data:h,error:f}=await I.auth.signInWithPassword({email:l,password:m});if(f)throw f;if(h.session){const i=h.session.user,S={id:i.id,name:((c=i.user_metadata)==null?void 0:c.name)||((N=i.user_metadata)==null?void 0:N.user_name)||((V=i.user_metadata)==null?void 0:V.full_name)||((A=i.email)==null?void 0:A.split("@")[0])||"User",email:i.email,avatar_url:((C=i.user_metadata)==null?void 0:C.avatar_url)||null,user_metadata:i.user_metadata};return o.value={user:S,isAuthenticated:!0,isLoading:!1},a.value={user:S,access_token:h.session.access_token,refresh_token:h.session.refresh_token},{success:!0,session:a.value}}return{success:!1,error:"No session returned"}}catch(h){return console.error("Sign in error:",h),o.value.isLoading=!1,{success:!1,error:h}}},E=async(l,m,c)=>{var N,V,A,C,h;try{o.value.isLoading=!0;const{data:f,error:i}=await I.auth.signUp({email:l,password:m,options:{data:c}});if(i)throw i;if(f.session){const S=f.session.user,k={id:S.id,name:((N=S.user_metadata)==null?void 0:N.name)||((V=S.user_metadata)==null?void 0:V.user_name)||((A=S.user_metadata)==null?void 0:A.full_name)||((C=S.email)==null?void 0:C.split("@")[0])||"User",email:S.email,avatar_url:((h=S.user_metadata)==null?void 0:h.avatar_url)||null,user_metadata:S.user_metadata};return o.value={user:k,isAuthenticated:!0,isLoading:!1},a.value={user:k,access_token:f.session.access_token,refresh_token:f.session.refresh_token},{success:!0,session:a.value}}return{success:!1,error:"No session returned"}}catch(f){return console.error("Sign up error:",f),o.value.isLoading=!1,{success:!1,error:f}}},d=async()=>{await b()};return e.onMounted(()=>{d()}),{authState:o,currentSession:a,isAuthenticated:r,currentUser:p,isLoading:v,loadUserInfo:b,logout:W,signIn:P,signUp:E,checkAuth:d}}const we=Be.defineStore("workspace",()=>{const o=e.ref(null),a=e.ref([]),r=e.ref(null),p=d=>{o.value=d,localStorage.setItem("current_workspace",JSON.stringify(d))},v=d=>{a.value=d,localStorage.setItem("available_workspaces",JSON.stringify(d))};return{currentWorkspace:o,workspaces:a,user:r,setCurrentWorkspace:p,setWorkspaces:v,setUser:d=>{r.value=d,localStorage.setItem("user_info",JSON.stringify(d))},loadPersistedData:()=>{const d=localStorage.getItem("current_workspace");if(d)try{o.value=JSON.parse(d)}catch(c){console.error("Error loading persisted workspace:",c)}const l=localStorage.getItem("available_workspaces");if(l)try{a.value=JSON.parse(l)}catch(c){console.error("Error loading persisted workspaces:",c)}const m=localStorage.getItem("user_info");if(m)try{r.value=JSON.parse(m)}catch(c){console.error("Error loading persisted user:",c)}},clearData:()=>{o.value=null,a.value=[],r.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(d=!1)=>{try{const{data:{user:l}}=await I.auth.getUser();if(!l)return[];let m=I.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at,
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",l.id);d||(m=m.eq("archived",!1));const{data:c,error:N}=await m;if(N)throw N;const V=new Map;(c||[]).forEach(i=>{(i.workspace_access||[]).forEach(S=>{S.shared_with_user_id===l.id&&V.set(i.id,S)})});const A=[...new Set((c||[]).filter(i=>i.parent_workspace_id).map(i=>i.parent_workspace_id).filter(i=>!V.has(i)))];let C=[];if(A.length){let i=I.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",A);d||(i=i.eq("archived",!1));const{data:S,error:k}=await i;if(k)throw k;C=S||[]}const f=[...c||[],...C].map(i=>{var S,k,g;return{id:i.id,title:i.title,description:i.description||"No description",parent_workspace_id:i.parent_workspace_id,created_by:i.created_by,archived:i.archived,created_at:i.created_at,latest_activity:((k=(S=i.workspace_activities)==null?void 0:S[0])==null?void 0:k.updated_at)||i.created_at,hasAccess:V.has(i.id),accessType:((g=V.get(i.id))==null?void 0:g.access_type)||null}});return f.sort((i,S)=>new Date(S.latest_activity)-new Date(i.latest_activity)),v(f),f}catch(l){return console.error("loadWorkspaces error",l),[]}}}});function ve(){const o=e.ref({user:null,isAuthenticated:!1,isLoading:!0,error:null}),a=e.ref(window.location.href),r=async()=>{var d,l,m,c,N,V,A,C;try{o.value.isLoading=!0;const{data:{session:h},error:f}=await I.auth.getSession();if(f){console.error("Error checking auth status:",f),o.value={user:null,isAuthenticated:!1,isLoading:!1,error:f.message};return}h!=null&&h.user?(o.value={user:{id:h.user.id,email:h.user.email||"",name:((d=h.user.user_metadata)==null?void 0:d.full_name)||((l=h.user.user_metadata)==null?void 0:l.name)||((m=h.user.email)==null?void 0:m.split("@")[0])||"User",avatar_url:((c=h.user.user_metadata)==null?void 0:c.avatar_url)||((N=h.user.user_metadata)==null?void 0:N.picture)||null,initials:(((V=h.user.user_metadata)==null?void 0:V.full_name)||((A=h.user.user_metadata)==null?void 0:A.name)||((C=h.user.email)==null?void 0:C.split("@")[0])||"U").split(" ").map(i=>i[0]).join("").toUpperCase().substring(0,2)},isAuthenticated:!0,isLoading:!1,error:null},h.access_token&&R(M,h.access_token),h.refresh_token&&R($,h.refresh_token),J()):o.value={user:null,isAuthenticated:!1,isLoading:!1,error:null}}catch(h){console.error("Auth check failed:",h),o.value={user:null,isAuthenticated:!1,isLoading:!1,error:h.message||"Authentication check failed"}}},p=async(d,l)=>{try{const{error:m}=await I.auth.signInWithPassword({email:d,password:l});return m?{success:!1,error:m.message}:(await r(),sessionStorage.setItem("post-login-redirect",a.value),{success:!0})}catch(m){return console.error("Login error:",m),{success:!1,error:m.message||"Login failed"}}},v=async(d,l)=>{var m;try{const{data:c,error:N}=await I.auth.signUp({email:d,password:l});return N?{success:!1,error:N.message}:c.user&&!c.user.email_confirmed_at?{success:!0,needsConfirmation:!0}:(m=c.session)!=null&&m.user?(await r(),sessionStorage.setItem("post-login-redirect",a.value),{success:!0}):{success:!1,error:"No session created"}}catch(c){return console.error("Signup error:",c),{success:!1,error:c.message||"Signup failed"}}},b=async d=>{try{const l=`${window.location.origin}/auth/callback`;console.log("[OAuth] Starting login with provider:",d),console.log("[OAuth] Redirect URL:",l),console.log("[OAuth] Current URL:",a.value),console.log("[OAuth] Current origin:",window.location.origin);const{error:m}=await I.auth.signInWithOAuth({provider:d,options:{redirectTo:l,queryParams:{redirect_origin:a.value}}});if(m)return console.error("[OAuth] Error:",m),{success:!1,error:m.message};const c=a.value||window.location.href;return sessionStorage.setItem("post-login-redirect",c),localStorage.setItem("post-login-redirect",c),console.log("[OAuth] Stored redirect URL:",c),console.log("[OAuth] Current URL value:",a.value),console.log("[OAuth] Window location href:",window.location.href),{success:!0}}catch(l){return console.error("OAuth login error:",l),{success:!1,error:l.message||"OAuth login failed"}}},W=async()=>{try{const{error:d}=await I.auth.signOut();d&&console.error("Logout error:",d),o.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},G(M),G($),K()}catch(d){console.error("Logout error:",d)}},P=async d=>{try{const{error:l}=await I.auth.resetPasswordForEmail(d,{redirectTo:`${window.location.origin}/auth/reset-password`});return l?{success:!1,error:l.message}:{success:!0}}catch(l){return console.error("Password reset error:",l),{success:!1,error:l.message||"Password reset failed"}}},E=()=>{I.auth.onAuthStateChange((d,l)=>{var m;switch(console.log("Auth state changed:",d,(m=l==null?void 0:l.user)==null?void 0:m.email),d){case"SIGNED_IN":l!=null&&l.user&&r();break;case"SIGNED_OUT":o.value={user:null,isAuthenticated:!1,isLoading:!1,error:null},G(M),G($),K();break;case"TOKEN_REFRESHED":l!=null&&l.access_token&&R(M,l.access_token),l!=null&&l.refresh_token&&R($,l.refresh_token),J();break;case"USER_UPDATED":l!=null&&l.user&&r();break}})};return e.onMounted(async()=>{E(),await r()}),e.watch(()=>window.location.href,d=>{a.value=d}),{authState:e.computed(()=>o.value),isAuthenticated:e.computed(()=>o.value.isAuthenticated),user:e.computed(()=>o.value.user),isLoading:e.computed(()=>o.value.isLoading),checkAuthStatus:r,loginWithEmail:p,signupWithEmail:v,loginWithProvider:b,logout:W,resetPassword:P,currentUrl:e.computed(()=>a.value)}}const Fe={class:"login-container"},He={class:"logo-section"},Je={class:"login-buttons"},Ge={key:0,class:"forgot-password"},Ye={class:"signup-link"},qe=e.defineComponent({__name:"LoginModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","login-success"],setup(o,{emit:a}){const r=o,p=a,v=e.computed({get:()=>r.modelValue,set:k=>p("update:modelValue",k)}),b=e.ref(!1),W=e.ref(!1),P=e.ref(),{loginWithEmail:E,signupWithEmail:d,loginWithProvider:l,resetPassword:m}=ve(),c=e.reactive({email:"",password:"",confirmPassword:""}),N=e.computed(()=>({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email",trigger:"blur"}],password:[{required:!0,message:"Please enter your password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],...b.value?{confirmPassword:[{required:!0,message:"Please confirm your password",trigger:"blur"},{validator:(k,g,D)=>{g!==c.password?D(new Error("Passwords do not match")):D()},trigger:"blur"}]}:{}})),V=()=>{var k;b.value=!b.value,c.email="",c.password="",c.confirmPassword="",(k=P.value)==null||k.clearValidate()},A=()=>{var k;v.value=!1,c.email="",c.password="",c.confirmPassword="",b.value=!1,(k=P.value)==null||k.clearValidate()},C=async()=>{if(P.value)try{await P.value.validate(),W.value=!0,b.value?await f():await h()}catch(k){console.error("Form validation failed:",k)}finally{W.value=!1}},h=async()=>{const k=await E(c.email,c.password);k.success?(U.ElMessage.success("Login successful"),p("login-success",{email:c.email}),A()):U.ElMessage.error("Login failed: "+k.error)},f=async()=>{const k=await d(c.email,c.password);k.success?k.needsConfirmation?U.ElMessage.success("Please check your email to confirm your account"):(U.ElMessage.success("Account created successfully"),p("login-success",{email:c.email}),A()):U.ElMessage.error("Signup failed: "+k.error)},i=async k=>{const g=await l(k);g.success?U.ElMessage.success("Redirecting to login provider..."):U.ElMessage.error("Login failed: "+g.error)},S=async()=>{if(!c.email){U.ElMessage.warning("Please enter your email address first");return}const k=await m(c.email);k.success?U.ElMessage.success("Password reset email sent! Please check your inbox."):U.ElMessage.error("Failed to send reset email: "+k.error)};return(k,g)=>{const D=e.resolveComponent("el-icon"),O=e.resolveComponent("el-input"),x=e.resolveComponent("el-form-item"),B=e.resolveComponent("el-button"),_=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(_,{modelValue:v.value,"onUpdate:modelValue":g[6]||(g[6]=L=>v.value=L),title:"",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!0,class:"login-modal",onClose:A},{default:e.withCtx(()=>[e.createElementVNode("div",Fe,[e.createElementVNode("div",He,[e.createElementVNode("h2",null,e.toDisplayString(b.value?"Create Account":"Welcome Back"),1),e.createElementVNode("p",null,e.toDisplayString(b.value?"Sign up to get started with your account":"Sign in to continue to your account"),1)]),e.createVNode(e.unref(U.ElForm),{model:c,rules:N.value,ref_key:"formRef",ref:P,class:"login-form",onSubmit:e.withModifiers(C,["prevent"])},{default:e.withCtx(()=>[e.createVNode(x,{prop:"email"},{default:e.withCtx(()=>[e.createVNode(O,{modelValue:c.email,"onUpdate:modelValue":g[0]||(g[0]=L=>c.email=L),placeholder:"Email",type:"email",size:"large",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Re))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(x,{prop:"password"},{default:e.withCtx(()=>[e.createVNode(O,{modelValue:c.password,"onUpdate:modelValue":g[1]||(g[1]=L=>c.password=L),placeholder:"Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(e.unref(he))]),_:1})]),_:1},8,["modelValue"])]),_:1}),b.value?(e.openBlock(),e.createBlock(x,{key:0,prop:"confirmPassword"},{default:e.withCtx(()=>[e.createVNode(O,{modelValue:c.confirmPassword,"onUpdate:modelValue":g[2]||(g[2]=L=>c.confirmPassword=L),placeholder:"Confirm Password",type:"password",size:"large","show-password":"",class:"form-input"},{prefix:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(e.unref(he))]),_:1})]),_:1},8,["modelValue"])]),_:1})):e.createCommentVNode("",!0),e.createVNode(x,null,{default:e.withCtx(()=>[e.createVNode(B,{type:"primary",class:"submit-button",loading:W.value,onClick:C,size:"large"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(b.value?"Sign Up":"Sign In"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),g[10]||(g[10]=e.createElementVNode("div",{class:"divider"},[e.createElementVNode("span",null,"Or continue with")],-1)),e.createElementVNode("div",Je,[e.createVNode(B,{class:"login-button google",onClick:g[3]||(g[3]=L=>i("google")),size:"large"},{default:e.withCtx(()=>[...g[7]||(g[7]=[e.createElementVNode("span",{class:"social-icon"},"G",-1),e.createTextVNode(" Google ",-1)])]),_:1}),e.createVNode(B,{class:"login-button github",onClick:g[4]||(g[4]=L=>i("github")),size:"large"},{default:e.withCtx(()=>[...g[8]||(g[8]=[e.createElementVNode("span",{class:"social-icon"},"âš¡",-1),e.createTextVNode(" GitHub ",-1)])]),_:1}),e.createVNode(B,{class:"login-button twitter",onClick:g[5]||(g[5]=L=>i("twitter")),size:"large"},{default:e.withCtx(()=>[...g[9]||(g[9]=[e.createElementVNode("span",{class:"social-icon"},"X",-1),e.createTextVNode(" X (Twitter) ",-1)])]),_:1})]),g[11]||(g[11]=e.createElementVNode("div",{class:"terms"}," By continuing, you agree to AI Workspace's Terms of Service and Privacy Policy ",-1)),b.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ge,[e.createElementVNode("a",{href:"#",onClick:e.withModifiers(S,["prevent"])},"Forgot Password?")])),e.createElementVNode("div",Ye,[e.createTextVNode(e.toDisplayString(b.value?"Already have an account?":"Don't have an account?")+" ",1),e.createElementVNode("a",{href:"#",onClick:e.withModifiers(V,["prevent"])},e.toDisplayString(b.value?"Sign in":"Sign up"),1)])])]),_:1},8,["modelValue"])}}});const le=(o,a)=>{const r=o.__vccOpts||o;for(const[p,v]of a)r[p]=v;return r},_e=le(qe,[["__scopeId","data-v-684a3f28"]]),Xe={class:"aiworkspace-header"},Ze={key:0,class:"header-content header-loading"},Ke={key:1,class:"header-content header-fallback"},je={key:2,class:"header-content"},Qe={class:"header-left"},et={class:"logo-section"},tt={href:"/",class:"logo"},ot=["src"],at={key:1,class:"text-logo"},st={key:0,class:"header-center"},rt={class:"main-navigation"},nt={class:"nav-item"},lt={href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},ct={class:"workspace-dropdown-item"},it=["href"],ut={class:"workspace-icon"},dt={key:1,class:"nav-divider"},pt={class:"nav-item"},ht=["href","onClick"],mt={class:"header-right"},ft={class:"user-profile"},kt={class:"user-info"},gt={class:"user-name"},wt={class:"user-avatar"},vt=["src","alt"],_t={key:1,class:"avatar-placeholder"},yt={key:3,class:"header-content header-unauthenticated"},St={class:"header-left"},Et={class:"logo-section"},Ct={href:"/",class:"logo"},Nt=["src"],bt={key:1,class:"text-logo"},Vt={class:"header-right"},It={class:"workspace-list"},At=["onClick"],xt={class:"workspace-icon"},Lt={class:"workspace-details"},Bt={class:"workspace-members"},Ut={key:0,class:"current-indicator"},q=50,Wt=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(o,{emit:a}){const r=o,p=a,{authState:v,logout:b}=ge(),W=()=>{try{return we()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},P=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},E=e.ref(W()),d=e.computed(()=>!!E.value),l=e.ref(0),m=()=>{if(!E.value&&l.value<q){if(P()){const s=W();if(s){E.value=s,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}l.value++,setTimeout(m,100)}else l.value>=q&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{E.value||m()});const c=e.ref(!1),N=e.ref(!1),V=e.ref([]),A=e.ref([]),C=e.ref({name:"",email:"",avatar_url:null,initials:""}),h=e.ref([]),f=e.ref([]),i=e.ref(!1);e.watch(f,async s=>{s.length>0&&d.value&&O.value&&await D()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{d.value&&O.value&&await D()},{immediate:!1});const S=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,s=>{S.value=s},{immediate:!0}),e.watch(d,s=>{!s&&l.value<q&&m()});const k=()=>{try{const s=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(s)return s[1];const n=new URLSearchParams(window.location.search).get("workspace_id");if(n)return n;const u=window.location.hash.match(/workspace_id=(\d+)/);return u?u[1]:null}catch(s){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",s),null}},g=()=>{try{return window.location.pathname.includes("/all-workspace/")}catch(s){return console.warn("[AIWorkspaceHeader] Error checking all-workspace mode:",s),!1}},D=async()=>{if(!E.value||!d.value)return;const s=g();if(i.value=s,s){E.value.currentWorkspace=null,localStorage.removeItem("current_workspace"),console.log("[AIWorkspaceHeader] Auto-selected all-workspace mode from URL");return}const t=k();if(t)try{f.value.length===0&&await ie();const n=f.value.find(u=>u.id.toString()===t);n?(E.value.setCurrentWorkspace(n),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${n.title} (ID: ${n.id})`),p("workspaceChange",n)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${t} not found in available workspaces`)}catch(n){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",n)}},O=e.computed(()=>v.value.isAuthenticated),x=e.computed(()=>E.value?E.value.currentWorkspace:null),B=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),_=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"All Tasks",key:"tasks",url:"/tasks"},{label:"All Goals",key:"goals",url:"/goals"},{label:"All Events",key:"events",url:"/events"},{label:"All Drive",key:"files",url:"/files"},{label:"All Contacts",key:"contacts",url:"/contacts"},{label:"All Settings",key:"settings",url:"/settings"}]),L=e.computed(()=>i.value?_.value:B.value),ye=e.computed(()=>{try{const s=S.value;let t="";const n=s.match(/\/all-workspace\/([^\/]+)/);if(n)t=n[1];else{const u=s.match(/\/single-workspace\/\d+\/([^\/]+)/);if(u)t=u[1];else{const y=s.match(/\/([^\/]+)$/);y&&(t=y[1])}}if(t){const u=L.value.find(y=>y.key===t||y.url.includes(`/${t}`)||y.url===`/${t}`);if(u)return u.label}return"Dashboard"}catch(s){return console.warn("[AIWorkspaceHeader] Error determining current section:",s),"Dashboard"}}),Se=s=>{const t=new Map;s.forEach(y=>{t.set(y.id,{...y,children:[]})});const n=[];t.forEach(y=>{y.parent_workspace_id&&t.has(y.parent_workspace_id)?t.get(y.parent_workspace_id).children.push(y):n.push(y)});const u=y=>{y.sort((T,z)=>T.title.localeCompare(z.title)),y.forEach(T=>{T.children&&u(T.children)})};return u(n),n},ce=(s,t=0,n=[])=>(s.forEach(u=>{n.push({...u,level:t}),u.children&&u.children.length&&ce(u.children,t+1,n)}),n),ie=async()=>{var s,t,n;try{const u=await((s=E.value)==null?void 0:s.loadWorkspaces());if(h.value=Se(u||[]),f.value=ce(h.value),A.value=f.value,V.value=f.value,r.currentWorkspaceId){const y=f.value.find(T=>{var z;return T.id.toString()===((z=r.currentWorkspaceId)==null?void 0:z.toString())});y&&((t=E.value)==null||t.setCurrentWorkspace(y))}else!x.value&&f.value.length&&((n=E.value)==null||n.setCurrentWorkspace(f.value[0]))}catch(u){console.error("loadWorkspaces (header) error",u)}},Ee=s=>{if(console.log("Navigation command:",s),s==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const t=parseInt(s.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t}/dashboard`;return}},Ce=s=>{const t=x.value,n=i.value;switch(s.key){case"dashboard":n?window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":t?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(n)window.location.href="https://outline.aiworkspace.pro/all-workspace/outlines";else if(t){const u=`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`;window.location.href=u}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(n)window.location.href="https://canvas.aiworkspace.pro/all-workspace/canvas";else if(t){const u=`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`;window.location.href=u}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(n)window.location.href="https://drive.aiworkspace.pro/all-workspace/files";else if(t){const u=`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`;window.location.href=u}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(n)window.location.href="https://tasks.aiworkspace.pro/all-workspace/tasks";else if(t){const u=`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`;window.location.href=u}else window.location.href="https://tasks.aiworkspace.pro";break;case"goals":if(n)window.location.href="https://app.aiworkspace.pro/all-workspace/goals";else if(t){const u=`https://app.aiworkspace.pro/single-workspace/${t.id}/goals`;window.location.href=u}else window.location.href="https://app.aiworkspace.pro/all-workspace/goals";break;case"events":if(n)window.location.href="https://app.aiworkspace.pro/all-workspace/events";else if(t){const u=`https://app.aiworkspace.pro/single-workspace/${t.id}/events`;window.location.href=u}else window.location.href="https://app.aiworkspace.pro/all-workspace/events";break;case"contacts":if(n)window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";else if(t){const u=`https://app.aiworkspace.pro/single-workspace/${t.id}/contacts`;window.location.href=u}else window.location.href="https://app.aiworkspace.pro/all-workspace/contacts";break;case"ai-portfolios":if(n)window.location.href="https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios";else if(t){const u=`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`;window.location.href=u}else window.location.href="https://spreadsheet.aiworkspace.pro";break;case"settings":if(n)window.location.href="https://settings.aiworkspace.pro/all-workspace/settings";else if(t){const u=`https://settings.aiworkspace.pro/single-workspace/${t.id}/settings`;window.location.href=u}else window.location.href="https://settings.aiworkspace.pro";break;default:if(n){const u=`https://app.aiworkspace.pro/all-workspace/${s.key}`;window.location.href=u}else if(t){const u=`https://app.aiworkspace.pro/single-workspace/${t.id}/${s.key}`;window.location.href=u}else{const u=`https://app.aiworkspace.pro/${s.key}`;window.location.href=u}break}},Ne=s=>{const t=x.value,n=i.value;switch(s.key){case"dashboard":return n?"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard":t?`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t.id}/dashboard`:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";case"ai-portfolios":return n?"https://spreadsheet.aiworkspace.pro/all-workspace/ai-portfolios":t?`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return n?"https://outline.aiworkspace.pro/all-workspace/outlines":t?`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return n?"https://canvas.aiworkspace.pro/all-workspace/canvas":t?`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return n?"https://drive.aiworkspace.pro/all-workspace/files":t?`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return n?"https://tasks.aiworkspace.pro/all-workspace/tasks":t?`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`:"https://tasks.aiworkspace.pro";case"goals":return n?"https://app.aiworkspace.pro/all-workspace/goals":t?`https://app.aiworkspace.pro/single-workspace/${t.id}/goals`:"https://app.aiworkspace.pro/all-workspace/goals";case"events":return n?"https://app.aiworkspace.pro/all-workspace/events":t?`https://app.aiworkspace.pro/single-workspace/${t.id}/events`:"https://app.aiworkspace.pro/all-workspace/events";case"contacts":return n?"https://app.aiworkspace.pro/all-workspace/contacts":t?`https://app.aiworkspace.pro/single-workspace/${t.id}/contacts`:"https://app.aiworkspace.pro/all-workspace/contacts";case"settings":return n?"https://settings.aiworkspace.pro/all-workspace/settings":t?`https://settings.aiworkspace.pro/single-workspace/${t.id}/settings`:"https://settings.aiworkspace.pro";default:return n?`https://app.aiworkspace.pro/all-workspace/${s.key}`:t?`https://app.aiworkspace.pro/single-workspace/${t.id}/${s.key}`:`https://app.aiworkspace.pro/${s.key}`}},X=s=>{switch(s){case"profile":r.onProfileClick?r.onProfileClick():U.ElMessage.info("Profile settings coming soon");break;case"workspaces":c.value=!0;break;case"logout":Ve();break}},ue=s=>{var t;(t=E.value)==null||t.setCurrentWorkspace(s),c.value=!1,p("workspaceChange",s),U.ElMessage.success(`Switched to ${s.title}`)},be=()=>{U.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:s})=>{var n;const t={id:Date.now(),title:s,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};V.value.push(t),(n=E.value)==null||n.setWorkspaces(V.value),ue(t),U.ElMessage.success(`Created workspace: ${s}`)}).catch(()=>{})},Ve=()=>{U.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var s;(s=E.value)==null||s.clearData(),await b(),p("logout"),U.ElMessage.success("Signed out successfully")}).catch(()=>{})},Q=async()=>{var s,t;if(v.value.user){const n=v.value.user;C.value={name:n.name||((s=n.email)==null?void 0:s.split("@")[0])||"User",email:n.email||"",avatar_url:n.avatar_url||null,initials:(n.name||((t=n.email)==null?void 0:t.split("@")[0])||"U").split(" ").map(u=>u[0]).join("").toUpperCase().substring(0,2)},r.showWorkspaceSelector&&await ie()}};e.watch(()=>v.value.user,s=>{var t;s?Q():(C.value={name:"",email:"",avatar_url:null,initials:""},(t=E.value)==null||t.clearData())}),e.watch(()=>r.currentWorkspaceId,s=>{var t;if(s&&f.value.length){const n=f.value.find(u=>u.id.toString()===s.toString());n&&((t=E.value)==null||t.setCurrentWorkspace(n))}}),e.onMounted(async()=>{O.value&&(await Q(),await D())});const Ie=async s=>{console.log("Login successful:",s),N.value=!1,await Q(),p("login"),U.ElMessage.success("Welcome back!")},Ae=()=>{l.value=0,m(),U.ElMessage.success("Manual Pinia retry initiated.")};return(s,t)=>{const n=e.resolveComponent("el-icon"),u=e.resolveComponent("el-tag"),y=e.resolveComponent("el-dropdown-item"),T=e.resolveComponent("el-dropdown-menu"),z=e.resolveComponent("el-dropdown"),ee=e.resolveComponent("el-button"),xe=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",Xe,[!d.value&&l.value<q?(e.openBlock(),e.createElementBlock("div",Ze,[...t[8]||(t[8]=[e.createStaticVNode('<div class="header-left" data-v-f830d242><div class="logo-section" data-v-f830d242><a href="/" class="logo" data-v-f830d242><div class="text-logo" data-v-f830d242><span class="logo-text" data-v-f830d242>AI Workspace</span></div></a></div></div><div class="header-center" data-v-f830d242><span class="loading-text" data-v-f830d242>Initializing...</span></div>',2)])])):!d.value&&l.value>=q?(e.openBlock(),e.createElementBlock("div",Ke,[t[10]||(t[10]=e.createStaticVNode('<div class="header-left" data-v-f830d242><div class="logo-section" data-v-f830d242><a href="/" class="logo" data-v-f830d242><div class="text-logo" data-v-f830d242><span class="logo-text" data-v-f830d242>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[t[9]||(t[9]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:Ae,class:"retry-button"},"Retry Pinia")]),t[11]||(t[11]=e.createStaticVNode('<div class="header-right" data-v-f830d242><div class="user-profile" data-v-f830d242><div class="user-info" data-v-f830d242><span class="user-name" data-v-f830d242>User</span></div><div class="user-avatar" data-v-f830d242><span class="avatar-placeholder" data-v-f830d242>U</span></div></div></div>',1))])):O.value?(e.openBlock(),e.createElementBlock("div",je,[e.createElementVNode("div",Qe,[e.createElementVNode("div",et,[e.createElementVNode("a",tt,[s.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:s.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,ot)):(e.openBlock(),e.createElementBlock("div",at,[...t[12]||(t[12]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),s.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",st,[e.createElementVNode("nav",rt,[s.showWorkspaceSelector?(e.openBlock(),e.createBlock(z,{key:0,onCommand:Ee,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(T,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(y,{command:"all-workspace",class:e.normalizeClass({active:i.value})},{default:e.withCtx(()=>[e.createElementVNode("a",lt,[e.createElementVNode("div",ct,[t[14]||(t[14]=e.createElementVNode("span",{class:"workspace-icon"},"ðŸŒ",-1)),t[15]||(t[15]=e.createElementVNode("span",null,"All workspace",-1)),i.value?(e.openBlock(),e.createBlock(u,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)])])]),_:1},8,["class"]),f.value.length>0?(e.openBlock(),e.createBlock(y,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,w=>(e.openBlock(),e.createBlock(y,{key:w.id,command:`workspace-${w.id}`},{default:e.withCtx(()=>{var Y;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${w.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(w.level||0)*16+"px"})},[e.createElementVNode("span",ut,e.toDisplayString(w.children&&w.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("span",null,e.toDisplayString(w.title),1),w.id===((Y=x.value)==null?void 0:Y.id)?(e.openBlock(),e.createBlock(u,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...t[16]||(t[16]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,it)]}),_:2},1032,["command"]))),128)),f.value.length===0?(e.openBlock(),e.createBlock(y,{key:1,disabled:""},{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var w;return[e.createElementVNode("span",nt,[e.createTextVNode(e.toDisplayString(i.value?"All workspace":((w=x.value)==null?void 0:w.title)||"Select Workspace")+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(pe))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),s.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",dt,"/")):e.createCommentVNode("",!0),s.showSecondaryNavigation?(e.openBlock(),e.createBlock(z,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(T,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(L.value,w=>(e.openBlock(),e.createBlock(y,{key:w.label,class:e.normalizeClass({active:w.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:Ne(w),class:"nav-link",onClick:e.withModifiers(Y=>Ce(w),["prevent"])},e.toDisplayString(w.label),9,ht)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",pt,[e.createTextVNode(e.toDisplayString(ye.value)+" ",1),e.createVNode(n,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(pe))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",mt,[e.createVNode(z,{onCommand:X,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(T,null,{default:e.withCtx(()=>[e.createVNode(y,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:t[0]||(t[0]=e.withModifiers(w=>X("profile"),["prevent"]))},"Profile Settings")]),_:1}),s.showWorkspaceSelector?(e.openBlock(),e.createBlock(y,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:t[1]||(t[1]=e.withModifiers(w=>X("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(y,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:t[2]||(t[2]=e.withModifiers(w=>X("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",ft,[e.createElementVNode("div",kt,[e.createElementVNode("span",gt,e.toDisplayString(C.value.name),1)]),e.createElementVNode("div",wt,[C.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:C.value.avatar_url,alt:C.value.name},null,8,vt)):(e.openBlock(),e.createElementBlock("span",_t,e.toDisplayString(C.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",yt,[e.createElementVNode("div",St,[e.createElementVNode("div",Et,[e.createElementVNode("a",Ct,[s.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:s.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Nt)):(e.openBlock(),e.createElementBlock("div",bt,[...t[18]||(t[18]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),t[20]||(t[20]=e.createElementVNode("div",{class:"header-center"},[e.createElementVNode("span",{class:"welcome-text"},"Welcome to AI Workspace")],-1)),e.createElementVNode("div",Vt,[e.createVNode(ee,{type:"primary",size:"large",class:"login-button",onClick:t[3]||(t[3]=w=>N.value=!0)},{default:e.withCtx(()=>[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Oe))]),_:1}),t[19]||(t[19]=e.createTextVNode(" Login / Signup ",-1))]),_:1})])])),O.value&&s.showWorkspaceSelector?(e.openBlock(),e.createBlock(xe,{key:4,modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=w=>c.value=w),title:"Switch Workspace",width:"500px",onClose:t[6]||(t[6]=w=>c.value=!1)},{footer:e.withCtx(()=>[e.createVNode(ee,{onClick:t[4]||(t[4]=w=>c.value=!1)},{default:e.withCtx(()=>[...t[21]||(t[21]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(ee,{type:"primary",onClick:be},{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",It,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(V.value,w=>{var Y,de;return e.openBlock(),e.createElementBlock("div",{key:w.id,class:e.normalizeClass(["workspace-item",{active:w.id===((Y=x.value)==null?void 0:Y.id)}]),onClick:Dt=>ue(w)},[e.createElementVNode("div",xt,e.toDisplayString(w.children&&w.children.length?"ðŸ“":"ðŸ“„"),1),e.createElementVNode("div",Lt,[e.createElementVNode("h3",null,e.toDisplayString(w.title),1),e.createElementVNode("p",null,e.toDisplayString(w.description),1),e.createElementVNode("span",Bt,e.toDisplayString(w.hasAccess?"Active":"Inactive"),1)]),w.id===((de=x.value)==null?void 0:de.id)?(e.openBlock(),e.createElementBlock("div",Ut,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Pe))]),_:1})])):e.createCommentVNode("",!0)],10,At)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0),e.createVNode(_e,{modelValue:N.value,"onUpdate:modelValue":t[7]||(t[7]=w=>N.value=w),onLoginSuccess:Ie},null,8,["modelValue"])])}}});const Pt=le(Wt,[["__scopeId","data-v-f830d242"]]),Mt={class:"auth-callback"},$t=e.defineComponent({__name:"AuthCallback",setup(o){e.onMounted(async()=>{console.log("[AuthCallback] Component mounted, starting callback processing...");try{await new Promise(v=>setTimeout(v,500));const{data:r,error:p}=await I.auth.getSession();if(p){console.error("Error processing callback:",p),a();return}if(r!=null&&r.session){const v=r.session.user;console.log("OAuth login successful:",v.email),r.session.access_token&&R(M,r.session.access_token),r.session.refresh_token&&R($,r.session.refresh_token),J();const b=fe();console.log("[callback] Post-login redirect URL:",b),console.log("[callback] Session storage redirect:",sessionStorage.getItem("post-login-redirect")),console.log("[callback] Local storage redirect:",localStorage.getItem("post-login-redirect"));const W=b||"/";if(console.log("[callback] Final redirect URL:",W),W.startsWith("/")){const P=window.location.origin,E=`${P}${W}`;console.log("[callback] redirecting to:",E,{hostname:window.location.hostname,origin:P}),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=E},100)}else console.log("[callback] redirecting to absolute URL:",W),sessionStorage.removeItem("post-login-redirect"),localStorage.removeItem("post-login-redirect"),setTimeout(()=>{window.location.href=W},100)}else a()}catch(r){console.error("Error processing callback:",r),a()}});const a=()=>{const p=window.location.href.replace("/auth/callback","");window.location.href=p};return(r,p)=>(e.openBlock(),e.createElementBlock("div",Mt,[...p[0]||(p[0]=[e.createElementVNode("div",{class:"callback-container"},[e.createElementVNode("div",{class:"loading-spinner"},[e.createElementVNode("div",{class:"spinner"})]),e.createElementVNode("h2",null,"Processing login..."),e.createElementVNode("p",null,"Please wait while we complete your authentication.")],-1)])]))}});const Rt=le($t,[["__scopeId","data-v-6e939359"]]);exports.ACCESS_COOKIE=M;exports.AIWorkspaceHeader=Pt;exports.AuthCallback=Rt;exports.LS_ACCESS_KEY=ae;exports.LS_REFRESH_KEY=se;exports.LoginModal=_e;exports.REFRESH_COOKIE=$;exports.buildOAuthRedirectUrl=Te;exports.clearLocalStorageTokens=K;exports.clearSessionCookie=G;exports.ensureCrossSubdomainCookies=oe;exports.getCookie=H;exports.getPostLoginBase=fe;exports.restoreCrossSubdomainSession=ze;exports.restoreSessionWithRetry=te;exports.setSessionCookie=R;exports.setupAuthStateListener=ke;exports.supabase=I;exports.syncCookiesToLocalStorage=J;exports.useAuth=ve;exports.useEnhancedAuth=ge;exports.useWorkspaceStore=we;
