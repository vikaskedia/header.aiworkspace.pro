"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),Y=require("element-plus"),Ee=require("@supabase/supabase-js"),Ie=require("pinia");/*! Element Plus Icons Vue v2.3.2 */var Ne=e.defineComponent({name:"ArrowDown",__name:"arrow-down",setup(a){return(s,n)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.59 30.59 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.59 30.59 0 0 0-42.752 0z"})]))}}),ie=Ne,be=e.defineComponent({name:"Check",__name:"check",setup(a){return(s,n)=>(e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Ae=be;const O="aiworkspace.pro";function Z(a){return a==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(a)}function pe(a){return a===O||a.endsWith(`.${O}`)}function K(a){return document.cookie.split(";").map(l=>l.trim()).filter(l=>a.some(g=>l.startsWith(g+"=")))}function T(a,s,n=60*60*24*365){const l=location.hostname;if(Z(l)){document.cookie=`${a}=${encodeURIComponent(s)}; Path=/; Max-Age=${n}; SameSite=Lax`,console.log("[auth][cookie][set][local]",{host:l,name:a,valuePreview:s.slice(0,20)+"..."}),console.log("[auth][cookie][after]",K([a]));return}document.cookie=`${a}=${encodeURIComponent(s)}; Domain=.${O}; Path=/; Max-Age=${n}; SameSite=Lax; Secure`,document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][set][apex]",{host:l,apex:O,name:a,valuePreview:s.slice(0,20)+"..."}),console.log("[auth][cookie][after]",K([a]))}function J(a){const s=new RegExp("(?:^|; )"+a.replace(/[$()*+.[\]?^{}|\\/-]/g,"\\$&")+"=([^;]*)"),n=document.cookie.match(s);return n?decodeURIComponent(n[1]):null}function X(a){const s=location.hostname;if(Z(s)){document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][local]",{host:s,name:a});return}document.cookie=`${a}=; Domain=.${O}; Path=/; Max-Age=0; SameSite=Lax; Secure`,document.cookie=`${a}=; Path=/; Max-Age=0; SameSite=Lax`,console.log("[auth][cookie][clear][apex]",{host:s,apex:O,name:a}),console.log("[auth][cookie][after]",K([a]))}function Q(a){const s=location.hostname;if(Z(s)){console.log("[auth][cookie][promote] skip (local host)",s);return}if(!pe(s)){console.log("[auth][cookie][promote] skip (not under apex)",{host:s,apex:O});return}console.log("[auth][cookie][promote] start",{host:s,apex:O,names:a}),a.forEach(n=>{const l=J(n);l?T(n,l,60*60*24*365):console.log("[auth][cookie][promote] missing",n)}),console.log("[auth][cookie][promote] done",K(a))}function Ve(){return`${window.location.origin}/callback`}function xe(){try{const a=new URLSearchParams(location.search),s=["redirect","redirect_to","returnTo","next"].find(l=>a.get(l));let n=s?a.get(s):"";if(n||(n=sessionStorage.getItem("post-login-redirect")||localStorage.getItem("post-login-redirect")||""),n||(n={VITE_SUPABASE_URL:"https://oqdnbpmmgntqtigstaow.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",VITE_APEX_DOMAIN:"aiworkspace.pro",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_DEFAULT_POST_LOGIN_URL||"/"),n.startsWith("http"))try{const l=new URL(n);return pe(l.hostname)||Z(l.hostname)?n:"/"}catch{return"/"}return n.startsWith("/")||(n="/"+n),n}catch{return"/"}}const U="sb-access-token",D="sb-refresh-token",ee="sb-access-token",te="sb-refresh-token";function G(){try{const a=J(U),s=J(D);a&&localStorage.setItem(ee,a),s&&localStorage.setItem(te,s),console.log("[auth][cookie->ls] sync",{hasAccess:!!a,hasRefresh:!!s})}catch(a){console.log("[auth][cookie->ls] error",a)}}function he(){try{localStorage.removeItem(ee),localStorage.removeItem(te),console.log("[auth][cookie->ls] cleared localStorage")}catch(a){console.log("[auth][cookie->ls] clear error",a)}}async function We(){try{Q([U,D]);const a=J(U),s=J(D);if(a&&s){const{data:{session:n}}=await V.auth.getSession();if(!n){const{data:l,error:g}=await V.auth.setSession({access_token:a,refresh_token:s});g?console.log("[auth][restore] error",g):console.log("[auth][restore] done",!!l.session)}}else console.log("[auth][restore] no cookies present");G()}catch(a){console.log("[auth][restore] exception",a)}}function ke(){console.log("[auth][listener] Setting up auth state listener..."),V.auth.onAuthStateChange(async(a,s)=>{switch(console.log("[auth][listener] Auth state changed:",a,!!s),a){case"TOKEN_REFRESHED":console.log("[auth][listener] Token refreshed successfully"),s&&(T(U,s.access_token,60*60*24*365),T(D,s.refresh_token,60*60*24*365),G());break;case"SIGNED_IN":console.log("[auth][listener] User signed in"),s&&(T(U,s.access_token,60*60*24*365),T(D,s.refresh_token,60*60*24*365),G());break;case"SIGNED_OUT":console.log("[auth][listener] User signed out");break;case"USER_UPDATED":console.log("[auth][listener] User updated");break;default:console.log("[auth][listener] Unhandled auth event:",a)}})}async function j(){try{const{data:{session:a}}=await V.auth.getSession();if(a&&a.user)return console.log("[auth][restore] Active session found"),{success:!0,session:a};const s=J(U),n=J(D);if(s&&n){console.log("[auth][restore] Attempting to restore session from cookies...");const{data:l,error:g}=await V.auth.setSession({access_token:s,refresh_token:n});if(g)return console.log("[auth][restore] Failed to restore session:",g.message),{success:!1,error:g};if(l.session)return console.log("[auth][restore] Session restored successfully"),T(U,l.session.access_token,60*60*24*365),T(D,l.session.refresh_token,60*60*24*365),G(),{success:!0,session:l.session}}return console.log("[auth][restore] No valid session or cookies found"),{success:!1,error:"No valid session or cookies"}}catch(a){return console.log("[auth][restore] Exception during session restoration:",a),{success:!1,error:a}}}const ae="https://oqdnbpmmgntqtigstaow.supabase.co",oe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",V=Ee.createClient(ae,oe,{db:{schema:"public"},auth:{storageKey:"sb-auth-token",storage:localStorage,autoRefreshToken:!0,persistSession:!0}});typeof window<"u"&&(Q([U,D]),ke());console.log("Supabase Configuration:",{url:ae,hasKey:!!oe,autoRefreshToken:!0,persistSession:!0});console.log("URL:",ae.replace(/https:\/\/(.+)\.supabase\.co/,"https://*****.supabase.co"));console.log("Key configured:",!oe.includes("your-anon-key"));console.log("Environment mode:","production");function me(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),s=e.ref(null),n=e.computed(()=>a.value.isAuthenticated),l=e.computed(()=>a.value.user),g=e.computed(()=>a.value.isLoading),z=async()=>{var v,y,w,C,I,S,N,d,_,c,m,A,M,$,W;try{const{data:{session:L}}=await V.auth.getSession();if(L&&L.user){const h=L.user,P={id:h.id,name:((v=h.user_metadata)==null?void 0:v.name)||((y=h.user_metadata)==null?void 0:y.user_name)||((w=h.user_metadata)==null?void 0:w.full_name)||((C=h.email)==null?void 0:C.split("@")[0])||"User",email:h.email,avatar_url:((I=h.user_metadata)==null?void 0:I.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:P,isAuthenticated:!0,isLoading:!1},s.value={user:P,access_token:L.access_token,refresh_token:L.refresh_token},{success:!0,session:s.value}}console.log("[auth][enhanced] No active session, attempting to restore from cookies...");const b=await j();if(b.success&&b.session){console.log("[auth][enhanced] Session restored successfully");const h=b.session.user,P={id:h.id,name:((S=h.user_metadata)==null?void 0:S.name)||((N=h.user_metadata)==null?void 0:N.user_name)||((d=h.user_metadata)==null?void 0:d.full_name)||((_=h.email)==null?void 0:_.split("@")[0])||"User",email:h.email,avatar_url:((c=h.user_metadata)==null?void 0:c.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:P,isAuthenticated:!0,isLoading:!1},s.value=b.session,{success:!0,session:s.value}}else console.log("[auth][enhanced] Failed to restore session:",b.error)}catch(L){console.error("Error getting Supabase session:",L);try{const b=await j();if(b.success&&b.session){console.log("[auth][enhanced] Session restored after error");const h=b.session.user,P={id:h.id,name:((m=h.user_metadata)==null?void 0:m.name)||((A=h.user_metadata)==null?void 0:A.user_name)||((M=h.user_metadata)==null?void 0:M.full_name)||(($=h.email)==null?void 0:$.split("@")[0])||"User",email:h.email,avatar_url:((W=h.user_metadata)==null?void 0:W.avatar_url)||null,user_metadata:h.user_metadata};return a.value={user:P,isAuthenticated:!0,isLoading:!1},s.value=b.session,{success:!0,session:s.value}}}catch(b){console.error("Error restoring session:",b)}}return a.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null,{success:!1,error:"No valid session found"}},E=async()=>{try{await V.auth.signOut(),X(U),X(D),he(),a.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null,console.log("[auth][enhanced] User logged out successfully")}catch(v){console.error("Error during logout:",v),a.value={user:null,isAuthenticated:!1,isLoading:!1},s.value=null}},x=async(v,y)=>{var w,C,I,S,N;try{a.value.isLoading=!0;const{data:d,error:_}=await V.auth.signInWithPassword({email:v,password:y});if(_)throw _;if(d.session){const c=d.session.user,m={id:c.id,name:((w=c.user_metadata)==null?void 0:w.name)||((C=c.user_metadata)==null?void 0:C.user_name)||((I=c.user_metadata)==null?void 0:I.full_name)||((S=c.email)==null?void 0:S.split("@")[0])||"User",email:c.email,avatar_url:((N=c.user_metadata)==null?void 0:N.avatar_url)||null,user_metadata:c.user_metadata};return a.value={user:m,isAuthenticated:!0,isLoading:!1},s.value={user:m,access_token:d.session.access_token,refresh_token:d.session.refresh_token},{success:!0,session:s.value}}return{success:!1,error:"No session returned"}}catch(d){return console.error("Sign in error:",d),a.value.isLoading=!1,{success:!1,error:d}}},f=async(v,y,w)=>{var C,I,S,N,d;try{a.value.isLoading=!0;const{data:_,error:c}=await V.auth.signUp({email:v,password:y,options:{data:w}});if(c)throw c;if(_.session){const m=_.session.user,A={id:m.id,name:((C=m.user_metadata)==null?void 0:C.name)||((I=m.user_metadata)==null?void 0:I.user_name)||((S=m.user_metadata)==null?void 0:S.full_name)||((N=m.email)==null?void 0:N.split("@")[0])||"User",email:m.email,avatar_url:((d=m.user_metadata)==null?void 0:d.avatar_url)||null,user_metadata:m.user_metadata};return a.value={user:A,isAuthenticated:!0,isLoading:!1},s.value={user:A,access_token:_.session.access_token,refresh_token:_.session.refresh_token},{success:!0,session:s.value}}return{success:!1,error:"No session returned"}}catch(_){return console.error("Sign up error:",_),a.value.isLoading=!1,{success:!1,error:_}}},u=async()=>{await z()};return e.onMounted(()=>{u()}),{authState:a,currentSession:s,isAuthenticated:n,currentUser:l,isLoading:g,loadUserInfo:z,logout:E,signIn:x,signUp:f,checkAuth:u}}const fe=Ie.defineStore("workspace",()=>{const a=e.ref(null),s=e.ref([]),n=e.ref(null),l=u=>{a.value=u,localStorage.setItem("current_workspace",JSON.stringify(u))},g=u=>{s.value=u,localStorage.setItem("available_workspaces",JSON.stringify(u))};return{currentWorkspace:a,workspaces:s,user:n,setCurrentWorkspace:l,setWorkspaces:g,setUser:u=>{n.value=u,localStorage.setItem("user_info",JSON.stringify(u))},loadPersistedData:()=>{const u=localStorage.getItem("current_workspace");if(u)try{a.value=JSON.parse(u)}catch(w){console.error("Error loading persisted workspace:",w)}const v=localStorage.getItem("available_workspaces");if(v)try{s.value=JSON.parse(v)}catch(w){console.error("Error loading persisted workspaces:",w)}const y=localStorage.getItem("user_info");if(y)try{n.value=JSON.parse(y)}catch(w){console.error("Error loading persisted user:",w)}},clearData:()=>{a.value=null,s.value=[],n.value=null,localStorage.removeItem("current_workspace"),localStorage.removeItem("available_workspaces"),localStorage.removeItem("user_info")},loadWorkspaces:async(u=!1)=>{try{const{data:{user:v}}=await V.auth.getUser();if(!v)return[];let y=V.from("workspaces").select(`
          id, title, description, parent_workspace_id, created_by, archived, created_at,
          workspace_access!inner ( access_type, shared_with_user_id ),
          workspace_activities!left ( updated_at )
        `).eq("workspace_access.shared_with_user_id",v.id);u||(y=y.eq("archived",!1));const{data:w,error:C}=await y;if(C)throw C;const I=new Map;(w||[]).forEach(c=>{(c.workspace_access||[]).forEach(m=>{m.shared_with_user_id===v.id&&I.set(c.id,m)})});const S=[...new Set((w||[]).filter(c=>c.parent_workspace_id).map(c=>c.parent_workspace_id).filter(c=>!I.has(c)))];let N=[];if(S.length){let c=V.from("workspaces").select("id, title, description, parent_workspace_id, created_by, archived, created_at").in("id",S);u||(c=c.eq("archived",!1));const{data:m,error:A}=await c;if(A)throw A;N=m||[]}const _=[...w||[],...N].map(c=>{var m,A,M;return{id:c.id,title:c.title,description:c.description||"No description",parent_workspace_id:c.parent_workspace_id,created_by:c.created_by,archived:c.archived,created_at:c.created_at,latest_activity:((A=(m=c.workspace_activities)==null?void 0:m[0])==null?void 0:A.updated_at)||c.created_at,hasAccess:I.has(c.id),accessType:((M=I.get(c.id))==null?void 0:M.access_type)||null}});return _.sort((c,m)=>new Date(m.latest_activity)-new Date(c.latest_activity)),g(_),_}catch(v){return console.error("loadWorkspaces error",v),[]}}}}),Le={class:"aiworkspace-header"},Be={key:0,class:"header-content header-loading"},Ue={key:1,class:"header-content header-fallback"},De={key:2,class:"header-content"},Me={class:"header-left"},Pe={class:"logo-section"},$e={href:"/",class:"logo"},Re=["src"],Te={key:1,class:"text-logo"},Oe={key:0,class:"header-center"},Je={class:"main-navigation"},ze={class:"nav-item"},Ye={href:"https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard",class:"nav-link"},He={class:"workspace-dropdown-item"},Fe=["href"],Ge={class:"workspace-icon"},qe={key:1,class:"nav-divider"},Ke={class:"nav-item"},Ze=["href","onClick"],Xe={class:"header-right"},je={class:"user-profile"},Qe={class:"user-info"},et={class:"user-name"},tt={class:"user-avatar"},at=["src","alt"],ot={key:1,class:"avatar-placeholder"},st={key:3,class:"unauth-message"},rt={class:"workspace-list"},nt=["onClick"],ct={class:"workspace-icon"},lt={class:"workspace-details"},it={class:"workspace-members"},ut={key:0,class:"current-indicator"},F=50,dt=e.defineComponent({__name:"AIWorkspaceHeader",props:{customLogo:{default:""},customLinks:{default:()=>[]},showUserMenu:{type:Boolean,default:!0},showWorkspaceSelector:{type:Boolean,default:!0},showSecondaryNavigation:{type:Boolean,default:!0},currentWorkspaceId:{},onProfileClick:{},onSettingsClick:{},onWorkspaceChange:{},onLogout:{},onLogin:{}},emits:["workspaceChange","logout","login","profileClick","settingsClick"],setup(a,{emit:s}){const n=a,l=s,{authState:g,logout:z}=me(),E=()=>{try{return fe()}catch{return console.warn("[AIWorkspaceHeader] Pinia not initialized yet, using fallback state"),null}},x=()=>{try{return typeof window<"u"?!!window.__PINIA__||!!window.Pinia:!1}catch{return!1}},f=e.ref(E()),u=e.computed(()=>!!f.value),v=e.ref(0),y=()=>{if(!f.value&&v.value<F){if(x()){const o=E();if(o){f.value=o,console.log("[AIWorkspaceHeader] Pinia store initialized successfully");return}}v.value++,setTimeout(y,100)}else v.value>=F&&console.warn("[AIWorkspaceHeader] Pinia initialization failed after maximum retries, using fallback mode")};e.onMounted(()=>{f.value||y()});const w=e.ref(!1),C=e.ref([]),I=e.ref([]),S=e.ref({name:"",email:"",avatar_url:null,initials:""}),N=e.ref([]),d=e.ref([]),_=e.ref(!1);e.watch(d,async o=>{o.length>0&&u.value&&$.value&&await M()},{immediate:!1}),e.watch(()=>window.location.pathname+window.location.search+window.location.hash,async()=>{u.value&&$.value&&await M()},{immediate:!1});const c=e.ref(window.location.pathname);e.watch(()=>window.location.pathname,o=>{c.value=o},{immediate:!0}),e.watch(u,o=>{!o&&v.value<F&&y()});const m=()=>{try{const o=window.location.pathname.match(/\/single-workspace\/(\d+)/);if(o)return o[1];const r=new URLSearchParams(window.location.search).get("workspace_id");if(r)return r;const p=window.location.hash.match(/workspace_id=(\d+)/);return p?p[1]:null}catch(o){return console.warn("[AIWorkspaceHeader] Error parsing URL for workspace_id:",o),null}},A=()=>{try{return window.location.pathname.includes("/all-workspace/")}catch(o){return console.warn("[AIWorkspaceHeader] Error checking all-workspace mode:",o),!1}},M=async()=>{if(!f.value||!u.value)return;const o=A();if(_.value=o,o){f.value.currentWorkspace=null,localStorage.removeItem("current_workspace"),console.log("[AIWorkspaceHeader] Auto-selected all-workspace mode from URL");return}const t=m();if(t)try{d.value.length===0&&await se();const r=d.value.find(p=>p.id.toString()===t);r?(f.value.setCurrentWorkspace(r),console.log(`[AIWorkspaceHeader] Auto-selected workspace from URL: ${r.title} (ID: ${r.id})`),l("workspaceChange",r)):console.warn(`[AIWorkspaceHeader] Workspace with ID ${t} not found in available workspaces`)}catch(r){console.error("[AIWorkspaceHeader] Error auto-selecting workspace from URL:",r)}},$=e.computed(()=>g.value.isAuthenticated),W=e.computed(()=>f.value?f.value.currentWorkspace:null),L=e.ref([{label:"Dashboard",key:"dashboard",url:"/dashboard"},{label:"Goals",key:"goals",url:"/goals"},{label:"Tasks",key:"tasks",url:"/tasks"},{label:"Events",key:"events",url:"/events"},{label:"Drive",key:"files",url:"/files"},{label:"Outlines",key:"outlines",url:"/outlines"},{label:"Communications",key:"communications",url:"/communications"},{label:"Canvas",key:"canvas",url:"/canvas"},{label:"AI Phone",key:"ai_phone",url:"/ai_phone"},{label:"AI Intake",key:"ai_intake",url:"/ai_intake"},{label:"AI Fax",key:"ai_fax",url:"/ai_fax"},{label:"AI Portfolios",key:"ai-portfolios",url:"/ai-portfolios"},{label:"AI Fund Analyst",key:"ai_fund_analyst",url:"/ai_fund_analyst"},{label:"Contacts",key:"contacts",url:"/contacts"},{label:"Settings",key:"settings",url:"/settings"}]),b=e.computed(()=>{try{const o=c.value;let t="";const r=o.match(/\/single-workspace\/\d+\/([^\/]+)/);if(r)t=r[1];else{const p=o.match(/\/([^\/]+)$/);p&&(t=p[1])}if(t){const p=L.value.find(k=>k.key===t||k.url.includes(`/${t}`)||k.url===`/${t}`);if(p)return p.label}return"Dashboard"}catch(o){return console.warn("[AIWorkspaceHeader] Error determining current section:",o),"Dashboard"}}),h=o=>{const t=new Map;o.forEach(k=>{t.set(k.id,{...k,children:[]})});const r=[];t.forEach(k=>{k.parent_workspace_id&&t.has(k.parent_workspace_id)?t.get(k.parent_workspace_id).children.push(k):r.push(k)});const p=k=>{k.sort((B,R)=>B.title.localeCompare(R.title)),k.forEach(B=>{B.children&&p(B.children)})};return p(r),r},P=(o,t=0,r=[])=>(o.forEach(p=>{r.push({...p,level:t}),p.children&&p.children.length&&P(p.children,t+1,r)}),r),se=async()=>{var o,t,r;try{const p=await((o=f.value)==null?void 0:o.loadWorkspaces());if(N.value=h(p||[]),d.value=P(N.value),I.value=d.value,C.value=d.value,n.currentWorkspaceId){const k=d.value.find(B=>{var R;return B.id.toString()===((R=n.currentWorkspaceId)==null?void 0:R.toString())});k&&((t=f.value)==null||t.setCurrentWorkspace(k))}else!W.value&&d.value.length&&((r=f.value)==null||r.setCurrentWorkspace(d.value[0]))}catch(p){console.error("loadWorkspaces (header) error",p)}},ve=o=>{if(console.log("Navigation command:",o),o==="all-workspace"){window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";return}else{const t=parseInt(o.replace("workspace-",""));window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t}/dashboard`;return}},ge=o=>{const t=W.value;switch(o.key){case"dashboard":t?window.location.href=`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${t.id}/dashboard`:window.location.href="https://all-ws-dashboard.aiworkspace.pro/all-workspace/dashboard";break;case"outlines":if(t){const r=`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`;window.location.href=r}else window.location.href="https://outline.aiworkspace.pro";break;case"canvas":if(t){const r=`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`;window.location.href=r}else window.location.href="https://canvas.aiworkspace.pro";break;case"files":if(t){const r=`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`;window.location.href=r}else window.location.href="https://drive.aiworkspace.pro";break;case"tasks":if(t){const r=`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`;window.location.href=r}else window.location.href="https://tasks.aiworkspace.pro";break;case"ai-portfolios":if(t){const r=`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`;window.location.href=r}else window.location.href="https://spreadsheet.aiworkspace.pro";break;default:if(t){const r=`https://app.aiworkspace.pro/single-workspace/${t.id}/${o.key}`;window.location.href=r}else{const r=`https://app.aiworkspace.pro/${o.key}`;window.location.href=r}break}},we=o=>{const t=W.value;switch(o.key){case"dashboard":return t?`/single-workspace/${t.id}/dashboard`:"/";case"ai-portfolios":return t?`https://spreadsheet.aiworkspace.pro/single-workspace/${t.id}/ai-portfolios`:"https://spreadsheet.aiworkspace.pro";case"outlines":return t?`https://outline.aiworkspace.pro/single-workspace/${t.id}/outlines`:"https://outline.aiworkspace.pro";case"canvas":return t?`https://canvas.aiworkspace.pro/single-workspace/${t.id}/canvas`:"https://canvas.aiworkspace.pro";case"files":return t?`https://drive.aiworkspace.pro/single-workspace/${t.id}/files`:"https://drive.aiworkspace.pro";case"tasks":return t?`https://tasks.aiworkspace.pro/single-workspace/${t.id}/tasks`:"https://tasks.aiworkspace.pro";default:return t?`https://app.aiworkspace.pro/single-workspace/${t.id}/${o.key}`:`https://app.aiworkspace.pro/${o.key}`}},q=o=>{switch(o){case"profile":n.onProfileClick?n.onProfileClick():Y.ElMessage.info("Profile settings coming soon");break;case"workspaces":w.value=!0;break;case"logout":Se();break}},re=o=>{var t;(t=f.value)==null||t.setCurrentWorkspace(o),w.value=!1,l("workspaceChange",o),Y.ElMessage.success(`Switched to ${o.title}`)},_e=()=>{Y.ElMessageBox.prompt("Enter workspace name:","Create New Workspace",{confirmButtonText:"Create",cancelButtonText:"Cancel",inputPattern:/\S/,inputErrorMessage:"Workspace name cannot be empty"}).then(({value:o})=>{var r;const t={id:Date.now(),title:o,description:"New workspace",archived:!1,created_by:"",created_at:new Date().toISOString(),latest_activity:new Date().toISOString(),hasAccess:!0,accessType:"edit"};C.value.push(t),(r=f.value)==null||r.setWorkspaces(C.value),re(t),Y.ElMessage.success(`Created workspace: ${o}`)}).catch(()=>{})},Se=()=>{Y.ElMessageBox.confirm("Are you sure you want to sign out?","Sign Out",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{var o;(o=f.value)==null||o.clearData(),await z(),l("logout"),Y.ElMessage.success("Signed out successfully")}).catch(()=>{})},ne=async()=>{var o,t;if(g.value.user){const r=g.value.user;S.value={name:r.name||((o=r.email)==null?void 0:o.split("@")[0])||"User",email:r.email||"",avatar_url:r.avatar_url||null,initials:(r.name||((t=r.email)==null?void 0:t.split("@")[0])||"U").split(" ").map(p=>p[0]).join("").toUpperCase().substring(0,2)},n.showWorkspaceSelector&&await se()}};e.watch(()=>g.value.user,o=>{var t;o?ne():(S.value={name:"",email:"",avatar_url:null,initials:""},(t=f.value)==null||t.clearData())}),e.watch(()=>n.currentWorkspaceId,o=>{var t;if(o&&d.value.length){const r=d.value.find(p=>p.id.toString()===o.toString());r&&((t=f.value)==null||t.setCurrentWorkspace(r))}}),e.onMounted(async()=>{$.value&&(await ne(),await M())});const ye=()=>{v.value=0,y(),Y.ElMessage.success("Manual Pinia retry initiated.")};return(o,t)=>{const r=e.resolveComponent("el-icon"),p=e.resolveComponent("el-tag"),k=e.resolveComponent("el-dropdown-item"),B=e.resolveComponent("el-dropdown-menu"),R=e.resolveComponent("el-dropdown"),ce=e.resolveComponent("el-button"),Ce=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("header",Le,[!u.value&&v.value<F?(e.openBlock(),e.createElementBlock("div",Be,[...t[6]||(t[6]=[e.createStaticVNode('<div class="header-left" data-v-97e080e1><div class="logo-section" data-v-97e080e1><a href="/" class="logo" data-v-97e080e1><div class="text-logo" data-v-97e080e1><span class="logo-text" data-v-97e080e1>AI Workspace</span></div></a></div></div><div class="header-center" data-v-97e080e1><span class="loading-text" data-v-97e080e1>Initializing...</span></div>',2)])])):!u.value&&v.value>=F?(e.openBlock(),e.createElementBlock("div",Ue,[t[8]||(t[8]=e.createStaticVNode('<div class="header-left" data-v-97e080e1><div class="logo-section" data-v-97e080e1><a href="/" class="logo" data-v-97e080e1><div class="text-logo" data-v-97e080e1><span class="logo-text" data-v-97e080e1>AI Workspace</span></div></a></div></div>',1)),e.createElementVNode("div",{class:"header-center"},[t[7]||(t[7]=e.createElementVNode("span",{class:"fallback-text"},"Header Ready (Fallback Mode)",-1)),e.createElementVNode("button",{onClick:ye,class:"retry-button"},"Retry Pinia")]),t[9]||(t[9]=e.createStaticVNode('<div class="header-right" data-v-97e080e1><div class="user-profile" data-v-97e080e1><div class="user-info" data-v-97e080e1><span class="user-name" data-v-97e080e1>User</span></div><div class="user-avatar" data-v-97e080e1><span class="avatar-placeholder" data-v-97e080e1>U</span></div></div></div>',1))])):$.value?(e.openBlock(),e.createElementBlock("div",De,[e.createElementVNode("div",Me,[e.createElementVNode("div",Pe,[e.createElementVNode("a",$e,[o.customLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:o.customLogo,alt:"AIWorkspace",class:"logo-image"},null,8,Re)):(e.openBlock(),e.createElementBlock("div",Te,[...t[10]||(t[10]=[e.createElementVNode("span",{class:"logo-text"},"AI Workspace",-1)])]))])])]),o.showSecondaryNavigation?(e.openBlock(),e.createElementBlock("div",Oe,[e.createElementVNode("nav",Je,[o.showWorkspaceSelector?(e.openBlock(),e.createBlock(R,{key:0,onCommand:ve,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(B,{class:"workspace-tree-dropdown"},{default:e.withCtx(()=>[e.createVNode(k,{command:"all-workspace",class:e.normalizeClass({active:_.value})},{default:e.withCtx(()=>[e.createElementVNode("a",Ye,[e.createElementVNode("div",He,[t[12]||(t[12]=e.createElementVNode("span",{class:"workspace-icon"},"🌐",-1)),t[13]||(t[13]=e.createElementVNode("span",null,"All workspace",-1)),_.value?(e.openBlock(),e.createBlock(p,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)])])]),_:1},8,["class"]),d.value.length>0?(e.openBlock(),e.createBlock(k,{key:0,divided:"",disabled:""})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,i=>(e.openBlock(),e.createBlock(k,{key:i.id,command:`workspace-${i.id}`},{default:e.withCtx(()=>{var H;return[e.createElementVNode("a",{href:`https://single-ws-dashboard.aiworkspace.pro/single-workspace/${i.id}/dashboard`,class:"nav-link"},[e.createElementVNode("div",{class:"workspace-dropdown-item",style:e.normalizeStyle({paddingLeft:(i.level||0)*16+"px"})},[e.createElementVNode("span",Ge,e.toDisplayString(i.children&&i.children.length?"📁":"📄"),1),e.createElementVNode("span",null,e.toDisplayString(i.title),1),i.id===((H=W.value)==null?void 0:H.id)?(e.openBlock(),e.createBlock(p,{key:0,size:"small",type:"success"},{default:e.withCtx(()=>[...t[14]||(t[14]=[e.createTextVNode("Current",-1)])]),_:1})):e.createCommentVNode("",!0)],4)],8,Fe)]}),_:2},1032,["command"]))),128)),d.value.length===0?(e.openBlock(),e.createBlock(k,{key:1,disabled:""},{default:e.withCtx(()=>[...t[15]||(t[15]=[e.createTextVNode(" No workspaces ",-1)])]),_:1})):e.createCommentVNode("",!0)]),_:1})]),default:e.withCtx(()=>{var i;return[e.createElementVNode("span",ze,[e.createTextVNode(e.toDisplayString(_.value?"All workspace":((i=W.value)==null?void 0:i.title)||"Select Workspace")+" ",1),e.createVNode(r,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(ie))]),_:1})])]}),_:1})):e.createCommentVNode("",!0),o.showWorkspaceSelector?(e.openBlock(),e.createElementBlock("span",qe,"/")):e.createCommentVNode("",!0),o.showSecondaryNavigation?(e.openBlock(),e.createBlock(R,{key:2,trigger:"hover"},{dropdown:e.withCtx(()=>[e.createVNode(B,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(L.value,i=>(e.openBlock(),e.createBlock(k,{key:i.label,class:e.normalizeClass({active:i.active})},{default:e.withCtx(()=>[e.createElementVNode("a",{href:we(i),class:"nav-link",onClick:e.withModifiers(H=>ge(i),["prevent"])},e.toDisplayString(i.label),9,Ze)]),_:2},1032,["class"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",Ke,[e.createTextVNode(e.toDisplayString(b.value)+" ",1),e.createVNode(r,{class:"nav-arrow"},{default:e.withCtx(()=>[e.createVNode(e.unref(ie))]),_:1})])]),_:1})):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Xe,[e.createVNode(R,{onCommand:q,trigger:"click",placement:"bottom-end"},{dropdown:e.withCtx(()=>[e.createVNode(B,null,{default:e.withCtx(()=>[e.createVNode(k,null,{default:e.withCtx(()=>[e.createElementVNode("a",{href:"/profile",class:"nav-link",onClick:t[0]||(t[0]=e.withModifiers(i=>q("profile"),["prevent"]))},"Profile Settings")]),_:1}),o.showWorkspaceSelector?(e.openBlock(),e.createBlock(k,{key:0},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#switch-workspace",class:"nav-link",onClick:t[1]||(t[1]=e.withModifiers(i=>q("workspaces"),["prevent"]))},"Switch Workspace")]),_:1})):e.createCommentVNode("",!0),e.createVNode(k,{divided:""},{default:e.withCtx(()=>[e.createElementVNode("a",{href:"#signout",class:"nav-link",onClick:t[2]||(t[2]=e.withModifiers(i=>q("logout"),["prevent"]))},"Sign Out")]),_:1})]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",je,[e.createElementVNode("div",Qe,[e.createElementVNode("span",et,e.toDisplayString(S.value.name),1)]),e.createElementVNode("div",tt,[S.value.avatar_url?(e.openBlock(),e.createElementBlock("img",{key:0,src:S.value.avatar_url,alt:S.value.name},null,8,at)):(e.openBlock(),e.createElementBlock("span",ot,e.toDisplayString(S.value.initials),1))])])]),_:1})])])):(e.openBlock(),e.createElementBlock("div",st,[...t[16]||(t[16]=[e.createElementVNode("div",{class:"unauth-inner"},[e.createElementVNode("strong",null,"Authentication required."),e.createTextVNode(" Please log in to access the workspace. ")],-1)])])),$.value&&o.showWorkspaceSelector?(e.openBlock(),e.createBlock(Ce,{key:4,modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=i=>w.value=i),title:"Switch Workspace",width:"500px",onClose:t[5]||(t[5]=i=>w.value=!1)},{footer:e.withCtx(()=>[e.createVNode(ce,{onClick:t[3]||(t[3]=i=>w.value=!1)},{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("Cancel",-1)])]),_:1}),e.createVNode(ce,{type:"primary",onClick:_e},{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("Create New Workspace",-1)])]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",rt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.value,i=>{var H,le;return e.openBlock(),e.createElementBlock("div",{key:i.id,class:e.normalizeClass(["workspace-item",{active:i.id===((H=W.value)==null?void 0:H.id)}]),onClick:mt=>re(i)},[e.createElementVNode("div",ct,e.toDisplayString(i.children&&i.children.length?"📁":"📄"),1),e.createElementVNode("div",lt,[e.createElementVNode("h3",null,e.toDisplayString(i.title),1),e.createElementVNode("p",null,e.toDisplayString(i.description),1),e.createElementVNode("span",it,e.toDisplayString(i.hasAccess?"Active":"Inactive"),1)]),i.id===((le=W.value)==null?void 0:le.id)?(e.openBlock(),e.createElementBlock("div",ut,[e.createVNode(r,null,{default:e.withCtx(()=>[e.createVNode(e.unref(Ae))]),_:1})])):e.createCommentVNode("",!0)],10,nt)}),128))])]),_:1},8,["modelValue"])):e.createCommentVNode("",!0)])}}});const pt=(a,s)=>{const n=a.__vccOpts||a;for(const[l,g]of s)n[l]=g;return n},ht=pt(dt,[["__scopeId","data-v-97e080e1"]]),ue="aiworkspace_auth",de="aiworkspace_user_id";function kt(){const a=e.ref({user:null,isAuthenticated:!1,isLoading:!0}),s=E=>{var u;const f=`; ${document.cookie}`.split(`; ${E}=`);return f.length===2&&((u=f.pop())==null?void 0:u.split(";").shift())||null},n=(E,x,f=7)=>{const u=new Date;u.setTime(u.getTime()+f*24*60*60*1e3),document.cookie=`${E}=${x};expires=${u.toUTCString()};path=/;domain=.aiworkspace.pro`},l=E=>{document.cookie=`${E}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.aiworkspace.pro`},g=async()=>{try{const E=s(ue),x=s(de);E&&x?a.value={user:{id:x,email:""},isAuthenticated:!0,isLoading:!1}:a.value={user:null,isAuthenticated:!1,isLoading:!1}}catch(E){console.error("Auth check failed:",E),a.value={user:null,isAuthenticated:!1,isLoading:!1}}},z=()=>{l(ue),l(de),a.value={user:null,isAuthenticated:!1,isLoading:!1}};return e.onMounted(()=>{g()}),{authState:a,checkAuth:g,logout:z,getCookie:s,setCookie:n,clearCookie:l}}exports.ACCESS_COOKIE=U;exports.AIWorkspaceHeader=ht;exports.LS_ACCESS_KEY=ee;exports.LS_REFRESH_KEY=te;exports.REFRESH_COOKIE=D;exports.buildOAuthRedirectUrl=Ve;exports.clearLocalStorageTokens=he;exports.clearSessionCookie=X;exports.ensureCrossSubdomainCookies=Q;exports.getCookie=J;exports.getPostLoginBase=xe;exports.restoreCrossSubdomainSession=We;exports.restoreSessionWithRetry=j;exports.setSessionCookie=T;exports.setupAuthStateListener=ke;exports.supabase=V;exports.syncCookiesToLocalStorage=G;exports.useAuth=kt;exports.useEnhancedAuth=me;exports.useWorkspaceStore=fe;
