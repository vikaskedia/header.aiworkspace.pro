"use strict";const l=require("@supabase/supabase-js"),e=require("./utils/authRedirect.js");async function S(){try{e.ensureCrossSubdomainCookies([e.ACCESS_COOKIE,e.REFRESH_COOKIE]);const s=e.getCookie(e.ACCESS_COOKIE),o=e.getCookie(e.REFRESH_COOKIE);if(s&&o){const{data:{session:a}}=await t.auth.getSession();if(!a){const{data:n,error:r}=await t.auth.setSession({access_token:s,refresh_token:o});r?console.log("[auth][restore] error",r):console.log("[auth][restore] done",!!n.session)}}else console.log("[auth][restore] no cookies present");e.syncCookiesToLocalStorage()}catch(s){console.log("[auth][restore] exception",s)}}function u(){console.log("[auth][listener] Setting up auth state listener..."),t.auth.onAuthStateChange(async(s,o)=>{switch(console.log("[auth][listener] Auth state changed:",s,!!o),s){case"TOKEN_REFRESHED":console.log("[auth][listener] Token refreshed successfully"),o&&(e.setSessionCookie(e.ACCESS_COOKIE,o.access_token,60*60*24*365),e.setSessionCookie(e.REFRESH_COOKIE,o.refresh_token,60*60*24*365),e.syncCookiesToLocalStorage());break;case"SIGNED_IN":console.log("[auth][listener] User signed in"),o&&(e.setSessionCookie(e.ACCESS_COOKIE,o.access_token,60*60*24*365),e.setSessionCookie(e.REFRESH_COOKIE,o.refresh_token,60*60*24*365),e.syncCookiesToLocalStorage());break;case"SIGNED_OUT":console.log("[auth][listener] User signed out");break;case"USER_UPDATED":console.log("[auth][listener] User updated");break;default:console.log("[auth][listener] Unhandled auth event:",s)}})}async function h(){try{const{data:{session:s}}=await t.auth.getSession();if(s&&s.user)return console.log("[auth][restore] Active session found"),{success:!0,session:s};const o=e.getCookie(e.ACCESS_COOKIE),a=e.getCookie(e.REFRESH_COOKIE);if(o&&a){console.log("[auth][restore] Attempting to restore session from cookies...");const{data:n,error:r}=await t.auth.setSession({access_token:o,refresh_token:a});if(r)return console.log("[auth][restore] Failed to restore session:",r.message),{success:!1,error:r};if(n.session)return console.log("[auth][restore] Session restored successfully"),e.setSessionCookie(e.ACCESS_COOKIE,n.session.access_token,60*60*24*365),e.setSessionCookie(e.REFRESH_COOKIE,n.session.refresh_token,60*60*24*365),e.syncCookiesToLocalStorage(),{success:!0,session:n.session}}return console.log("[auth][restore] No valid session or cookies found"),{success:!1,error:"No valid session or cookies"}}catch(s){return console.log("[auth][restore] Exception during session restoration:",s),{success:!1,error:s}}}const i="https://oqdnbpmmgntqtigstaow.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZG5icG1tZ250cXRpZ3N0YW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0NTk2NDYsImV4cCI6MjA1MDAzNTY0Nn0.rn0nRY9xLgLt-ajiSPeG0PcdS9V-549C1yeqhcxxG40",t=l.createClient(i,c,{db:{schema:"public"},auth:{storageKey:"sb-auth-token",storage:localStorage,autoRefreshToken:!0,persistSession:!0,cookieOptions:{domain:window.location.hostname==="localhost"?"localhost":".aiworkspace.pro",path:"/",sameSite:"Lax",secure:window.location.protocol==="https:",maxAge:365*24*60*60}}});typeof window<"u"&&(e.ensureCrossSubdomainCookies([e.ACCESS_COOKIE,e.REFRESH_COOKIE]),u());console.log("Supabase Configuration:",{url:i,hasKey:!!c,autoRefreshToken:!0,persistSession:!0});console.log("URL:",i.replace(/https:\/\/(.+)\.supabase\.co/,"https://*****.supabase.co"));console.log("Key configured:",!c.includes("your-anon-key"));console.log("Environment mode:","production");const C=Object.freeze(Object.defineProperty({__proto__:null,supabase:t},Symbol.toStringTag,{value:"Module"}));exports.restoreCrossSubdomainSession=S;exports.restoreSessionWithRetry=h;exports.setupAuthStateListener=u;exports.supabase=t;exports.supabase$1=C;
